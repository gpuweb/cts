{"version":3,"file":"print_environment.spec.js","names":["description","getResourcePath","globalTestConfig","makeTestGroup","getDefaultRequestAdapterOptions","GPUTest","g","consoleLogIfNotWPT","x","globalThis","cons","console","log","test","desc","fn","t","defaultDeviceProperties","Object","fromEntries","device","key","includes","info","JSON","stringify","userAgent","navigator","globalScope","getPrototypeOf","constructor","name","baseResourcePath","defaultRequestAdapterOptions","adapter","defaultDevice","_key","value","undefined","Array","Symbol","iterator","from","valueObj"],"sources":["../../src/webgpu/print_environment.spec.ts"],"sourcesContent":["export const description = `\n\nExamples of writing CTS tests with various features.\n\nStart here when looking for examples of basic framework usage.\n`;\n\nimport { getResourcePath } from '../common/framework/resources.js';\nimport { globalTestConfig } from '../common/framework/test_config.js';\nimport { makeTestGroup } from '../common/framework/test_group.js';\nimport { getDefaultRequestAdapterOptions } from '../common/util/navigator_gpu.js';\n\nimport { GPUTest } from './gpu_test.js';\n\nexport const g = makeTestGroup(GPUTest);\n\n/** console.log is disallowed by WPT. Work around it when we're not in WPT. */\nfunction consoleLogIfNotWPT(x: unknown) {\n  if (!('step_timeout' in globalThis)) {\n    const cons = console;\n    cons.log(x);\n  }\n}\n\ng.test('info')\n  .desc(\n    `Test which prints what global scope (e.g. worker type) it's running in, and info about\nthe adapter and device that it gets.\n\nNote, other tests should not check the global scope type to detect features; instead, they should\ncheck for the presence of the feature they need (like HTMLCanvasElement) and skip if not available.\n\nRun this test under various configurations to see different results\n(Window, worker scopes, Node, etc.)\n\nNOTE: If your test runtime elides logs when tests pass, you won't see the prints from this test\nin the logs. On non-WPT runtimes, it will also print to the console with console.log.\nWPT disallows console.log and doesn't support logs on passing tests, so this does nothing on WPT.`\n  )\n  .fn(t => {\n    // `t.device` will be the default device, because no additional capabilities were requested.\n    const defaultDeviceProperties = Object.fromEntries(\n      (function* () {\n        const device = t.device as unknown as Record<string, unknown>;\n        for (const key in device) {\n          // Skip things that we don't want to JSON.stringify.\n          if (['lost', 'queue', 'onuncapturederror', 'label'].includes(key)) {\n            continue;\n          }\n          yield [key, device[key]];\n        }\n      })()\n    );\n\n    const info = JSON.stringify(\n      {\n        userAgent: globalThis.navigator?.userAgent,\n        globalScope: Object.getPrototypeOf(globalThis).constructor.name,\n        globalTestConfig,\n        baseResourcePath: getResourcePath(''),\n        defaultRequestAdapterOptions: getDefaultRequestAdapterOptions(),\n        // Print all of the properties of the adapter and defaultDeviceProperties. JSON.stringify\n        // will skip methods (e.g. adapter.requestDevice), because they're not stringifiable.\n        adapter: t.adapter,\n        defaultDevice: defaultDeviceProperties,\n      },\n      // - Replace `undefined` with `null`.\n      // - Expand iterable things into arrays.\n      // - Flatten objects with prototype chains into plain objects, using `for..in`. (Otherwise,\n      //   properties from the prototype chain will be ignored and things will print as `{}`.)\n      (_key, value) => {\n        if (value === undefined || value === null) return null;\n        if (typeof value !== 'object') return value;\n        if (value instanceof Array) return value;\n        if (Symbol.iterator in value) return Array.from(value as Iterable<unknown>);\n\n        const valueObj = value as Record<string, unknown>;\n        return Object.fromEntries(\n          (function* () {\n            for (const key in valueObj) {\n              yield [key, valueObj[key]];\n            }\n          })()\n        );\n      },\n      2\n    );\n\n    t.info(info);\n    consoleLogIfNotWPT(info);\n  });\n"],"mappings":";;GAAA,OAAO,MAAMA,WAAW,GAAI;AAC5B;AACA;AACA;AACA;AACA,CAAC,CAED,SAASC,eAAe,QAAQ,kCAAkC;AAClE,SAASC,gBAAgB,QAAQ,oCAAoC;AACrE,SAASC,aAAa,QAAQ,mCAAmC;AACjE,SAASC,+BAA+B,QAAQ,iCAAiC;;AAEjF,SAASC,OAAO,QAAQ,eAAe;;AAEvC,OAAO,MAAMC,CAAC,GAAGH,aAAa,CAACE,OAAO,CAAC;;AAEvC;AACA,SAASE,kBAAkBA,CAACC,CAAU,EAAE;EACtC,IAAI,EAAE,cAAc,IAAIC,UAAU,CAAC,EAAE;IACnC,MAAMC,IAAI,GAAGC,OAAO;IACpBD,IAAI,CAACE,GAAG,CAACJ,CAAC,CAAC;EACb;AACF;;AAEAF,CAAC,CAACO,IAAI,CAAC,MAAM,CAAC;AACXC,IAAI;EACF;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACE,CAAC;AACAC,EAAE,CAAC,CAAAC,CAAC,KAAI;EACP;EACA,MAAMC,uBAAuB,GAAGC,MAAM,CAACC,WAAW;IAC/C,aAAa;MACZ,MAAMC,MAAM,GAAGJ,CAAC,CAACI,MAA4C;MAC7D,KAAK,MAAMC,GAAG,IAAID,MAAM,EAAE;QACxB;QACA,IAAI,CAAC,MAAM,EAAE,OAAO,EAAE,mBAAmB,EAAE,OAAO,CAAC,CAACE,QAAQ,CAACD,GAAG,CAAC,EAAE;UACjE;QACF;QACA,MAAM,CAACA,GAAG,EAAED,MAAM,CAACC,GAAG,CAAC,CAAC;MAC1B;IACF,CAAC,CAAE;EACL,CAAC;;EAED,MAAME,IAAI,GAAGC,IAAI,CAACC,SAAS;IACzB;MACEC,SAAS,EAAEjB,UAAU,CAACkB,SAAS,EAAED,SAAS;MAC1CE,WAAW,EAAEV,MAAM,CAACW,cAAc,CAACpB,UAAU,CAAC,CAACqB,WAAW,CAACC,IAAI;MAC/D7B,gBAAgB;MAChB8B,gBAAgB,EAAE/B,eAAe,CAAC,EAAE,CAAC;MACrCgC,4BAA4B,EAAE7B,+BAA+B,CAAC,CAAC;MAC/D;MACA;MACA8B,OAAO,EAAElB,CAAC,CAACkB,OAAO;MAClBC,aAAa,EAAElB;IACjB,CAAC;IACD;IACA;IACA;IACA;IACA,CAACmB,IAAI,EAAEC,KAAK,KAAK;MACf,IAAIA,KAAK,KAAKC,SAAS,IAAID,KAAK,KAAK,IAAI,EAAE,OAAO,IAAI;MACtD,IAAI,OAAOA,KAAK,KAAK,QAAQ,EAAE,OAAOA,KAAK;MAC3C,IAAIA,KAAK,YAAYE,KAAK,EAAE,OAAOF,KAAK;MACxC,IAAIG,MAAM,CAACC,QAAQ,IAAIJ,KAAK,EAAE,OAAOE,KAAK,CAACG,IAAI,CAACL,KAA0B,CAAC;;MAE3E,MAAMM,QAAQ,GAAGN,KAAgC;MACjD,OAAOnB,MAAM,CAACC,WAAW;QACtB,aAAa;UACZ,KAAK,MAAME,GAAG,IAAIsB,QAAQ,EAAE;YAC1B,MAAM,CAACtB,GAAG,EAAEsB,QAAQ,CAACtB,GAAG,CAAC,CAAC;UAC5B;QACF,CAAC,CAAE;MACL,CAAC;IACH,CAAC;IACD;EACF,CAAC;;EAEDL,CAAC,CAACO,IAAI,CAACA,IAAI,CAAC;EACZhB,kBAAkB,CAACgB,IAAI,CAAC;AAC1B,CAAC,CAAC"}