{"version":3,"file":"texel_data.spec.js","names":["description","makeTestGroup","assert","kEncodableTextureFormats","kTextureFormatInfo","GPUTest","gammaCompress","floatAsNormalizedIntegerUnquantized","kTexelRepresentationInfo","getSingleDataType","getComponentReadbackTraits","g","doTest","t","format","params","componentData","rep","texelData","pack","texture","device","createTexture","size","usage","GPUTextureUsage","COPY_DST","TEXTURE_BINDING","queue","writeTexture","bytesPerRow","byteLength","ReadbackTypedArray","shaderType","shader","componentOrder","map","C","join","toLowerCase","pipeline","createComputePipeline","layout","compute","module","createShaderModule","code","entryPoint","outputBuffer","createBuffer","length","GPUBufferUsage","STORAGE","COPY_SRC","bindGroup","createBindGroup","getBindGroupLayout","entries","binding","resource","createView","buffer","encoder","createCommandEncoder","pass","beginComputePass","setPipeline","setBindGroup","dispatchWorkgroups","end","submit","finish","idealReadbackData","c","value","decode","undefined","readBackValue","readGPUBufferRangeTyped","type","Float32Array","typedLength","expect","data","readBackValueToSRGB","Array","i","gammaCompressed","outputIndex","cleanup","check8UnormSRGB","inputValue","idealValue","kToleranceULP","Math","abs","R","G","B","expectGPUBufferValuesEqual","makeParam","fn","componentInfo","bitLength","A","test","u","combine","filter","info","color","copyDst","beginSubcases","expand","max","pow","floor","offset","beforeAllSubcases","skipIfTextureFormatNotSupported","range","desc"],"sources":["../../../../src/webgpu/util/texture/texel_data.spec.ts"],"sourcesContent":["export const description = 'Test helpers for texel data produce the expected data in the shader';\n\nimport { makeTestGroup } from '../../../common/framework/test_group.js';\nimport { assert } from '../../../common/util/util.js';\nimport {\n  kEncodableTextureFormats,\n  kTextureFormatInfo,\n  EncodableTextureFormat,\n} from '../../format_info.js';\nimport { GPUTest } from '../../gpu_test.js';\nimport { gammaCompress, floatAsNormalizedIntegerUnquantized } from '../conversion.js';\n\nimport {\n  kTexelRepresentationInfo,\n  getSingleDataType,\n  getComponentReadbackTraits,\n} from './texel_data.js';\n\nexport const g = makeTestGroup(GPUTest);\n\nasync function doTest(\n  t: GPUTest & {\n    params: {\n      format: EncodableTextureFormat;\n      componentData: {\n        R?: number;\n        G?: number;\n        B?: number;\n        A?: number;\n      };\n    };\n  }\n) {\n  const { format } = t.params;\n  const componentData = t.params.componentData;\n\n  const rep = kTexelRepresentationInfo[format];\n  const texelData = rep.pack(componentData);\n  const texture = t.device.createTexture({\n    format,\n    size: [1, 1, 1],\n    usage: GPUTextureUsage.COPY_DST | GPUTextureUsage.TEXTURE_BINDING,\n  });\n\n  t.device.queue.writeTexture(\n    { texture },\n    texelData,\n    {\n      bytesPerRow: texelData.byteLength,\n    },\n    [1]\n  );\n\n  const { ReadbackTypedArray, shaderType } = getComponentReadbackTraits(getSingleDataType(format));\n\n  const shader = `\n  @group(0) @binding(0) var tex : texture_2d<${shaderType}>;\n\n  struct Output {\n    ${rep.componentOrder.map(C => `result${C} : ${shaderType},`).join('\\n')}\n  };\n  @group(0) @binding(1) var<storage, read_write> output : Output;\n\n  @compute @workgroup_size(1)\n  fn main() {\n      var texel : vec4<${shaderType}> = textureLoad(tex, vec2<i32>(0, 0), 0);\n      ${rep.componentOrder.map(C => `output.result${C} = texel.${C.toLowerCase()};`).join('\\n')}\n      return;\n  }`;\n\n  const pipeline = t.device.createComputePipeline({\n    layout: 'auto',\n    compute: {\n      module: t.device.createShaderModule({\n        code: shader,\n      }),\n      entryPoint: 'main',\n    },\n  });\n\n  const outputBuffer = t.device.createBuffer({\n    size: rep.componentOrder.length * 4,\n    usage: GPUBufferUsage.STORAGE | GPUBufferUsage.COPY_SRC,\n  });\n\n  const bindGroup = t.device.createBindGroup({\n    layout: pipeline.getBindGroupLayout(0),\n    entries: [\n      {\n        binding: 0,\n        resource: texture.createView(),\n      },\n      {\n        binding: 1,\n        resource: {\n          buffer: outputBuffer,\n        },\n      },\n    ],\n  });\n\n  const encoder = t.device.createCommandEncoder();\n  const pass = encoder.beginComputePass();\n  pass.setPipeline(pipeline);\n  pass.setBindGroup(0, bindGroup);\n  pass.dispatchWorkgroups(1);\n  pass.end();\n  t.device.queue.submit([encoder.finish()]);\n\n  const idealReadbackData = new ReadbackTypedArray(\n    rep.componentOrder.map(c => {\n      const value = rep.decode(componentData)[c];\n      assert(value !== undefined);\n      return value;\n    })\n  );\n\n  if (format === 'rgba8unorm-srgb' || format === 'bgra8unorm-srgb') {\n    // The SRGB -> float conversion is permitted a tolerance of 0.5f ULP on the SRGB side. The\n    // procedure for measuring this tolerance is to convert the result back into SRGB space\n    // using the ideal float -> SRGB conversion specified below but WITHOUT the rounding to integer,\n    // and taking the floating point difference versus the original SRGB value to yield the error.\n    // Exact conversion is required: 0.0f and 1.0f (the ends) must be exactly achievable.\n    const readBackValue = await t.readGPUBufferRangeTyped(outputBuffer, {\n      type: Float32Array,\n      typedLength: 4,\n    });\n    // Gamma correction shouldn't be applied to the alpha channel.\n    t.expect(idealReadbackData[3] === readBackValue.data[3]);\n\n    // Do the ideal float -> 8unorm-srgb conversion on the readback float value without the rounding\n    // to integer.\n    const readBackValueToSRGB = new Array(3);\n    for (let i = 0; i < 3; ++i) {\n      const gammaCompressed = gammaCompress(readBackValue.data[i]);\n      let outputIndex = i;\n      if (format === 'bgra8unorm-srgb' && (i === 0 || i === 2)) {\n        outputIndex = 2 - i;\n      }\n      readBackValueToSRGB[outputIndex] = floatAsNormalizedIntegerUnquantized(\n        gammaCompressed,\n        8,\n        false\n      );\n    }\n    readBackValue.cleanup();\n\n    // Take the floating point difference versus the original SRGB value to yield the error.\n    const check8UnormSRGB = (inputValue: number, idealValue: number) => {\n      const kToleranceULP = 0.5;\n      if (idealValue === 0 || idealValue === 255) {\n        t.expect(inputValue === idealValue);\n      } else {\n        t.expect(Math.abs(inputValue - idealValue) <= kToleranceULP);\n      }\n    };\n\n    assert(\n      componentData.R !== undefined &&\n        componentData.G !== undefined &&\n        componentData.B !== undefined\n    );\n    check8UnormSRGB(readBackValueToSRGB[0], componentData.R);\n    check8UnormSRGB(readBackValueToSRGB[1], componentData.G);\n    check8UnormSRGB(readBackValueToSRGB[2], componentData.B);\n  } else {\n    t.expectGPUBufferValuesEqual(outputBuffer, idealReadbackData);\n  }\n}\n\n// Make a test parameter by mapping a format and each component to a texel component\n// data value.\nfunction makeParam(\n  format: EncodableTextureFormat,\n  fn: (bitLength: number, index: number) => number\n) {\n  const rep = kTexelRepresentationInfo[format];\n  return {\n    R: rep.componentInfo.R ? fn(rep.componentInfo.R.bitLength, 0) : undefined,\n    G: rep.componentInfo.G ? fn(rep.componentInfo.G.bitLength, 1) : undefined,\n    B: rep.componentInfo.B ? fn(rep.componentInfo.B.bitLength, 2) : undefined,\n    A: rep.componentInfo.A ? fn(rep.componentInfo.A.bitLength, 3) : undefined,\n  };\n}\n\ng.test('unorm_texel_data_in_shader')\n  .params(u =>\n    u\n      .combine('format', kEncodableTextureFormats)\n      .filter(({ format }) => {\n        const info = kTextureFormatInfo[format];\n        return !!info.color && info.color.copyDst && getSingleDataType(format) === 'unorm';\n      })\n      .beginSubcases()\n      .expand('componentData', ({ format }) => {\n        const max = (bitLength: number) => Math.pow(2, bitLength) - 1;\n        return [\n          // Test extrema\n          makeParam(format, () => 0),\n          makeParam(format, bitLength => max(bitLength)),\n\n          // Test a middle value\n          makeParam(format, bitLength => Math.floor(max(bitLength) / 2)),\n\n          // Test mixed values\n          makeParam(format, (bitLength, i) => {\n            const offset = [0.13, 0.63, 0.42, 0.89];\n            return Math.floor(offset[i] * max(bitLength));\n          }),\n        ];\n      })\n  )\n  .beforeAllSubcases(t => {\n    t.skipIfTextureFormatNotSupported(t.params.format);\n  })\n  .fn(doTest);\n\ng.test('snorm_texel_data_in_shader')\n  .params(u =>\n    u\n      .combine('format', kEncodableTextureFormats)\n      .filter(({ format }) => {\n        const info = kTextureFormatInfo[format];\n        return !!info.color && info.color.copyDst && getSingleDataType(format) === 'snorm';\n      })\n      .beginSubcases()\n      .expand('componentData', ({ format }) => {\n        const max = (bitLength: number) => Math.pow(2, bitLength - 1) - 1;\n        return [\n          // Test extrema\n          makeParam(format, () => 0),\n          makeParam(format, bitLength => max(bitLength)),\n          makeParam(format, bitLength => -max(bitLength)),\n          makeParam(format, bitLength => -max(bitLength) - 1),\n\n          // Test a middle value\n          makeParam(format, bitLength => Math.floor(max(bitLength) / 2)),\n\n          // Test mixed values\n          makeParam(format, (bitLength, i) => {\n            const offset = [0.13, 0.63, 0.42, 0.89];\n            const range = 2 * max(bitLength);\n            return -max(bitLength) + Math.floor(offset[i] * range);\n          }),\n        ];\n      })\n  )\n  .fn(doTest);\n\ng.test('uint_texel_data_in_shader')\n  .params(u =>\n    u\n      .combine('format', kEncodableTextureFormats)\n      .filter(({ format }) => {\n        const info = kTextureFormatInfo[format];\n        return !!info.color && info.color.copyDst && getSingleDataType(format) === 'uint';\n      })\n      .beginSubcases()\n      .expand('componentData', ({ format }) => {\n        const max = (bitLength: number) => Math.pow(2, bitLength) - 1;\n        return [\n          // Test extrema\n          makeParam(format, () => 0),\n          makeParam(format, bitLength => max(bitLength)),\n\n          // Test a middle value\n          makeParam(format, bitLength => Math.floor(max(bitLength) / 2)),\n\n          // Test mixed values\n          makeParam(format, (bitLength, i) => {\n            const offset = [0.13, 0.63, 0.42, 0.89];\n            return Math.floor(offset[i] * max(bitLength));\n          }),\n        ];\n      })\n  )\n  .fn(doTest);\n\ng.test('sint_texel_data_in_shader')\n  .params(u =>\n    u\n      .combine('format', kEncodableTextureFormats)\n      .filter(({ format }) => {\n        const info = kTextureFormatInfo[format];\n        return !!info.color && info.color.copyDst && getSingleDataType(format) === 'sint';\n      })\n      .beginSubcases()\n      .expand('componentData', ({ format }) => {\n        const max = (bitLength: number) => Math.pow(2, bitLength - 1) - 1;\n        return [\n          // Test extrema\n          makeParam(format, () => 0),\n          makeParam(format, bitLength => max(bitLength)),\n          makeParam(format, bitLength => -max(bitLength) - 1),\n\n          // Test a middle value\n          makeParam(format, bitLength => Math.floor(max(bitLength) / 2)),\n\n          // Test mixed values\n          makeParam(format, (bitLength, i) => {\n            const offset = [0.13, 0.63, 0.42, 0.89];\n            const range = 2 * max(bitLength);\n            return -max(bitLength) + Math.floor(offset[i] * range);\n          }),\n        ];\n      })\n  )\n  .fn(doTest);\n\ng.test('float_texel_data_in_shader')\n  .desc(\n    `\nTODO: Test NaN, Infinity, -Infinity [1]`\n  )\n  .params(u =>\n    u\n      .combine('format', kEncodableTextureFormats)\n      .filter(({ format }) => {\n        const info = kTextureFormatInfo[format];\n        return !!info.color && info.color.copyDst && getSingleDataType(format) === 'float';\n      })\n      .beginSubcases()\n      .expand('componentData', ({ format }) => {\n        return [\n          // Test extrema\n          makeParam(format, () => 0),\n\n          // [1]: Test NaN, Infinity, -Infinity\n\n          // Test some values\n          makeParam(format, () => 0.1199951171875),\n          makeParam(format, () => 1.4072265625),\n          makeParam(format, () => 24928),\n          makeParam(format, () => -0.1319580078125),\n          makeParam(format, () => -323.25),\n          makeParam(format, () => -7440),\n\n          // Test mixed values\n          makeParam(format, (bitLength, i) => {\n            return [24896, -0.1319580078125, -323.25, -234.375][i];\n          }),\n        ];\n      })\n  )\n  .fn(doTest);\n\ng.test('ufloat_texel_data_in_shader')\n  .desc(\n    `\nNote: this uses values that are representable by both rg11b10ufloat and rgb9e5ufloat.\n\nTODO: Test NaN, Infinity`\n  )\n  .params(u =>\n    u\n      .combine('format', kEncodableTextureFormats)\n      .filter(({ format }) => {\n        const info = kTextureFormatInfo[format];\n        return !!info.color && info.color.copyDst && getSingleDataType(format) === 'ufloat';\n      })\n      .beginSubcases()\n      .expand('componentData', ({ format }) => {\n        return [\n          // Test extrema\n          makeParam(format, () => 0),\n\n          // Test some values\n          makeParam(format, () => 128),\n          makeParam(format, () => 1984),\n          makeParam(format, () => 3968),\n\n          // Test scattered mixed values\n          makeParam(format, (bitLength, i) => {\n            return [128, 1984, 3968][i];\n          }),\n\n          // Test mixed values that are close in magnitude.\n          makeParam(format, (bitLength, i) => {\n            return [0.05859375, 0.03125, 0.03515625][i];\n          }),\n        ];\n      })\n  )\n  .fn(doTest);\n"],"mappings":"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"}