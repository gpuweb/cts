{"version":3,"file":"create_elements.js","names":["unreachable","kAllCanvasTypes","kValidCanvasContextIds","createCanvas","test","canvasType","width","height","document","createOnscreenCanvas","skip","OffscreenCanvas","createOffscreenCanvas","canvas","createElement"],"sources":["../../../src/webgpu/util/create_elements.ts"],"sourcesContent":["import { Fixture } from '../../common/framework/fixture.js';\nimport { unreachable } from '../../common/util/util.js';\n\n// TESTING_TODO: This should expand to more canvas types (which will enhance a bunch of tests):\n// - canvas element not in dom\n// - canvas element in dom\n// - offscreen canvas from transferControlToOffscreen from canvas not in dom\n// - offscreen canvas from transferControlToOffscreen from canvas in dom\n// - offscreen canvas from new OffscreenCanvas\nexport const kAllCanvasTypes = ['onscreen', 'offscreen'] as const;\nexport type CanvasType = (typeof kAllCanvasTypes)[number];\n\ntype CanvasForCanvasType<T extends CanvasType> = {\n  onscreen: HTMLCanvasElement;\n  offscreen: OffscreenCanvas;\n}[T];\n\n/** Valid contextId for HTMLCanvasElement/OffscreenCanvas,\n *  spec: https://html.spec.whatwg.org/multipage/canvas.html#dom-canvas-getcontext\n */\nexport const kValidCanvasContextIds = [\n  '2d',\n  'bitmaprenderer',\n  'webgl',\n  'webgl2',\n  'webgpu',\n] as const;\nexport type CanvasContext = (typeof kValidCanvasContextIds)[number];\n\n/** Create HTMLCanvas/OffscreenCanvas. */\nexport function createCanvas<T extends CanvasType>(\n  test: Fixture,\n  canvasType: T,\n  width: number,\n  height: number\n): CanvasForCanvasType<T> {\n  if (canvasType === 'onscreen') {\n    if (typeof document !== 'undefined') {\n      return createOnscreenCanvas(test, width, height) as CanvasForCanvasType<T>;\n    } else {\n      test.skip('Cannot create HTMLCanvasElement');\n    }\n  } else if (canvasType === 'offscreen') {\n    if (typeof OffscreenCanvas !== 'undefined') {\n      return createOffscreenCanvas(test, width, height) as CanvasForCanvasType<T>;\n    } else {\n      test.skip('Cannot create an OffscreenCanvas');\n    }\n  } else {\n    unreachable();\n  }\n}\n\n/** Create HTMLCanvasElement. */\nexport function createOnscreenCanvas(\n  test: Fixture,\n  width: number,\n  height: number\n): HTMLCanvasElement {\n  let canvas: HTMLCanvasElement;\n  if (typeof document !== 'undefined') {\n    canvas = document.createElement('canvas');\n    canvas.width = width;\n    canvas.height = height;\n  } else {\n    test.skip('Cannot create HTMLCanvasElement');\n  }\n  return canvas;\n}\n\n/** Create OffscreenCanvas. */\nexport function createOffscreenCanvas(\n  test: Fixture,\n  width: number,\n  height: number\n): OffscreenCanvas {\n  if (typeof OffscreenCanvas === 'undefined') {\n    test.skip('OffscreenCanvas is not supported');\n  }\n\n  return new OffscreenCanvas(width, height);\n}\n"],"mappings":";;GACA,SAASA,WAAW,QAAQ,2BAA2B;AAEvD;AACA;AACA;AACA;AACA;AACA;AACA,OAAO,MAAMC,eAAe,GAAG,CAAC,UAAU,EAAE,WAAW,CAAU;;;;;;;;AAQjE;AACA;AACA;AACA,OAAO,MAAMC,sBAAsB,GAAG;AACpC,IAAI;AACJ,gBAAgB;AAChB,OAAO;AACP,QAAQ;AACR,QAAQ,CACA;;;;AAGV;AACA,OAAO,SAASC,YAAYA;AAC1BC,IAAa;AACbC,UAAa;AACbC,KAAa;AACbC,MAAc;AACU;EACxB,IAAIF,UAAU,KAAK,UAAU,EAAE;IAC7B,IAAI,OAAOG,QAAQ,KAAK,WAAW,EAAE;MACnC,OAAOC,oBAAoB,CAACL,IAAI,EAAEE,KAAK,EAAEC,MAAM,CAAC;IAClD,CAAC,MAAM;MACLH,IAAI,CAACM,IAAI,CAAC,iCAAiC,CAAC;IAC9C;EACF,CAAC,MAAM,IAAIL,UAAU,KAAK,WAAW,EAAE;IACrC,IAAI,OAAOM,eAAe,KAAK,WAAW,EAAE;MAC1C,OAAOC,qBAAqB,CAACR,IAAI,EAAEE,KAAK,EAAEC,MAAM,CAAC;IACnD,CAAC,MAAM;MACLH,IAAI,CAACM,IAAI,CAAC,kCAAkC,CAAC;IAC/C;EACF,CAAC,MAAM;IACLV,WAAW,CAAC,CAAC;EACf;AACF;;AAEA;AACA,OAAO,SAASS,oBAAoBA;AAClCL,IAAa;AACbE,KAAa;AACbC,MAAc;AACK;EACnB,IAAIM,MAAyB;EAC7B,IAAI,OAAOL,QAAQ,KAAK,WAAW,EAAE;IACnCK,MAAM,GAAGL,QAAQ,CAACM,aAAa,CAAC,QAAQ,CAAC;IACzCD,MAAM,CAACP,KAAK,GAAGA,KAAK;IACpBO,MAAM,CAACN,MAAM,GAAGA,MAAM;EACxB,CAAC,MAAM;IACLH,IAAI,CAACM,IAAI,CAAC,iCAAiC,CAAC;EAC9C;EACA,OAAOG,MAAM;AACf;;AAEA;AACA,OAAO,SAASD,qBAAqBA;AACnCR,IAAa;AACbE,KAAa;AACbC,MAAc;AACG;EACjB,IAAI,OAAOI,eAAe,KAAK,WAAW,EAAE;IAC1CP,IAAI,CAACM,IAAI,CAAC,kCAAkC,CAAC;EAC/C;;EAEA,OAAO,IAAIC,eAAe,CAACL,KAAK,EAAEC,MAAM,CAAC;AAC3C"}