{"version":3,"file":"indirect_multi_draw.spec.js","names":["description","kUnitCaseParamsBuilder","makeTestGroup","GPUConst","kMaxUnsignedLongValue","kMaxUnsignedLongLongValue","kResourceStates","AllFeaturesMaxLimitsGPUTest","vtu","kIndirectMultiDrawTestParams","combine","F","makeIndexBuffer","createBufferTracked","size","usage","GPUBufferUsage","INDEX","g","test","desc","paramsSubcasesOnly","filter","p","useDrawCountBuffer","drawCountState","indirectState","fn","t","skipIfDeviceDoesNotHaveFeature","indexed","params","indirectBuffer","createBufferWithState","INDIRECT","drawCountBuffer","undefined","encoder","validateFinishAndSubmit","createEncoder","setPipeline","createNoOpRenderPipeline","setIndexBuffer","multiDrawIndexedIndirect","multiDrawIndirect","shouldBeValid","submitShouldSucceedIfValid","combineWithParams","indirectMismatched","drawCountMismatched","beforeAllSubcases","usesMismatchedDevice","indirectDevice","mismatchedDevice","device","drawCountDevice","trackForCleanup","createBuffer","validateFinish","BufferUsage","VERTEX","indirectUsage","drawCountUsage","shouldSucceed","indirectOffset","drawCountOffset","u","expandWithParams","drawParamsSize","maxDrawCount","offset","exactRequiredSize","bufferSize","paramsSize","valid","kDrawCountSize"],"sources":["../../../../../../../src/webgpu/api/validation/encoding/cmds/render/indirect_multi_draw.spec.ts"],"sourcesContent":["export const description = `\nValidation tests for multiDrawIndirect/multiDrawIndexedIndirect on render pass.\n`;\n\nimport { kUnitCaseParamsBuilder } from '../../../../../../common/framework/params_builder.js';\nimport { makeTestGroup } from '../../../../../../common/framework/test_group.js';\nimport {\n  GPUConst,\n  kMaxUnsignedLongValue,\n  kMaxUnsignedLongLongValue,\n} from '../../../../../constants.js';\nimport { kResourceStates, AllFeaturesMaxLimitsGPUTest } from '../../../../../gpu_test.js';\nimport * as vtu from '../../../validation_test_utils.js';\n\nconst kIndirectMultiDrawTestParams = kUnitCaseParamsBuilder\n  .combine('indexed', [true, false] as const)\n  .combine('useDrawCountBuffer', [true, false] as const);\n\nclass F extends AllFeaturesMaxLimitsGPUTest {\n  makeIndexBuffer(): GPUBuffer {\n    return this.createBufferTracked({\n      size: 16,\n      usage: GPUBufferUsage.INDEX,\n    });\n  }\n}\n\nexport const g = makeTestGroup(F);\n\ng.test('buffers_state')\n  .desc(\n    `\nTests indirect and draw count buffers must be valid.\n  `\n  )\n  .paramsSubcasesOnly(\n    kIndirectMultiDrawTestParams\n      .combine('indirectState', kResourceStates)\n      .combine('drawCountState', kResourceStates)\n      // drawCountState only matters if useDrawCountBuffer=true\n      .filter(p => p.useDrawCountBuffer || p.drawCountState === 'valid')\n      // Filter out a few unnecessary cases that would hit two errors in the same API call\n      .filter(\n        p =>\n          p.indirectState === 'valid' ||\n          p.drawCountState === 'valid' ||\n          p.indirectState !== p.drawCountState\n      )\n  )\n  .fn(t => {\n    t.skipIfDeviceDoesNotHaveFeature('chromium-experimental-multi-draw-indirect' as GPUFeatureName);\n    const { indexed, indirectState, useDrawCountBuffer, drawCountState } = t.params;\n    const indirectBuffer = vtu.createBufferWithState(t, indirectState, {\n      size: 256,\n      usage: GPUBufferUsage.INDIRECT,\n    });\n    const drawCountBuffer = useDrawCountBuffer\n      ? vtu.createBufferWithState(t, drawCountState, {\n          size: 256,\n          usage: GPUBufferUsage.INDIRECT,\n        })\n      : undefined;\n\n    const { encoder, validateFinishAndSubmit } = t.createEncoder('render pass');\n    encoder.setPipeline(vtu.createNoOpRenderPipeline(t));\n    if (indexed) {\n      encoder.setIndexBuffer(t.makeIndexBuffer(), 'uint32');\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      (encoder as any).multiDrawIndexedIndirect(indirectBuffer, 0, 1, drawCountBuffer);\n    } else {\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      (encoder as any).multiDrawIndirect(indirectBuffer, 0, 1, drawCountBuffer);\n    }\n\n    const shouldBeValid =\n      indirectState !== 'invalid' && (!drawCountBuffer || drawCountState !== 'invalid');\n    const submitShouldSucceedIfValid =\n      indirectState !== 'destroyed' && (!drawCountBuffer || drawCountState !== 'destroyed');\n    validateFinishAndSubmit(shouldBeValid, submitShouldSucceedIfValid);\n  });\n\ng.test('buffers,device_mismatch')\n  .desc(\n    'Tests multiDraw(Indexed)Indirect cannot be called with buffers created from another device'\n  )\n  .paramsSubcasesOnly(\n    kIndirectMultiDrawTestParams\n      .combineWithParams([\n        { indirectMismatched: false, drawCountMismatched: false }, // control case\n        { indirectMismatched: true, drawCountMismatched: false },\n        { indirectMismatched: false, drawCountMismatched: true },\n      ])\n      // drawCountMismatched only matters if useDrawCountBuffer=true\n      .filter(p => p.useDrawCountBuffer || !p.drawCountMismatched)\n  )\n  .beforeAllSubcases(t => t.usesMismatchedDevice())\n  .fn(t => {\n    t.skipIfDeviceDoesNotHaveFeature('chromium-experimental-multi-draw-indirect' as GPUFeatureName);\n    const { indexed, useDrawCountBuffer, indirectMismatched, drawCountMismatched } = t.params;\n\n    const indirectDevice = indirectMismatched ? t.mismatchedDevice : t.device;\n    const drawCountDevice = drawCountMismatched ? t.mismatchedDevice : t.device;\n\n    const indirectBuffer = t.trackForCleanup(\n      indirectDevice.createBuffer({\n        size: 256,\n        usage: GPUBufferUsage.INDIRECT,\n      })\n    );\n    const drawCountBuffer = useDrawCountBuffer\n      ? t.trackForCleanup(\n          drawCountDevice.createBuffer({\n            size: 256,\n            usage: GPUBufferUsage.INDIRECT,\n          })\n        )\n      : undefined;\n\n    const { encoder, validateFinish } = t.createEncoder('render pass');\n    encoder.setPipeline(vtu.createNoOpRenderPipeline(t));\n    if (indexed) {\n      encoder.setIndexBuffer(t.makeIndexBuffer(), 'uint32');\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      (encoder as any).multiDrawIndexedIndirect(indirectBuffer, 0, 1, drawCountBuffer);\n    } else {\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      (encoder as any).multiDrawIndirect(indirectBuffer, 0, 1, drawCountBuffer);\n    }\n    validateFinish(!indirectMismatched && !drawCountMismatched);\n  });\n\ng.test('indirect_buffer_usage')\n  .desc(\n    `\nTests indirect and draw count buffers must have 'Indirect' usage.\n  `\n  )\n  .paramsSubcasesOnly(\n    kIndirectMultiDrawTestParams\n      .combine('indirectUsage', [\n        GPUConst.BufferUsage.INDIRECT,\n        GPUConst.BufferUsage.VERTEX,\n        GPUConst.BufferUsage.VERTEX | GPUConst.BufferUsage.INDIRECT,\n      ] as const)\n      .combine('drawCountUsage', [\n        GPUConst.BufferUsage.INDIRECT,\n        GPUConst.BufferUsage.VERTEX,\n        GPUConst.BufferUsage.VERTEX | GPUConst.BufferUsage.INDIRECT,\n      ] as const)\n  )\n  .fn(t => {\n    t.skipIfDeviceDoesNotHaveFeature('chromium-experimental-multi-draw-indirect' as GPUFeatureName);\n    const { indexed, indirectUsage, useDrawCountBuffer, drawCountUsage } = t.params;\n\n    const indirectBuffer = t.createBufferTracked({\n      size: 256,\n      usage: indirectUsage,\n    });\n    const drawCountBuffer = useDrawCountBuffer\n      ? t.createBufferTracked({\n          size: 256,\n          usage: drawCountUsage,\n        })\n      : undefined;\n\n    const { encoder, validateFinish } = t.createEncoder('render pass');\n    encoder.setPipeline(vtu.createNoOpRenderPipeline(t));\n    if (indexed) {\n      encoder.setIndexBuffer(t.makeIndexBuffer(), 'uint32');\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      (encoder as any).multiDrawIndexedIndirect(indirectBuffer, 0, 1, drawCountBuffer);\n    } else {\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      (encoder as any).multiDrawIndirect(indirectBuffer, 0, 1, drawCountBuffer);\n    }\n    const shouldSucceed =\n      (indirectUsage & GPUBufferUsage.INDIRECT) !== 0 &&\n      (!drawCountBuffer || drawCountUsage & GPUBufferUsage.INDIRECT) !== 0;\n    validateFinish(shouldSucceed);\n  });\n\ng.test('offsets_alignment')\n  .desc(\n    `\nTests indirect and draw count offsets must be a multiple of 4.\n  `\n  )\n  .paramsSubcasesOnly(\n    kIndirectMultiDrawTestParams.combineWithParams([\n      // Valid\n      { indirectOffset: 0, drawCountOffset: 0 },\n      { indirectOffset: 4, drawCountOffset: 0 },\n      { indirectOffset: 0, drawCountOffset: 4 },\n      // Invalid\n      { indirectOffset: 2, drawCountOffset: 0 },\n      { indirectOffset: 6, drawCountOffset: 0 },\n      { indirectOffset: 0, drawCountOffset: 2 },\n      { indirectOffset: 0, drawCountOffset: 6 },\n    ] as const)\n  )\n  .fn(t => {\n    t.skipIfDeviceDoesNotHaveFeature('chromium-experimental-multi-draw-indirect' as GPUFeatureName);\n    const { indexed, indirectOffset, useDrawCountBuffer, drawCountOffset } = t.params;\n\n    const indirectBuffer = t.createBufferTracked({\n      size: 256,\n      usage: GPUBufferUsage.INDIRECT,\n    });\n    const drawCountBuffer = useDrawCountBuffer\n      ? t.createBufferTracked({\n          size: 256,\n          usage: GPUBufferUsage.INDIRECT,\n        })\n      : undefined;\n\n    const { encoder, validateFinish } = t.createEncoder('render pass');\n    encoder.setPipeline(vtu.createNoOpRenderPipeline(t));\n    if (indexed) {\n      encoder.setIndexBuffer(t.makeIndexBuffer(), 'uint32');\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      (encoder as any).multiDrawIndexedIndirect(\n        indirectBuffer,\n        indirectOffset,\n        1,\n        drawCountBuffer,\n        drawCountOffset\n      );\n    } else {\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      (encoder as any).multiDrawIndirect(\n        indirectBuffer,\n        indirectOffset,\n        1,\n        drawCountBuffer,\n        drawCountOffset\n      );\n    }\n\n    // We need to figure out if https://github.com/gpuweb/gpuweb/pull/2315/files#r1773031950 applies.\n    validateFinish(indirectOffset % 4 === 0 && (!useDrawCountBuffer || drawCountOffset % 4 === 0));\n  });\n\ng.test('indirectBuffer_range')\n  .desc(\n    `\nTests multi indirect draw calls with various indirect offsets and buffer sizes without draw count buffer.\n`\n  )\n  .paramsSubcasesOnly(u =>\n    u\n      .combine('indexed', [true, false] as const) //\n      .expandWithParams(function* (p) {\n        const drawParamsSize = p.indexed ? 20 : 16;\n\n        // Simple OOB test cases, using a delta from the exact required size\n        for (const { maxDrawCount, offset } of [\n          { maxDrawCount: 1, offset: 0 },\n          { maxDrawCount: 1, offset: 4 },\n          { maxDrawCount: 1, offset: drawParamsSize + 4 },\n          { maxDrawCount: 2, offset: 0 },\n          { maxDrawCount: 6, offset: drawParamsSize },\n        ]) {\n          const exactRequiredSize = offset + maxDrawCount * drawParamsSize;\n          yield { offset, maxDrawCount, bufferSize: exactRequiredSize };\n          yield { offset, maxDrawCount, bufferSize: exactRequiredSize - 1 };\n        }\n\n        // Additional test cases\n        // - Buffer size is 0\n        yield { offset: 0, maxDrawCount: 1, bufferSize: 0 };\n        // - Buffer size is unaligned (OK)\n        yield { offset: 0, maxDrawCount: 1, bufferSize: drawParamsSize + 1 };\n        // - In-bounds, but non-multiple of 4 offset\n        yield { offset: 2, maxDrawCount: 1, bufferSize: drawParamsSize + 8 };\n        yield { offset: 6, maxDrawCount: 1, bufferSize: drawParamsSize + 8 };\n        // - Out of bounds, (offset + (drawParamsSize * maxDrawCount)) may overflow\n        yield { offset: kMaxUnsignedLongLongValue, maxDrawCount: 1, bufferSize: 1024 };\n        yield { offset: 0, maxDrawCount: kMaxUnsignedLongValue, bufferSize: 1024 };\n      })\n  )\n  .fn(t => {\n    t.skipIfDeviceDoesNotHaveFeature('chromium-experimental-multi-draw-indirect' as GPUFeatureName);\n    const { indexed, offset, maxDrawCount, bufferSize } = t.params;\n\n    const indirectBuffer = t.createBufferTracked({\n      size: bufferSize,\n      usage: GPUBufferUsage.INDIRECT,\n    });\n\n    const { encoder, validateFinish } = t.createEncoder('render pass');\n    encoder.setPipeline(vtu.createNoOpRenderPipeline(t));\n    if (indexed) {\n      encoder.setIndexBuffer(t.makeIndexBuffer(), 'uint32');\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      (encoder as any).multiDrawIndexedIndirect(indirectBuffer, offset, maxDrawCount);\n    } else {\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      (encoder as any).multiDrawIndirect(indirectBuffer, offset, maxDrawCount);\n    }\n\n    const paramsSize = indexed ? 20 : 16;\n    const exactRequiredSize = offset + maxDrawCount * paramsSize;\n    const valid = offset % 4 === 0 && bufferSize >= exactRequiredSize;\n    validateFinish(valid);\n  });\n\ng.test('drawCountBuffer_range')\n  .desc(\n    `\nTests multi indirect draw calls with various draw count offsets, and draw count buffer sizes.\n  `\n  )\n  .paramsSubcasesOnly(u =>\n    u\n      .combine('indexed', [true, false] as const) //\n      .combineWithParams([\n        // In bounds\n        { offset: 0, bufferSize: 4 },\n        { offset: 0, bufferSize: 5 },\n        // In bounds, but non-multiple of 4 offset\n        { offset: 2, bufferSize: 8 },\n        // Out of bounds, offset too big for drawCountBuffer\n        { offset: 4, bufferSize: 7 },\n        // Out of bounds, (offset + kDrawCountSize) may overflow\n        { offset: kMaxUnsignedLongLongValue, bufferSize: 1024 },\n      ])\n  )\n  .fn(t => {\n    t.skipIfDeviceDoesNotHaveFeature('chromium-experimental-multi-draw-indirect' as GPUFeatureName);\n    const { indexed, bufferSize, offset } = t.params;\n\n    const indirectBuffer = t.createBufferTracked({\n      size: indexed ? 20 : 16,\n      usage: GPUBufferUsage.INDIRECT,\n    });\n    const drawCountBuffer = t.createBufferTracked({\n      size: bufferSize,\n      usage: GPUBufferUsage.INDIRECT,\n    });\n\n    const { encoder, validateFinish } = t.createEncoder('render pass');\n    encoder.setPipeline(vtu.createNoOpRenderPipeline(t));\n    if (indexed) {\n      encoder.setIndexBuffer(t.makeIndexBuffer(), 'uint32');\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      (encoder as any).multiDrawIndexedIndirect(indirectBuffer, 0, 1, drawCountBuffer, offset);\n    } else {\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      (encoder as any).multiDrawIndirect(indirectBuffer, 0, 1, drawCountBuffer, offset);\n    }\n\n    const kDrawCountSize = 4;\n    const valid = offset % 4 === 0 && offset + kDrawCountSize <= bufferSize;\n    validateFinish(valid);\n  });\n"],"mappings":";;GAAA,OAAO,MAAMA,WAAW,GAAI;AAC5B;AACA,CAAC,CAED,SAASC,sBAAsB,QAAQ,sDAAsD;AAC7F,SAASC,aAAa,QAAQ,kDAAkD;AAChF;EACEC,QAAQ;EACRC,qBAAqB;EACrBC,yBAAyB;AACpB,6BAA6B;AACpC,SAASC,eAAe,EAAEC,2BAA2B,QAAQ,4BAA4B;AACzF,OAAO,KAAKC,GAAG,MAAM,mCAAmC;;AAExD,MAAMC,4BAA4B,GAAGR,sBAAsB;AACxDS,OAAO,CAAC,SAAS,EAAE,CAAC,IAAI,EAAE,KAAK,CAAU,CAAC;AAC1CA,OAAO,CAAC,oBAAoB,EAAE,CAAC,IAAI,EAAE,KAAK,CAAU,CAAC;;AAExD,MAAMC,CAAC,SAASJ,2BAA2B,CAAC;EAC1CK,eAAeA,CAAA,EAAc;IAC3B,OAAO,IAAI,CAACC,mBAAmB,CAAC;MAC9BC,IAAI,EAAE,EAAE;MACRC,KAAK,EAAEC,cAAc,CAACC;IACxB,CAAC,CAAC;EACJ;AACF;;AAEA,OAAO,MAAMC,CAAC,GAAGhB,aAAa,CAACS,CAAC,CAAC;;AAEjCO,CAAC,CAACC,IAAI,CAAC,eAAe,CAAC;AACpBC,IAAI;EACF;AACL;AACA;AACE,CAAC;AACAC,kBAAkB;EACjBZ,4BAA4B;EACzBC,OAAO,CAAC,eAAe,EAAEJ,eAAe,CAAC;EACzCI,OAAO,CAAC,gBAAgB,EAAEJ,eAAe;EAC1C;EAAA,CACCgB,MAAM,CAAC,CAAAC,CAAC,KAAIA,CAAC,CAACC,kBAAkB,IAAID,CAAC,CAACE,cAAc,KAAK,OAAO;EACjE;EAAA,CACCH,MAAM;IACL,CAAAC,CAAC;IACCA,CAAC,CAACG,aAAa,KAAK,OAAO;IAC3BH,CAAC,CAACE,cAAc,KAAK,OAAO;IAC5BF,CAAC,CAACG,aAAa,KAAKH,CAAC,CAACE;EAC1B;AACJ,CAAC;AACAE,EAAE,CAAC,CAAAC,CAAC,KAAI;EACPA,CAAC,CAACC,8BAA8B,CAAC,2CAA6D,CAAC;EAC/F,MAAM,EAAEC,OAAO,EAAEJ,aAAa,EAAEF,kBAAkB,EAAEC,cAAc,CAAC,CAAC,GAAGG,CAAC,CAACG,MAAM;EAC/E,MAAMC,cAAc,GAAGxB,GAAG,CAACyB,qBAAqB,CAACL,CAAC,EAAEF,aAAa,EAAE;IACjEZ,IAAI,EAAE,GAAG;IACTC,KAAK,EAAEC,cAAc,CAACkB;EACxB,CAAC,CAAC;EACF,MAAMC,eAAe,GAAGX,kBAAkB;EACtChB,GAAG,CAACyB,qBAAqB,CAACL,CAAC,EAAEH,cAAc,EAAE;IAC3CX,IAAI,EAAE,GAAG;IACTC,KAAK,EAAEC,cAAc,CAACkB;EACxB,CAAC,CAAC;EACFE,SAAS;;EAEb,MAAM,EAAEC,OAAO,EAAEC,uBAAuB,CAAC,CAAC,GAAGV,CAAC,CAACW,aAAa,CAAC,aAAa,CAAC;EAC3EF,OAAO,CAACG,WAAW,CAAChC,GAAG,CAACiC,wBAAwB,CAACb,CAAC,CAAC,CAAC;EACpD,IAAIE,OAAO,EAAE;IACXO,OAAO,CAACK,cAAc,CAACd,CAAC,CAAChB,eAAe,CAAC,CAAC,EAAE,QAAQ,CAAC;;IAEpDyB,OAAO,CAASM,wBAAwB,CAACX,cAAc,EAAE,CAAC,EAAE,CAAC,EAAEG,eAAe,CAAC;EAClF,CAAC,MAAM;;IAEJE,OAAO,CAASO,iBAAiB,CAACZ,cAAc,EAAE,CAAC,EAAE,CAAC,EAAEG,eAAe,CAAC;EAC3E;;EAEA,MAAMU,aAAa;EACjBnB,aAAa,KAAK,SAAS,KAAK,CAACS,eAAe,IAAIV,cAAc,KAAK,SAAS,CAAC;EACnF,MAAMqB,0BAA0B;EAC9BpB,aAAa,KAAK,WAAW,KAAK,CAACS,eAAe,IAAIV,cAAc,KAAK,WAAW,CAAC;EACvFa,uBAAuB,CAACO,aAAa,EAAEC,0BAA0B,CAAC;AACpE,CAAC,CAAC;;AAEJ5B,CAAC,CAACC,IAAI,CAAC,yBAAyB,CAAC;AAC9BC,IAAI;EACH;AACF,CAAC;AACAC,kBAAkB;EACjBZ,4BAA4B;EACzBsC,iBAAiB,CAAC;EACjB,EAAEC,kBAAkB,EAAE,KAAK,EAAEC,mBAAmB,EAAE,KAAK,CAAC,CAAC,EAAE;EAC3D,EAAED,kBAAkB,EAAE,IAAI,EAAEC,mBAAmB,EAAE,KAAK,CAAC,CAAC;EACxD,EAAED,kBAAkB,EAAE,KAAK,EAAEC,mBAAmB,EAAE,IAAI,CAAC,CAAC;EACzD;EACD;EAAA,CACC3B,MAAM,CAAC,CAAAC,CAAC,KAAIA,CAAC,CAACC,kBAAkB,IAAI,CAACD,CAAC,CAAC0B,mBAAmB;AAC/D,CAAC;AACAC,iBAAiB,CAAC,CAAAtB,CAAC,KAAIA,CAAC,CAACuB,oBAAoB,CAAC,CAAC,CAAC;AAChDxB,EAAE,CAAC,CAAAC,CAAC,KAAI;EACPA,CAAC,CAACC,8BAA8B,CAAC,2CAA6D,CAAC;EAC/F,MAAM,EAAEC,OAAO,EAAEN,kBAAkB,EAAEwB,kBAAkB,EAAEC,mBAAmB,CAAC,CAAC,GAAGrB,CAAC,CAACG,MAAM;;EAEzF,MAAMqB,cAAc,GAAGJ,kBAAkB,GAAGpB,CAAC,CAACyB,gBAAgB,GAAGzB,CAAC,CAAC0B,MAAM;EACzE,MAAMC,eAAe,GAAGN,mBAAmB,GAAGrB,CAAC,CAACyB,gBAAgB,GAAGzB,CAAC,CAAC0B,MAAM;;EAE3E,MAAMtB,cAAc,GAAGJ,CAAC,CAAC4B,eAAe;IACtCJ,cAAc,CAACK,YAAY,CAAC;MAC1B3C,IAAI,EAAE,GAAG;MACTC,KAAK,EAAEC,cAAc,CAACkB;IACxB,CAAC;EACH,CAAC;EACD,MAAMC,eAAe,GAAGX,kBAAkB;EACtCI,CAAC,CAAC4B,eAAe;IACfD,eAAe,CAACE,YAAY,CAAC;MAC3B3C,IAAI,EAAE,GAAG;MACTC,KAAK,EAAEC,cAAc,CAACkB;IACxB,CAAC;EACH,CAAC;EACDE,SAAS;;EAEb,MAAM,EAAEC,OAAO,EAAEqB,cAAc,CAAC,CAAC,GAAG9B,CAAC,CAACW,aAAa,CAAC,aAAa,CAAC;EAClEF,OAAO,CAACG,WAAW,CAAChC,GAAG,CAACiC,wBAAwB,CAACb,CAAC,CAAC,CAAC;EACpD,IAAIE,OAAO,EAAE;IACXO,OAAO,CAACK,cAAc,CAACd,CAAC,CAAChB,eAAe,CAAC,CAAC,EAAE,QAAQ,CAAC;;IAEpDyB,OAAO,CAASM,wBAAwB,CAACX,cAAc,EAAE,CAAC,EAAE,CAAC,EAAEG,eAAe,CAAC;EAClF,CAAC,MAAM;;IAEJE,OAAO,CAASO,iBAAiB,CAACZ,cAAc,EAAE,CAAC,EAAE,CAAC,EAAEG,eAAe,CAAC;EAC3E;EACAuB,cAAc,CAAC,CAACV,kBAAkB,IAAI,CAACC,mBAAmB,CAAC;AAC7D,CAAC,CAAC;;AAEJ/B,CAAC,CAACC,IAAI,CAAC,uBAAuB,CAAC;AAC5BC,IAAI;EACF;AACL;AACA;AACE,CAAC;AACAC,kBAAkB;EACjBZ,4BAA4B;EACzBC,OAAO,CAAC,eAAe,EAAE;EACxBP,QAAQ,CAACwD,WAAW,CAACzB,QAAQ;EAC7B/B,QAAQ,CAACwD,WAAW,CAACC,MAAM;EAC3BzD,QAAQ,CAACwD,WAAW,CAACC,MAAM,GAAGzD,QAAQ,CAACwD,WAAW,CAACzB,QAAQ;EACnD,CAAC;EACVxB,OAAO,CAAC,gBAAgB,EAAE;EACzBP,QAAQ,CAACwD,WAAW,CAACzB,QAAQ;EAC7B/B,QAAQ,CAACwD,WAAW,CAACC,MAAM;EAC3BzD,QAAQ,CAACwD,WAAW,CAACC,MAAM,GAAGzD,QAAQ,CAACwD,WAAW,CAACzB,QAAQ;EACnD;AACd,CAAC;AACAP,EAAE,CAAC,CAAAC,CAAC,KAAI;EACPA,CAAC,CAACC,8BAA8B,CAAC,2CAA6D,CAAC;EAC/F,MAAM,EAAEC,OAAO,EAAE+B,aAAa,EAAErC,kBAAkB,EAAEsC,cAAc,CAAC,CAAC,GAAGlC,CAAC,CAACG,MAAM;;EAE/E,MAAMC,cAAc,GAAGJ,CAAC,CAACf,mBAAmB,CAAC;IAC3CC,IAAI,EAAE,GAAG;IACTC,KAAK,EAAE8C;EACT,CAAC,CAAC;EACF,MAAM1B,eAAe,GAAGX,kBAAkB;EACtCI,CAAC,CAACf,mBAAmB,CAAC;IACpBC,IAAI,EAAE,GAAG;IACTC,KAAK,EAAE+C;EACT,CAAC,CAAC;EACF1B,SAAS;;EAEb,MAAM,EAAEC,OAAO,EAAEqB,cAAc,CAAC,CAAC,GAAG9B,CAAC,CAACW,aAAa,CAAC,aAAa,CAAC;EAClEF,OAAO,CAACG,WAAW,CAAChC,GAAG,CAACiC,wBAAwB,CAACb,CAAC,CAAC,CAAC;EACpD,IAAIE,OAAO,EAAE;IACXO,OAAO,CAACK,cAAc,CAACd,CAAC,CAAChB,eAAe,CAAC,CAAC,EAAE,QAAQ,CAAC;;IAEpDyB,OAAO,CAASM,wBAAwB,CAACX,cAAc,EAAE,CAAC,EAAE,CAAC,EAAEG,eAAe,CAAC;EAClF,CAAC,MAAM;;IAEJE,OAAO,CAASO,iBAAiB,CAACZ,cAAc,EAAE,CAAC,EAAE,CAAC,EAAEG,eAAe,CAAC;EAC3E;EACA,MAAM4B,aAAa;EACjB,CAACF,aAAa,GAAG7C,cAAc,CAACkB,QAAQ,MAAM,CAAC;EAC/C,CAAC,CAACC,eAAe,IAAI2B,cAAc,GAAG9C,cAAc,CAACkB,QAAQ,MAAM,CAAC;EACtEwB,cAAc,CAACK,aAAa,CAAC;AAC/B,CAAC,CAAC;;AAEJ7C,CAAC,CAACC,IAAI,CAAC,mBAAmB,CAAC;AACxBC,IAAI;EACF;AACL;AACA;AACE,CAAC;AACAC,kBAAkB;EACjBZ,4BAA4B,CAACsC,iBAAiB,CAAC;EAC7C;EACA,EAAEiB,cAAc,EAAE,CAAC,EAAEC,eAAe,EAAE,CAAC,CAAC,CAAC;EACzC,EAAED,cAAc,EAAE,CAAC,EAAEC,eAAe,EAAE,CAAC,CAAC,CAAC;EACzC,EAAED,cAAc,EAAE,CAAC,EAAEC,eAAe,EAAE,CAAC,CAAC,CAAC;EACzC;EACA,EAAED,cAAc,EAAE,CAAC,EAAEC,eAAe,EAAE,CAAC,CAAC,CAAC;EACzC,EAAED,cAAc,EAAE,CAAC,EAAEC,eAAe,EAAE,CAAC,CAAC,CAAC;EACzC,EAAED,cAAc,EAAE,CAAC,EAAEC,eAAe,EAAE,CAAC,CAAC,CAAC;EACzC,EAAED,cAAc,EAAE,CAAC,EAAEC,eAAe,EAAE,CAAC,CAAC,CAAC;EACjC;AACZ,CAAC;AACAtC,EAAE,CAAC,CAAAC,CAAC,KAAI;EACPA,CAAC,CAACC,8BAA8B,CAAC,2CAA6D,CAAC;EAC/F,MAAM,EAAEC,OAAO,EAAEkC,cAAc,EAAExC,kBAAkB,EAAEyC,eAAe,CAAC,CAAC,GAAGrC,CAAC,CAACG,MAAM;;EAEjF,MAAMC,cAAc,GAAGJ,CAAC,CAACf,mBAAmB,CAAC;IAC3CC,IAAI,EAAE,GAAG;IACTC,KAAK,EAAEC,cAAc,CAACkB;EACxB,CAAC,CAAC;EACF,MAAMC,eAAe,GAAGX,kBAAkB;EACtCI,CAAC,CAACf,mBAAmB,CAAC;IACpBC,IAAI,EAAE,GAAG;IACTC,KAAK,EAAEC,cAAc,CAACkB;EACxB,CAAC,CAAC;EACFE,SAAS;;EAEb,MAAM,EAAEC,OAAO,EAAEqB,cAAc,CAAC,CAAC,GAAG9B,CAAC,CAACW,aAAa,CAAC,aAAa,CAAC;EAClEF,OAAO,CAACG,WAAW,CAAChC,GAAG,CAACiC,wBAAwB,CAACb,CAAC,CAAC,CAAC;EACpD,IAAIE,OAAO,EAAE;IACXO,OAAO,CAACK,cAAc,CAACd,CAAC,CAAChB,eAAe,CAAC,CAAC,EAAE,QAAQ,CAAC;;IAEpDyB,OAAO,CAASM,wBAAwB;MACvCX,cAAc;MACdgC,cAAc;MACd,CAAC;MACD7B,eAAe;MACf8B;IACF,CAAC;EACH,CAAC,MAAM;;IAEJ5B,OAAO,CAASO,iBAAiB;MAChCZ,cAAc;MACdgC,cAAc;MACd,CAAC;MACD7B,eAAe;MACf8B;IACF,CAAC;EACH;;EAEA;EACAP,cAAc,CAACM,cAAc,GAAG,CAAC,KAAK,CAAC,KAAK,CAACxC,kBAAkB,IAAIyC,eAAe,GAAG,CAAC,KAAK,CAAC,CAAC,CAAC;AAChG,CAAC,CAAC;;AAEJ/C,CAAC,CAACC,IAAI,CAAC,sBAAsB,CAAC;AAC3BC,IAAI;EACF;AACL;AACA;AACE,CAAC;AACAC,kBAAkB,CAAC,CAAA6C,CAAC;AACnBA,CAAC;AACExD,OAAO,CAAC,SAAS,EAAE,CAAC,IAAI,EAAE,KAAK,CAAU,CAAC,CAAC;AAAA,CAC3CyD,gBAAgB,CAAC,WAAW5C,CAAC,EAAE;EAC9B,MAAM6C,cAAc,GAAG7C,CAAC,CAACO,OAAO,GAAG,EAAE,GAAG,EAAE;;EAE1C;EACA,KAAK,MAAM,EAAEuC,YAAY,EAAEC,MAAM,CAAC,CAAC,IAAI;EACrC,EAAED,YAAY,EAAE,CAAC,EAAEC,MAAM,EAAE,CAAC,CAAC,CAAC;EAC9B,EAAED,YAAY,EAAE,CAAC,EAAEC,MAAM,EAAE,CAAC,CAAC,CAAC;EAC9B,EAAED,YAAY,EAAE,CAAC,EAAEC,MAAM,EAAEF,cAAc,GAAG,CAAC,CAAC,CAAC;EAC/C,EAAEC,YAAY,EAAE,CAAC,EAAEC,MAAM,EAAE,CAAC,CAAC,CAAC;EAC9B,EAAED,YAAY,EAAE,CAAC,EAAEC,MAAM,EAAEF,cAAc,CAAC,CAAC,CAC5C;EAAE;IACD,MAAMG,iBAAiB,GAAGD,MAAM,GAAGD,YAAY,GAAGD,cAAc;IAChE,MAAM,EAAEE,MAAM,EAAED,YAAY,EAAEG,UAAU,EAAED,iBAAiB,CAAC,CAAC;IAC7D,MAAM,EAAED,MAAM,EAAED,YAAY,EAAEG,UAAU,EAAED,iBAAiB,GAAG,CAAC,CAAC,CAAC;EACnE;;EAEA;EACA;EACA,MAAM,EAAED,MAAM,EAAE,CAAC,EAAED,YAAY,EAAE,CAAC,EAAEG,UAAU,EAAE,CAAC,CAAC,CAAC;EACnD;EACA,MAAM,EAAEF,MAAM,EAAE,CAAC,EAAED,YAAY,EAAE,CAAC,EAAEG,UAAU,EAAEJ,cAAc,GAAG,CAAC,CAAC,CAAC;EACpE;EACA,MAAM,EAAEE,MAAM,EAAE,CAAC,EAAED,YAAY,EAAE,CAAC,EAAEG,UAAU,EAAEJ,cAAc,GAAG,CAAC,CAAC,CAAC;EACpE,MAAM,EAAEE,MAAM,EAAE,CAAC,EAAED,YAAY,EAAE,CAAC,EAAEG,UAAU,EAAEJ,cAAc,GAAG,CAAC,CAAC,CAAC;EACpE;EACA,MAAM,EAAEE,MAAM,EAAEjE,yBAAyB,EAAEgE,YAAY,EAAE,CAAC,EAAEG,UAAU,EAAE,IAAI,CAAC,CAAC;EAC9E,MAAM,EAAEF,MAAM,EAAE,CAAC,EAAED,YAAY,EAAEjE,qBAAqB,EAAEoE,UAAU,EAAE,IAAI,CAAC,CAAC;AAC5E,CAAC;AACL,CAAC;AACA7C,EAAE,CAAC,CAAAC,CAAC,KAAI;EACPA,CAAC,CAACC,8BAA8B,CAAC,2CAA6D,CAAC;EAC/F,MAAM,EAAEC,OAAO,EAAEwC,MAAM,EAAED,YAAY,EAAEG,UAAU,CAAC,CAAC,GAAG5C,CAAC,CAACG,MAAM;;EAE9D,MAAMC,cAAc,GAAGJ,CAAC,CAACf,mBAAmB,CAAC;IAC3CC,IAAI,EAAE0D,UAAU;IAChBzD,KAAK,EAAEC,cAAc,CAACkB;EACxB,CAAC,CAAC;;EAEF,MAAM,EAAEG,OAAO,EAAEqB,cAAc,CAAC,CAAC,GAAG9B,CAAC,CAACW,aAAa,CAAC,aAAa,CAAC;EAClEF,OAAO,CAACG,WAAW,CAAChC,GAAG,CAACiC,wBAAwB,CAACb,CAAC,CAAC,CAAC;EACpD,IAAIE,OAAO,EAAE;IACXO,OAAO,CAACK,cAAc,CAACd,CAAC,CAAChB,eAAe,CAAC,CAAC,EAAE,QAAQ,CAAC;;IAEpDyB,OAAO,CAASM,wBAAwB,CAACX,cAAc,EAAEsC,MAAM,EAAED,YAAY,CAAC;EACjF,CAAC,MAAM;;IAEJhC,OAAO,CAASO,iBAAiB,CAACZ,cAAc,EAAEsC,MAAM,EAAED,YAAY,CAAC;EAC1E;;EAEA,MAAMI,UAAU,GAAG3C,OAAO,GAAG,EAAE,GAAG,EAAE;EACpC,MAAMyC,iBAAiB,GAAGD,MAAM,GAAGD,YAAY,GAAGI,UAAU;EAC5D,MAAMC,KAAK,GAAGJ,MAAM,GAAG,CAAC,KAAK,CAAC,IAAIE,UAAU,IAAID,iBAAiB;EACjEb,cAAc,CAACgB,KAAK,CAAC;AACvB,CAAC,CAAC;;AAEJxD,CAAC,CAACC,IAAI,CAAC,uBAAuB,CAAC;AAC5BC,IAAI;EACF;AACL;AACA;AACE,CAAC;AACAC,kBAAkB,CAAC,CAAA6C,CAAC;AACnBA,CAAC;AACExD,OAAO,CAAC,SAAS,EAAE,CAAC,IAAI,EAAE,KAAK,CAAU,CAAC,CAAC;AAAA,CAC3CqC,iBAAiB,CAAC;AACjB;AACA,EAAEuB,MAAM,EAAE,CAAC,EAAEE,UAAU,EAAE,CAAC,CAAC,CAAC;AAC5B,EAAEF,MAAM,EAAE,CAAC,EAAEE,UAAU,EAAE,CAAC,CAAC,CAAC;AAC5B;AACA,EAAEF,MAAM,EAAE,CAAC,EAAEE,UAAU,EAAE,CAAC,CAAC,CAAC;AAC5B;AACA,EAAEF,MAAM,EAAE,CAAC,EAAEE,UAAU,EAAE,CAAC,CAAC,CAAC;AAC5B;AACA,EAAEF,MAAM,EAAEjE,yBAAyB,EAAEmE,UAAU,EAAE,IAAI,CAAC,CAAC;AACxD;AACL,CAAC;AACA7C,EAAE,CAAC,CAAAC,CAAC,KAAI;EACPA,CAAC,CAACC,8BAA8B,CAAC,2CAA6D,CAAC;EAC/F,MAAM,EAAEC,OAAO,EAAE0C,UAAU,EAAEF,MAAM,CAAC,CAAC,GAAG1C,CAAC,CAACG,MAAM;;EAEhD,MAAMC,cAAc,GAAGJ,CAAC,CAACf,mBAAmB,CAAC;IAC3CC,IAAI,EAAEgB,OAAO,GAAG,EAAE,GAAG,EAAE;IACvBf,KAAK,EAAEC,cAAc,CAACkB;EACxB,CAAC,CAAC;EACF,MAAMC,eAAe,GAAGP,CAAC,CAACf,mBAAmB,CAAC;IAC5CC,IAAI,EAAE0D,UAAU;IAChBzD,KAAK,EAAEC,cAAc,CAACkB;EACxB,CAAC,CAAC;;EAEF,MAAM,EAAEG,OAAO,EAAEqB,cAAc,CAAC,CAAC,GAAG9B,CAAC,CAACW,aAAa,CAAC,aAAa,CAAC;EAClEF,OAAO,CAACG,WAAW,CAAChC,GAAG,CAACiC,wBAAwB,CAACb,CAAC,CAAC,CAAC;EACpD,IAAIE,OAAO,EAAE;IACXO,OAAO,CAACK,cAAc,CAACd,CAAC,CAAChB,eAAe,CAAC,CAAC,EAAE,QAAQ,CAAC;;IAEpDyB,OAAO,CAASM,wBAAwB,CAACX,cAAc,EAAE,CAAC,EAAE,CAAC,EAAEG,eAAe,EAAEmC,MAAM,CAAC;EAC1F,CAAC,MAAM;;IAEJjC,OAAO,CAASO,iBAAiB,CAACZ,cAAc,EAAE,CAAC,EAAE,CAAC,EAAEG,eAAe,EAAEmC,MAAM,CAAC;EACnF;;EAEA,MAAMK,cAAc,GAAG,CAAC;EACxB,MAAMD,KAAK,GAAGJ,MAAM,GAAG,CAAC,KAAK,CAAC,IAAIA,MAAM,GAAGK,cAAc,IAAIH,UAAU;EACvEd,cAAc,CAACgB,KAAK,CAAC;AACvB,CAAC,CAAC"}