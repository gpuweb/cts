{"version":3,"file":"setPipeline.spec.js","names":["description","makeTestGroup","AllFeaturesMaxLimitsGPUTest","kRenderEncodeTypes","vtu","kRenderEncodeTypeParams","g","test","desc","paramsSubcasesOnly","u","combine","fn","t","encoderType","state","params","pipeline","createRenderPipelineWithState","encoder","validateFinish","createEncoder","setPipeline","beforeAllSubcases","usesMismatchedDevice","mismatched","sourceDevice","mismatchedDevice","device","createRenderPipeline","layout","vertex","module","createShaderModule","code","entryPoint","fragment","targets","format","writeMask","primitive","topology"],"sources":["../../../../../../../src/webgpu/api/validation/encoding/cmds/render/setPipeline.spec.ts"],"sourcesContent":["export const description = `\nValidation tests for setPipeline on render pass and render bundle.\n`;\n\nimport { makeTestGroup } from '../../../../../../common/framework/test_group.js';\nimport { AllFeaturesMaxLimitsGPUTest } from '../../../../../gpu_test.js';\nimport { kRenderEncodeTypes } from '../../../../../util/command_buffer_maker.js';\nimport * as vtu from '../../../validation_test_utils.js';\n\nimport { kRenderEncodeTypeParams } from './render.js';\n\nexport const g = makeTestGroup(AllFeaturesMaxLimitsGPUTest);\n\ng.test('invalid_pipeline')\n  .desc(\n    `\nTests setPipeline should generate an error iff using an 'invalid' pipeline.\n  `\n  )\n  .paramsSubcasesOnly(u =>\n    u.combine('encoderType', kRenderEncodeTypes).combine('state', ['valid', 'invalid'] as const)\n  )\n  .fn(t => {\n    const { encoderType, state } = t.params;\n    const pipeline = vtu.createRenderPipelineWithState(t, state);\n\n    const { encoder, validateFinish } = t.createEncoder(encoderType);\n    encoder.setPipeline(pipeline);\n    validateFinish(state !== 'invalid');\n  });\n\ng.test('pipeline,device_mismatch')\n  .desc('Tests setPipeline cannot be called with a render pipeline created from another device')\n  .paramsSubcasesOnly(kRenderEncodeTypeParams.combine('mismatched', [true, false]))\n  .beforeAllSubcases(t => t.usesMismatchedDevice())\n  .fn(t => {\n    const { encoderType, mismatched } = t.params;\n    const sourceDevice = mismatched ? t.mismatchedDevice : t.device;\n\n    const pipeline = sourceDevice.createRenderPipeline({\n      layout: 'auto',\n      vertex: {\n        module: sourceDevice.createShaderModule({\n          code: `@vertex fn main() -> @builtin(position) vec4<f32> { return vec4<f32>(); }`,\n        }),\n        entryPoint: 'main',\n      },\n      fragment: {\n        module: sourceDevice.createShaderModule({\n          code: '@fragment fn main() {}',\n        }),\n        entryPoint: 'main',\n        targets: [{ format: 'rgba8unorm', writeMask: 0 }],\n      },\n      primitive: { topology: 'triangle-list' },\n    });\n\n    const { encoder, validateFinish } = t.createEncoder(encoderType);\n    encoder.setPipeline(pipeline);\n    validateFinish(!mismatched);\n  });\n"],"mappings":";;GAAA,OAAO,MAAMA,WAAW,GAAI;AAC5B;AACA,CAAC,CAED,SAASC,aAAa,QAAQ,kDAAkD;AAChF,SAASC,2BAA2B,QAAQ,4BAA4B;AACxE,SAASC,kBAAkB,QAAQ,6CAA6C;AAChF,OAAO,KAAKC,GAAG,MAAM,mCAAmC;;AAExD,SAASC,uBAAuB,QAAQ,aAAa;;AAErD,OAAO,MAAMC,CAAC,GAAGL,aAAa,CAACC,2BAA2B,CAAC;;AAE3DI,CAAC,CAACC,IAAI,CAAC,kBAAkB,CAAC;AACvBC,IAAI;EACF;AACL;AACA;AACE,CAAC;AACAC,kBAAkB,CAAC,CAAAC,CAAC;AACnBA,CAAC,CAACC,OAAO,CAAC,aAAa,EAAER,kBAAkB,CAAC,CAACQ,OAAO,CAAC,OAAO,EAAE,CAAC,OAAO,EAAE,SAAS,CAAU;AAC7F,CAAC;AACAC,EAAE,CAAC,CAAAC,CAAC,KAAI;EACP,MAAM,EAAEC,WAAW,EAAEC,KAAK,CAAC,CAAC,GAAGF,CAAC,CAACG,MAAM;EACvC,MAAMC,QAAQ,GAAGb,GAAG,CAACc,6BAA6B,CAACL,CAAC,EAAEE,KAAK,CAAC;;EAE5D,MAAM,EAAEI,OAAO,EAAEC,cAAc,CAAC,CAAC,GAAGP,CAAC,CAACQ,aAAa,CAACP,WAAW,CAAC;EAChEK,OAAO,CAACG,WAAW,CAACL,QAAQ,CAAC;EAC7BG,cAAc,CAACL,KAAK,KAAK,SAAS,CAAC;AACrC,CAAC,CAAC;;AAEJT,CAAC,CAACC,IAAI,CAAC,0BAA0B,CAAC;AAC/BC,IAAI,CAAC,uFAAuF,CAAC;AAC7FC,kBAAkB,CAACJ,uBAAuB,CAACM,OAAO,CAAC,YAAY,EAAE,CAAC,IAAI,EAAE,KAAK,CAAC,CAAC,CAAC;AAChFY,iBAAiB,CAAC,CAAAV,CAAC,KAAIA,CAAC,CAACW,oBAAoB,CAAC,CAAC,CAAC;AAChDZ,EAAE,CAAC,CAAAC,CAAC,KAAI;EACP,MAAM,EAAEC,WAAW,EAAEW,UAAU,CAAC,CAAC,GAAGZ,CAAC,CAACG,MAAM;EAC5C,MAAMU,YAAY,GAAGD,UAAU,GAAGZ,CAAC,CAACc,gBAAgB,GAAGd,CAAC,CAACe,MAAM;;EAE/D,MAAMX,QAAQ,GAAGS,YAAY,CAACG,oBAAoB,CAAC;IACjDC,MAAM,EAAE,MAAM;IACdC,MAAM,EAAE;MACNC,MAAM,EAAEN,YAAY,CAACO,kBAAkB,CAAC;QACtCC,IAAI,EAAG;MACT,CAAC,CAAC;MACFC,UAAU,EAAE;IACd,CAAC;IACDC,QAAQ,EAAE;MACRJ,MAAM,EAAEN,YAAY,CAACO,kBAAkB,CAAC;QACtCC,IAAI,EAAE;MACR,CAAC,CAAC;MACFC,UAAU,EAAE,MAAM;MAClBE,OAAO,EAAE,CAAC,EAAEC,MAAM,EAAE,YAAY,EAAEC,SAAS,EAAE,CAAC,CAAC,CAAC;IAClD,CAAC;IACDC,SAAS,EAAE,EAAEC,QAAQ,EAAE,eAAe,CAAC;EACzC,CAAC,CAAC;;EAEF,MAAM,EAAEtB,OAAO,EAAEC,cAAc,CAAC,CAAC,GAAGP,CAAC,CAACQ,aAAa,CAACP,WAAW,CAAC;EAChEK,OAAO,CAACG,WAAW,CAACL,QAAQ,CAAC;EAC7BG,cAAc,CAAC,CAACK,UAAU,CAAC;AAC7B,CAAC,CAAC"}