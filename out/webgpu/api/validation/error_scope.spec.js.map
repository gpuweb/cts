{"version":3,"file":"error_scope.spec.js","names":["description","Fixture","makeTestGroup","getGPU","assert","raceWithRejectOnTimeout","kErrorScopeFilters","kGeneratableErrorScopeFilters","ErrorScopeTests","_device","undefined","device","init","gpu","rec","adapter","requestAdapter","trackForCleanup","requestDevice","requiredLimits","maxTextureDimension2D","limits","maxTextureArrayLayers","generateError","filter","createTexture","format","usage","GPUTextureUsage","COPY_DST","size","createBuffer","queue","submit","isInstanceOfError","error","GPUOutOfMemoryError","GPUValidationError","GPUInternalError","expectUncapturedError","fn","immediateAsyncExpectation","TIMEOUT_IN_MS","promise","Promise","resolve","eventListener","event","debug","addEventListener","once","g","test","desc","params","u","combine","t","errorType","errorFilter","pushErrorScope","uncapturedErrorEvent","expect","popErrorScope","shouldReject","allowMissingStack","stackDepth","unmatchedFilters","i","length","promises","push","errors","all","every","e","numErrors"],"sources":["../../../../src/webgpu/api/validation/error_scope.spec.ts"],"sourcesContent":["export const description = `\nError scope validation tests.\n\nNote these must create their own device, not use GPUTest (that one already has error scopes on it).\n\nTODO: (POSTV1) Test error scopes of different threads and make sure they go to the right place.\nTODO: (POSTV1) Test that unhandled errors go the right device, and nowhere if the device was dropped.\n`;\n\nimport { Fixture } from '../../../common/framework/fixture.js';\nimport { makeTestGroup } from '../../../common/framework/test_group.js';\nimport { getGPU } from '../../../common/util/navigator_gpu.js';\nimport { assert, raceWithRejectOnTimeout } from '../../../common/util/util.js';\nimport { kErrorScopeFilters, kGeneratableErrorScopeFilters } from '../../capability_info.js';\n\nclass ErrorScopeTests extends Fixture {\n  _device: GPUDevice | undefined = undefined;\n\n  get device(): GPUDevice {\n    assert(this._device !== undefined);\n    return this._device;\n  }\n\n  override async init(): Promise<void> {\n    await super.init();\n    const gpu = getGPU(this.rec);\n    const adapter = await gpu.requestAdapter();\n    assert(adapter !== null);\n\n    // We need to max out the adapter limits related to texture dimensions to more reliably cause an\n    // OOM error when asked for it, so set that on the device now.\n    const device = this.trackForCleanup(\n      await adapter.requestDevice({\n        requiredLimits: {\n          maxTextureDimension2D: adapter.limits.maxTextureDimension2D,\n          maxTextureArrayLayers: adapter.limits.maxTextureArrayLayers,\n        },\n      })\n    );\n    assert(device !== null);\n    this._device = device;\n  }\n\n  // Generates an error of the given filter type. For now, the errors are generated by calling a\n  // known code-path to cause the error. This can be updated in the future should there be a more\n  // direct way to inject errors.\n  generateError(filter: GPUErrorFilter): void {\n    switch (filter) {\n      case 'out-of-memory':\n        this.trackForCleanup(\n          this.device.createTexture({\n            // One of the largest formats. With the base limits, the texture will be 256 GiB.\n            format: 'rgba32float',\n            usage: GPUTextureUsage.COPY_DST,\n            size: [\n              this.device.limits.maxTextureDimension2D,\n              this.device.limits.maxTextureDimension2D,\n              this.device.limits.maxTextureArrayLayers,\n            ],\n          })\n        );\n        break;\n      case 'validation':\n        // Generating a validation error by passing in an invalid usage when creating a buffer.\n        this.trackForCleanup(\n          this.device.createBuffer({\n            size: 1024,\n            usage: 0xffff, // Invalid GPUBufferUsage\n          })\n        );\n        break;\n    }\n    // MAINTENANCE_TODO: This is a workaround for Chromium not flushing. Remove when not needed.\n    this.device.queue.submit([]);\n  }\n\n  // Checks whether the error is of the type expected given the filter.\n  isInstanceOfError(filter: GPUErrorFilter, error: GPUError | null): boolean {\n    switch (filter) {\n      case 'out-of-memory':\n        return error instanceof GPUOutOfMemoryError;\n      case 'validation':\n        return error instanceof GPUValidationError;\n      case 'internal':\n        return error instanceof GPUInternalError;\n    }\n  }\n\n  // Expect an uncapturederror event to occur. Note: this MUST be awaited, because\n  // otherwise it could erroneously pass by capturing an error from later in the test.\n  async expectUncapturedError(fn: Function): Promise<GPUUncapturedErrorEvent> {\n    return this.immediateAsyncExpectation(() => {\n      // MAINTENANCE_TODO: Make arbitrary timeout value a test runner variable\n      const TIMEOUT_IN_MS = 1000;\n\n      const promise: Promise<GPUUncapturedErrorEvent> = new Promise(resolve => {\n        const eventListener = ((event: GPUUncapturedErrorEvent) => {\n          this.debug(`Got uncaptured error event with ${event.error}`);\n          resolve(event);\n        }) as EventListener;\n\n        this.device.addEventListener('uncapturederror', eventListener, { once: true });\n      });\n\n      fn();\n\n      return raceWithRejectOnTimeout(\n        promise,\n        TIMEOUT_IN_MS,\n        'Timeout occurred waiting for uncaptured error'\n      );\n    });\n  }\n}\n\nexport const g = makeTestGroup(ErrorScopeTests);\n\ng.test('simple')\n  .desc(\n    `\nTests that error scopes catches their expected errors, firing an uncaptured error event otherwise.\n\n- Same error and error filter (popErrorScope should return the error)\n- Different error from filter (uncaptured error should result)\n    `\n  )\n  .params(u =>\n    u.combine('errorType', kGeneratableErrorScopeFilters).combine('errorFilter', kErrorScopeFilters)\n  )\n  .fn(async t => {\n    const { errorType, errorFilter } = t.params;\n    t.device.pushErrorScope(errorFilter);\n\n    if (errorType !== errorFilter) {\n      // Different error case\n      const uncapturedErrorEvent = await t.expectUncapturedError(() => {\n        t.generateError(errorType);\n      });\n      t.expect(t.isInstanceOfError(errorType, uncapturedErrorEvent.error));\n\n      const error = await t.device.popErrorScope();\n      t.expect(error === null);\n    } else {\n      // Same error as filter\n      t.generateError(errorType);\n      const error = await t.device.popErrorScope();\n      t.expect(t.isInstanceOfError(errorType, error));\n    }\n  });\n\ng.test('empty')\n  .desc(\n    `\nTests that popping an empty error scope stack should reject.\n    `\n  )\n  .fn(t => {\n    const promise = t.device.popErrorScope();\n    t.shouldReject('OperationError', promise, { allowMissingStack: true });\n  });\n\ng.test('parent_scope')\n  .desc(\n    `\nTests that an error bubbles to the correct parent scope.\n\n- Different error types as the parent scope\n- Different depths of non-capturing filters for the generated error\n    `\n  )\n  .params(u =>\n    u\n      .combine('errorFilter', kGeneratableErrorScopeFilters)\n      .combine('stackDepth', [1, 10, 100, 1000])\n  )\n  .fn(async t => {\n    const { errorFilter, stackDepth } = t.params;\n    t.device.pushErrorScope(errorFilter);\n\n    // Push a bunch of error filters onto the stack (none that match errorFilter)\n    const unmatchedFilters = kErrorScopeFilters.filter(filter => {\n      return filter !== errorFilter;\n    });\n    for (let i = 0; i < stackDepth; i++) {\n      t.device.pushErrorScope(unmatchedFilters[i % unmatchedFilters.length]);\n    }\n\n    // Cause the error and then pop all the unrelated filters.\n    t.generateError(errorFilter);\n    const promises = [];\n    for (let i = 0; i < stackDepth; i++) {\n      promises.push(t.device.popErrorScope());\n    }\n    const errors = await Promise.all(promises);\n    t.expect(errors.every(e => e === null));\n\n    // Finally the actual error should have been caught by the parent scope.\n    const error = await t.device.popErrorScope();\n    t.expect(t.isInstanceOfError(errorFilter, error));\n  });\n\ng.test('current_scope')\n  .desc(\n    `\nTests that an error does not bubbles to parent scopes when local scope matches.\n\n- Different error types as the current scope\n- Different depths of non-capturing filters for the generated error\n    `\n  )\n  .params(u =>\n    u\n      .combine('errorFilter', kGeneratableErrorScopeFilters)\n      .combine('stackDepth', [1, 10, 100, 1000, 100000])\n  )\n  .fn(async t => {\n    const { errorFilter, stackDepth } = t.params;\n\n    // Push a bunch of error filters onto the stack\n    for (let i = 0; i < stackDepth; i++) {\n      t.device.pushErrorScope(kErrorScopeFilters[i % kErrorScopeFilters.length]);\n    }\n\n    // Current scope should catch the error immediately.\n    t.device.pushErrorScope(errorFilter);\n    t.generateError(errorFilter);\n    const error = await t.device.popErrorScope();\n    t.expect(t.isInstanceOfError(errorFilter, error));\n\n    // Remaining scopes shouldn't catch anything.\n    const promises = [];\n    for (let i = 0; i < stackDepth; i++) {\n      promises.push(t.device.popErrorScope());\n    }\n    const errors = await Promise.all(promises);\n    t.expect(errors.every(e => e === null));\n  });\n\ng.test('balanced_siblings')\n  .desc(\n    `\nTests that sibling error scopes need to be balanced.\n\n- Different error types as the current scope\n- Different number of sibling errors\n    `\n  )\n  .params(u =>\n    u.combine('errorFilter', kErrorScopeFilters).combine('numErrors', [1, 10, 100, 1000])\n  )\n  .fn(async t => {\n    const { errorFilter, numErrors } = t.params;\n\n    const promises = [];\n    for (let i = 0; i < numErrors; i++) {\n      t.device.pushErrorScope(errorFilter);\n      promises.push(t.device.popErrorScope());\n    }\n\n    {\n      // Trying to pop an additional non-existing scope should reject.\n      const promise = t.device.popErrorScope();\n      t.shouldReject('OperationError', promise, { allowMissingStack: true });\n    }\n\n    const errors = await Promise.all(promises);\n    t.expect(errors.every(e => e === null));\n  });\n\ng.test('balanced_nesting')\n  .desc(\n    `\nTests that nested error scopes need to be balanced.\n\n- Different error types as the current scope\n- Different number of nested errors\n    `\n  )\n  .params(u =>\n    u.combine('errorFilter', kErrorScopeFilters).combine('numErrors', [1, 10, 100, 1000])\n  )\n  .fn(async t => {\n    const { errorFilter, numErrors } = t.params;\n\n    for (let i = 0; i < numErrors; i++) {\n      t.device.pushErrorScope(errorFilter);\n    }\n\n    const promises = [];\n    for (let i = 0; i < numErrors; i++) {\n      promises.push(t.device.popErrorScope());\n    }\n    const errors = await Promise.all(promises);\n    t.expect(errors.every(e => e === null));\n\n    {\n      // Trying to pop an additional non-existing scope should reject.\n      const promise = t.device.popErrorScope();\n      t.shouldReject('OperationError', promise, { allowMissingStack: true });\n    }\n  });\n"],"mappings":";;GAAA,OAAO,MAAMA,WAAW,GAAI;AAC5B;AACA;AACA;AACA;AACA;AACA;AACA,CAAC,CAED,SAASC,OAAO,QAAQ,sCAAsC;AAC9D,SAASC,aAAa,QAAQ,yCAAyC;AACvE,SAASC,MAAM,QAAQ,uCAAuC;AAC9D,SAASC,MAAM,EAAEC,uBAAuB,QAAQ,8BAA8B;AAC9E,SAASC,kBAAkB,EAAEC,6BAA6B,QAAQ,0BAA0B;;AAE5F,MAAMC,eAAe,SAASP,OAAO,CAAC;EACpCQ,OAAO,GAA0BC,SAAS;;EAE1C,IAAIC,MAAMA,CAAA,EAAc;IACtBP,MAAM,CAAC,IAAI,CAACK,OAAO,KAAKC,SAAS,CAAC;IAClC,OAAO,IAAI,CAACD,OAAO;EACrB;;EAEA,MAAeG,IAAIA,CAAA,EAAkB;IACnC,MAAM,KAAK,CAACA,IAAI,CAAC,CAAC;IAClB,MAAMC,GAAG,GAAGV,MAAM,CAAC,IAAI,CAACW,GAAG,CAAC;IAC5B,MAAMC,OAAO,GAAG,MAAMF,GAAG,CAACG,cAAc,CAAC,CAAC;IAC1CZ,MAAM,CAACW,OAAO,KAAK,IAAI,CAAC;;IAExB;IACA;IACA,MAAMJ,MAAM,GAAG,IAAI,CAACM,eAAe;MACjC,MAAMF,OAAO,CAACG,aAAa,CAAC;QAC1BC,cAAc,EAAE;UACdC,qBAAqB,EAAEL,OAAO,CAACM,MAAM,CAACD,qBAAqB;UAC3DE,qBAAqB,EAAEP,OAAO,CAACM,MAAM,CAACC;QACxC;MACF,CAAC;IACH,CAAC;IACDlB,MAAM,CAACO,MAAM,KAAK,IAAI,CAAC;IACvB,IAAI,CAACF,OAAO,GAAGE,MAAM;EACvB;;EAEA;EACA;EACA;EACAY,aAAaA,CAACC,MAAsB,EAAQ;IAC1C,QAAQA,MAAM;MACZ,KAAK,eAAe;QAClB,IAAI,CAACP,eAAe;UAClB,IAAI,CAACN,MAAM,CAACc,aAAa,CAAC;YACxB;YACAC,MAAM,EAAE,aAAa;YACrBC,KAAK,EAAEC,eAAe,CAACC,QAAQ;YAC/BC,IAAI,EAAE;YACJ,IAAI,CAACnB,MAAM,CAACU,MAAM,CAACD,qBAAqB;YACxC,IAAI,CAACT,MAAM,CAACU,MAAM,CAACD,qBAAqB;YACxC,IAAI,CAACT,MAAM,CAACU,MAAM,CAACC,qBAAqB;;UAE5C,CAAC;QACH,CAAC;QACD;MACF,KAAK,YAAY;QACf;QACA,IAAI,CAACL,eAAe;UAClB,IAAI,CAACN,MAAM,CAACoB,YAAY,CAAC;YACvBD,IAAI,EAAE,IAAI;YACVH,KAAK,EAAE,MAAM,CAAE;UACjB,CAAC;QACH,CAAC;QACD;IACJ;IACA;IACA,IAAI,CAAChB,MAAM,CAACqB,KAAK,CAACC,MAAM,CAAC,EAAE,CAAC;EAC9B;;EAEA;EACAC,iBAAiBA,CAACV,MAAsB,EAAEW,KAAsB,EAAW;IACzE,QAAQX,MAAM;MACZ,KAAK,eAAe;QAClB,OAAOW,KAAK,YAAYC,mBAAmB;MAC7C,KAAK,YAAY;QACf,OAAOD,KAAK,YAAYE,kBAAkB;MAC5C,KAAK,UAAU;QACb,OAAOF,KAAK,YAAYG,gBAAgB;IAC5C;EACF;;EAEA;EACA;EACA,MAAMC,qBAAqBA,CAACC,EAAY,EAAoC;IAC1E,OAAO,IAAI,CAACC,yBAAyB,CAAC,MAAM;MAC1C;MACA,MAAMC,aAAa,GAAG,IAAI;;MAE1B,MAAMC,OAAyC,GAAG,IAAIC,OAAO,CAAC,CAAAC,OAAO,KAAI;QACvE,MAAMC,aAAa,GAAIA,CAACC,KAA8B,KAAK;UACzD,IAAI,CAACC,KAAK,CAAE,mCAAkCD,KAAK,CAACZ,KAAM,EAAC,CAAC;UAC5DU,OAAO,CAACE,KAAK,CAAC;QAChB,CAAmB;;QAEnB,IAAI,CAACpC,MAAM,CAACsC,gBAAgB,CAAC,iBAAiB,EAAEH,aAAa,EAAE,EAAEI,IAAI,EAAE,IAAI,CAAC,CAAC,CAAC;MAChF,CAAC,CAAC;;MAEFV,EAAE,CAAC,CAAC;;MAEJ,OAAOnC,uBAAuB;QAC5BsC,OAAO;QACPD,aAAa;QACb;MACF,CAAC;IACH,CAAC,CAAC;EACJ;AACF;;AAEA,OAAO,MAAMS,CAAC,GAAGjD,aAAa,CAACM,eAAe,CAAC;;AAE/C2C,CAAC,CAACC,IAAI,CAAC,QAAQ,CAAC;AACbC,IAAI;EACF;AACL;AACA;AACA;AACA;AACA;AACE,CAAC;AACAC,MAAM,CAAC,CAAAC,CAAC;AACPA,CAAC,CAACC,OAAO,CAAC,WAAW,EAAEjD,6BAA6B,CAAC,CAACiD,OAAO,CAAC,aAAa,EAAElD,kBAAkB;AACjG,CAAC;AACAkC,EAAE,CAAC,OAAMiB,CAAC,KAAI;EACb,MAAM,EAAEC,SAAS,EAAEC,WAAW,CAAC,CAAC,GAAGF,CAAC,CAACH,MAAM;EAC3CG,CAAC,CAAC9C,MAAM,CAACiD,cAAc,CAACD,WAAW,CAAC;;EAEpC,IAAID,SAAS,KAAKC,WAAW,EAAE;IAC7B;IACA,MAAME,oBAAoB,GAAG,MAAMJ,CAAC,CAAClB,qBAAqB,CAAC,MAAM;MAC/DkB,CAAC,CAAClC,aAAa,CAACmC,SAAS,CAAC;IAC5B,CAAC,CAAC;IACFD,CAAC,CAACK,MAAM,CAACL,CAAC,CAACvB,iBAAiB,CAACwB,SAAS,EAAEG,oBAAoB,CAAC1B,KAAK,CAAC,CAAC;;IAEpE,MAAMA,KAAK,GAAG,MAAMsB,CAAC,CAAC9C,MAAM,CAACoD,aAAa,CAAC,CAAC;IAC5CN,CAAC,CAACK,MAAM,CAAC3B,KAAK,KAAK,IAAI,CAAC;EAC1B,CAAC,MAAM;IACL;IACAsB,CAAC,CAAClC,aAAa,CAACmC,SAAS,CAAC;IAC1B,MAAMvB,KAAK,GAAG,MAAMsB,CAAC,CAAC9C,MAAM,CAACoD,aAAa,CAAC,CAAC;IAC5CN,CAAC,CAACK,MAAM,CAACL,CAAC,CAACvB,iBAAiB,CAACwB,SAAS,EAAEvB,KAAK,CAAC,CAAC;EACjD;AACF,CAAC,CAAC;;AAEJgB,CAAC,CAACC,IAAI,CAAC,OAAO,CAAC;AACZC,IAAI;EACF;AACL;AACA;AACE,CAAC;AACAb,EAAE,CAAC,CAAAiB,CAAC,KAAI;EACP,MAAMd,OAAO,GAAGc,CAAC,CAAC9C,MAAM,CAACoD,aAAa,CAAC,CAAC;EACxCN,CAAC,CAACO,YAAY,CAAC,gBAAgB,EAAErB,OAAO,EAAE,EAAEsB,iBAAiB,EAAE,IAAI,CAAC,CAAC,CAAC;AACxE,CAAC,CAAC;;AAEJd,CAAC,CAACC,IAAI,CAAC,cAAc,CAAC;AACnBC,IAAI;EACF;AACL;AACA;AACA;AACA;AACA;AACE,CAAC;AACAC,MAAM,CAAC,CAAAC,CAAC;AACPA,CAAC;AACEC,OAAO,CAAC,aAAa,EAAEjD,6BAA6B,CAAC;AACrDiD,OAAO,CAAC,YAAY,EAAE,CAAC,CAAC,EAAE,EAAE,EAAE,GAAG,EAAE,IAAI,CAAC;AAC7C,CAAC;AACAhB,EAAE,CAAC,OAAMiB,CAAC,KAAI;EACb,MAAM,EAAEE,WAAW,EAAEO,UAAU,CAAC,CAAC,GAAGT,CAAC,CAACH,MAAM;EAC5CG,CAAC,CAAC9C,MAAM,CAACiD,cAAc,CAACD,WAAW,CAAC;;EAEpC;EACA,MAAMQ,gBAAgB,GAAG7D,kBAAkB,CAACkB,MAAM,CAAC,CAAAA,MAAM,KAAI;IAC3D,OAAOA,MAAM,KAAKmC,WAAW;EAC/B,CAAC,CAAC;EACF,KAAK,IAAIS,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGF,UAAU,EAAEE,CAAC,EAAE,EAAE;IACnCX,CAAC,CAAC9C,MAAM,CAACiD,cAAc,CAACO,gBAAgB,CAACC,CAAC,GAAGD,gBAAgB,CAACE,MAAM,CAAC,CAAC;EACxE;;EAEA;EACAZ,CAAC,CAAClC,aAAa,CAACoC,WAAW,CAAC;EAC5B,MAAMW,QAAQ,GAAG,EAAE;EACnB,KAAK,IAAIF,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGF,UAAU,EAAEE,CAAC,EAAE,EAAE;IACnCE,QAAQ,CAACC,IAAI,CAACd,CAAC,CAAC9C,MAAM,CAACoD,aAAa,CAAC,CAAC,CAAC;EACzC;EACA,MAAMS,MAAM,GAAG,MAAM5B,OAAO,CAAC6B,GAAG,CAACH,QAAQ,CAAC;EAC1Cb,CAAC,CAACK,MAAM,CAACU,MAAM,CAACE,KAAK,CAAC,CAAAC,CAAC,KAAIA,CAAC,KAAK,IAAI,CAAC,CAAC;;EAEvC;EACA,MAAMxC,KAAK,GAAG,MAAMsB,CAAC,CAAC9C,MAAM,CAACoD,aAAa,CAAC,CAAC;EAC5CN,CAAC,CAACK,MAAM,CAACL,CAAC,CAACvB,iBAAiB,CAACyB,WAAW,EAAExB,KAAK,CAAC,CAAC;AACnD,CAAC,CAAC;;AAEJgB,CAAC,CAACC,IAAI,CAAC,eAAe,CAAC;AACpBC,IAAI;EACF;AACL;AACA;AACA;AACA;AACA;AACE,CAAC;AACAC,MAAM,CAAC,CAAAC,CAAC;AACPA,CAAC;AACEC,OAAO,CAAC,aAAa,EAAEjD,6BAA6B,CAAC;AACrDiD,OAAO,CAAC,YAAY,EAAE,CAAC,CAAC,EAAE,EAAE,EAAE,GAAG,EAAE,IAAI,EAAE,MAAM,CAAC;AACrD,CAAC;AACAhB,EAAE,CAAC,OAAMiB,CAAC,KAAI;EACb,MAAM,EAAEE,WAAW,EAAEO,UAAU,CAAC,CAAC,GAAGT,CAAC,CAACH,MAAM;;EAE5C;EACA,KAAK,IAAIc,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGF,UAAU,EAAEE,CAAC,EAAE,EAAE;IACnCX,CAAC,CAAC9C,MAAM,CAACiD,cAAc,CAACtD,kBAAkB,CAAC8D,CAAC,GAAG9D,kBAAkB,CAAC+D,MAAM,CAAC,CAAC;EAC5E;;EAEA;EACAZ,CAAC,CAAC9C,MAAM,CAACiD,cAAc,CAACD,WAAW,CAAC;EACpCF,CAAC,CAAClC,aAAa,CAACoC,WAAW,CAAC;EAC5B,MAAMxB,KAAK,GAAG,MAAMsB,CAAC,CAAC9C,MAAM,CAACoD,aAAa,CAAC,CAAC;EAC5CN,CAAC,CAACK,MAAM,CAACL,CAAC,CAACvB,iBAAiB,CAACyB,WAAW,EAAExB,KAAK,CAAC,CAAC;;EAEjD;EACA,MAAMmC,QAAQ,GAAG,EAAE;EACnB,KAAK,IAAIF,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGF,UAAU,EAAEE,CAAC,EAAE,EAAE;IACnCE,QAAQ,CAACC,IAAI,CAACd,CAAC,CAAC9C,MAAM,CAACoD,aAAa,CAAC,CAAC,CAAC;EACzC;EACA,MAAMS,MAAM,GAAG,MAAM5B,OAAO,CAAC6B,GAAG,CAACH,QAAQ,CAAC;EAC1Cb,CAAC,CAACK,MAAM,CAACU,MAAM,CAACE,KAAK,CAAC,CAAAC,CAAC,KAAIA,CAAC,KAAK,IAAI,CAAC,CAAC;AACzC,CAAC,CAAC;;AAEJxB,CAAC,CAACC,IAAI,CAAC,mBAAmB,CAAC;AACxBC,IAAI;EACF;AACL;AACA;AACA;AACA;AACA;AACE,CAAC;AACAC,MAAM,CAAC,CAAAC,CAAC;AACPA,CAAC,CAACC,OAAO,CAAC,aAAa,EAAElD,kBAAkB,CAAC,CAACkD,OAAO,CAAC,WAAW,EAAE,CAAC,CAAC,EAAE,EAAE,EAAE,GAAG,EAAE,IAAI,CAAC;AACtF,CAAC;AACAhB,EAAE,CAAC,OAAMiB,CAAC,KAAI;EACb,MAAM,EAAEE,WAAW,EAAEiB,SAAS,CAAC,CAAC,GAAGnB,CAAC,CAACH,MAAM;;EAE3C,MAAMgB,QAAQ,GAAG,EAAE;EACnB,KAAK,IAAIF,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGQ,SAAS,EAAER,CAAC,EAAE,EAAE;IAClCX,CAAC,CAAC9C,MAAM,CAACiD,cAAc,CAACD,WAAW,CAAC;IACpCW,QAAQ,CAACC,IAAI,CAACd,CAAC,CAAC9C,MAAM,CAACoD,aAAa,CAAC,CAAC,CAAC;EACzC;;EAEA;IACE;IACA,MAAMpB,OAAO,GAAGc,CAAC,CAAC9C,MAAM,CAACoD,aAAa,CAAC,CAAC;IACxCN,CAAC,CAACO,YAAY,CAAC,gBAAgB,EAAErB,OAAO,EAAE,EAAEsB,iBAAiB,EAAE,IAAI,CAAC,CAAC,CAAC;EACxE;;EAEA,MAAMO,MAAM,GAAG,MAAM5B,OAAO,CAAC6B,GAAG,CAACH,QAAQ,CAAC;EAC1Cb,CAAC,CAACK,MAAM,CAACU,MAAM,CAACE,KAAK,CAAC,CAAAC,CAAC,KAAIA,CAAC,KAAK,IAAI,CAAC,CAAC;AACzC,CAAC,CAAC;;AAEJxB,CAAC,CAACC,IAAI,CAAC,kBAAkB,CAAC;AACvBC,IAAI;EACF;AACL;AACA;AACA;AACA;AACA;AACE,CAAC;AACAC,MAAM,CAAC,CAAAC,CAAC;AACPA,CAAC,CAACC,OAAO,CAAC,aAAa,EAAElD,kBAAkB,CAAC,CAACkD,OAAO,CAAC,WAAW,EAAE,CAAC,CAAC,EAAE,EAAE,EAAE,GAAG,EAAE,IAAI,CAAC;AACtF,CAAC;AACAhB,EAAE,CAAC,OAAMiB,CAAC,KAAI;EACb,MAAM,EAAEE,WAAW,EAAEiB,SAAS,CAAC,CAAC,GAAGnB,CAAC,CAACH,MAAM;;EAE3C,KAAK,IAAIc,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGQ,SAAS,EAAER,CAAC,EAAE,EAAE;IAClCX,CAAC,CAAC9C,MAAM,CAACiD,cAAc,CAACD,WAAW,CAAC;EACtC;;EAEA,MAAMW,QAAQ,GAAG,EAAE;EACnB,KAAK,IAAIF,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGQ,SAAS,EAAER,CAAC,EAAE,EAAE;IAClCE,QAAQ,CAACC,IAAI,CAACd,CAAC,CAAC9C,MAAM,CAACoD,aAAa,CAAC,CAAC,CAAC;EACzC;EACA,MAAMS,MAAM,GAAG,MAAM5B,OAAO,CAAC6B,GAAG,CAACH,QAAQ,CAAC;EAC1Cb,CAAC,CAACK,MAAM,CAACU,MAAM,CAACE,KAAK,CAAC,CAAAC,CAAC,KAAIA,CAAC,KAAK,IAAI,CAAC,CAAC;;EAEvC;IACE;IACA,MAAMhC,OAAO,GAAGc,CAAC,CAAC9C,MAAM,CAACoD,aAAa,CAAC,CAAC;IACxCN,CAAC,CAACO,YAAY,CAAC,gBAAgB,EAAErB,OAAO,EAAE,EAAEsB,iBAAiB,EAAE,IAAI,CAAC,CAAC,CAAC;EACxE;AACF,CAAC,CAAC"}