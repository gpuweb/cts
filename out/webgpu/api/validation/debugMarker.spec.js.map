{"version":3,"file":"debugMarker.spec.js","names":["description","makeTestGroup","ValidationTest","F","beginRenderPass","commandEncoder","attachmentTexture","device","createTexture","format","size","width","height","depthOrArrayLayers","usage","GPUTextureUsage","RENDER_ATTACHMENT","trackForCleanup","colorAttachments","view","createView","clearValue","r","g","b","a","loadOp","storeOp","test","desc","paramsSubcasesOnly","u","combine","fn","t","pushCount","popCount","params","encoder","createCommandEncoder","i","pushDebugGroup","insertDebugMarker","popDebugGroup","expectValidationError","finish","beginSubcases","passType","pass","beginComputePass","end"],"sources":["../../../../src/webgpu/api/validation/debugMarker.spec.ts"],"sourcesContent":["export const description = `\nTest validation of pushDebugGroup, popDebugGroup, and insertDebugMarker.\n`;\n\nimport { makeTestGroup } from '../../../common/framework/test_group.js';\n\nimport { ValidationTest } from './validation_test.js';\n\nclass F extends ValidationTest {\n  beginRenderPass(commandEncoder: GPUCommandEncoder): GPURenderPassEncoder {\n    const attachmentTexture = this.device.createTexture({\n      format: 'rgba8unorm',\n      size: { width: 16, height: 16, depthOrArrayLayers: 1 },\n      usage: GPUTextureUsage.RENDER_ATTACHMENT,\n    });\n    this.trackForCleanup(attachmentTexture);\n    return commandEncoder.beginRenderPass({\n      colorAttachments: [\n        {\n          view: attachmentTexture.createView(),\n          clearValue: { r: 1.0, g: 0.0, b: 0.0, a: 1.0 },\n          loadOp: 'clear',\n          storeOp: 'store',\n        },\n      ],\n    });\n  }\n}\n\nexport const g = makeTestGroup(F);\n\ng.test('push_pop_call_count_unbalance,command_encoder')\n  .desc(\n    `\n  Test that a validation error is generated if {push,pop} debug group call count is not paired.\n  `\n  )\n  .paramsSubcasesOnly(u =>\n    u //\n      .combine('pushCount', [1, 2, 3])\n      .combine('popCount', [1, 2, 3])\n  )\n  .fn(t => {\n    const { pushCount, popCount } = t.params;\n\n    const encoder = t.device.createCommandEncoder();\n\n    for (let i = 0; i < pushCount; ++i) {\n      encoder.pushDebugGroup('EventStart');\n    }\n\n    encoder.insertDebugMarker('Marker');\n\n    for (let i = 0; i < popCount; ++i) {\n      encoder.popDebugGroup();\n    }\n\n    t.expectValidationError(() => {\n      encoder.finish();\n    }, pushCount !== popCount);\n  });\n\ng.test('push_pop_call_count_unbalance,render_compute_pass')\n  .desc(\n    `\n  Test that a validation error is generated if {push,pop} debug group call count is not paired in\n  ComputePassEncoder and RenderPassEncoder.\n  `\n  )\n  .params(u =>\n    u //\n      .combine('passType', ['compute', 'render'])\n      .beginSubcases()\n      .combine('pushCount', [1, 2, 3])\n      .combine('popCount', [1, 2, 3])\n  )\n  .fn(t => {\n    const { passType, pushCount, popCount } = t.params;\n\n    const encoder = t.device.createCommandEncoder();\n\n    const pass = passType === 'compute' ? encoder.beginComputePass() : t.beginRenderPass(encoder);\n\n    for (let i = 0; i < pushCount; ++i) {\n      pass.pushDebugGroup('EventStart');\n    }\n\n    pass.insertDebugMarker('Marker');\n\n    for (let i = 0; i < popCount; ++i) {\n      pass.popDebugGroup();\n    }\n\n    t.expectValidationError(() => {\n      pass.end();\n      encoder.finish();\n    }, pushCount !== popCount);\n  });\n"],"mappings":"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"}