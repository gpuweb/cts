{"version":3,"sources":["../../../../../src/webgpu/api/validation/buffer/create.spec.ts"],"names":["description","makeTestGroup","assert","kBufferSizeAlignment","GPUConst","kMaxSafeMultipleOf8","ValidationTest","g","test","desc","params","u","combine","beginSubcases","unimplemented","BufferUsage","paramsSubcasesOnly","combineWithParams","_valid","usage","UNIFORM","size","STORAGE","MAP_WRITE","MAP_READ","fn","t","expectGPUError","device","createBuffer"],"mappings":"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","sourcesContent":["export const description = `\nTests for validation in createBuffer.\n`;\n\nimport { makeTestGroup } from '../../../../common/framework/test_group.js';\nimport { assert } from '../../../../common/util/util.js';\nimport { kBufferSizeAlignment } from '../../../capability_info.js';\nimport { GPUConst } from '../../../constants.js';\nimport { kMaxSafeMultipleOf8 } from '../../../util/math.js';\nimport { ValidationTest } from '../validation_test.js';\n\nexport const g = makeTestGroup(ValidationTest);\n\nassert(kBufferSizeAlignment === 4);\ng.test('size')\n  .desc('Test buffer size alignment.')\n  .params(u =>\n    u\n      .combine('mappedAtCreation', [false, true])\n      .beginSubcases()\n      .combine('size', [\n        0,\n        kBufferSizeAlignment * 0.5,\n        kBufferSizeAlignment,\n        kBufferSizeAlignment * 1.5,\n        kBufferSizeAlignment * 2,\n      ])\n  )\n  .unimplemented();\n\ng.test('usage')\n  .desc('Test combinations of (one to two?) usage flags.')\n  .params(u =>\n    u //\n      .beginSubcases()\n      .combine('mappedAtCreation', [false, true])\n      .combine('usage', [\n        // TODO\n      ])\n  )\n  .unimplemented();\n\nconst BufferUsage = GPUConst.BufferUsage;\ng.test('createBuffer_invalid_and_oom')\n  .desc(\n    `When creating a mappable buffer, it's expected that shmem may be immediately allocated\n(in the content process, before validation occurs in the GPU process). If the buffer is really\nlarge, though, it could fail shmem allocation before validation fails. Ensure that OOM error is\nhidden behind the \"more severe\" validation error.`\n  )\n  .paramsSubcasesOnly(u =>\n    u.combineWithParams([\n      { _valid: true, usage: BufferUsage.UNIFORM, size: 16 },\n      { _valid: true, usage: BufferUsage.STORAGE, size: 16 },\n      // Invalid because UNIFORM is not allowed with map usages.\n      { usage: BufferUsage.MAP_WRITE | BufferUsage.UNIFORM, size: 16 },\n      { usage: BufferUsage.MAP_WRITE | BufferUsage.UNIFORM, size: kMaxSafeMultipleOf8 },\n      { usage: BufferUsage.MAP_WRITE | BufferUsage.UNIFORM, size: 0x20_0000_0000 }, // 128 GiB\n      { usage: BufferUsage.MAP_READ | BufferUsage.UNIFORM, size: 16 },\n      { usage: BufferUsage.MAP_READ | BufferUsage.UNIFORM, size: kMaxSafeMultipleOf8 },\n      { usage: BufferUsage.MAP_READ | BufferUsage.UNIFORM, size: 0x20_0000_0000 }, // 128 GiB\n      // Invalid because size is not aligned to 4 bytes.\n      { usage: BufferUsage.STORAGE, size: 15 },\n      { usage: BufferUsage.STORAGE, size: kMaxSafeMultipleOf8 - 1 },\n      { usage: BufferUsage.STORAGE, size: 0x20_0000_0000 - 1 }, // 128 GiB - 1\n    ] as const)\n  )\n  .fn(t => {\n    const { _valid, usage, size } = t.params;\n\n    t.expectGPUError('validation', () => t.device.createBuffer({ size, usage }), !_valid);\n  });\n"],"file":"create.spec.js"}