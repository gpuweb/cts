{"version":3,"file":"common.js","names":["getTextureFormatType","getFragmentShaderCodeWithOutput","getPlainTypeInfo","kDefaultVertexShaderCode","AllFeaturesMaxLimitsValidationTest","values","getDescriptorForCreateRenderPipelineValidationTest","device","options","primitive","targets","format","multisample","depthStencil","fragmentShaderCode","plainType","componentCount","noFragment","fragmentConstants","vertex","module","createShaderModule","code","entryPoint","fragment","undefined","constants","layout","createPipelineLayout","bindGroupLayouts","CreateRenderPipelineValidationTest","getDescriptor","getPipelineLayout"],"sources":["../../../../../src/webgpu/api/validation/render_pipeline/common.ts"],"sourcesContent":["import { ColorTextureFormat, getTextureFormatType } from '../../../format_info.js';\nimport {\n  getFragmentShaderCodeWithOutput,\n  getPlainTypeInfo,\n  kDefaultVertexShaderCode,\n} from '../../../util/shader.js';\nimport { AllFeaturesMaxLimitsValidationTest } from '../validation_test.js';\n\nexport type ColorTargetState = GPUColorTargetState & { format: ColorTextureFormat };\n\nconst values = [0, 1, 0, 1];\nexport function getDescriptorForCreateRenderPipelineValidationTest(\n  device: GPUDevice,\n  options: {\n    primitive?: GPUPrimitiveState;\n    targets?: ColorTargetState[];\n    multisample?: GPUMultisampleState;\n    depthStencil?: GPUDepthStencilState;\n    fragmentShaderCode?: string;\n    noFragment?: boolean;\n    fragmentConstants?: Record<string, GPUPipelineConstantValue>;\n  } = {}\n): GPURenderPipelineDescriptor {\n  const {\n    primitive = {},\n    targets = [{ format: 'rgba8unorm' }] as const,\n    multisample = {},\n    depthStencil,\n    fragmentShaderCode = getFragmentShaderCodeWithOutput([\n      {\n        values,\n        plainType: getPlainTypeInfo(\n          getTextureFormatType(targets[0] ? targets[0].format : 'rgba8unorm')\n        ),\n        componentCount: 4,\n      },\n    ]),\n    noFragment = false,\n    fragmentConstants = {},\n  } = options;\n\n  return {\n    vertex: {\n      module: device.createShaderModule({\n        code: kDefaultVertexShaderCode,\n      }),\n      entryPoint: 'main',\n    },\n    fragment: noFragment\n      ? undefined\n      : {\n          module: device.createShaderModule({\n            code: fragmentShaderCode,\n          }),\n          entryPoint: 'main',\n          targets,\n          constants: fragmentConstants,\n        },\n    layout: device.createPipelineLayout({ bindGroupLayouts: [] }),\n    primitive,\n    multisample,\n    depthStencil,\n  };\n}\n\nexport class CreateRenderPipelineValidationTest extends AllFeaturesMaxLimitsValidationTest {\n  getDescriptor(\n    options: {\n      primitive?: GPUPrimitiveState;\n      targets?: ColorTargetState[];\n      multisample?: GPUMultisampleState;\n      depthStencil?: GPUDepthStencilState;\n      fragmentShaderCode?: string;\n      noFragment?: boolean;\n      fragmentConstants?: Record<string, GPUPipelineConstantValue>;\n    } = {}\n  ): GPURenderPipelineDescriptor {\n    return getDescriptorForCreateRenderPipelineValidationTest(this.device, options);\n  }\n\n  getPipelineLayout(): GPUPipelineLayout {\n    return this.device.createPipelineLayout({ bindGroupLayouts: [] });\n  }\n}\n"],"mappings":";;GAAA,SAA6BA,oBAAoB,QAAQ,yBAAyB,CAClF,SACEC,+BAA+B;AAC/BC,gBAAgB;AAChBC,wBAAwB;AACnB,yBAAyB;AAChC,SAASC,kCAAkC,QAAQ,uBAAuB;;;;AAI1E,MAAMC,MAAM,GAAG,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC;AAC3B,OAAO,SAASC,kDAAkDA;AAChEC,MAAiB;AACjBC,OAQC;;;;;;;;AAAG,CAAC,CAAC;AACuB;EAC7B,MAAM;IACJC,SAAS,GAAG,CAAC,CAAC;IACdC,OAAO,GAAG,CAAC,EAAEC,MAAM,EAAE,YAAY,CAAC,CAAC,CAAU;IAC7CC,WAAW,GAAG,CAAC,CAAC;IAChBC,YAAY;IACZC,kBAAkB,GAAGb,+BAA+B,CAAC;IACnD;MACEI,MAAM;MACNU,SAAS,EAAEb,gBAAgB;QACzBF,oBAAoB,CAACU,OAAO,CAAC,CAAC,CAAC,GAAGA,OAAO,CAAC,CAAC,CAAC,CAACC,MAAM,GAAG,YAAY;MACpE,CAAC;MACDK,cAAc,EAAE;IAClB,CAAC;IACF,CAAC;IACFC,UAAU,GAAG,KAAK;IAClBC,iBAAiB,GAAG,CAAC;EACvB,CAAC,GAAGV,OAAO;;EAEX,OAAO;IACLW,MAAM,EAAE;MACNC,MAAM,EAAEb,MAAM,CAACc,kBAAkB,CAAC;QAChCC,IAAI,EAAEnB;MACR,CAAC,CAAC;MACFoB,UAAU,EAAE;IACd,CAAC;IACDC,QAAQ,EAAEP,UAAU;IAChBQ,SAAS;IACT;MACEL,MAAM,EAAEb,MAAM,CAACc,kBAAkB,CAAC;QAChCC,IAAI,EAAER;MACR,CAAC,CAAC;MACFS,UAAU,EAAE,MAAM;MAClBb,OAAO;MACPgB,SAAS,EAAER;IACb,CAAC;IACLS,MAAM,EAAEpB,MAAM,CAACqB,oBAAoB,CAAC,EAAEC,gBAAgB,EAAE,EAAE,CAAC,CAAC,CAAC;IAC7DpB,SAAS;IACTG,WAAW;IACXC;EACF,CAAC;AACH;;AAEA,OAAO,MAAMiB,kCAAkC,SAAS1B,kCAAkC,CAAC;EACzF2B,aAAaA;EACXvB,OAQC;;;;;;;;EAAG,CAAC,CAAC;EACuB;IAC7B,OAAOF,kDAAkD,CAAC,IAAI,CAACC,MAAM,EAAEC,OAAO,CAAC;EACjF;;EAEAwB,iBAAiBA,CAAA,EAAsB;IACrC,OAAO,IAAI,CAACzB,MAAM,CAACqB,oBAAoB,CAAC,EAAEC,gBAAgB,EAAE,EAAE,CAAC,CAAC,CAAC;EACnE;AACF"}