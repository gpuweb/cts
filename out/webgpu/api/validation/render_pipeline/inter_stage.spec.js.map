{"version":3,"file":"inter_stage.spec.js","names":["description","makeTestGroup","hasFeature","range","unreachable","vtu","CreateRenderPipelineValidationTest","getVarName","i","skipIfDisallowedInterpolationParameter","t","wgsl","isCompatibility","s","includes","skip","InterStageMatchingValidationTest","getVertexStateWithOutputs","outputs","module","device","createShaderModule","code","map","v","replace","join","entryPoint","getFragmentStateWithInputs","inputs","hasBuiltinPosition","targets","format","features","getDescriptorWithStates","vertex","fragment","layout","g","test","desc","params","u","combine","combineWithParams","_success","fn","isAsync","descriptor","doCreateRenderPipelineTest","output","input","_compat_success","beforeAllSubcases","shouldSucceed","locationDelta","maxInterStageShaderVariables","limits","location","numVariablesDelta","topology","numVec4","primitive","beginSubcases","builtins","overLimit","skipIf","push","length","success"],"sources":["../../../../../src/webgpu/api/validation/render_pipeline/inter_stage.spec.ts"],"sourcesContent":["export const description = `\nInterface matching between vertex and fragment shader validation for createRenderPipeline.\n`;\n\nimport { makeTestGroup } from '../../../../common/framework/test_group.js';\nimport { hasFeature, range, unreachable } from '../../../../common/util/util.js';\nimport { GPUTestSubcaseBatchState } from '../../../gpu_test.js';\nimport * as vtu from '../validation_test_utils.js';\n\nimport { CreateRenderPipelineValidationTest } from './common.js';\n\nfunction getVarName(i: number) {\n  return `v${i}`;\n}\n\nfunction skipIfDisallowedInterpolationParameter(t: GPUTestSubcaseBatchState, ...wgsl: string[]) {\n  if (t.isCompatibility) {\n    for (const s of wgsl) {\n      if (s.includes('linear') || s.includes('sample')) {\n        t.skip(`unsupported interpolation parameter in compat: ${wgsl}`);\n      }\n    }\n  }\n}\n\nclass InterStageMatchingValidationTest extends CreateRenderPipelineValidationTest {\n  getVertexStateWithOutputs(outputs: readonly string[]): GPUVertexState {\n    return {\n      module: this.device.createShaderModule({\n        code: `\n        struct A {\n            ${outputs.map((v, i) => v.replace('__', getVarName(i))).join(',\\n')},\n            @builtin(position) pos: vec4<f32>,\n        }\n        @vertex fn main() -> A {\n            var vertexOut: A;\n            vertexOut.pos = vec4<f32>(0.0, 0.0, 0.0, 1.0);\n            return vertexOut;\n        }\n        `,\n      }),\n      entryPoint: 'main',\n    };\n  }\n\n  getFragmentStateWithInputs(\n    inputs: readonly string[],\n    hasBuiltinPosition: boolean = false\n  ): GPUFragmentState {\n    return {\n      targets: [{ format: 'rgba8unorm' }],\n      module: this.device.createShaderModule({\n        code: `\n        ${hasFeature(this.device.features, 'primitive-index') ? 'enable primitive_index;' : ''}\n        ${hasFeature(this.device.features, 'subgroups') ? 'enable subgroups;' : ''}\n        struct B {\n            ${inputs.map((v, i) => v.replace('__', getVarName(i))).join(',\\n')},\n            ${hasBuiltinPosition ? '@builtin(position) pos: vec4<f32>' : ''}\n        }\n        @fragment fn main(fragmentIn: B) -> @location(0) vec4<f32> {\n            return vec4<f32>(1.0, 1.0, 1.0, 1.0);\n        }\n        `,\n      }),\n      entryPoint: 'main',\n    };\n  }\n\n  getDescriptorWithStates(\n    vertex: GPUVertexState,\n    fragment: GPUFragmentState\n  ): GPURenderPipelineDescriptor {\n    return {\n      layout: 'auto',\n      vertex,\n      fragment,\n    };\n  }\n}\n\nexport const g = makeTestGroup(InterStageMatchingValidationTest);\n\ng.test('location,mismatch')\n  .desc(`Tests that missing declaration at the same location should fail validation.`)\n  .params(u =>\n    u.combine('isAsync', [false, true]).combineWithParams([\n      { outputs: ['@location(0) __: f32'], inputs: ['@location(0) __: f32'], _success: true },\n      { outputs: ['@location(0) __: f32'], inputs: ['@location(1) __: f32'], _success: false },\n      { outputs: ['@location(1) __: f32'], inputs: ['@location(0) __: f32'], _success: false },\n      {\n        outputs: ['@location(0) __: f32', '@location(1) __: f32'],\n        inputs: ['@location(1) __: f32', '@location(0) __: f32'],\n        _success: true,\n      },\n      {\n        outputs: ['@location(1) __: f32', '@location(0) __: f32'],\n        inputs: ['@location(0) __: f32', '@location(1) __: f32'],\n        _success: true,\n      },\n    ])\n  )\n  .fn(t => {\n    const { isAsync, outputs, inputs, _success } = t.params;\n\n    const descriptor = t.getDescriptorWithStates(\n      t.getVertexStateWithOutputs(outputs),\n      t.getFragmentStateWithInputs(inputs)\n    );\n\n    vtu.doCreateRenderPipelineTest(t, isAsync, _success, descriptor);\n  });\n\ng.test('location,superset')\n  .desc(`Tests that validation should succeed when vertex output is superset of fragment input`)\n  .params(u => u.combine('isAsync', [false, true]))\n  .fn(t => {\n    const { isAsync } = t.params;\n\n    const descriptor = t.getDescriptorWithStates(\n      t.getVertexStateWithOutputs(['@location(0) vout0: f32', '@location(1) vout1: f32']),\n      t.getFragmentStateWithInputs(['@location(1) fin1: f32'])\n    );\n\n    vtu.doCreateRenderPipelineTest(t, isAsync, true, descriptor);\n  });\n\ng.test('location,subset')\n  .desc(`Tests that validation should fail when vertex output is a subset of fragment input.`)\n  .params(u => u.combine('isAsync', [false, true]))\n  .fn(t => {\n    const { isAsync } = t.params;\n\n    const descriptor = t.getDescriptorWithStates(\n      t.getVertexStateWithOutputs(['@location(0) vout0: f32']),\n      t.getFragmentStateWithInputs(['@location(0) fin0: f32', '@location(1) fin1: f32'])\n    );\n\n    vtu.doCreateRenderPipelineTest(t, isAsync, false, descriptor);\n  });\n\ng.test('type')\n  .desc(\n    `Tests that validation should fail when type of vertex output and fragment input at the same location doesn't match.`\n  )\n  .params(u =>\n    u.combine('isAsync', [false, true]).combineWithParams([\n      { output: 'f32', input: 'f32' },\n      { output: 'i32', input: 'f32' },\n      { output: 'u32', input: 'f32' },\n      { output: 'u32', input: 'i32' },\n      { output: 'i32', input: 'u32' },\n      { output: 'vec2<f32>', input: 'vec2<f32>' },\n      { output: 'vec3<f32>', input: 'vec2<f32>' },\n      { output: 'vec2<f32>', input: 'vec3<f32>' },\n      { output: 'vec2<f32>', input: 'f32' },\n      { output: 'f32', input: 'vec2<f32>' },\n    ])\n  )\n  .fn(t => {\n    const { isAsync, output, input } = t.params;\n\n    const descriptor = t.getDescriptorWithStates(\n      t.getVertexStateWithOutputs([`@location(0) @interpolate(flat, either) vout0: ${output}`]),\n      t.getFragmentStateWithInputs([`@location(0) @interpolate(flat, either) fin0: ${input}`])\n    );\n\n    vtu.doCreateRenderPipelineTest(t, isAsync, output === input, descriptor);\n  });\n\ng.test('interpolation_type')\n  .desc(\n    `Tests that validation should fail when interpolation type of vertex output and fragment input at the same location doesn't match.`\n  )\n  .params(u =>\n    u.combine('isAsync', [false, true]).combineWithParams([\n      // default is @interpolate(perspective, center)\n      { output: '', input: '' },\n      { output: '', input: '@interpolate(perspective)', _success: true },\n      { output: '', input: '@interpolate(perspective, center)', _success: true },\n      { output: '@interpolate(perspective)', input: '', _success: true },\n      { output: '', input: '@interpolate(linear)' },\n      { output: '@interpolate(perspective)', input: '@interpolate(perspective)' },\n      { output: '@interpolate(linear)', input: '@interpolate(perspective)' },\n      { output: '@interpolate(flat, either)', input: '@interpolate(perspective)' },\n      { output: '@interpolate(linear)', input: '@interpolate(flat, either)' },\n      {\n        output: '@interpolate(linear, center)',\n        input: '@interpolate(linear, center)',\n        _compat_success: false,\n      },\n    ])\n  )\n  .beforeAllSubcases(t => {\n    skipIfDisallowedInterpolationParameter(t, t.params.output, t.params.input);\n  })\n  .fn(t => {\n    const { isAsync, output, input, _success, _compat_success } = t.params;\n\n    const descriptor = t.getDescriptorWithStates(\n      t.getVertexStateWithOutputs([`@location(0) ${output} vout0: f32`]),\n      t.getFragmentStateWithInputs([`@location(0) ${input} fin0: f32`])\n    );\n\n    const shouldSucceed =\n      (_success ?? output === input) && (!t.isCompatibility || _compat_success !== false);\n\n    vtu.doCreateRenderPipelineTest(t, isAsync, shouldSucceed, descriptor);\n  });\n1;\ng.test('interpolation_sampling')\n  .desc(\n    `Tests that validation should fail when interpolation sampling of vertex output and fragment input at the same location doesn't match.`\n  )\n  .params(u =>\n    u.combine('isAsync', [false, true]).combineWithParams([\n      // default is @interpolate(perspective, center)\n      { output: '@interpolate(perspective)', input: '@interpolate(perspective)' },\n      {\n        output: '@interpolate(perspective)',\n        input: '@interpolate(perspective, center)',\n        _success: true,\n      },\n      {\n        output: '@interpolate(linear, center)',\n        input: '@interpolate(linear)',\n        _success: true,\n        _compat_success: false,\n      },\n      { output: '@interpolate(flat, either)', input: '@interpolate(flat, either)' },\n      { output: '@interpolate(perspective)', input: '@interpolate(perspective, sample)' },\n      { output: '@interpolate(perspective, center)', input: '@interpolate(perspective, sample)' },\n      {\n        output: '@interpolate(perspective, center)',\n        input: '@interpolate(perspective, centroid)',\n      },\n      { output: '@interpolate(perspective, centroid)', input: '@interpolate(perspective)' },\n    ])\n  )\n  .beforeAllSubcases(t => {\n    skipIfDisallowedInterpolationParameter(t, t.params.output, t.params.input);\n  })\n  .fn(t => {\n    const { isAsync, output, input, _success, _compat_success } = t.params;\n\n    const descriptor = t.getDescriptorWithStates(\n      t.getVertexStateWithOutputs([`@location(0) ${output} vout0: f32`]),\n      t.getFragmentStateWithInputs([`@location(0) ${input} fin0: f32`])\n    );\n\n    const shouldSucceed =\n      (_success ?? output === input) && (!t.isCompatibility || _compat_success !== false);\n\n    vtu.doCreateRenderPipelineTest(t, isAsync, shouldSucceed, descriptor);\n  });\n\ng.test('max_shader_variable_location')\n  .desc(\n    `Tests that validation should fail when there is location of user-defined output/input variable >= device.limits.maxInterStageShaderVariables`\n  )\n  .params(u =>\n    u\n      .combine('isAsync', [false, true])\n      // User defined variable location = maxInterStageShaderVariables + locationDelta\n      .combine('locationDelta', [0, -1, -2])\n  )\n  .fn(t => {\n    const { isAsync, locationDelta } = t.params;\n    const maxInterStageShaderVariables = t.device.limits.maxInterStageShaderVariables;\n    const location = maxInterStageShaderVariables + locationDelta;\n\n    const descriptor = t.getDescriptorWithStates(\n      t.getVertexStateWithOutputs([`@location(${location}) vout0: f32`]),\n      t.getFragmentStateWithInputs([`@location(${location}) fin0: f32`])\n    );\n\n    vtu.doCreateRenderPipelineTest(t, isAsync, location < maxInterStageShaderVariables, descriptor);\n  });\n\ng.test('max_variables_count,output')\n  .desc(\n    `Tests that validation should fail when all user-defined outputs > max vertex shader output\n    variables.`\n  )\n  .params(u =>\n    u.combine('isAsync', [false, true]).combineWithParams([\n      // Number of user-defined output variables in test shader =\n      //     device.limits.maxInterStageShaderVariables + numVariablesDelta\n      { numVariablesDelta: 0, topology: 'triangle-list', _success: true },\n      { numVariablesDelta: 1, topology: 'triangle-list', _success: false },\n      { numVariablesDelta: 0, topology: 'point-list', _success: false },\n      { numVariablesDelta: -1, topology: 'point-list', _success: true },\n    ] as const)\n  )\n  .fn(t => {\n    const { isAsync, numVariablesDelta, topology, _success } = t.params;\n\n    const numVec4 = t.device.limits.maxInterStageShaderVariables + numVariablesDelta;\n\n    const outputs = range(numVec4, i => `@location(${i}) vout${i}: vec4<f32>`);\n    const inputs = range(numVec4, i => `@location(${i}) fin${i}: vec4<f32>`);\n\n    const descriptor = t.getDescriptorWithStates(\n      t.getVertexStateWithOutputs(outputs),\n      t.getFragmentStateWithInputs(inputs)\n    );\n    descriptor.primitive = { topology };\n\n    vtu.doCreateRenderPipelineTest(t, isAsync, _success, descriptor);\n  });\n\ng.test('max_variables_count,input')\n  .desc(\n    `Tests that validation should fail when all user-defined inputs > max vertex shader output\n    variables (with varying proportions of builtins and user-defined variables).`\n  )\n  .params(u =>\n    u\n      .combine('isAsync', [false, true])\n      .combine('builtins', ['none', 'compat', 'all'])\n      .beginSubcases()\n      .combine('overLimit', [false, true])\n  )\n  .fn(t => {\n    const { isAsync, builtins, overLimit } = t.params;\n\n    const inputs: string[] = [];\n    switch (builtins) {\n      case 'all':\n        t.skipIf(t.isCompatibility);\n        inputs.push(\n          '@builtin(sample_mask) sample_mask_in: u32',\n          '@builtin(sample_index) sample_index_in: u32'\n        );\n        if (hasFeature(t.device.features, 'primitive-index')) {\n          inputs.push('@builtin(primitive_index) primitive_index_in: u32');\n        }\n        if (hasFeature(t.device.features, 'subgroups')) {\n          inputs.push(\n            '@builtin(subgroup_invocation_id) subgroup_invocation_id_in: u32',\n            '@builtin(subgroup_size) subgroup_size_in: u32'\n          );\n        }\n      // fallthrough\n      case 'compat':\n        inputs.push('@builtin(front_facing) front_facing_in: bool');\n      // fallthrough\n      case 'none':\n        break;\n      default:\n        unreachable();\n    }\n\n    const numVec4 =\n      t.device.limits.maxInterStageShaderVariables - inputs.length + (overLimit ? 1 : 0);\n\n    const outputs = range(numVec4, i => `@location(${i}) vout${i}: vec4<f32>`);\n    inputs.push(...range(numVec4, i => `@location(${i}) fin${i}: vec4<f32>`));\n\n    const descriptor = t.getDescriptorWithStates(\n      t.getVertexStateWithOutputs(outputs),\n      t.getFragmentStateWithInputs(inputs, true)\n    );\n\n    const success = !overLimit;\n    vtu.doCreateRenderPipelineTest(t, isAsync, success, descriptor);\n  });\n"],"mappings":"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"}