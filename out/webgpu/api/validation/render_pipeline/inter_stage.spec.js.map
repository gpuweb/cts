{"version":3,"file":"inter_stage.spec.js","names":["description","makeTestGroup","assert","range","CreateRenderPipelineValidationTest","getVarName","i","InterStageMatchingValidationTest","getVertexStateWithOutputs","outputs","module","device","createShaderModule","code","map","v","replace","join","entryPoint","getFragmentStateWithInputs","inputs","hasBuiltinPosition","targets","format","getDescriptorWithStates","vertex","fragment","layout","g","test","desc","params","u","combine","combineWithParams","_success","fn","t","isAsync","descriptor","doCreateRenderPipelineTest","unimplemented","output","input","locationDelta","maxInterStageShaderVariables","limits","location","numScalarDelta","topology","numScalarComponents","maxInterStageShaderComponents","numVec4","Math","floor","numTrailingScalars","numUserDefinedInterStageVariables","typeString","push","primitive","useExtraBuiltinInputs"],"sources":["../../../../../src/webgpu/api/validation/render_pipeline/inter_stage.spec.ts"],"sourcesContent":["export const description = `\nInterface matching between vertex and fragment shader validation for createRenderPipeline.\n`;\n\nimport { makeTestGroup } from '../../../../common/framework/test_group.js';\nimport { assert, range } from '../../../../common/util/util.js';\n\nimport { CreateRenderPipelineValidationTest } from './common.js';\n\nfunction getVarName(i: number) {\n  return `v${i}`;\n}\n\nclass InterStageMatchingValidationTest extends CreateRenderPipelineValidationTest {\n  getVertexStateWithOutputs(outputs: readonly string[]): GPUVertexState {\n    return {\n      module: this.device.createShaderModule({\n        code: `\n        struct A {\n            ${outputs.map((v, i) => v.replace('__', getVarName(i))).join(',\\n')},\n            @builtin(position) pos: vec4<f32>,\n        }\n        @vertex fn main() -> A {\n            var vertexOut: A;\n            vertexOut.pos = vec4<f32>(0.0, 0.0, 0.0, 1.0);\n            return vertexOut;\n        }\n        `,\n      }),\n      entryPoint: 'main',\n    };\n  }\n\n  getFragmentStateWithInputs(\n    inputs: readonly string[],\n    hasBuiltinPosition: boolean = false\n  ): GPUFragmentState {\n    return {\n      targets: [{ format: 'rgba8unorm' }],\n      module: this.device.createShaderModule({\n        code: `\n        struct B {\n            ${inputs.map((v, i) => v.replace('__', getVarName(i))).join(',\\n')},\n            ${hasBuiltinPosition ? '@builtin(position) pos: vec4<f32>' : ''}\n        }\n        @fragment fn main(fragmentIn: B) -> @location(0) vec4<f32> {\n            return vec4<f32>(1.0, 1.0, 1.0, 1.0);\n        }\n        `,\n      }),\n      entryPoint: 'main',\n    };\n  }\n\n  getDescriptorWithStates(\n    vertex: GPUVertexState,\n    fragment: GPUFragmentState\n  ): GPURenderPipelineDescriptor {\n    return {\n      layout: 'auto',\n      vertex,\n      fragment,\n    };\n  }\n}\n\nexport const g = makeTestGroup(InterStageMatchingValidationTest);\n\ng.test('location,mismatch')\n  .desc(`Tests that missing declaration at the same location should fail validation.`)\n  .params(u =>\n    u.combine('isAsync', [false, true]).combineWithParams([\n      { outputs: ['@location(0) __: f32'], inputs: ['@location(0) __: f32'], _success: true },\n      { outputs: ['@location(0) __: f32'], inputs: ['@location(1) __: f32'], _success: false },\n      { outputs: ['@location(1) __: f32'], inputs: ['@location(0) __: f32'], _success: false },\n      {\n        outputs: ['@location(0) __: f32', '@location(1) __: f32'],\n        inputs: ['@location(1) __: f32', '@location(0) __: f32'],\n        _success: true,\n      },\n      {\n        outputs: ['@location(1) __: f32', '@location(0) __: f32'],\n        inputs: ['@location(0) __: f32', '@location(1) __: f32'],\n        _success: true,\n      },\n    ])\n  )\n  .fn(t => {\n    const { isAsync, outputs, inputs, _success } = t.params;\n\n    const descriptor = t.getDescriptorWithStates(\n      t.getVertexStateWithOutputs(outputs),\n      t.getFragmentStateWithInputs(inputs)\n    );\n\n    t.doCreateRenderPipelineTest(isAsync, _success, descriptor);\n  });\n\ng.test('location,superset')\n  .desc(`TODO: implement after spec is settled: https://github.com/gpuweb/gpuweb/issues/2038`)\n  .unimplemented();\n\ng.test('location,subset')\n  .desc(`Tests that validation should fail when vertex output is a subset of fragment input.`)\n  .params(u => u.combine('isAsync', [false, true]))\n  .fn(t => {\n    const { isAsync } = t.params;\n\n    const descriptor = t.getDescriptorWithStates(\n      t.getVertexStateWithOutputs(['@location(0) vout0: f32']),\n      t.getFragmentStateWithInputs(['@location(0) fin0: f32', '@location(1) fin1: f32'])\n    );\n\n    t.doCreateRenderPipelineTest(isAsync, false, descriptor);\n  });\n\ng.test('type')\n  .desc(\n    `Tests that validation should fail when type of vertex output and fragment input at the same location doesn't match.`\n  )\n  .params(u =>\n    u.combine('isAsync', [false, true]).combineWithParams([\n      { output: 'f32', input: 'f32' },\n      { output: 'i32', input: 'f32' },\n      { output: 'u32', input: 'f32' },\n      { output: 'u32', input: 'i32' },\n      { output: 'i32', input: 'u32' },\n      { output: 'vec2<f32>', input: 'vec2<f32>' },\n      { output: 'vec3<f32>', input: 'vec2<f32>' },\n      { output: 'vec2<f32>', input: 'vec3<f32>' },\n      { output: 'vec2<f32>', input: 'f32' },\n      { output: 'f32', input: 'vec2<f32>' },\n    ])\n  )\n  .fn(t => {\n    const { isAsync, output, input } = t.params;\n\n    const descriptor = t.getDescriptorWithStates(\n      t.getVertexStateWithOutputs([`@location(0) @interpolate(flat) vout0: ${output}`]),\n      t.getFragmentStateWithInputs([`@location(0) @interpolate(flat) fin0: ${input}`])\n    );\n\n    t.doCreateRenderPipelineTest(isAsync, output === input, descriptor);\n  });\n\ng.test('interpolation_type')\n  .desc(\n    `Tests that validation should fail when interpolation type of vertex output and fragment input at the same location doesn't match.`\n  )\n  .params(u =>\n    u.combine('isAsync', [false, true]).combineWithParams([\n      // default is @interpolate(perspective, center)\n      { output: '', input: '' },\n      { output: '', input: '@interpolate(perspective)', _success: true },\n      { output: '', input: '@interpolate(perspective, center)', _success: true },\n      { output: '@interpolate(perspective)', input: '', _success: true },\n      { output: '', input: '@interpolate(linear)' },\n      { output: '@interpolate(perspective)', input: '@interpolate(perspective)' },\n      { output: '@interpolate(linear)', input: '@interpolate(perspective)' },\n      { output: '@interpolate(flat)', input: '@interpolate(perspective)' },\n      { output: '@interpolate(linear)', input: '@interpolate(flat)' },\n      { output: '@interpolate(linear, center)', input: '@interpolate(linear, center)' },\n    ])\n  )\n  .fn(t => {\n    const { isAsync, output, input, _success } = t.params;\n\n    const descriptor = t.getDescriptorWithStates(\n      t.getVertexStateWithOutputs([`@location(0) ${output} vout0: f32`]),\n      t.getFragmentStateWithInputs([`@location(0) ${input} fin0: f32`])\n    );\n\n    t.doCreateRenderPipelineTest(isAsync, _success ?? output === input, descriptor);\n  });\n\ng.test('interpolation_sampling')\n  .desc(\n    `Tests that validation should fail when interpolation sampling of vertex output and fragment input at the same location doesn't match.`\n  )\n  .params(u =>\n    u.combine('isAsync', [false, true]).combineWithParams([\n      // default is @interpolate(perspective, center)\n      { output: '@interpolate(perspective)', input: '@interpolate(perspective)' },\n      {\n        output: '@interpolate(perspective)',\n        input: '@interpolate(perspective, center)',\n        _success: true,\n      },\n      { output: '@interpolate(linear, center)', input: '@interpolate(linear)', _success: true },\n      { output: '@interpolate(flat)', input: '@interpolate(flat)' },\n      { output: '@interpolate(perspective)', input: '@interpolate(perspective, sample)' },\n      { output: '@interpolate(perspective, center)', input: '@interpolate(perspective, sample)' },\n      {\n        output: '@interpolate(perspective, center)',\n        input: '@interpolate(perspective, centroid)',\n      },\n      { output: '@interpolate(perspective, centroid)', input: '@interpolate(perspective)' },\n    ])\n  )\n  .fn(t => {\n    const { isAsync, output, input, _success } = t.params;\n\n    const descriptor = t.getDescriptorWithStates(\n      t.getVertexStateWithOutputs([`@location(0) ${output} vout0: f32`]),\n      t.getFragmentStateWithInputs([`@location(0) ${input} fin0: f32`])\n    );\n\n    t.doCreateRenderPipelineTest(isAsync, _success ?? output === input, descriptor);\n  });\n\ng.test('max_shader_variable_location')\n  .desc(\n    `Tests that validation should fail when there is location of user-defined output/input variable >= device.limits.maxInterStageShaderVariables`\n  )\n  .params(u =>\n    u\n      .combine('isAsync', [false, true])\n      // User defined variable location = maxInterStageShaderVariables + locationDelta\n      .combine('locationDelta', [0, -1, -2])\n  )\n  .fn(t => {\n    const { isAsync, locationDelta } = t.params;\n    const maxInterStageShaderVariables = t.device.limits.maxInterStageShaderVariables;\n    const location = maxInterStageShaderVariables + locationDelta;\n\n    const descriptor = t.getDescriptorWithStates(\n      t.getVertexStateWithOutputs([`@location(${location}) vout0: f32`]),\n      t.getFragmentStateWithInputs([`@location(${location}) fin0: f32`])\n    );\n\n    t.doCreateRenderPipelineTest(isAsync, location < maxInterStageShaderVariables, descriptor);\n  });\n\ng.test('max_components_count,output')\n  .desc(\n    `Tests that validation should fail when scalar components of all user-defined outputs > max vertex shader output components.`\n  )\n  .params(u =>\n    u.combine('isAsync', [false, true]).combineWithParams([\n      // Number of user-defined output scalar components in test shader = device.limits.maxInterStageShaderComponents + numScalarDelta.\n      { numScalarDelta: 0, topology: 'triangle-list', _success: true },\n      { numScalarDelta: 1, topology: 'triangle-list', _success: false },\n      { numScalarDelta: 0, topology: 'point-list', _success: false },\n      { numScalarDelta: -1, topology: 'point-list', _success: true },\n    ] as const)\n  )\n  .fn(t => {\n    const { isAsync, numScalarDelta, topology, _success } = t.params;\n\n    const numScalarComponents = t.device.limits.maxInterStageShaderComponents + numScalarDelta;\n\n    const numVec4 = Math.floor(numScalarComponents / 4);\n    const numTrailingScalars = numScalarComponents % 4;\n    const numUserDefinedInterStageVariables = numTrailingScalars > 0 ? numVec4 + 1 : numVec4;\n\n    assert(numUserDefinedInterStageVariables <= t.device.limits.maxInterStageShaderVariables);\n\n    const outputs = range(numVec4, i => `@location(${i}) vout${i}: vec4<f32>`);\n    const inputs = range(numVec4, i => `@location(${i}) fin${i}: vec4<f32>`);\n\n    if (numTrailingScalars > 0) {\n      const typeString = numTrailingScalars === 1 ? 'f32' : `vec${numTrailingScalars}<f32>`;\n      outputs.push(`@location(${numVec4}) vout${numVec4}: ${typeString}`);\n      inputs.push(`@location(${numVec4}) fin${numVec4}: ${typeString}`);\n    }\n\n    const descriptor = t.getDescriptorWithStates(\n      t.getVertexStateWithOutputs(outputs),\n      t.getFragmentStateWithInputs(inputs)\n    );\n    descriptor.primitive = { topology };\n\n    t.doCreateRenderPipelineTest(isAsync, _success, descriptor);\n  });\n\ng.test('max_components_count,input')\n  .desc(\n    `Tests that validation should fail when scalar components of all user-defined inputs > max vertex shader output components.`\n  )\n  .params(u =>\n    u.combine('isAsync', [false, true]).combineWithParams([\n      // Number of user-defined input scalar components in test shader = device.limits.maxInterStageShaderComponents + numScalarDelta.\n      { numScalarDelta: 0, useExtraBuiltinInputs: false, _success: true },\n      { numScalarDelta: 1, useExtraBuiltinInputs: false, _success: false },\n      { numScalarDelta: 0, useExtraBuiltinInputs: true, _success: false },\n      { numScalarDelta: -3, useExtraBuiltinInputs: true, _success: true },\n      { numScalarDelta: -2, useExtraBuiltinInputs: true, _success: false },\n    ] as const)\n  )\n  .fn(t => {\n    const { isAsync, numScalarDelta, useExtraBuiltinInputs, _success } = t.params;\n\n    const numScalarComponents = t.device.limits.maxInterStageShaderComponents + numScalarDelta;\n\n    const numVec4 = Math.floor(numScalarComponents / 4);\n    const numTrailingScalars = numScalarComponents % 4;\n    const numUserDefinedInterStageVariables = numTrailingScalars > 0 ? numVec4 + 1 : numVec4;\n\n    assert(numUserDefinedInterStageVariables <= t.device.limits.maxInterStageShaderVariables);\n\n    const outputs = range(numVec4, i => `@location(${i}) vout${i}: vec4<f32>`);\n    const inputs = range(numVec4, i => `@location(${i}) fin${i}: vec4<f32>`);\n\n    if (numTrailingScalars > 0) {\n      const typeString = numTrailingScalars === 1 ? 'f32' : `vec${numTrailingScalars}<f32>`;\n      outputs.push(`@location(${numVec4}) vout${numVec4}: ${typeString}`);\n      inputs.push(`@location(${numVec4}) fin${numVec4}: ${typeString}`);\n    }\n\n    if (useExtraBuiltinInputs) {\n      inputs.push(\n        '@builtin(front_facing) front_facing_in: bool',\n        '@builtin(sample_index) sample_index_in: u32',\n        '@builtin(sample_mask) sample_mask_in: u32'\n      );\n    }\n\n    const descriptor = t.getDescriptorWithStates(\n      t.getVertexStateWithOutputs(outputs),\n      t.getFragmentStateWithInputs(inputs, true)\n    );\n\n    t.doCreateRenderPipelineTest(isAsync, _success, descriptor);\n  });\n"],"mappings":"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"}