{"version":3,"file":"getBindGroupLayout.spec.js","names":["description","makeTestGroup","assert","ValidationTest","g","test","desc","params","u","combine","fn","t","index","pipelineBindGroupLayouts","device","createBindGroupLayout","entries","kBindGroupLayoutsSizeInPipelineLayout","pipelineLayout","createPipelineLayout","bindGroupLayouts","pipeline","createRenderPipeline","layout","vertex","module","createShaderModule","code","entryPoint","fragment","targets","format","shouldError","expectValidationError","getBindGroupLayout","kIndex","bgl1","extra","bgl2","undefined"],"sources":["../../../../src/webgpu/api/validation/getBindGroupLayout.spec.ts"],"sourcesContent":["export const description = `\n  getBindGroupLayout validation tests.\n`;\n\nimport { makeTestGroup } from '../../../common/framework/test_group.js';\nimport { assert } from '../../../common/util/util.js';\n\nimport { ValidationTest } from './validation_test.js';\n\nexport const g = makeTestGroup(ValidationTest);\n\ng.test('index_range,explicit_layout')\n  .desc(\n    `\n  Test that a validation error is generated if the index exceeds the size of the bind group layouts\n  using a pipeline with an explicit layout.\n  `\n  )\n  .params(u => u.combine('index', [0, 1, 2, 3, 4, 5]))\n  .fn(t => {\n    const { index } = t.params;\n\n    const pipelineBindGroupLayouts = t.device.createBindGroupLayout({\n      entries: [],\n    });\n\n    const kBindGroupLayoutsSizeInPipelineLayout = 1;\n    const pipelineLayout = t.device.createPipelineLayout({\n      bindGroupLayouts: [pipelineBindGroupLayouts],\n    });\n\n    const pipeline = t.device.createRenderPipeline({\n      layout: pipelineLayout,\n      vertex: {\n        module: t.device.createShaderModule({\n          code: `\n            @vertex\n            fn main()-> @builtin(position) vec4<f32> {\n              return vec4<f32>(0.0, 0.0, 0.0, 1.0);\n            }`,\n        }),\n        entryPoint: 'main',\n      },\n      fragment: {\n        module: t.device.createShaderModule({\n          code: `\n            @fragment\n            fn main() -> @location(0) vec4<f32> {\n              return vec4<f32>(0.0, 1.0, 0.0, 1.0);\n            }`,\n        }),\n        entryPoint: 'main',\n        targets: [{ format: 'rgba8unorm' }],\n      },\n    });\n\n    const shouldError = index >= kBindGroupLayoutsSizeInPipelineLayout;\n\n    t.expectValidationError(() => {\n      pipeline.getBindGroupLayout(index);\n    }, shouldError);\n  });\n\ng.test('index_range,auto_layout')\n  .desc(\n    `\n  Test that a validation error is generated if the index exceeds the size of the bind group layouts\n  using a pipeline with an auto layout.\n  `\n  )\n  .params(u => u.combine('index', [0, 1, 2, 3, 4, 5]))\n  .fn(t => {\n    const { index } = t.params;\n\n    const kBindGroupLayoutsSizeInPipelineLayout = 1;\n\n    const pipeline = t.device.createRenderPipeline({\n      layout: 'auto',\n      vertex: {\n        module: t.device.createShaderModule({\n          code: `\n            @vertex\n            fn main()-> @builtin(position) vec4<f32> {\n              return vec4<f32>(0.0, 0.0, 0.0, 1.0);\n            }`,\n        }),\n        entryPoint: 'main',\n      },\n      fragment: {\n        module: t.device.createShaderModule({\n          code: `\n            @group(0) @binding(0) var<uniform> binding: f32;\n            @fragment\n            fn main() -> @location(0) vec4<f32> {\n              _ = binding;\n              return vec4<f32>(0.0, 1.0, 0.0, 1.0);\n            }`,\n        }),\n        entryPoint: 'main',\n        targets: [{ format: 'rgba8unorm' }],\n      },\n    });\n\n    const shouldError = index >= kBindGroupLayoutsSizeInPipelineLayout;\n\n    t.expectValidationError(() => {\n      pipeline.getBindGroupLayout(index);\n    }, shouldError);\n  });\n\ng.test('unique_js_object,auto_layout')\n  .desc(\n    `\n  Test that getBindGroupLayout returns a new JavaScript object for each call.\n  `\n  )\n  .fn(t => {\n    const pipeline = t.device.createRenderPipeline({\n      layout: 'auto',\n      vertex: {\n        module: t.device.createShaderModule({\n          code: `\n            @vertex\n            fn main()-> @builtin(position) vec4<f32> {\n              return vec4<f32>(0.0, 0.0, 0.0, 1.0);\n            }`,\n        }),\n        entryPoint: 'main',\n      },\n      fragment: {\n        module: t.device.createShaderModule({\n          code: `\n            @group(0) @binding(0) var<uniform> binding: f32;\n            @fragment\n            fn main() -> @location(0) vec4<f32> {\n              _ = binding;\n              return vec4<f32>(0.0, 1.0, 0.0, 1.0);\n            }`,\n        }),\n        entryPoint: 'main',\n        targets: [{ format: 'rgba8unorm' }],\n      },\n    });\n\n    const kIndex = 0;\n    const bgl1 = pipeline.getBindGroupLayout(kIndex) as unknown as Record<string, number>;\n    bgl1.extra = 42;\n    const bgl2 = pipeline.getBindGroupLayout(kIndex) as unknown as Record<string, number>;\n\n    assert(bgl1 !== bgl2, 'objects are not the same object');\n    assert(bgl2.extra === undefined, 'objects do not retain expando properties');\n  });\n\ng.test('unique_js_object,explicit_layout')\n  .desc(\n    `\n  Test that getBindGroupLayout returns a new JavaScript object for each call.\n  `\n  )\n  .fn(t => {\n    const pipelineBindGroupLayouts = t.device.createBindGroupLayout({\n      entries: [],\n    });\n\n    const pipelineLayout = t.device.createPipelineLayout({\n      bindGroupLayouts: [pipelineBindGroupLayouts],\n    });\n\n    const pipeline = t.device.createRenderPipeline({\n      layout: pipelineLayout,\n      vertex: {\n        module: t.device.createShaderModule({\n          code: `\n            @vertex\n            fn main()-> @builtin(position) vec4<f32> {\n              return vec4<f32>(0.0, 0.0, 0.0, 1.0);\n            }`,\n        }),\n        entryPoint: 'main',\n      },\n      fragment: {\n        module: t.device.createShaderModule({\n          code: `\n            @fragment\n            fn main() -> @location(0) vec4<f32> {\n              return vec4<f32>(0.0, 1.0, 0.0, 1.0);\n            }`,\n        }),\n        entryPoint: 'main',\n        targets: [{ format: 'rgba8unorm' }],\n      },\n    });\n\n    const kIndex = 0;\n    const bgl1 = pipeline.getBindGroupLayout(kIndex) as unknown as Record<string, number>;\n    bgl1.extra = 42;\n    const bgl2 = pipeline.getBindGroupLayout(kIndex) as unknown as Record<string, number>;\n\n    assert(bgl1 !== bgl2, 'objects are not the same object');\n    assert(bgl2.extra === undefined, 'objects do not retain expando properties');\n  });\n"],"mappings":"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"}