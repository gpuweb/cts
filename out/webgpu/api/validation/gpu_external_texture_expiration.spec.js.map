{"version":3,"file":"gpu_external_texture_expiration.spec.js","names":["description","makeTestGroup","assert","getVideoElement","startPlayingAndWaitForVideo","getVideoFrameFromVideoElement","waitForNextFrame","waitForNextTask","ValidationTest","GPUExternalTextureExpireTest","submitCommandBuffer","bindGroup","success","kHeight","kWidth","kFormat","colorAttachment","createTextureTracked","format","size","width","height","depthOrArrayLayers","usage","GPUTextureUsage","COPY_SRC","RENDER_ATTACHMENT","passDescriptor","colorAttachments","view","createView","clearValue","loadOp","storeOp","commandEncoder","device","createCommandEncoder","passEncoder","beginRenderPass","setBindGroup","end","commandBuffer","finish","expectValidationError","queue","submit","getDefaultVideoElementAndCheck","videoElement","skip","getDefaultBindGroupLayout","createBindGroupLayout","entries","binding","visibility","GPUShaderStage","FRAGMENT","externalTexture","g","test","desc","params","u","combine","fn","t","sourceType","source","importExternalTexture","createBindGroup","layout","resource","mayBeTheSameExternalTexture","queueMicrotask","close","newValidExternalTexture"],"sources":["../../../../src/webgpu/api/validation/gpu_external_texture_expiration.spec.ts"],"sourcesContent":["export const description = `\nGPUExternalTexture expiration mechanism validation tests.\n`;\n\nimport { makeTestGroup } from '../../../common/framework/test_group.js';\nimport { assert } from '../../../common/util/util.js';\nimport {\n  getVideoElement,\n  startPlayingAndWaitForVideo,\n  getVideoFrameFromVideoElement,\n  waitForNextFrame,\n  waitForNextTask,\n} from '../../web_platform/util.js';\n\nimport { ValidationTest } from './validation_test.js';\n\nclass GPUExternalTextureExpireTest extends ValidationTest {\n  submitCommandBuffer(bindGroup: GPUBindGroup, success: boolean): void {\n    const kHeight = 16;\n    const kWidth = 16;\n    const kFormat = 'rgba8unorm';\n\n    const colorAttachment = this.createTextureTracked({\n      format: kFormat,\n      size: { width: kWidth, height: kHeight, depthOrArrayLayers: 1 },\n      usage: GPUTextureUsage.COPY_SRC | GPUTextureUsage.RENDER_ATTACHMENT,\n    });\n    const passDescriptor = {\n      colorAttachments: [\n        {\n          view: colorAttachment.createView(),\n          clearValue: [0, 0, 0, 1],\n          loadOp: 'clear',\n          storeOp: 'store',\n        },\n      ],\n    } as const;\n\n    const commandEncoder = this.device.createCommandEncoder();\n    const passEncoder = commandEncoder.beginRenderPass(passDescriptor);\n    passEncoder.setBindGroup(0, bindGroup);\n    passEncoder.end();\n    const commandBuffer = commandEncoder.finish();\n    this.expectValidationError(() => this.device.queue.submit([commandBuffer]), !success);\n  }\n\n  getDefaultVideoElementAndCheck(): HTMLVideoElement {\n    const videoElement = getVideoElement(this, 'four-colors-vp9-bt601.webm');\n\n    if (!('requestVideoFrameCallback' in videoElement)) {\n      this.skip('HTMLVideoElement.requestVideoFrameCallback is not supported');\n    }\n\n    return videoElement;\n  }\n\n  getDefaultBindGroupLayout(): GPUBindGroupLayout {\n    return this.device.createBindGroupLayout({\n      entries: [{ binding: 0, visibility: GPUShaderStage.FRAGMENT, externalTexture: {} }],\n    });\n  }\n}\n\nexport const g = makeTestGroup(GPUExternalTextureExpireTest);\n\ng.test('import_multiple_times_in_same_task_scope')\n  .desc(\n    `\n    Tests that GPUExternalTexture is valid after been imported in the task.\n    Tests that in the same task scope, import twice on the same video source may return\n    the same GPUExternalTexture and bindGroup doesn't need to be updated.\n    `\n  )\n  .params(u =>\n    u //\n      .combine('sourceType', ['VideoElement', 'VideoFrame'] as const)\n  )\n  .fn(async t => {\n    const sourceType = t.params.sourceType;\n    const videoElement = t.getDefaultVideoElementAndCheck();\n\n    let bindGroup: GPUBindGroup;\n    let externalTexture: GPUExternalTexture;\n    await startPlayingAndWaitForVideo(videoElement, async () => {\n      const source =\n        sourceType === 'VideoFrame'\n          ? await getVideoFrameFromVideoElement(t, videoElement)\n          : videoElement;\n      externalTexture = t.device.importExternalTexture({ source });\n\n      bindGroup = t.device.createBindGroup({\n        layout: t.getDefaultBindGroupLayout(),\n        entries: [{ binding: 0, resource: externalTexture }],\n      });\n\n      t.submitCommandBuffer(bindGroup, true);\n\n      // Import again in the same task scope should return same object.\n      const mayBeTheSameExternalTexture = t.device.importExternalTexture({ source });\n\n      if (externalTexture === mayBeTheSameExternalTexture) {\n        t.submitCommandBuffer(bindGroup, true);\n      } else {\n        bindGroup = t.device.createBindGroup({\n          layout: t.getDefaultBindGroupLayout(),\n          entries: [{ binding: 0, resource: externalTexture }],\n        });\n\n        t.submitCommandBuffer(bindGroup, true);\n      }\n    });\n  });\n\ng.test('import_and_use_in_different_microtask')\n  .desc(\n    `\n    Tests that in the same task scope, imported GPUExternalTexture is valid in\n    different microtasks.\n    `\n  )\n  .params(u =>\n    u //\n      .combine('sourceType', ['VideoElement', 'VideoFrame'] as const)\n  )\n  .fn(async t => {\n    const sourceType = t.params.sourceType;\n    const videoElement = t.getDefaultVideoElementAndCheck();\n\n    let bindGroup: GPUBindGroup;\n    let externalTexture: GPUExternalTexture;\n    await startPlayingAndWaitForVideo(videoElement, async () => {\n      const source =\n        sourceType === 'VideoFrame'\n          ? await getVideoFrameFromVideoElement(t, videoElement)\n          : videoElement;\n\n      // Import GPUExternalTexture\n      queueMicrotask(() => {\n        externalTexture = t.device.importExternalTexture({ source });\n      });\n\n      // Submit GPUExternalTexture\n      queueMicrotask(() => {\n        bindGroup = t.device.createBindGroup({\n          layout: t.getDefaultBindGroupLayout(),\n          entries: [{ binding: 0, resource: externalTexture }],\n        });\n        t.submitCommandBuffer(bindGroup, true);\n      });\n    });\n  });\n\ng.test('import_and_use_in_different_task')\n  .desc(\n    `\n    Tests that in the different task scope, previous imported GPUExternalTexture\n    should be expired if it is imported from HTMLVideoElment. GPUExternalTexture\n    imported from WebCodec VideoFrame is not expired.\n    `\n  )\n  .params(u =>\n    u //\n      .combine('sourceType', ['VideoElement', 'VideoFrame'] as const)\n  )\n  .fn(async t => {\n    const sourceType = t.params.sourceType;\n    const videoElement = t.getDefaultVideoElementAndCheck();\n\n    let bindGroup: GPUBindGroup;\n    let externalTexture: GPUExternalTexture;\n    await startPlayingAndWaitForVideo(videoElement, async () => {\n      const source =\n        sourceType === 'VideoFrame'\n          ? await getVideoFrameFromVideoElement(t, videoElement)\n          : videoElement;\n      externalTexture = t.device.importExternalTexture({ source });\n\n      bindGroup = t.device.createBindGroup({\n        layout: t.getDefaultBindGroupLayout(),\n        entries: [{ binding: 0, resource: externalTexture }],\n      });\n\n      t.submitCommandBuffer(bindGroup, true);\n    });\n\n    await waitForNextTask(() => {\n      // Enter in another task scope. For GPUExternalTexture imported from WebCodec,\n      // it shouldn't be expired because VideoFrame is not 'closed'.\n      // For GPUExternalTexutre imported from HTMLVideoElement, it should be expired.\n      t.submitCommandBuffer(bindGroup, sourceType === 'VideoFrame' ? true : false);\n    });\n  });\n\ng.test('use_import_to_refresh')\n  .desc(\n    `\n    Tests that in the different task scope, imported GPUExternalTexture\n    again on the same HTMLVideoElement should return active GPUExternalTexture.\n    `\n  )\n  .fn(async t => {\n    const videoElement = t.getDefaultVideoElementAndCheck();\n\n    let bindGroup: GPUBindGroup;\n    let externalTexture: GPUExternalTexture;\n    let source: HTMLVideoElement | VideoFrame;\n    await startPlayingAndWaitForVideo(videoElement, () => {\n      source = videoElement;\n      externalTexture = t.device.importExternalTexture({ source });\n\n      bindGroup = t.device.createBindGroup({\n        layout: t.getDefaultBindGroupLayout(),\n        entries: [{ binding: 0, resource: externalTexture }],\n      });\n\n      t.submitCommandBuffer(bindGroup, true);\n    });\n\n    await waitForNextTask(() => {\n      const mayBeTheSameExternalTexture = t.device.importExternalTexture({ source });\n\n      if (externalTexture === mayBeTheSameExternalTexture) {\n        // ImportExternalTexture should refresh expired GPUExternalTexture.\n        t.submitCommandBuffer(bindGroup, true);\n      } else {\n        bindGroup = t.device.createBindGroup({\n          layout: t.getDefaultBindGroupLayout(),\n          entries: [{ binding: 0, resource: mayBeTheSameExternalTexture }],\n        });\n        t.submitCommandBuffer(bindGroup, true);\n      }\n    });\n  });\n\ng.test('webcodec_video_frame_close_expire_immediately')\n  .desc(\n    `\n    Tests that in the same task scope, imported GPUExternalTexture should be expired\n    immediately if webcodec VideoFrame.close() is called.\n    `\n  )\n  .fn(async t => {\n    const videoElement = t.getDefaultVideoElementAndCheck();\n\n    let bindGroup: GPUBindGroup;\n    let externalTexture: GPUExternalTexture;\n    await startPlayingAndWaitForVideo(videoElement, async () => {\n      const source = await getVideoFrameFromVideoElement(t, videoElement);\n      externalTexture = t.device.importExternalTexture({ source });\n\n      bindGroup = t.device.createBindGroup({\n        layout: t.getDefaultBindGroupLayout(),\n        entries: [{ binding: 0, resource: externalTexture }],\n      });\n\n      t.submitCommandBuffer(bindGroup, true);\n\n      source.close();\n\n      t.submitCommandBuffer(bindGroup, false);\n    });\n  });\n\ng.test('import_from_different_video_frame')\n  .desc(\n    `\n    Tests that imported GPUExternalTexture from different video frame should\n    return different GPUExternalTexture objects.\n    If the frames are from the same HTMLVideoElement source, GPUExternalTexture\n    with old frame should be expired and not been refreshed again.\n    `\n  )\n  .fn(async t => {\n    const videoElement = t.getDefaultVideoElementAndCheck();\n\n    let bindGroup: GPUBindGroup;\n    let externalTexture: GPUExternalTexture;\n    await startPlayingAndWaitForVideo(videoElement, () => {\n      externalTexture = t.device.importExternalTexture({\n        source: videoElement,\n      });\n\n      bindGroup = t.device.createBindGroup({\n        layout: t.getDefaultBindGroupLayout(),\n        entries: [{ binding: 0, resource: externalTexture }],\n      });\n\n      t.submitCommandBuffer(bindGroup, true);\n    });\n\n    // Update new video frame.\n    await waitForNextFrame(videoElement, () => {\n      // Import again for the new video frame.\n      const newValidExternalTexture = t.device.importExternalTexture({\n        source: videoElement,\n      });\n      assert(externalTexture !== newValidExternalTexture);\n\n      // VideoFrame is updated. GPUExternalTexture imported from old frame should be expired and\n      // cannot be refreshed again.\n      // Using the GPUExternalTexture should result in an error.\n      t.submitCommandBuffer(bindGroup, false);\n\n      // Update bindGroup with updated GPUExternalTexture should work.\n      bindGroup = t.device.createBindGroup({\n        layout: t.getDefaultBindGroupLayout(),\n        entries: [{ binding: 0, resource: newValidExternalTexture }],\n      });\n      t.submitCommandBuffer(bindGroup, true);\n    });\n  });\n"],"mappings":"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"}