{"version":3,"file":"query_set.spec.js","names":["description","makeTestGroup","AllFeaturesMaxLimitsGPUTest","vtu","g","test","desc","paramsSubcasesOnly","u","combine","fn","t","occlusionQuerySet","createQuerySetWithState","params","querySetState","encoder","createEncoder","beginOcclusionQuery","endOcclusionQuery","validateFinishAndSubmitGivenState","beginSubcases","skipIfDeviceDoesNotSupportQueryType","querySet","type","count","beginComputePass","timestampWrites","beginningOfPassWriteIndex","end","texture","createTextureTracked","size","format","usage","GPUTextureUsage","RENDER_ATTACHMENT","beginRenderPass","colorAttachments","view","createView","loadOp","storeOp","buffer","createBufferTracked","GPUBufferUsage","QUERY_RESOLVE","resolveQuerySet"],"sources":["../../../../../../src/webgpu/api/validation/queue/destroyed/query_set.spec.ts"],"sourcesContent":["export const description = `\nTests using a destroyed query set on a queue.\n`;\n\nimport { makeTestGroup } from '../../../../../common/framework/test_group.js';\nimport { AllFeaturesMaxLimitsGPUTest } from '../../../../gpu_test.js';\nimport * as vtu from '../../validation_test_utils.js';\n\nexport const g = makeTestGroup(AllFeaturesMaxLimitsGPUTest);\n\ng.test('beginOcclusionQuery')\n  .desc(\n    `\nTests that use a destroyed query set in occlusion query on render pass encoder.\n- x= {destroyed, not destroyed (control case)}\n  `\n  )\n  .paramsSubcasesOnly(u => u.combine('querySetState', ['valid', 'destroyed'] as const))\n  .fn(t => {\n    const occlusionQuerySet = vtu.createQuerySetWithState(t, t.params.querySetState);\n\n    const encoder = t.createEncoder('render pass', { occlusionQuerySet });\n    encoder.encoder.beginOcclusionQuery(0);\n    encoder.encoder.endOcclusionQuery();\n    encoder.validateFinishAndSubmitGivenState(t.params.querySetState);\n  });\n\ng.test('timestamps')\n  .desc(\n    `\nTests that use a destroyed query set in timestamp query on {non-pass, compute, render} encoder.\n- x= {destroyed, not destroyed (control case)}\n  `\n  )\n  .params(u => u.beginSubcases().combine('querySetState', ['valid', 'destroyed'] as const))\n  .fn(t => {\n    t.skipIfDeviceDoesNotSupportQueryType('timestamp');\n    const querySet = vtu.createQuerySetWithState(t, t.params.querySetState, {\n      type: 'timestamp',\n      count: 2,\n    });\n\n    {\n      const encoder = t.createEncoder('non-pass');\n      encoder.encoder\n        .beginComputePass({\n          timestampWrites: { querySet, beginningOfPassWriteIndex: 0 },\n        })\n        .end();\n      encoder.validateFinishAndSubmitGivenState(t.params.querySetState);\n    }\n\n    {\n      const texture = t.createTextureTracked({\n        size: [1, 1, 1],\n        format: 'rgba8unorm',\n        usage: GPUTextureUsage.RENDER_ATTACHMENT,\n      });\n      const encoder = t.createEncoder('non-pass');\n      encoder.encoder\n        .beginRenderPass({\n          colorAttachments: [\n            {\n              view: texture.createView(),\n              loadOp: 'load',\n              storeOp: 'store',\n            },\n          ],\n          timestampWrites: { querySet, beginningOfPassWriteIndex: 0 },\n        })\n        .end();\n      encoder.validateFinishAndSubmitGivenState(t.params.querySetState);\n    }\n  });\n\ng.test('resolveQuerySet')\n  .desc(\n    `\nTests that use a destroyed query set in resolveQuerySet.\n- x= {destroyed, not destroyed (control case)}\n  `\n  )\n  .paramsSubcasesOnly(u => u.combine('querySetState', ['valid', 'destroyed'] as const))\n  .fn(t => {\n    const querySet = vtu.createQuerySetWithState(t, t.params.querySetState);\n\n    const buffer = t.createBufferTracked({ size: 8, usage: GPUBufferUsage.QUERY_RESOLVE });\n\n    const encoder = t.createEncoder('non-pass');\n    encoder.encoder.resolveQuerySet(querySet, 0, 1, buffer, 0);\n    encoder.validateFinishAndSubmitGivenState(t.params.querySetState);\n  });\n"],"mappings":"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"}