{"version":3,"file":"entry_point.spec.js","names":["description","makeTestGroup","kDefaultVertexShaderCode","getShaderWithEntryPoint","ValidationTest","g","kEntryPointTestCases","shaderModuleEntryPoint","stageEntryPoint","test","desc","params","u","combine","combineWithParams","fn","t","isAsync","descriptor","layout","compute","module","device","createShaderModule","code","entryPoint","_success","doCreateComputePipelineTest","vertex","doCreateRenderPipelineTest","fragment","targets","format"],"sources":["../../../../../src/webgpu/api/validation/shader_module/entry_point.spec.ts"],"sourcesContent":["export const description = `\nThis tests entry point validation of compute/render pipelines and their shader modules.\n\nThe entryPoint in shader module include standard \"main\" and others.\nThe entryPoint assigned in descriptor include:\n- Matching case (control case)\n- Empty string\n- Mistyping\n- Containing invalid char, including space and control codes (Null character)\n- Unicode entrypoints and their ASCIIfied version\n\nTODO:\n- Test unicode normalization (gpuweb/gpuweb#1160)\n- Fine-tune test cases to reduce number by removing trivially similiar cases\n`;\n\nimport { makeTestGroup } from '../../../../common/framework/test_group.js';\nimport { kDefaultVertexShaderCode, getShaderWithEntryPoint } from '../../../util/shader.js';\nimport { ValidationTest } from '../validation_test.js';\n\nexport const g = makeTestGroup(ValidationTest);\n\nconst kEntryPointTestCases = [\n  { shaderModuleEntryPoint: 'main', stageEntryPoint: 'main' },\n  { shaderModuleEntryPoint: 'main', stageEntryPoint: '' },\n  { shaderModuleEntryPoint: 'main', stageEntryPoint: 'main\\0' },\n  { shaderModuleEntryPoint: 'main', stageEntryPoint: 'main\\0a' },\n  { shaderModuleEntryPoint: 'main', stageEntryPoint: 'mian' },\n  { shaderModuleEntryPoint: 'main', stageEntryPoint: 'main ' },\n  { shaderModuleEntryPoint: 'main', stageEntryPoint: 'ma in' },\n  { shaderModuleEntryPoint: 'main', stageEntryPoint: 'main\\n' },\n  { shaderModuleEntryPoint: 'mian', stageEntryPoint: 'mian' },\n  { shaderModuleEntryPoint: 'mian', stageEntryPoint: 'main' },\n  { shaderModuleEntryPoint: 'mainmain', stageEntryPoint: 'mainmain' },\n  { shaderModuleEntryPoint: 'mainmain', stageEntryPoint: 'foo' },\n  { shaderModuleEntryPoint: 'main_t12V3', stageEntryPoint: 'main_t12V3' },\n  { shaderModuleEntryPoint: 'main_t12V3', stageEntryPoint: 'main_t12V5' },\n  { shaderModuleEntryPoint: 'main_t12V3', stageEntryPoint: '_main_t12V3' },\n  { shaderModuleEntryPoint: 'séquençage', stageEntryPoint: 'séquençage' },\n  { shaderModuleEntryPoint: 'séquençage', stageEntryPoint: 'sequencage' },\n];\n\ng.test('compute')\n  .desc(\n    `\nTests calling createComputePipeline(Async) with valid vertex stage shader and different entryPoints,\nand check that the APIs only accept matching entryPoint.\n`\n  )\n  .params(u => u.combine('isAsync', [true, false]).combineWithParams(kEntryPointTestCases))\n  .fn(t => {\n    const { isAsync, shaderModuleEntryPoint, stageEntryPoint } = t.params;\n    const descriptor: GPUComputePipelineDescriptor = {\n      layout: 'auto',\n      compute: {\n        module: t.device.createShaderModule({\n          code: getShaderWithEntryPoint('compute', shaderModuleEntryPoint),\n        }),\n        entryPoint: stageEntryPoint,\n      },\n    };\n    const _success = shaderModuleEntryPoint === stageEntryPoint;\n    t.doCreateComputePipelineTest(isAsync, _success, descriptor);\n  });\n\ng.test('vertex')\n  .desc(\n    `\nTests calling createRenderPipeline(Async) with valid vertex stage shader and different entryPoints,\nand check that the APIs only accept matching entryPoint.\n`\n  )\n  .params(u => u.combine('isAsync', [true, false]).combineWithParams(kEntryPointTestCases))\n  .fn(t => {\n    const { isAsync, shaderModuleEntryPoint, stageEntryPoint } = t.params;\n    const descriptor: GPURenderPipelineDescriptor = {\n      layout: 'auto',\n      vertex: {\n        module: t.device.createShaderModule({\n          code: getShaderWithEntryPoint('vertex', shaderModuleEntryPoint),\n        }),\n        entryPoint: stageEntryPoint,\n      },\n    };\n    const _success = shaderModuleEntryPoint === stageEntryPoint;\n    t.doCreateRenderPipelineTest(isAsync, _success, descriptor);\n  });\n\ng.test('fragment')\n  .desc(\n    `\nTests calling createRenderPipeline(Async) with valid fragment stage shader and different entryPoints,\nand check that the APIs only accept matching entryPoint.\n`\n  )\n  .params(u => u.combine('isAsync', [true, false]).combineWithParams(kEntryPointTestCases))\n  .fn(t => {\n    const { isAsync, shaderModuleEntryPoint, stageEntryPoint } = t.params;\n    const descriptor: GPURenderPipelineDescriptor = {\n      layout: 'auto',\n      vertex: {\n        module: t.device.createShaderModule({\n          code: kDefaultVertexShaderCode,\n        }),\n        entryPoint: 'main',\n      },\n      fragment: {\n        module: t.device.createShaderModule({\n          code: getShaderWithEntryPoint('fragment', shaderModuleEntryPoint),\n        }),\n        entryPoint: stageEntryPoint,\n        targets: [{ format: 'rgba8unorm' }],\n      },\n    };\n    const _success = shaderModuleEntryPoint === stageEntryPoint;\n    t.doCreateRenderPipelineTest(isAsync, _success, descriptor);\n  });\n"],"mappings":"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"}