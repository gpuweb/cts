{"version":3,"file":"all_limits_and_features.spec.js","names":["description","makeTestGroup","GPUTest","GPUTestSubcaseBatchState","initUncanonicalizedDeviceDescriptor","getAdapterLimitsAsDeviceRequiredLimits","adapter","requiredLimits","adapterLimits","limits","key","setAllLimitsToAdapterLimitsAndAddAllFeatures","desc","descWithMaxLimits","defaultQueue","requiredFeatures","features","AllLimitsAndFeaturesGPUTestSubcaseBatchState","selectDeviceOrSkipTestCase","descriptor","descriptorModifier","mod","keyModifier","baseKey","AllLimitsAndFeaturesLimitsTest","MakeSharedState","recorder","params","g","test","fn","t","deviceLimits","device","deviceLimit","adapterLimit","expect","feature","has"],"sources":["../../../../../src/webgpu/api/operation/device/all_limits_and_features.spec.ts"],"sourcesContent":["export const description = `Test you can request an device with all features and limits`;\n\nimport { TestCaseRecorder, TestParams } from '../../../../common/framework/fixture.js';\nimport { makeTestGroup } from '../../../../common/framework/test_group.js';\nimport {\n  DeviceSelectionDescriptor,\n  GPUTest,\n  GPUTestSubcaseBatchState,\n  initUncanonicalizedDeviceDescriptor,\n} from '../../../gpu_test.js';\nimport { CanonicalDeviceDescriptor, DescriptorModifier } from '../../../util/device_pool.js';\n\n/**\n * Gets the adapter limits as a standard JavaScript object.\n */\nfunction getAdapterLimitsAsDeviceRequiredLimits(adapter: GPUAdapter) {\n  const requiredLimits: Record<string, GPUSize64> = {};\n  const adapterLimits = adapter.limits as unknown as Record<string, GPUSize64>;\n  for (const key in adapter.limits) {\n    requiredLimits[key] = adapterLimits[key];\n  }\n  return requiredLimits;\n}\n\nfunction setAllLimitsToAdapterLimitsAndAddAllFeatures(\n  adapter: GPUAdapter,\n  desc: CanonicalDeviceDescriptor | undefined\n) {\n  const descWithMaxLimits: CanonicalDeviceDescriptor = {\n    defaultQueue: {},\n    ...desc,\n    requiredFeatures: [...adapter.features] as GPUFeatureName[],\n    requiredLimits: getAdapterLimitsAsDeviceRequiredLimits(adapter),\n  };\n  return descWithMaxLimits;\n}\n\n/**\n * Used to request a device with all the max limits of the adapter.\n */\nexport class AllLimitsAndFeaturesGPUTestSubcaseBatchState extends GPUTestSubcaseBatchState {\n  override selectDeviceOrSkipTestCase(\n    descriptor: DeviceSelectionDescriptor,\n    descriptorModifier?: DescriptorModifier\n  ): void {\n    const mod: DescriptorModifier = {\n      descriptorModifier(adapter: GPUAdapter, desc: CanonicalDeviceDescriptor | undefined) {\n        desc = descriptorModifier?.descriptorModifier\n          ? descriptorModifier.descriptorModifier(adapter, desc)\n          : desc;\n        return setAllLimitsToAdapterLimitsAndAddAllFeatures(adapter, desc);\n      },\n      keyModifier(baseKey: string) {\n        return `${baseKey}:AllLimitsAndFeaturesTest`;\n      },\n    };\n    super.selectDeviceOrSkipTestCase(initUncanonicalizedDeviceDescriptor(descriptor), mod);\n  }\n}\n\n/**\n * A Test that requests all the max limits from the adapter on the device.\n */\nexport class AllLimitsAndFeaturesLimitsTest extends GPUTest {\n  public static override MakeSharedState(\n    recorder: TestCaseRecorder,\n    params: TestParams\n  ): GPUTestSubcaseBatchState {\n    return new AllLimitsAndFeaturesGPUTestSubcaseBatchState(recorder, params);\n  }\n}\n\nexport const g = makeTestGroup(AllLimitsAndFeaturesLimitsTest);\n\ng.test('everything')\n  .desc(\n    `\nTest we can request all features and limits.\n\nIt is expected that, even though this is generally not recommended, because\nit is possible, make sure it works and continues to work going forward so that\nchanges to WebGPU do not break sites requesting everything.\n`\n  )\n  .fn(t => {\n    // Test that all the limits on the device match the adapter.\n    const adapterLimits = t.adapter.limits as unknown as Record<string, GPUSize64>;\n    const deviceLimits = t.device.limits as unknown as Record<string, GPUSize64>;\n    for (const key in t.adapter.limits) {\n      const deviceLimit = deviceLimits[key];\n      const adapterLimit = adapterLimits[key];\n      t.expect(\n        deviceLimit === adapterLimit,\n        `device.limits.${key} (${deviceLimit}) === adapter.limits.${key} (${adapterLimit})`\n      );\n    }\n\n    // Test that all the adapter features are on the device.\n    for (const feature of t.adapter.features) {\n      t.expect(t.device.features.has(feature), `device has feature: ${feature}`);\n    }\n  });\n"],"mappings":"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"}