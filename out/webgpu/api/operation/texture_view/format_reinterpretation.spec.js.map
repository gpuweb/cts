{"version":3,"file":"format_reinterpretation.spec.js","names":["description","makeTestGroup","getBaseFormatForTextureFormat","kDifferentBaseFormatRegularTextureFormats","AllFeaturesMaxLimitsGPUTest","ttu","TexelView","g","kColors","R","G","B","A","kTextureSize","makeInputTexelView","format","fromTexelsAsColors","coords","pixelPos","y","x","length","clampToFormatRange","makeBlitPipeline","device","multisample","createRenderPipeline","layout","vertex","module","createShaderModule","code","entryPoint","fragment","sample","targets","count","render","test","desc","params","u","combine","beforeAllSubcases","t","skipIf","isCompatibility","fn","viewFormat","skipIfTextureFormatNotSupported","cases","inputTexelView","texture","createTextureFromTexelView","size","usage","GPUTextureUsage","TEXTURE_BINDING","viewFormats","reinterpretedView","createView","reinterpretedTexelView","fromTexelsAsBytes","bytes","pipeline","createComputePipeline","compute","outputTexture","createTextureTracked","STORAGE_BINDING","COPY_SRC","commandEncoder","createCommandEncoder","pass","beginComputePass","setPipeline","setBindGroup","createBindGroup","getBindGroupLayout","entries","binding","resource","dispatchWorkgroups","end","queue","submit","finish","expectTexelViewComparisonIsOkInTexture","color","sampleCount","renderTexture","RENDER_ATTACHMENT","resolveTexture","undefined","sampleSource","reinterpretedRenderView","reinterpretedResolveView","beginRenderPass","colorAttachments","view","resolveTarget","loadOp","storeOp","draw","singleSampleRenderTexture","renderViewTexels","maxDiffULPsForNormFormat","resolveView"],"sources":["../../../../../src/webgpu/api/operation/texture_view/format_reinterpretation.spec.ts"],"sourcesContent":["export const description = `\nTest texture views can reinterpret the format of the original texture.\n\n- TODO: test compressed texture reinterpretation\n`;\n\nimport { makeTestGroup } from '../../../../common/framework/test_group.js';\nimport {\n  EncodableTextureFormat,\n  getBaseFormatForTextureFormat,\n  kDifferentBaseFormatRegularTextureFormats,\n  RegularTextureFormat,\n} from '../../../format_info.js';\nimport { AllFeaturesMaxLimitsGPUTest } from '../../../gpu_test.js';\nimport * as ttu from '../../../texture_test_utils.js';\nimport { TexelView } from '../../../util/texture/texel_view.js';\n\nexport const g = makeTestGroup(AllFeaturesMaxLimitsGPUTest);\n\nconst kColors = [\n  { R: 1.0, G: 0.0, B: 0.0, A: 0.8 },\n  { R: 0.0, G: 1.0, B: 0.0, A: 0.7 },\n  { R: 0.0, G: 0.0, B: 0.0, A: 0.6 },\n  { R: 0.0, G: 0.0, B: 0.0, A: 0.5 },\n  { R: 1.0, G: 1.0, B: 1.0, A: 0.4 },\n  { R: 0.7, G: 0.0, B: 0.0, A: 0.3 },\n  { R: 0.0, G: 0.8, B: 0.0, A: 0.2 },\n  { R: 0.0, G: 0.0, B: 0.9, A: 0.1 },\n  { R: 0.1, G: 0.2, B: 0.0, A: 0.3 },\n  { R: 0.4, G: 0.3, B: 0.6, A: 0.8 },\n];\n\nconst kTextureSize = 16;\n\nfunction makeInputTexelView(format: EncodableTextureFormat) {\n  return TexelView.fromTexelsAsColors(\n    format,\n    coords => {\n      const pixelPos = coords.y * kTextureSize + coords.x;\n      return kColors[pixelPos % kColors.length];\n    },\n    { clampToFormatRange: true }\n  );\n}\n\nfunction makeBlitPipeline(\n  device: GPUDevice,\n  format: GPUTextureFormat,\n  multisample: { sample: number; render: number }\n) {\n  return device.createRenderPipeline({\n    layout: 'auto',\n    vertex: {\n      module: device.createShaderModule({\n        code: `\n          @vertex fn main(@builtin(vertex_index) VertexIndex : u32) -> @builtin(position) vec4<f32> {\n            var pos = array<vec2<f32>, 6>(\n                                        vec2<f32>(-1.0, -1.0),\n                                        vec2<f32>(-1.0,  1.0),\n                                        vec2<f32>( 1.0, -1.0),\n                                        vec2<f32>(-1.0,  1.0),\n                                        vec2<f32>( 1.0, -1.0),\n                                        vec2<f32>( 1.0,  1.0));\n            return vec4<f32>(pos[VertexIndex], 0.0, 1.0);\n          }`,\n      }),\n      entryPoint: 'main',\n    },\n    fragment: {\n      module:\n        multisample.sample > 1\n          ? device.createShaderModule({\n              code: `\n            @group(0) @binding(0) var src: texture_multisampled_2d<f32>;\n            @fragment fn main(@builtin(position) coord: vec4<f32>) -> @location(0) vec4<f32> {\n              var result : vec4<f32>;\n              for (var i = 0; i < ${multisample.sample}; i = i + 1) {\n                result = result + textureLoad(src, vec2<i32>(coord.xy), i);\n              }\n              return result * ${1 / multisample.sample};\n            }`,\n            })\n          : device.createShaderModule({\n              code: `\n            @group(0) @binding(0) var src: texture_2d<f32>;\n            @fragment fn main(@builtin(position) coord: vec4<f32>) -> @location(0) vec4<f32> {\n              return textureLoad(src, vec2<i32>(coord.xy), 0);\n            }`,\n            }),\n      entryPoint: 'main',\n      targets: [{ format }],\n    },\n    multisample: {\n      count: multisample.render,\n    },\n  });\n}\n\ng.test('texture_binding')\n  .desc(`Test that a regular texture allocated as 'format' is correctly sampled as 'viewFormat'.`)\n  .params(u =>\n    u //\n      .combine('format', kDifferentBaseFormatRegularTextureFormats)\n  )\n  // Compatibility mode does not support format reinterpretation.\n  .beforeAllSubcases(t => t.skipIf(t.isCompatibility))\n  .fn(t => {\n    const { format } = t.params;\n    const viewFormat = getBaseFormatForTextureFormat(format) as RegularTextureFormat;\n\n    t.skipIfTextureFormatNotSupported(format, viewFormat);\n\n    const cases = [\n      { format, viewFormat },\n      { format: viewFormat, viewFormat: format },\n    ];\n\n    for (const { format, viewFormat } of cases) {\n      // Make an input texel view.\n      const inputTexelView = makeInputTexelView(format);\n\n      // Create the initial texture with the contents of the input texel view.\n      const texture = ttu.createTextureFromTexelView(t, inputTexelView, {\n        size: [kTextureSize, kTextureSize],\n        usage: GPUTextureUsage.TEXTURE_BINDING,\n        viewFormats: [viewFormat],\n      });\n\n      // Reinterpret the texture as the view format.\n      // Make a texel view of the format that also reinterprets the data.\n      const reinterpretedView = texture.createView({ format: viewFormat });\n      const reinterpretedTexelView = TexelView.fromTexelsAsBytes(viewFormat, inputTexelView.bytes);\n\n      // Create a pipeline to write data out to rgba8unorm.\n      const pipeline = t.device.createComputePipeline({\n        layout: 'auto',\n        compute: {\n          module: t.device.createShaderModule({\n            code: `\n            @group(0) @binding(0) var src: texture_2d<f32>;\n            @group(0) @binding(1) var dst: texture_storage_2d<rgba8unorm, write>;\n            @compute @workgroup_size(1, 1) fn main(\n              @builtin(global_invocation_id) global_id: vec3<u32>,\n            ) {\n              var coord = vec2<i32>(global_id.xy);\n              textureStore(dst, coord, textureLoad(src, coord, 0));\n            }`,\n          }),\n          entryPoint: 'main',\n        },\n      });\n\n      // Create an rgba8unorm output texture.\n      const outputTexture = t.createTextureTracked({\n        format: 'rgba8unorm',\n        size: [kTextureSize, kTextureSize],\n        usage: GPUTextureUsage.STORAGE_BINDING | GPUTextureUsage.COPY_SRC,\n      });\n\n      // Execute a compute pass to load data from the reinterpreted view and\n      // write out to the rgba8unorm texture.\n      const commandEncoder = t.device.createCommandEncoder();\n      const pass = commandEncoder.beginComputePass();\n      pass.setPipeline(pipeline);\n      pass.setBindGroup(\n        0,\n        t.device.createBindGroup({\n          layout: pipeline.getBindGroupLayout(0),\n          entries: [\n            {\n              binding: 0,\n              resource: reinterpretedView,\n            },\n            {\n              binding: 1,\n              resource: outputTexture.createView(),\n            },\n          ],\n        })\n      );\n      pass.dispatchWorkgroups(kTextureSize, kTextureSize);\n      pass.end();\n      t.device.queue.submit([commandEncoder.finish()]);\n\n      ttu.expectTexelViewComparisonIsOkInTexture(\n        t,\n        { texture: outputTexture },\n        TexelView.fromTexelsAsColors('rgba8unorm', reinterpretedTexelView.color, {\n          clampToFormatRange: true,\n        }),\n        [kTextureSize, kTextureSize]\n      );\n    }\n  });\n\ng.test('render_and_resolve_attachment')\n  .desc(\n    `Test that a color render attachment allocated as 'format' is correctly rendered to as 'viewFormat',\nand resolved to an attachment allocated as 'format' viewed as 'viewFormat'.\n\nOther combinations aren't possible because the render and resolve targets must both match\nin view format and match in base format.`\n  )\n  .params(u =>\n    u //\n      .combine('format', kDifferentBaseFormatRegularTextureFormats)\n      .combine('sampleCount', [1, 4])\n  )\n  // Compatibility mode does not support format reinterpretation.\n  .beforeAllSubcases(t => t.skipIf(t.isCompatibility))\n  .fn(t => {\n    const { format, sampleCount } = t.params;\n    const viewFormat = getBaseFormatForTextureFormat(format) as RegularTextureFormat;\n\n    t.skipIfTextureFormatNotSupported(format, viewFormat);\n\n    const cases = [\n      { format, viewFormat },\n      { format: viewFormat, viewFormat: format },\n    ];\n\n    for (const { format, viewFormat } of cases) {\n      // Make an input texel view.\n      const inputTexelView = makeInputTexelView(format);\n\n      // Create the renderTexture as |format|.\n      const renderTexture = t.createTextureTracked({\n        format,\n        size: [kTextureSize, kTextureSize],\n        usage:\n          GPUTextureUsage.RENDER_ATTACHMENT |\n          (sampleCount > 1 ? GPUTextureUsage.TEXTURE_BINDING : GPUTextureUsage.COPY_SRC),\n        viewFormats: [viewFormat],\n        sampleCount,\n      });\n\n      const resolveTexture =\n        sampleCount === 1\n          ? undefined\n          : t.createTextureTracked({\n              format,\n              size: [kTextureSize, kTextureSize],\n              usage: GPUTextureUsage.COPY_SRC | GPUTextureUsage.RENDER_ATTACHMENT,\n              viewFormats: [viewFormat],\n            });\n\n      // Create the sample source with the contents of the input texel view.\n      // We will sample this texture into |renderTexture|. It uses the same format to keep the same\n      // number of bits of precision.\n      const sampleSource = ttu.createTextureFromTexelView(t, inputTexelView, {\n        size: [kTextureSize, kTextureSize],\n        usage: GPUTextureUsage.TEXTURE_BINDING,\n      });\n\n      // Reinterpret the renderTexture as |viewFormat|.\n      const reinterpretedRenderView = renderTexture.createView({ format: viewFormat });\n      const reinterpretedResolveView =\n        resolveTexture && resolveTexture.createView({ format: viewFormat });\n\n      // Create a pipeline to blit a src texture to the render attachment.\n      const pipeline = makeBlitPipeline(t.device, viewFormat, {\n        sample: 1,\n        render: sampleCount,\n      });\n\n      // Execute a render pass to sample |sampleSource| into |texture| viewed as |viewFormat|.\n      const commandEncoder = t.device.createCommandEncoder();\n      const pass = commandEncoder.beginRenderPass({\n        colorAttachments: [\n          {\n            view: reinterpretedRenderView,\n            resolveTarget: reinterpretedResolveView,\n            loadOp: 'load',\n            storeOp: 'store',\n          },\n        ],\n      });\n      pass.setPipeline(pipeline);\n      pass.setBindGroup(\n        0,\n        t.device.createBindGroup({\n          layout: pipeline.getBindGroupLayout(0),\n          entries: [\n            {\n              binding: 0,\n              resource: sampleSource.createView(),\n            },\n          ],\n        })\n      );\n      pass.draw(6);\n      pass.end();\n\n      // If the render target is multisampled, we'll manually resolve it to check\n      // the contents.\n      const singleSampleRenderTexture = resolveTexture\n        ? t.createTextureTracked({\n            format,\n            size: [kTextureSize, kTextureSize],\n            usage: GPUTextureUsage.COPY_SRC | GPUTextureUsage.RENDER_ATTACHMENT,\n          })\n        : renderTexture;\n\n      if (resolveTexture) {\n        // Create a pipeline to blit the multisampled render texture to a non-multisample texture.\n        // We are basically performing a manual resolve step to the same format as the original\n        // render texture to check its contents.\n        const pipeline = makeBlitPipeline(t.device, format, { sample: sampleCount, render: 1 });\n        const pass = commandEncoder.beginRenderPass({\n          colorAttachments: [\n            {\n              view: singleSampleRenderTexture.createView(),\n              loadOp: 'load',\n              storeOp: 'store',\n            },\n          ],\n        });\n        pass.setPipeline(pipeline);\n        pass.setBindGroup(\n          0,\n          t.device.createBindGroup({\n            layout: pipeline.getBindGroupLayout(0),\n            entries: [\n              {\n                binding: 0,\n                resource: renderTexture.createView(),\n              },\n            ],\n          })\n        );\n        pass.draw(6);\n        pass.end();\n      }\n\n      // Submit the commands.\n      t.device.queue.submit([commandEncoder.finish()]);\n\n      // Check the rendered contents.\n      const renderViewTexels = TexelView.fromTexelsAsColors(viewFormat, inputTexelView.color, {\n        clampToFormatRange: true,\n      });\n      ttu.expectTexelViewComparisonIsOkInTexture(\n        t,\n        { texture: singleSampleRenderTexture },\n        renderViewTexels,\n        [kTextureSize, kTextureSize],\n        { maxDiffULPsForNormFormat: 2 }\n      );\n\n      // Check the resolved contents.\n      if (resolveTexture) {\n        const resolveView = TexelView.fromTexelsAsColors(viewFormat, renderViewTexels.color, {\n          clampToFormatRange: true,\n        });\n        ttu.expectTexelViewComparisonIsOkInTexture(\n          t,\n          { texture: resolveTexture },\n          resolveView,\n          [kTextureSize, kTextureSize],\n          { maxDiffULPsForNormFormat: 2 }\n        );\n      }\n    }\n  });\n"],"mappings":"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"}