{"version":3,"file":"format_reinterpretation.spec.js","names":["description","makeTestGroup","kRenderableColorTextureFormats","kRegularTextureFormats","viewCompatible","GPUTest","TextureTestMixin","TexelView","g","kColors","R","G","B","A","kTextureSize","makeInputTexelView","format","fromTexelsAsColors","coords","pixelPos","y","x","length","clampToFormatRange","makeBlitPipeline","device","multisample","createRenderPipeline","layout","vertex","module","createShaderModule","code","entryPoint","fragment","sample","targets","count","render","test","desc","params","u","combine","filter","viewFormat","beforeAllSubcases","t","skipIfTextureFormatNotSupported","fn","inputTexelView","texture","createTextureFromTexelView","size","usage","GPUTextureUsage","TEXTURE_BINDING","viewFormats","reinterpretedView","createView","reinterpretedTexelView","fromTexelsAsBytes","bytes","pipeline","createComputePipeline","compute","outputTexture","trackForCleanup","createTexture","STORAGE_BINDING","COPY_SRC","commandEncoder","createCommandEncoder","pass","beginComputePass","setPipeline","setBindGroup","createBindGroup","getBindGroupLayout","entries","binding","resource","dispatchWorkgroups","end","queue","submit","finish","expectTexelViewComparisonIsOkInTexture","color","sampleCount","renderTexture","RENDER_ATTACHMENT","resolveTexture","undefined","sampleSource","reinterpretedRenderView","reinterpretedResolveView","beginRenderPass","colorAttachments","view","resolveTarget","loadOp","storeOp","draw","singleSampleRenderTexture","renderViewTexels","maxDiffULPsForNormFormat","resolveView"],"sources":["../../../../../src/webgpu/api/operation/texture_view/format_reinterpretation.spec.ts"],"sourcesContent":["export const description = `\nTest texture views can reinterpret the format of the original texture.\n`;\n\nimport { makeTestGroup } from '../../../../common/framework/test_group.js';\nimport {\n  kRenderableColorTextureFormats,\n  kRegularTextureFormats,\n  viewCompatible,\n  EncodableTextureFormat,\n} from '../../../format_info.js';\nimport { GPUTest, TextureTestMixin } from '../../../gpu_test.js';\nimport { TexelView } from '../../../util/texture/texel_view.js';\n\nexport const g = makeTestGroup(TextureTestMixin(GPUTest));\n\nconst kColors = [\n  { R: 1.0, G: 0.0, B: 0.0, A: 0.8 },\n  { R: 0.0, G: 1.0, B: 0.0, A: 0.7 },\n  { R: 0.0, G: 0.0, B: 0.0, A: 0.6 },\n  { R: 0.0, G: 0.0, B: 0.0, A: 0.5 },\n  { R: 1.0, G: 1.0, B: 1.0, A: 0.4 },\n  { R: 0.7, G: 0.0, B: 0.0, A: 0.3 },\n  { R: 0.0, G: 0.8, B: 0.0, A: 0.2 },\n  { R: 0.0, G: 0.0, B: 0.9, A: 0.1 },\n  { R: 0.1, G: 0.2, B: 0.0, A: 0.3 },\n  { R: 0.4, G: 0.3, B: 0.6, A: 0.8 },\n];\n\nconst kTextureSize = 16;\n\nfunction makeInputTexelView(format: EncodableTextureFormat) {\n  return TexelView.fromTexelsAsColors(\n    format,\n    coords => {\n      const pixelPos = coords.y * kTextureSize + coords.x;\n      return kColors[pixelPos % kColors.length];\n    },\n    { clampToFormatRange: true }\n  );\n}\n\nfunction makeBlitPipeline(\n  device: GPUDevice,\n  format: GPUTextureFormat,\n  multisample: { sample: number; render: number }\n) {\n  return device.createRenderPipeline({\n    layout: 'auto',\n    vertex: {\n      module: device.createShaderModule({\n        code: `\n          @vertex fn main(@builtin(vertex_index) VertexIndex : u32) -> @builtin(position) vec4<f32> {\n            var pos = array<vec2<f32>, 6>(\n                                        vec2<f32>(-1.0, -1.0),\n                                        vec2<f32>(-1.0,  1.0),\n                                        vec2<f32>( 1.0, -1.0),\n                                        vec2<f32>(-1.0,  1.0),\n                                        vec2<f32>( 1.0, -1.0),\n                                        vec2<f32>( 1.0,  1.0));\n            return vec4<f32>(pos[VertexIndex], 0.0, 1.0);\n          }`,\n      }),\n      entryPoint: 'main',\n    },\n    fragment: {\n      module:\n        multisample.sample > 1\n          ? device.createShaderModule({\n              code: `\n            @group(0) @binding(0) var src: texture_multisampled_2d<f32>;\n            @fragment fn main(@builtin(position) coord: vec4<f32>) -> @location(0) vec4<f32> {\n              var result : vec4<f32>;\n              for (var i = 0; i < ${multisample.sample}; i = i + 1) {\n                result = result + textureLoad(src, vec2<i32>(coord.xy), i);\n              }\n              return result * ${1 / multisample.sample};\n            }`,\n            })\n          : device.createShaderModule({\n              code: `\n            @group(0) @binding(0) var src: texture_2d<f32>;\n            @fragment fn main(@builtin(position) coord: vec4<f32>) -> @location(0) vec4<f32> {\n              return textureLoad(src, vec2<i32>(coord.xy), 0);\n            }`,\n            }),\n      entryPoint: 'main',\n      targets: [{ format }],\n    },\n    multisample: {\n      count: multisample.render,\n    },\n  });\n}\n\ng.test('texture_binding')\n  .desc(`Test that a regular texture allocated as 'format' is correctly sampled as 'viewFormat'.`)\n  .params(u =>\n    u //\n      .combine('format', kRegularTextureFormats)\n      .combine('viewFormat', kRegularTextureFormats)\n      .filter(\n        ({ format, viewFormat }) => format !== viewFormat && viewCompatible(format, viewFormat)\n      )\n  )\n  .beforeAllSubcases(t => {\n    const { format, viewFormat } = t.params;\n    t.skipIfTextureFormatNotSupported(format, viewFormat);\n  })\n  .fn(t => {\n    const { format, viewFormat } = t.params;\n\n    // Make an input texel view.\n    const inputTexelView = makeInputTexelView(format);\n\n    // Create the initial texture with the contents if the input texel view.\n    const texture = t.createTextureFromTexelView(inputTexelView, {\n      size: [kTextureSize, kTextureSize],\n      usage: GPUTextureUsage.TEXTURE_BINDING,\n      viewFormats: [viewFormat],\n    });\n\n    // Reinterpret the texture as the view format.\n    // Make a texel view of the format that also reinterprets the data.\n    const reinterpretedView = texture.createView({ format: viewFormat });\n    const reinterpretedTexelView = TexelView.fromTexelsAsBytes(viewFormat, inputTexelView.bytes);\n\n    // Create a pipeline to write data out to rgba8unorm.\n    const pipeline = t.device.createComputePipeline({\n      layout: 'auto',\n      compute: {\n        module: t.device.createShaderModule({\n          code: `\n          @group(0) @binding(0) var src: texture_2d<f32>;\n          @group(0) @binding(1) var dst: texture_storage_2d<rgba8unorm, write>;\n          @compute @workgroup_size(1, 1) fn main(\n            @builtin(global_invocation_id) global_id: vec3<u32>,\n          ) {\n            var coord = vec2<i32>(global_id.xy);\n            textureStore(dst, coord, textureLoad(src, coord, 0));\n          }`,\n        }),\n        entryPoint: 'main',\n      },\n    });\n\n    // Create an rgba8unorm output texture.\n    const outputTexture = t.trackForCleanup(\n      t.device.createTexture({\n        format: 'rgba8unorm',\n        size: [kTextureSize, kTextureSize],\n        usage: GPUTextureUsage.STORAGE_BINDING | GPUTextureUsage.COPY_SRC,\n      })\n    );\n\n    // Execute a compute pass to load data from the reinterpreted view and\n    // write out to the rgba8unorm texture.\n    const commandEncoder = t.device.createCommandEncoder();\n    const pass = commandEncoder.beginComputePass();\n    pass.setPipeline(pipeline);\n    pass.setBindGroup(\n      0,\n      t.device.createBindGroup({\n        layout: pipeline.getBindGroupLayout(0),\n        entries: [\n          {\n            binding: 0,\n            resource: reinterpretedView,\n          },\n          {\n            binding: 1,\n            resource: outputTexture.createView(),\n          },\n        ],\n      })\n    );\n    pass.dispatchWorkgroups(kTextureSize, kTextureSize);\n    pass.end();\n    t.device.queue.submit([commandEncoder.finish()]);\n\n    t.expectTexelViewComparisonIsOkInTexture(\n      { texture: outputTexture },\n      TexelView.fromTexelsAsColors('rgba8unorm', reinterpretedTexelView.color, {\n        clampToFormatRange: true,\n      }),\n      [kTextureSize, kTextureSize]\n    );\n  });\n\ng.test('render_and_resolve_attachment')\n  .desc(\n    `Test that a color render attachment allocated as 'format' is correctly rendered to as 'viewFormat',\nand resolved to an attachment allocated as 'format' viewed as 'viewFormat'.\n\nOther combinations aren't possible because the render and resolve targets must both match\nin view format and match in base format.`\n  )\n  .params(u =>\n    u //\n      .combine('format', kRenderableColorTextureFormats)\n      .combine('viewFormat', kRenderableColorTextureFormats)\n      .filter(\n        ({ format, viewFormat }) => format !== viewFormat && viewCompatible(format, viewFormat)\n      )\n      .combine('sampleCount', [1, 4])\n  )\n  .beforeAllSubcases(t => {\n    const { format, viewFormat } = t.params;\n    t.skipIfTextureFormatNotSupported(format, viewFormat);\n  })\n  .fn(t => {\n    const { format, viewFormat, sampleCount } = t.params;\n\n    // Make an input texel view.\n    const inputTexelView = makeInputTexelView(format);\n\n    // Create the renderTexture as |format|.\n    const renderTexture = t.trackForCleanup(\n      t.device.createTexture({\n        format,\n        size: [kTextureSize, kTextureSize],\n        usage:\n          GPUTextureUsage.RENDER_ATTACHMENT |\n          (sampleCount > 1 ? GPUTextureUsage.TEXTURE_BINDING : GPUTextureUsage.COPY_SRC),\n        viewFormats: [viewFormat],\n        sampleCount,\n      })\n    );\n\n    const resolveTexture =\n      sampleCount === 1\n        ? undefined\n        : t.trackForCleanup(\n            t.device.createTexture({\n              format,\n              size: [kTextureSize, kTextureSize],\n              usage: GPUTextureUsage.COPY_SRC | GPUTextureUsage.RENDER_ATTACHMENT,\n              viewFormats: [viewFormat],\n            })\n          );\n\n    // Create the sample source with the contents of the input texel view.\n    // We will sample this texture into |renderTexture|. It uses the same format to keep the same\n    // number of bits of precision.\n    const sampleSource = t.createTextureFromTexelView(inputTexelView, {\n      size: [kTextureSize, kTextureSize],\n      usage: GPUTextureUsage.TEXTURE_BINDING,\n    });\n\n    // Reinterpret the renderTexture as |viewFormat|.\n    const reinterpretedRenderView = renderTexture.createView({ format: viewFormat });\n    const reinterpretedResolveView =\n      resolveTexture && resolveTexture.createView({ format: viewFormat });\n\n    // Create a pipeline to blit a src texture to the render attachment.\n    const pipeline = makeBlitPipeline(t.device, viewFormat, {\n      sample: 1,\n      render: sampleCount,\n    });\n\n    // Execute a render pass to sample |sampleSource| into |texture| viewed as |viewFormat|.\n    const commandEncoder = t.device.createCommandEncoder();\n    const pass = commandEncoder.beginRenderPass({\n      colorAttachments: [\n        {\n          view: reinterpretedRenderView,\n          resolveTarget: reinterpretedResolveView,\n          loadOp: 'load',\n          storeOp: 'store',\n        },\n      ],\n    });\n    pass.setPipeline(pipeline);\n    pass.setBindGroup(\n      0,\n      t.device.createBindGroup({\n        layout: pipeline.getBindGroupLayout(0),\n        entries: [\n          {\n            binding: 0,\n            resource: sampleSource.createView(),\n          },\n        ],\n      })\n    );\n    pass.draw(6);\n    pass.end();\n\n    // If the render target is multisampled, we'll manually resolve it to check\n    // the contents.\n    const singleSampleRenderTexture = resolveTexture\n      ? t.trackForCleanup(\n          t.device.createTexture({\n            format,\n            size: [kTextureSize, kTextureSize],\n            usage: GPUTextureUsage.COPY_SRC | GPUTextureUsage.RENDER_ATTACHMENT,\n          })\n        )\n      : renderTexture;\n\n    if (resolveTexture) {\n      // Create a pipeline to blit the multisampled render texture to a non-multisample texture.\n      // We are basically performing a manual resolve step to the same format as the original\n      // render texture to check its contents.\n      const pipeline = makeBlitPipeline(t.device, format, { sample: sampleCount, render: 1 });\n      const pass = commandEncoder.beginRenderPass({\n        colorAttachments: [\n          {\n            view: singleSampleRenderTexture.createView(),\n            loadOp: 'load',\n            storeOp: 'store',\n          },\n        ],\n      });\n      pass.setPipeline(pipeline);\n      pass.setBindGroup(\n        0,\n        t.device.createBindGroup({\n          layout: pipeline.getBindGroupLayout(0),\n          entries: [\n            {\n              binding: 0,\n              resource: renderTexture.createView(),\n            },\n          ],\n        })\n      );\n      pass.draw(6);\n      pass.end();\n    }\n\n    // Submit the commands.\n    t.device.queue.submit([commandEncoder.finish()]);\n\n    // Check the rendered contents.\n    const renderViewTexels = TexelView.fromTexelsAsColors(viewFormat, inputTexelView.color, {\n      clampToFormatRange: true,\n    });\n    t.expectTexelViewComparisonIsOkInTexture(\n      { texture: singleSampleRenderTexture },\n      renderViewTexels,\n      [kTextureSize, kTextureSize],\n      { maxDiffULPsForNormFormat: 2 }\n    );\n\n    // Check the resolved contents.\n    if (resolveTexture) {\n      const resolveView = TexelView.fromTexelsAsColors(viewFormat, renderViewTexels.color, {\n        clampToFormatRange: true,\n      });\n      t.expectTexelViewComparisonIsOkInTexture(\n        { texture: resolveTexture },\n        resolveView,\n        [kTextureSize, kTextureSize],\n        { maxDiffULPsForNormFormat: 2 }\n      );\n    }\n  });\n"],"mappings":"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"}