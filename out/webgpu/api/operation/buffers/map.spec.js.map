{"version":3,"file":"map.spec.js","names":["description","makeTestGroup","assert","memcpy","checkElementsEqual","MappingTest","g","kSubcases","size","range","undefined","reifyMapRange","bufferSize","offset","mapRegionBoundModes","getRegionForMap","mapAsyncRegionLeft","mapAsyncRegionRight","regionLeft","regionRight","test","desc","params","u","combine","beginSubcases","combineWithParams","fn","t","rangeOffset","rangeSize","buffer","device","createBuffer","usage","GPUBufferUsage","COPY_SRC","MAP_WRITE","mapRegion","mapAsync","GPUMapMode","WRITE","arrayBuffer","getMappedRange","checkMapWrite","range1","range2","mappedAtCreation","rangeOffset1","rangeSize1","rangeOffset2","rangeSize2","init","byteLength","expectedBuffer","ArrayBuffer","expected","Uint32Array","BYTES_PER_ELEMENT","data","i","length","unmap","init2","expected2","data2","expectGPUBufferValuesEqual","COPY_DST","MAP_READ","READ","actual","Uint8Array","expectOK","expectedArrayBuffer","uint8Expected","int8Expected","Int8Array","uint16Expected","Uint16Array","int16Expected","Int16Array","uint32Expected","int32Expected","Int32Array","float32Expected","Float32Array","float64Expected","Float64Array","Number","MAX_VALUE","MIN_VALUE","src","dst","mappedArrayBuffer","mappable"],"sources":["../../../../../src/webgpu/api/operation/buffers/map.spec.ts"],"sourcesContent":["export const description = `\nTest the operation of buffer mapping, specifically the data contents written via\nmap-write/mappedAtCreation, and the contents of buffers returned by getMappedRange on\nbuffers which are mapped-read/mapped-write/mappedAtCreation.\n\nrange: used for getMappedRange\nmapRegion: used for mapAsync\n\nmapRegionBoundModes is used to get mapRegion from range:\n - default-expand: expand mapRegion to buffer bound by setting offset/size to undefined\n - explicit-expand: expand mapRegion to buffer bound by explicitly calculating offset/size\n - minimal: make mapRegion to be the same as range which is the minimal range to make getMappedRange input valid\n`;\n\nimport { makeTestGroup } from '../../../../common/framework/test_group.js';\nimport { assert, memcpy } from '../../../../common/util/util.js';\nimport { checkElementsEqual } from '../../../util/check_contents.js';\n\nimport { MappingTest } from './mapping_test.js';\n\nexport const g = makeTestGroup(MappingTest);\n\nconst kSubcases = [\n  { size: 0, range: [] },\n  { size: 0, range: [undefined] },\n  { size: 0, range: [undefined, undefined] },\n  { size: 0, range: [0] },\n  { size: 0, range: [0, undefined] },\n  { size: 0, range: [0, 0] },\n  { size: 12, range: [] },\n  { size: 12, range: [undefined] },\n  { size: 12, range: [undefined, undefined] },\n  { size: 12, range: [0] },\n  { size: 12, range: [0, undefined] },\n  { size: 12, range: [0, 12] },\n  { size: 12, range: [0, 0] },\n  { size: 12, range: [8] },\n  { size: 12, range: [8, undefined] },\n  { size: 12, range: [8, 4] },\n  { size: 28, range: [8, 8] },\n  { size: 28, range: [8, 12] },\n  { size: 512 * 1024, range: [] },\n] as const;\n\nfunction reifyMapRange(bufferSize: number, range: readonly [number?, number?]): [number, number] {\n  const offset = range[0] ?? 0;\n  return [offset, range[1] ?? bufferSize - offset];\n}\n\nconst mapRegionBoundModes = ['default-expand', 'explicit-expand', 'minimal'] as const;\ntype MapRegionBoundMode = typeof mapRegionBoundModes[number];\n\nfunction getRegionForMap(\n  bufferSize: number,\n  range: [number, number],\n  {\n    mapAsyncRegionLeft,\n    mapAsyncRegionRight,\n  }: {\n    mapAsyncRegionLeft: MapRegionBoundMode;\n    mapAsyncRegionRight: MapRegionBoundMode;\n  }\n) {\n  const regionLeft = mapAsyncRegionLeft === 'minimal' ? range[0] : 0;\n  const regionRight = mapAsyncRegionRight === 'minimal' ? range[0] + range[1] : bufferSize;\n  return [\n    mapAsyncRegionLeft === 'default-expand' ? undefined : regionLeft,\n    mapAsyncRegionRight === 'default-expand' ? undefined : regionRight - regionLeft,\n  ] as const;\n}\n\ng.test('mapAsync,write')\n  .desc(\n    `Use map-write to write to various ranges of variously-sized buffers, then expectContents\n(which does copyBufferToBuffer + map-read) to ensure the contents were written.`\n  )\n  .params(u =>\n    u\n      .combine('mapAsyncRegionLeft', mapRegionBoundModes)\n      .combine('mapAsyncRegionRight', mapRegionBoundModes)\n      .beginSubcases()\n      .combineWithParams(kSubcases)\n  )\n  .fn(async t => {\n    const { size, range } = t.params;\n    const [rangeOffset, rangeSize] = reifyMapRange(size, range);\n\n    const buffer = t.device.createBuffer({\n      size,\n      usage: GPUBufferUsage.COPY_SRC | GPUBufferUsage.MAP_WRITE,\n    });\n\n    const mapRegion = getRegionForMap(size, [rangeOffset, rangeSize], t.params);\n    await buffer.mapAsync(GPUMapMode.WRITE, ...mapRegion);\n    const arrayBuffer = buffer.getMappedRange(...range);\n    t.checkMapWrite(buffer, rangeOffset, arrayBuffer, rangeSize);\n  });\n\ng.test('mapAsync,write,unchanged_ranges_preserved')\n  .desc(\n    `Use mappedAtCreation or mapAsync to write to various ranges of variously-sized buffers, then\nuse mapAsync to map a different range and zero it out. Finally use expectGPUBufferValuesEqual\n(which does copyBufferToBuffer + map-read) to verify that contents originally written outside the\nsecond mapped range were not altered.`\n  )\n  .params(u =>\n    u\n      .beginSubcases()\n      .combine('mappedAtCreation', [false, true])\n      .combineWithParams([\n        { size: 12, range1: [], range2: [8] },\n        { size: 12, range1: [], range2: [0, 8] },\n        { size: 12, range1: [0, 8], range2: [8] },\n        { size: 12, range1: [8], range2: [0, 8] },\n        { size: 28, range1: [], range2: [8, 8] },\n        { size: 28, range1: [8, 16], range2: [16, 8] },\n        { size: 32, range1: [16, 12], range2: [8, 16] },\n        { size: 32, range1: [8, 8], range2: [24, 4] },\n      ] as const)\n  )\n  .fn(async t => {\n    const { size, range1, range2, mappedAtCreation } = t.params;\n    const [rangeOffset1, rangeSize1] = reifyMapRange(size, range1);\n    const [rangeOffset2, rangeSize2] = reifyMapRange(size, range2);\n\n    const buffer = t.device.createBuffer({\n      mappedAtCreation,\n      size,\n      usage: GPUBufferUsage.COPY_SRC | GPUBufferUsage.MAP_WRITE,\n    });\n\n    // If the buffer is not mappedAtCreation map it now.\n    if (!mappedAtCreation) {\n      await buffer.mapAsync(GPUMapMode.WRITE);\n    }\n\n    // Set the initial contents of the buffer.\n    const init = buffer.getMappedRange(...range1);\n\n    assert(init.byteLength === rangeSize1);\n    const expectedBuffer = new ArrayBuffer(size);\n    const expected = new Uint32Array(\n      expectedBuffer,\n      rangeOffset1,\n      rangeSize1 / Uint32Array.BYTES_PER_ELEMENT\n    );\n    const data = new Uint32Array(init);\n    for (let i = 0; i < data.length; ++i) {\n      data[i] = expected[i] = i + 1;\n    }\n    buffer.unmap();\n\n    // Write to a second range of the buffer\n    await buffer.mapAsync(GPUMapMode.WRITE, ...range2);\n    const init2 = buffer.getMappedRange(...range2);\n\n    assert(init2.byteLength === rangeSize2);\n    const expected2 = new Uint32Array(\n      expectedBuffer,\n      rangeOffset2,\n      rangeSize2 / Uint32Array.BYTES_PER_ELEMENT\n    );\n    const data2 = new Uint32Array(init2);\n    for (let i = 0; i < data2.length; ++i) {\n      data2[i] = expected2[i] = 0;\n    }\n    buffer.unmap();\n\n    // Verify that the range of the buffer which was not overwritten was preserved.\n    t.expectGPUBufferValuesEqual(buffer, expected, rangeOffset1);\n  });\n\ng.test('mapAsync,read')\n  .desc(\n    `Use mappedAtCreation to initialize various ranges of variously-sized buffers, then\nmap-read and check the read-back result.`\n  )\n  .params(u =>\n    u\n      .combine('mapAsyncRegionLeft', mapRegionBoundModes)\n      .combine('mapAsyncRegionRight', mapRegionBoundModes)\n      .beginSubcases()\n      .combineWithParams(kSubcases)\n  )\n  .fn(async t => {\n    const { size, range } = t.params;\n    const [rangeOffset, rangeSize] = reifyMapRange(size, range);\n\n    const buffer = t.device.createBuffer({\n      mappedAtCreation: true,\n      size,\n      usage: GPUBufferUsage.COPY_DST | GPUBufferUsage.MAP_READ,\n    });\n    const init = buffer.getMappedRange(...range);\n\n    assert(init.byteLength === rangeSize);\n    const expected = new Uint32Array(new ArrayBuffer(rangeSize));\n    const data = new Uint32Array(init);\n    for (let i = 0; i < data.length; ++i) {\n      data[i] = expected[i] = i + 1;\n    }\n    buffer.unmap();\n\n    const mapRegion = getRegionForMap(size, [rangeOffset, rangeSize], t.params);\n    await buffer.mapAsync(GPUMapMode.READ, ...mapRegion);\n    const actual = new Uint8Array(buffer.getMappedRange(...range));\n    t.expectOK(checkElementsEqual(actual, new Uint8Array(expected.buffer)));\n  });\n\ng.test('mapAsync,read,typedArrayAccess')\n  .desc(`Use various TypedArray types to read back from a mapped buffer`)\n  .params(u =>\n    u\n      .combine('mapAsyncRegionLeft', mapRegionBoundModes)\n      .combine('mapAsyncRegionRight', mapRegionBoundModes)\n      .beginSubcases()\n      .combineWithParams([\n        { size: 80, range: [] },\n        { size: 160, range: [] },\n        { size: 160, range: [0, 80] },\n        { size: 160, range: [80] },\n        { size: 160, range: [40, 120] },\n        { size: 160, range: [40] },\n      ] as const)\n  )\n  .fn(async t => {\n    const { size, range } = t.params;\n    const [rangeOffset, rangeSize] = reifyMapRange(size, range);\n\n    // Fill an array buffer with a variety of values of different types.\n    const expectedArrayBuffer = new ArrayBuffer(80);\n    const uint8Expected = new Uint8Array(expectedArrayBuffer, 0, 2);\n    uint8Expected[0] = 1;\n    uint8Expected[1] = 255;\n\n    const int8Expected = new Int8Array(expectedArrayBuffer, 2, 2);\n    int8Expected[0] = -1;\n    int8Expected[1] = 127;\n\n    const uint16Expected = new Uint16Array(expectedArrayBuffer, 4, 2);\n    uint16Expected[0] = 1;\n    uint16Expected[1] = 65535;\n\n    const int16Expected = new Int16Array(expectedArrayBuffer, 8, 2);\n    int16Expected[0] = -1;\n    int16Expected[1] = 32767;\n\n    const uint32Expected = new Uint32Array(expectedArrayBuffer, 12, 2);\n    uint32Expected[0] = 1;\n    uint32Expected[1] = 4294967295;\n\n    const int32Expected = new Int32Array(expectedArrayBuffer, 20, 2);\n    int32Expected[2] = -1;\n    int32Expected[3] = 2147483647;\n\n    const float32Expected = new Float32Array(expectedArrayBuffer, 28, 3);\n    float32Expected[0] = 1;\n    float32Expected[1] = -1;\n    float32Expected[2] = 12345.6789;\n\n    const float64Expected = new Float64Array(expectedArrayBuffer, 40, 5);\n    float64Expected[0] = 1;\n    float64Expected[1] = -1;\n    float64Expected[2] = 12345.6789;\n    float64Expected[3] = Number.MAX_VALUE;\n    float64Expected[4] = Number.MIN_VALUE;\n\n    const buffer = t.device.createBuffer({\n      mappedAtCreation: true,\n      size,\n      usage: GPUBufferUsage.COPY_DST | GPUBufferUsage.MAP_READ,\n    });\n    const init = buffer.getMappedRange(...range);\n\n    // Copy the expected values into the mapped range.\n    assert(init.byteLength === rangeSize);\n    memcpy({ src: expectedArrayBuffer }, { dst: init });\n    buffer.unmap();\n\n    const mapRegion = getRegionForMap(size, [rangeOffset, rangeSize], t.params);\n    await buffer.mapAsync(GPUMapMode.READ, ...mapRegion);\n    const mappedArrayBuffer = buffer.getMappedRange(...range);\n    t.expectOK(checkElementsEqual(new Uint8Array(mappedArrayBuffer, 0, 2), uint8Expected));\n    t.expectOK(checkElementsEqual(new Int8Array(mappedArrayBuffer, 2, 2), int8Expected));\n    t.expectOK(checkElementsEqual(new Uint16Array(mappedArrayBuffer, 4, 2), uint16Expected));\n    t.expectOK(checkElementsEqual(new Int16Array(mappedArrayBuffer, 8, 2), int16Expected));\n    t.expectOK(checkElementsEqual(new Uint32Array(mappedArrayBuffer, 12, 2), uint32Expected));\n    t.expectOK(checkElementsEqual(new Int32Array(mappedArrayBuffer, 20, 2), int32Expected));\n    t.expectOK(checkElementsEqual(new Float32Array(mappedArrayBuffer, 28, 3), float32Expected));\n    t.expectOK(checkElementsEqual(new Float64Array(mappedArrayBuffer, 40, 5), float64Expected));\n  });\n\ng.test('mappedAtCreation')\n  .desc(\n    `Use mappedAtCreation to write to various ranges of variously-sized buffers created either\nwith or without the MAP_WRITE usage (since this could affect the mappedAtCreation upload path),\nthen expectContents (which does copyBufferToBuffer + map-read) to ensure the contents were written.`\n  )\n  .params(u =>\n    u //\n      .combine('mappable', [false, true])\n      .beginSubcases()\n      .combineWithParams(kSubcases)\n  )\n  .fn(async t => {\n    const { size, range, mappable } = t.params;\n    const [, rangeSize] = reifyMapRange(size, range);\n\n    const buffer = t.device.createBuffer({\n      mappedAtCreation: true,\n      size,\n      usage: GPUBufferUsage.COPY_SRC | (mappable ? GPUBufferUsage.MAP_WRITE : 0),\n    });\n    const arrayBuffer = buffer.getMappedRange(...range);\n    t.checkMapWrite(buffer, range[0] ?? 0, arrayBuffer, rangeSize);\n  });\n\ng.test('remapped_for_write')\n  .desc(\n    `Use mappedAtCreation or mapAsync to write to various ranges of variously-sized buffers created\nwith the MAP_WRITE usage, then mapAsync again and ensure that the previously written values are\nstill present in the mapped buffer.`\n  )\n  .params(u =>\n    u //\n      .combine('mapAsyncRegionLeft', mapRegionBoundModes)\n      .combine('mapAsyncRegionRight', mapRegionBoundModes)\n      .beginSubcases()\n      .combine('mappedAtCreation', [false, true])\n      .combineWithParams(kSubcases)\n  )\n  .fn(async t => {\n    const { size, range, mappedAtCreation } = t.params;\n    const [rangeOffset, rangeSize] = reifyMapRange(size, range);\n\n    const buffer = t.device.createBuffer({\n      mappedAtCreation,\n      size,\n      usage: GPUBufferUsage.COPY_SRC | GPUBufferUsage.MAP_WRITE,\n    });\n\n    // If the buffer is not mappedAtCreation map it now.\n    if (!mappedAtCreation) {\n      await buffer.mapAsync(GPUMapMode.WRITE);\n    }\n\n    // Set the initial contents of the buffer.\n    const init = buffer.getMappedRange(...range);\n\n    assert(init.byteLength === rangeSize);\n    const expected = new Uint32Array(new ArrayBuffer(rangeSize));\n    const data = new Uint32Array(init);\n    for (let i = 0; i < data.length; ++i) {\n      data[i] = expected[i] = i + 1;\n    }\n    buffer.unmap();\n\n    // Check that upon remapping the for WRITE the values in the buffer are\n    // still the same.\n    const mapRegion = getRegionForMap(size, [rangeOffset, rangeSize], t.params);\n    await buffer.mapAsync(GPUMapMode.WRITE, ...mapRegion);\n    const actual = new Uint8Array(buffer.getMappedRange(...range));\n    t.expectOK(checkElementsEqual(actual, new Uint8Array(expected.buffer)));\n  });\n"],"mappings":"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"}