{"version":3,"sources":["../../../../../src/webgpu/api/operation/rendering/blending.spec.ts"],"names":["description","makeTestGroup","assert","unreachable","kBlendFactors","kBlendOperations","GPUTest","float32ToFloat16Bits","g","mapColor","col","f","r","b","a","computeBlendFactor","src","dst","blendColor","factor","v","Math","min","undefined","computeBlendOperation","srcFactor","dstFactor","operation","_","k","max","test","desc","params","u","combine","filter","t","beginSubcases","expand","p","needsBlendConstant","fn","textureFormat","srcColor","dstColor","blendConstant","expectedColor","component","pipeline","device","createRenderPipeline","fragment","targets","format","blend","color","alpha","module","createShaderModule","code","entryPoint","vertex","primitive","topology","renderTarget","createTexture","usage","GPUTextureUsage","RENDER_ATTACHMENT","COPY_SRC","size","commandEncoder","createCommandEncoder","renderPass","beginRenderPass","colorAttachments","view","createView","clearValue","loadOp","storeOp","setPipeline","setBlendConstant","setBindGroup","createBindGroup","layout","getBindGroupLayout","entries","binding","resource","buffer","makeBufferWithContents","Float32Array","GPUBufferUsage","UNIFORM","draw","end","queue","submit","finish","tolerance","expectedLow","expectedHigh","expectSinglePixelBetweenTwoValuesFloat16In2DTexture","x","y","exp","Uint16Array","map","unimplemented"],"mappings":"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","sourcesContent":["export const description = `\nTest blending results.\n\nTODO:\n- Test result for all combinations of args (make sure each case is distinguishable from others\n- Test underflow/overflow has consistent behavior\n- ?\n`;\n\nimport { makeTestGroup } from '../../../../common/framework/test_group.js';\nimport { assert, unreachable } from '../../../../common/util/util.js';\nimport { kBlendFactors, kBlendOperations } from '../../../capability_info.js';\nimport { GPUTest } from '../../../gpu_test.js';\nimport { float32ToFloat16Bits } from '../../../util/conversion.js';\n\nexport const g = makeTestGroup(GPUTest);\n\nfunction mapColor(\n  col: GPUColorDict,\n  f: (v: number, k: keyof GPUColorDict) => number\n): GPUColorDict {\n  return {\n    r: f(col.r, 'r'),\n    g: f(col.g, 'g'),\n    b: f(col.b, 'b'),\n    a: f(col.a, 'a'),\n  };\n}\n\nfunction computeBlendFactor(\n  src: GPUColorDict,\n  dst: GPUColorDict,\n  blendColor: GPUColorDict | undefined,\n  factor: GPUBlendFactor\n): GPUColorDict {\n  switch (factor) {\n    case 'zero':\n      return { r: 0, g: 0, b: 0, a: 0 };\n    case 'one':\n      return { r: 1, g: 1, b: 1, a: 1 };\n    case 'src':\n      return { ...src };\n    case 'one-minus-src':\n      return mapColor(src, v => 1 - v);\n    case 'src-alpha':\n      return mapColor(src, () => src.a);\n    case 'one-minus-src-alpha':\n      return mapColor(src, () => 1 - src.a);\n    case 'dst':\n      return { ...dst };\n    case 'one-minus-dst':\n      return mapColor(dst, v => 1 - v);\n    case 'dst-alpha':\n      return mapColor(dst, () => dst.a);\n    case 'one-minus-dst-alpha':\n      return mapColor(dst, () => 1 - dst.a);\n    case 'src-alpha-saturated': {\n      const f = Math.min(src.a, 1 - dst.a);\n      return { r: f, g: f, b: f, a: 1 };\n    }\n    case 'constant':\n      assert(blendColor !== undefined);\n      return { ...blendColor };\n    case 'one-minus-constant':\n      assert(blendColor !== undefined);\n      return mapColor(blendColor, v => 1 - v);\n    default:\n      unreachable();\n  }\n}\n\nfunction computeBlendOperation(\n  src: GPUColorDict,\n  srcFactor: GPUColorDict,\n  dst: GPUColorDict,\n  dstFactor: GPUColorDict,\n  operation: GPUBlendOperation\n) {\n  switch (operation) {\n    case 'add':\n      return mapColor(src, (_, k) => srcFactor[k] * src[k] + dstFactor[k] * dst[k]);\n    case 'max':\n      return mapColor(src, (_, k) => Math.max(src[k], dst[k]));\n    case 'min':\n      return mapColor(src, (_, k) => Math.min(src[k], dst[k]));\n    case 'reverse-subtract':\n      return mapColor(src, (_, k) => dstFactor[k] * dst[k] - srcFactor[k] * src[k]);\n    case 'subtract':\n      return mapColor(src, (_, k) => srcFactor[k] * src[k] - dstFactor[k] * dst[k]);\n  }\n}\n\ng.test('GPUBlendComponent')\n  .desc(\n    `Test all combinations of parameters for GPUBlendComponent.\n\n  Tests that parameters are correctly passed to the backend API and blend computations\n  are done correctly by blending a single pixel. The test uses rgba16float as the format\n  to avoid checking clamping behavior (tested in api,operation,rendering,blending:clamp,*).\n\n  Params:\n    - component= {color, alpha} - whether to test blending the color or the alpha component.\n    - srcFactor= {...all GPUBlendFactors}\n    - dstFactor= {...all GPUBlendFactors}\n    - operation= {...all GPUBlendOperations}`\n  )\n  .params(u =>\n    u //\n      .combine('component', ['color', 'alpha'] as const)\n      .combine('srcFactor', kBlendFactors)\n      .combine('dstFactor', kBlendFactors)\n      .combine('operation', kBlendOperations)\n      .filter(t => {\n        if (t.operation === 'min' || t.operation === 'max') {\n          return t.srcFactor === 'one' && t.dstFactor === 'one';\n        }\n        return true;\n      })\n      .beginSubcases()\n      .combine('srcColor', [{ r: 0.11, g: 0.61, b: 0.81, a: 0.44 }])\n      .combine('dstColor', [\n        { r: 0.51, g: 0.22, b: 0.71, a: 0.33 },\n        { r: 0.09, g: 0.73, b: 0.93, a: 0.81 },\n      ])\n      .expand('blendConstant', p => {\n        const needsBlendConstant =\n          p.srcFactor === 'one-minus-constant' ||\n          p.srcFactor === 'constant' ||\n          p.dstFactor === 'one-minus-constant' ||\n          p.dstFactor === 'constant';\n        return needsBlendConstant ? [{ r: 0.91, g: 0.82, b: 0.73, a: 0.64 }] : [undefined];\n      })\n  )\n  .fn(t => {\n    const textureFormat: GPUTextureFormat = 'rgba16float';\n    const srcColor = t.params.srcColor;\n    const dstColor = t.params.dstColor;\n    const blendConstant = t.params.blendConstant;\n\n    const srcFactor = computeBlendFactor(srcColor, dstColor, blendConstant, t.params.srcFactor);\n    const dstFactor = computeBlendFactor(srcColor, dstColor, blendConstant, t.params.dstFactor);\n\n    const expectedColor = computeBlendOperation(\n      srcColor,\n      srcFactor,\n      dstColor,\n      dstFactor,\n      t.params.operation\n    );\n\n    switch (t.params.component) {\n      case 'color':\n        expectedColor.a = srcColor.a;\n        break;\n      case 'alpha':\n        expectedColor.r = srcColor.r;\n        expectedColor.g = srcColor.g;\n        expectedColor.b = srcColor.b;\n        break;\n    }\n\n    const pipeline = t.device.createRenderPipeline({\n      fragment: {\n        targets: [\n          {\n            format: textureFormat,\n            blend: {\n              // Set both color/alpha to defaults...\n              color: {},\n              alpha: {},\n              // ... but then override the component we're testing.\n              [t.params.component]: {\n                srcFactor: t.params.srcFactor,\n                dstFactor: t.params.dstFactor,\n                operation: t.params.operation,\n              },\n            },\n          },\n        ],\n        module: t.device.createShaderModule({\n          code: `\nstruct Uniform {\n  color: vec4<f32>\n};\n@group(0) @binding(0) var<uniform> u : Uniform;\n\n@stage(fragment) fn main() -> @location(0) vec4<f32> {\n  return u.color;\n}\n          `,\n        }),\n        entryPoint: 'main',\n      },\n      vertex: {\n        module: t.device.createShaderModule({\n          code: `\n@stage(vertex) fn main() -> @builtin(position) vec4<f32> {\n    return vec4<f32>(0.0, 0.0, 0.0, 1.0);\n}\n          `,\n        }),\n        entryPoint: 'main',\n      },\n      primitive: {\n        topology: 'point-list',\n      },\n    });\n\n    const renderTarget = t.device.createTexture({\n      usage: GPUTextureUsage.RENDER_ATTACHMENT | GPUTextureUsage.COPY_SRC,\n      size: [1, 1, 1],\n      format: textureFormat,\n    });\n\n    const commandEncoder = t.device.createCommandEncoder();\n    const renderPass = commandEncoder.beginRenderPass({\n      colorAttachments: [\n        {\n          view: renderTarget.createView(),\n          clearValue: dstColor,\n          loadOp: 'clear',\n          storeOp: 'store',\n        },\n      ],\n    });\n    renderPass.setPipeline(pipeline);\n    if (blendConstant) {\n      renderPass.setBlendConstant(blendConstant);\n    }\n    renderPass.setBindGroup(\n      0,\n      t.device.createBindGroup({\n        layout: pipeline.getBindGroupLayout(0),\n        entries: [\n          {\n            binding: 0,\n            resource: {\n              buffer: t.makeBufferWithContents(\n                new Float32Array([srcColor.r, srcColor.g, srcColor.b, srcColor.a]),\n                GPUBufferUsage.UNIFORM\n              ),\n            },\n          },\n        ],\n      })\n    );\n    renderPass.draw(1);\n    renderPass.end();\n\n    t.device.queue.submit([commandEncoder.finish()]);\n\n    const tolerance = 0.003;\n    const expectedLow = mapColor(expectedColor, v => v - tolerance);\n    const expectedHigh = mapColor(expectedColor, v => v + tolerance);\n\n    t.expectSinglePixelBetweenTwoValuesFloat16In2DTexture(\n      renderTarget,\n      textureFormat,\n      { x: 0, y: 0 },\n      {\n        exp: [\n          // Use Uint16Array to store Float16 value bits\n          new Uint16Array(\n            [expectedLow.r, expectedLow.g, expectedLow.b, expectedLow.a].map(float32ToFloat16Bits)\n          ),\n          new Uint16Array(\n            [expectedHigh.r, expectedHigh.g, expectedHigh.b, expectedHigh.a].map(\n              float32ToFloat16Bits\n            )\n          ),\n        ],\n      }\n    );\n  });\n\ng.test('formats')\n  .desc(\n    `Test blending results works for all formats that support it, and that blending is not applied\n  for formats that do not. Blending should be done in linear space for srgb formats.`\n  )\n  .unimplemented();\n\ng.test('clamp,blend_factor')\n  .desc('For fixed-point formats, test that the blend factor is clamped in the blend equation.')\n  .unimplemented();\n\ng.test('clamp,blend_color')\n  .desc('For fixed-point formats, test that the blend color is clamped in the blend equation.')\n  .unimplemented();\n\ng.test('clamp,blend_result')\n  .desc('For fixed-point formats, test that the blend result is clamped in the blend equation.')\n  .unimplemented();\n"],"file":"blending.spec.js"}