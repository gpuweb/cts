{"version":3,"file":"stencil.spec.js","names":["description","makeTestGroup","assert","kBufferSizeAlignment","kMinDynamicBufferOffsetAlignment","kStencilTextureFormats","isDepthTextureFormat","isStencilTextureFormat","kDepthStencilFormats","depthStencilFormatAspectSize","AllFeaturesMaxLimitsGPUTest","ttu","align","DataArrayGenerator","dataBytesForCopyOrFail","getTextureCopyLayout","TexelView","kBaseColor","Float32Array","kRedStencilColor","kGreenStencilColor","StencilTest","checkStencilOperation","depthStencilFormat","testStencilState","initialStencil","_expectedStencil","depthCompare","kReferenceStencil","baseStencilState","compare","failOp","passOp","stencilState","baseState","format","depthWriteEnabled","stencilFront","stencilBack","testState","testState2","testStates","state","color","stencil","runStencilStateTest","checkStencilCompareFunction","compareFunction","stencilRefValue","expectedColor","isSingleEncoderMultiplePass","renderTargetFormat","renderTarget","createTextureTracked","size","width","height","depthOrArrayLayers","usage","GPUTextureUsage","COPY_SRC","RENDER_ATTACHMENT","depthTexture","sampleCount","mipLevelCount","COPY_DST","hasDepth","depthStencilAttachment","view","createView","depthLoadOp","undefined","depthStoreOp","stencilLoadOp","stencilStoreOp","encoder","device","createCommandEncoder","pass","beginRenderPass","colorAttachments","loadOp","storeOp","end","test","testPipeline","createRenderPipelineForTest","setPipeline","setStencilReference","setBindGroup","createBindGroupForTest","getBindGroupLayout","draw","queue","submit","finish","expColor","R","G","B","A","expTexelView","fromTexelsAsColors","_coords","expectTexelViewComparisonIsOkInTexture","texture","depthStencil","createRenderPipeline","layout","vertex","module","createShaderModule","code","entryPoint","fragment","targets","primitive","topology","data","createBindGroup","entries","binding","resource","buffer","makeBufferWithContents","GPUBufferUsage","UNIFORM","g","desc","params","u","combine","combineWithParams","stencilCompare","_expectedColor","fn","t","skipIfTextureFormatNotSupported","filter","depthFailOp","maskType","stencilReadMask","stencilWriteMask","dataGenerator","beginSubcases","offsetInBlocks","dataPaddingInBytes","copyDepth","mipLevel","aspect","bytesPerBlock","initialDataOffset","copySize","rowsPerImage","bytesPerRow","textureSize","minDataSize","offset","method","initialDataSize","srcTexture","writeSize","initialData","generateView","writeTexture","stencilBitCount","uniformBufferSize","uniformBufferData","Uint32Array","i","uniformBuffer","bindGroupLayout","createBindGroupLayout","visibility","GPUShaderStage","FRAGMENT","type","minBindingSize","hasDynamicOffset","renderPipelineDescriptorBase","createPipelineLayout","bindGroupLayouts","blend","srcFactor","dstFactor","operation","alpha","bindGroup","copyFromOutputTextureLayout","outputTextureSize","mipSize","outputTexture","stencilTextureLayer","baseMipLevel","baseArrayLayer","arrayLayerCount","depthClearValue","renderPass","clearValue","r","b","a","stencilBitIndex","renderPipelineDescriptor","renderPipeline","outputStagingBuffer","createBufferTracked","byteLength","copyTextureToBuffer","y","dataStart","expectGPUBufferValuesEqual","slice"],"sources":["../../../../../src/webgpu/api/operation/rendering/stencil.spec.ts"],"sourcesContent":["export const description = `\nTest related to stencil states, stencil op, compare func, etc.\n`;\n\nimport { makeTestGroup } from '../../../../common/framework/test_group.js';\nimport { assert, TypedArrayBufferView } from '../../../../common/util/util.js';\nimport {\n  kBufferSizeAlignment,\n  kMinDynamicBufferOffsetAlignment,\n} from '../../../capability_info.js';\nimport {\n  kStencilTextureFormats,\n  DepthStencilFormat,\n  isDepthTextureFormat,\n  isStencilTextureFormat,\n  kDepthStencilFormats,\n  depthStencilFormatAspectSize,\n} from '../../../format_info.js';\nimport { AllFeaturesMaxLimitsGPUTest } from '../../../gpu_test.js';\nimport * as ttu from '../../../texture_test_utils.js';\nimport { align } from '../../../util/math.js';\nimport { DataArrayGenerator } from '../../../util/texture/data_generation.js';\nimport { dataBytesForCopyOrFail, getTextureCopyLayout } from '../../../util/texture/layout.js';\nimport { TexelView } from '../../../util/texture/texel_view.js';\n\nconst kBaseColor = new Float32Array([1.0, 1.0, 1.0, 1.0]);\nconst kRedStencilColor = new Float32Array([1.0, 0.0, 0.0, 1.0]);\nconst kGreenStencilColor = new Float32Array([0.0, 1.0, 0.0, 1.0]);\n\ntype TestStates = {\n  state: GPUDepthStencilState;\n  color: Float32Array;\n  stencil: number | undefined;\n};\n\nclass StencilTest extends AllFeaturesMaxLimitsGPUTest {\n  checkStencilOperation(\n    depthStencilFormat: DepthStencilFormat,\n    testStencilState: GPUStencilFaceState,\n    initialStencil: number,\n    _expectedStencil: number,\n    depthCompare: GPUCompareFunction = 'always'\n  ) {\n    const kReferenceStencil = 3;\n\n    const baseStencilState = {\n      compare: 'always',\n      failOp: 'keep',\n      passOp: 'replace',\n    } as const;\n\n    const stencilState = {\n      compare: 'equal',\n      failOp: 'keep',\n      passOp: 'keep',\n    } as const;\n\n    const baseState = {\n      format: depthStencilFormat,\n      depthWriteEnabled: false,\n      depthCompare: 'always',\n      stencilFront: baseStencilState,\n      stencilBack: baseStencilState,\n    } as const;\n\n    const testState = {\n      format: depthStencilFormat,\n      depthWriteEnabled: false,\n      depthCompare,\n      stencilFront: testStencilState,\n      stencilBack: testStencilState,\n    } as const;\n\n    const testState2 = {\n      format: depthStencilFormat,\n      depthWriteEnabled: false,\n      depthCompare: 'always',\n      stencilFront: stencilState,\n      stencilBack: stencilState,\n    } as const;\n\n    const testStates = [\n      // Draw the base triangle with stencil reference 1. This clears the stencil buffer to 1.\n      { state: baseState, color: kBaseColor, stencil: initialStencil },\n      { state: testState, color: kRedStencilColor, stencil: kReferenceStencil },\n      { state: testState2, color: kGreenStencilColor, stencil: _expectedStencil },\n    ];\n    this.runStencilStateTest(depthStencilFormat, testStates, kGreenStencilColor);\n  }\n\n  checkStencilCompareFunction(\n    depthStencilFormat: DepthStencilFormat,\n    compareFunction: GPUCompareFunction,\n    stencilRefValue: number,\n    expectedColor: Float32Array\n  ) {\n    const baseStencilState = {\n      compare: 'always',\n      failOp: 'keep',\n      passOp: 'replace',\n    } as const;\n\n    const stencilState = {\n      compare: compareFunction,\n      failOp: 'keep',\n      passOp: 'keep',\n    } as const;\n\n    const baseState = {\n      format: depthStencilFormat,\n      depthWriteEnabled: false,\n      depthCompare: 'always',\n      stencilFront: baseStencilState,\n      stencilBack: baseStencilState,\n    } as const;\n\n    const testState = {\n      format: depthStencilFormat,\n      depthWriteEnabled: false,\n      depthCompare: 'always',\n      stencilFront: stencilState,\n      stencilBack: stencilState,\n    } as const;\n\n    const testStates = [\n      // Draw the base triangle with stencil reference 1. This clears the stencil buffer to 1.\n      { state: baseState, color: kBaseColor, stencil: 1 },\n      { state: testState, color: kGreenStencilColor, stencil: stencilRefValue },\n    ];\n    this.runStencilStateTest(depthStencilFormat, testStates, expectedColor);\n  }\n\n  runStencilStateTest(\n    depthStencilFormat: DepthStencilFormat,\n    testStates: TestStates[],\n    expectedColor: Float32Array,\n    isSingleEncoderMultiplePass: boolean = false\n  ) {\n    const renderTargetFormat = 'rgba8unorm';\n    const renderTarget = this.createTextureTracked({\n      format: renderTargetFormat,\n      size: { width: 1, height: 1, depthOrArrayLayers: 1 },\n      usage: GPUTextureUsage.COPY_SRC | GPUTextureUsage.RENDER_ATTACHMENT,\n    });\n\n    const depthTexture = this.createTextureTracked({\n      size: { width: 1, height: 1, depthOrArrayLayers: 1 },\n      format: depthStencilFormat,\n      sampleCount: 1,\n      mipLevelCount: 1,\n      usage: GPUTextureUsage.RENDER_ATTACHMENT | GPUTextureUsage.COPY_DST,\n    });\n\n    const hasDepth = isDepthTextureFormat(depthStencilFormat);\n    const depthStencilAttachment: GPURenderPassDepthStencilAttachment = {\n      view: depthTexture.createView(),\n      depthLoadOp: hasDepth ? 'load' : undefined,\n      depthStoreOp: hasDepth ? 'store' : undefined,\n      stencilLoadOp: 'load',\n      stencilStoreOp: 'store',\n    };\n\n    const encoder = this.device.createCommandEncoder();\n    let pass = encoder.beginRenderPass({\n      colorAttachments: [\n        {\n          view: renderTarget.createView(),\n          loadOp: 'load',\n          storeOp: 'store',\n        },\n      ],\n      depthStencilAttachment,\n    });\n\n    if (isSingleEncoderMultiplePass) {\n      pass.end();\n    }\n\n    // Draw a triangle with the given stencil reference and the comparison function.\n    // The color will be kGreenStencilColor if the stencil test passes, and kBaseColor if not.\n    for (const test of testStates) {\n      if (isSingleEncoderMultiplePass) {\n        pass = encoder.beginRenderPass({\n          colorAttachments: [\n            {\n              view: renderTarget.createView(),\n              loadOp: 'load',\n              storeOp: 'store',\n            },\n          ],\n          depthStencilAttachment,\n        });\n      }\n      const testPipeline = this.createRenderPipelineForTest(test.state);\n      pass.setPipeline(testPipeline);\n      if (test.stencil !== undefined) {\n        pass.setStencilReference(test.stencil);\n      }\n      pass.setBindGroup(\n        0,\n        this.createBindGroupForTest(testPipeline.getBindGroupLayout(0), test.color)\n      );\n      pass.draw(1);\n\n      if (isSingleEncoderMultiplePass) {\n        pass.end();\n      }\n    }\n\n    if (!isSingleEncoderMultiplePass) {\n      pass.end();\n    }\n    this.device.queue.submit([encoder.finish()]);\n\n    const expColor = {\n      R: expectedColor[0],\n      G: expectedColor[1],\n      B: expectedColor[2],\n      A: expectedColor[3],\n    };\n    const expTexelView = TexelView.fromTexelsAsColors(renderTargetFormat, _coords => expColor);\n    ttu.expectTexelViewComparisonIsOkInTexture(\n      this,\n      { texture: renderTarget },\n      expTexelView,\n      [1, 1]\n    );\n  }\n\n  createRenderPipelineForTest(depthStencil: GPUDepthStencilState): GPURenderPipeline {\n    return this.device.createRenderPipeline({\n      layout: 'auto',\n      vertex: {\n        module: this.device.createShaderModule({\n          code: `\n            @vertex\n            fn main(@builtin(vertex_index) VertexIndex : u32) -> @builtin(position) vec4<f32> {\n                return vec4<f32>(0.0, 0.0, 0.0, 1.0);\n            }\n            `,\n        }),\n        entryPoint: 'main',\n      },\n      fragment: {\n        targets: [{ format: 'rgba8unorm' }],\n        module: this.device.createShaderModule({\n          code: `\n            struct Params {\n              color : vec4<f32>\n            }\n            @group(0) @binding(0) var<uniform> params : Params;\n\n            @fragment fn main() -> @location(0) vec4<f32> {\n                return vec4<f32>(params.color);\n            }`,\n        }),\n        entryPoint: 'main',\n      },\n      primitive: { topology: 'point-list' },\n      depthStencil,\n    });\n  }\n\n  createBindGroupForTest(layout: GPUBindGroupLayout, data: TypedArrayBufferView): GPUBindGroup {\n    return this.device.createBindGroup({\n      layout,\n      entries: [\n        {\n          binding: 0,\n          resource: {\n            buffer: this.makeBufferWithContents(data, GPUBufferUsage.UNIFORM),\n          },\n        },\n      ],\n    });\n  }\n}\n\nexport const g = makeTestGroup(StencilTest);\n\ng.test('stencil_compare_func')\n  .desc(\n    `\n  Tests that stencil comparison functions with the stencil reference value works as expected.\n  `\n  )\n  .params(u =>\n    u //\n      .combine('format', kStencilTextureFormats)\n      .combineWithParams([\n        { stencilCompare: 'always', stencilRefValue: 0, _expectedColor: kGreenStencilColor },\n        { stencilCompare: 'always', stencilRefValue: 1, _expectedColor: kGreenStencilColor },\n        { stencilCompare: 'always', stencilRefValue: 2, _expectedColor: kGreenStencilColor },\n        { stencilCompare: 'equal', stencilRefValue: 0, _expectedColor: kBaseColor },\n        { stencilCompare: 'equal', stencilRefValue: 1, _expectedColor: kGreenStencilColor },\n        { stencilCompare: 'equal', stencilRefValue: 2, _expectedColor: kBaseColor },\n        { stencilCompare: 'greater', stencilRefValue: 0, _expectedColor: kBaseColor },\n        { stencilCompare: 'greater', stencilRefValue: 1, _expectedColor: kBaseColor },\n        { stencilCompare: 'greater', stencilRefValue: 2, _expectedColor: kGreenStencilColor },\n        { stencilCompare: 'greater-equal', stencilRefValue: 0, _expectedColor: kBaseColor },\n        { stencilCompare: 'greater-equal', stencilRefValue: 1, _expectedColor: kGreenStencilColor },\n        { stencilCompare: 'greater-equal', stencilRefValue: 2, _expectedColor: kGreenStencilColor },\n        { stencilCompare: 'less', stencilRefValue: 0, _expectedColor: kGreenStencilColor },\n        { stencilCompare: 'less', stencilRefValue: 1, _expectedColor: kBaseColor },\n        { stencilCompare: 'less', stencilRefValue: 2, _expectedColor: kBaseColor },\n        { stencilCompare: 'less-equal', stencilRefValue: 0, _expectedColor: kGreenStencilColor },\n        { stencilCompare: 'less-equal', stencilRefValue: 1, _expectedColor: kGreenStencilColor },\n        { stencilCompare: 'less-equal', stencilRefValue: 2, _expectedColor: kBaseColor },\n        { stencilCompare: 'never', stencilRefValue: 0, _expectedColor: kBaseColor },\n        { stencilCompare: 'never', stencilRefValue: 1, _expectedColor: kBaseColor },\n        { stencilCompare: 'never', stencilRefValue: 2, _expectedColor: kBaseColor },\n        { stencilCompare: 'not-equal', stencilRefValue: 0, _expectedColor: kGreenStencilColor },\n        { stencilCompare: 'not-equal', stencilRefValue: 1, _expectedColor: kBaseColor },\n        { stencilCompare: 'not-equal', stencilRefValue: 2, _expectedColor: kGreenStencilColor },\n      ] as const)\n  )\n  .fn(t => {\n    const { format, stencilCompare, stencilRefValue, _expectedColor } = t.params;\n    t.skipIfTextureFormatNotSupported(format);\n\n    t.checkStencilCompareFunction(format, stencilCompare, stencilRefValue, _expectedColor);\n  });\n\ng.test('stencil_passOp_operation')\n  .desc(\n    `\n  Test that the stencil operation is executed on stencil pass. A triangle is drawn with the 'always'\n  comparison function, so it should pass. Then, test that each pass stencil operation works with the\n  given stencil values correctly as expected. For example,\n    - If the pass operation is 'keep', it keeps the initial stencil value.\n    - If the pass operation is 'replace', it replaces the initial stencil value with the reference\n      stencil value.\n  `\n  )\n  .params(u =>\n    u //\n      .combine('format', kStencilTextureFormats)\n      .combineWithParams([\n        { passOp: 'keep', initialStencil: 1, _expectedStencil: 1 },\n        { passOp: 'zero', initialStencil: 1, _expectedStencil: 0 },\n        { passOp: 'replace', initialStencil: 1, _expectedStencil: 3 },\n        { passOp: 'invert', initialStencil: 0xf0, _expectedStencil: 0x0f },\n        { passOp: 'increment-clamp', initialStencil: 1, _expectedStencil: 2 },\n        { passOp: 'increment-clamp', initialStencil: 0xff, _expectedStencil: 0xff },\n        { passOp: 'increment-wrap', initialStencil: 1, _expectedStencil: 2 },\n        { passOp: 'increment-wrap', initialStencil: 0xff, _expectedStencil: 0 },\n        { passOp: 'decrement-clamp', initialStencil: 1, _expectedStencil: 0 },\n        { passOp: 'decrement-clamp', initialStencil: 0, _expectedStencil: 0 },\n        { passOp: 'decrement-wrap', initialStencil: 1, _expectedStencil: 0 },\n        { passOp: 'decrement-wrap', initialStencil: 0, _expectedStencil: 0xff },\n      ] as const)\n  )\n  .fn(t => {\n    const { format, passOp, initialStencil, _expectedStencil } = t.params;\n    t.skipIfTextureFormatNotSupported(format);\n\n    const stencilState = {\n      compare: 'always',\n      failOp: 'keep',\n      passOp,\n    } as const;\n\n    t.checkStencilOperation(format, stencilState, initialStencil, _expectedStencil);\n  });\n\ng.test('stencil_failOp_operation')\n  .desc(\n    `\n  Test that the stencil operation is executed on stencil fail. A triangle is drawn with the 'never'\n  comparison function, so it should fail. Then, test that each fail stencil operation works with the\n  given stencil values correctly as expected. For example,\n    - If the fail operation is 'keep', it keeps the initial stencil value.\n    - If the fail operation is 'replace', it replaces the initial stencil value with the reference\n      stencil value.\n  `\n  )\n  .params(u =>\n    u //\n      .combine('format', kStencilTextureFormats)\n      .combineWithParams([\n        { failOp: 'keep', initialStencil: 1, _expectedStencil: 1 },\n        { failOp: 'zero', initialStencil: 1, _expectedStencil: 0 },\n        { failOp: 'replace', initialStencil: 1, _expectedStencil: 3 },\n        { failOp: 'invert', initialStencil: 0xf0, _expectedStencil: 0x0f },\n        { failOp: 'increment-clamp', initialStencil: 1, _expectedStencil: 2 },\n        { failOp: 'increment-clamp', initialStencil: 0xff, _expectedStencil: 0xff },\n        { failOp: 'increment-wrap', initialStencil: 1, _expectedStencil: 2 },\n        { failOp: 'increment-wrap', initialStencil: 0xff, _expectedStencil: 0 },\n        { failOp: 'decrement-clamp', initialStencil: 1, _expectedStencil: 0 },\n        { failOp: 'decrement-clamp', initialStencil: 0, _expectedStencil: 0 },\n        { failOp: 'decrement-wrap', initialStencil: 2, _expectedStencil: 1 },\n        { failOp: 'decrement-wrap', initialStencil: 1, _expectedStencil: 0 },\n        { failOp: 'decrement-wrap', initialStencil: 0, _expectedStencil: 0xff },\n      ] as const)\n  )\n  .fn(t => {\n    const { format, failOp, initialStencil, _expectedStencil } = t.params;\n    t.skipIfTextureFormatNotSupported(format);\n\n    const stencilState = {\n      compare: 'never',\n      failOp,\n      passOp: 'keep',\n    } as const;\n\n    // Draw the base triangle with stencil reference 1. This clears the stencil buffer to 1.\n    // Always fails because the comparison never passes. Therefore red is never drawn, and the\n    // stencil contents may be updated according to `operation`.\n    t.checkStencilOperation(format, stencilState, initialStencil, _expectedStencil);\n  });\n\ng.test('stencil_depthFailOp_operation')\n  .desc(\n    `\n  Test that the stencil operation is executed on depthCompare fail. A triangle is drawn with the\n  'never' depthCompare, so it should fail the depth test. Then, test that each 'depthFailOp' stencil operation\n  works with the given stencil values correctly as expected. For example,\n    - If the depthFailOp operation is 'keep', it keeps the initial stencil value.\n    - If the depthFailOp operation is 'replace', it replaces the initial stencil value with the\n      reference stencil value.\n  `\n  )\n  .params(u =>\n    u //\n      .combine(\n        'format',\n        kDepthStencilFormats.filter(\n          format => isDepthTextureFormat(format) && isStencilTextureFormat(format)\n        )\n      )\n      .combineWithParams([\n        { depthFailOp: 'keep', initialStencil: 1, _expectedStencil: 1 },\n        { depthFailOp: 'zero', initialStencil: 1, _expectedStencil: 0 },\n        { depthFailOp: 'replace', initialStencil: 1, _expectedStencil: 3 },\n        { depthFailOp: 'invert', initialStencil: 0xf0, _expectedStencil: 0x0f },\n        { depthFailOp: 'increment-clamp', initialStencil: 1, _expectedStencil: 2 },\n        { depthFailOp: 'increment-clamp', initialStencil: 0xff, _expectedStencil: 0xff },\n        { depthFailOp: 'increment-wrap', initialStencil: 1, _expectedStencil: 2 },\n        { depthFailOp: 'increment-wrap', initialStencil: 0xff, _expectedStencil: 0 },\n        { depthFailOp: 'decrement-clamp', initialStencil: 1, _expectedStencil: 0 },\n        { depthFailOp: 'decrement-clamp', initialStencil: 0, _expectedStencil: 0 },\n        { depthFailOp: 'decrement-wrap', initialStencil: 2, _expectedStencil: 1 },\n        { depthFailOp: 'decrement-wrap', initialStencil: 1, _expectedStencil: 0 },\n        { depthFailOp: 'decrement-wrap', initialStencil: 0, _expectedStencil: 0xff },\n      ] as const)\n  )\n  .fn(t => {\n    const { format, depthFailOp, initialStencil, _expectedStencil } = t.params;\n    t.skipIfTextureFormatNotSupported(format);\n\n    const stencilState = {\n      compare: 'always',\n      failOp: 'keep',\n      passOp: 'keep',\n      depthFailOp,\n    } as const;\n\n    // Call checkStencilOperation function with enabling the depthTest to test that the depthFailOp\n    // stencil operation works as expected.\n    t.checkStencilOperation(format, stencilState, initialStencil, _expectedStencil, 'never');\n  });\n\ng.test('stencil_read_write_mask')\n  .desc(\n    `\n  Tests that setting a stencil read/write masks work. Basically, The base triangle sets 3 to the\n  stencil, and then try to draw a triangle with different stencil values.\n    - In case that 'write' mask is 1,\n      * If the stencil of the triangle is 1, it draws because\n        'base stencil(3) & write mask(1) == triangle stencil(1)'.\n      * If the stencil of the triangle is 2, it does not draw because\n        'base stencil(3) & write mask(1) != triangle stencil(2)'.\n\n    - In case that 'read' mask is 2,\n      * If the stencil of the triangle is 1, it does not draw because\n        'base stencil(3) & read mask(2) != triangle stencil(1)'.\n      * If the stencil of the triangle is 2, it draws because\n        'base stencil(3) & read mask(2) == triangle stencil(2)'.\n  `\n  )\n  .params(u =>\n    u //\n      .combine('format', kStencilTextureFormats)\n      .combineWithParams([\n        { maskType: 'write', stencilRefValue: 1, _expectedColor: kRedStencilColor },\n        { maskType: 'write', stencilRefValue: 2, _expectedColor: kBaseColor },\n        { maskType: 'read', stencilRefValue: 1, _expectedColor: kBaseColor },\n        { maskType: 'read', stencilRefValue: 2, _expectedColor: kRedStencilColor },\n      ])\n  )\n  .fn(t => {\n    const { format, maskType, stencilRefValue, _expectedColor } = t.params;\n    t.skipIfTextureFormatNotSupported(format);\n\n    const baseStencilState = {\n      compare: 'always',\n      failOp: 'keep',\n      passOp: 'replace',\n    } as const;\n\n    const stencilState = {\n      compare: 'equal',\n      failOp: 'keep',\n      passOp: 'keep',\n    } as const;\n\n    const baseState = {\n      format,\n      depthWriteEnabled: false,\n      depthCompare: 'always',\n      stencilFront: baseStencilState,\n      stencilBack: baseStencilState,\n      stencilReadMask: 0xff,\n      stencilWriteMask: maskType === 'write' ? 0x1 : 0xff,\n    } as const;\n\n    const testState = {\n      format,\n      depthWriteEnabled: false,\n      depthCompare: 'always',\n      stencilFront: stencilState,\n      stencilBack: stencilState,\n      stencilReadMask: maskType === 'read' ? 0x2 : 0xff,\n      stencilWriteMask: 0xff,\n    } as const;\n\n    const testStates = [\n      // Draw the base triangle with stencil reference 3. This clears the stencil buffer to 3.\n      { state: baseState, color: kBaseColor, stencil: 3 },\n      { state: testState, color: kRedStencilColor, stencil: stencilRefValue },\n    ];\n\n    t.runStencilStateTest(format, testStates, _expectedColor);\n  });\n\ng.test('stencil_reference_initialized')\n  .desc('Test that stencil reference is initialized as zero for new render pass.')\n  .params(u => u.combine('format', kStencilTextureFormats))\n  .fn(t => {\n    const { format } = t.params;\n    t.skipIfTextureFormatNotSupported(format);\n\n    const baseStencilState = {\n      compare: 'always',\n      passOp: 'replace',\n    } as const;\n\n    const testStencilState = {\n      compare: 'equal',\n      passOp: 'keep',\n    } as const;\n\n    const hasDepth = isDepthTextureFormat(format);\n\n    const baseState = {\n      format,\n      depthWriteEnabled: hasDepth,\n      depthCompare: 'always',\n      stencilFront: baseStencilState,\n      stencilBack: baseStencilState,\n    } as const;\n\n    const testState = {\n      format,\n      depthWriteEnabled: hasDepth,\n      depthCompare: 'always',\n      stencilFront: testStencilState,\n      stencilBack: testStencilState,\n    } as const;\n\n    // First pass sets the stencil to 0x1, the second pass sets the stencil to its default\n    // value, and the third pass tests if the stencil is zero.\n    const testStates = [\n      { state: baseState, color: kBaseColor, stencil: 0x1 },\n      { state: baseState, color: kRedStencilColor, stencil: undefined },\n      { state: testState, color: kGreenStencilColor, stencil: 0x0 },\n    ];\n\n    // The third draw should pass the stencil test since the second pass set it to default zero.\n    t.runStencilStateTest(format, testStates, kGreenStencilColor, true);\n  });\n\nconst dataGenerator = new DataArrayGenerator();\ng.test('stencil_accumulation')\n  .desc(\n    `A variation of a technique previously used to verify stencil texture copy that was observed to\n    fail on some Qualcomm chipsets. Attempts to read back from a stencil texture by doing multiple\n    fullscreen renders, one per stencil bit. Each pass sets the stencil mask and stencil reference\n    to 1 << passIndex, and renders 1 << passIndex into the red channel with additive blending. This\n    should duplicate the stencil values into the red channel of the texture, and on most GPUs it\n    works. Technique is replicated here to catch driver bugs, while the original stencil copy test\n    has been updated to verify the stencil values using copyTextureToBuffer, which is more\n    straightforward and allows those tests to focus on the behavior of the APIs in question.\n`\n  )\n  .params(u =>\n    u\n      .combine('format', kDepthStencilFormats)\n      .filter(t => isStencilTextureFormat(t.format))\n      .beginSubcases()\n      .combineWithParams([\n        { offsetInBlocks: 0, dataPaddingInBytes: 0 },\n        { offsetInBlocks: 16, dataPaddingInBytes: 0 },\n        { offsetInBlocks: 768, dataPaddingInBytes: 0 },\n        { offsetInBlocks: 0, dataPaddingInBytes: 1 },\n      ])\n      .combine('copyDepth', [1, 2])\n      .combine('mipLevel', [0, 2])\n  )\n  .fn(t => {\n    const { format, offsetInBlocks, dataPaddingInBytes, copyDepth, mipLevel } = t.params;\n    t.skipIfTextureFormatNotSupported(format);\n    const aspect = 'stencil-only';\n    const bytesPerBlock = depthStencilFormatAspectSize(format, aspect);\n    const initialDataOffset = offsetInBlocks * bytesPerBlock;\n    const copySize = [3, 3, copyDepth] as const;\n    const rowsPerImage = 3;\n    const bytesPerRow = 256;\n\n    const textureSize = [copySize[0] << mipLevel, copySize[1] << mipLevel, copyDepth] as const;\n\n    const minDataSize = dataBytesForCopyOrFail({\n      layout: { offset: initialDataOffset, bytesPerRow, rowsPerImage },\n      format: 'stencil8',\n      copySize,\n      method: 'WriteTexture',\n    });\n    const initialDataSize = minDataSize + dataPaddingInBytes;\n\n    const srcTexture = t.createTextureTracked({\n      size: textureSize,\n      usage:\n        GPUTextureUsage.COPY_DST | GPUTextureUsage.COPY_SRC | GPUTextureUsage.RENDER_ATTACHMENT,\n      format,\n      mipLevelCount: mipLevel + 1,\n    });\n\n    const writeSize = [textureSize[0] >> mipLevel, textureSize[1] >> mipLevel, textureSize[2]];\n    const initialData = dataGenerator.generateView(\n      align(initialDataSize, kBufferSizeAlignment),\n      0,\n      initialDataOffset\n    );\n\n    t.queue.writeTexture(\n      { texture: srcTexture, aspect: 'stencil-only', mipLevel },\n      initialData,\n      {\n        offset: initialDataOffset,\n        bytesPerRow,\n        rowsPerImage,\n      },\n      writeSize\n    );\n\n    // Everything below here was previously checkStencilTextureContent in image_copy.spec.ts\n    const stencilBitCount = 8;\n\n    // Prepare the uniform buffer that stores the bit indices (from 0 to 7) at stride 256 (required\n    // by Dynamic Buffer Offset).\n    const uniformBufferSize = kMinDynamicBufferOffsetAlignment * (stencilBitCount - 1) + 4;\n    const uniformBufferData = new Uint32Array(uniformBufferSize / 4);\n    for (let i = 1; i < stencilBitCount; ++i) {\n      uniformBufferData[(kMinDynamicBufferOffsetAlignment / 4) * i] = i;\n    }\n    const uniformBuffer = t.makeBufferWithContents(\n      uniformBufferData,\n      GPUBufferUsage.COPY_DST | GPUBufferUsage.UNIFORM\n    );\n\n    // Prepare the base render pipeline descriptor (all the settings expect stencilReadMask).\n    const bindGroupLayout = t.device.createBindGroupLayout({\n      entries: [\n        {\n          binding: 0,\n          visibility: GPUShaderStage.FRAGMENT,\n          buffer: {\n            type: 'uniform',\n            minBindingSize: 4,\n            hasDynamicOffset: true,\n          },\n        },\n      ],\n    });\n    const renderPipelineDescriptorBase: GPURenderPipelineDescriptor = {\n      layout: t.device.createPipelineLayout({ bindGroupLayouts: [bindGroupLayout] }),\n      vertex: {\n        module: t.device.createShaderModule({\n          code: `\n            @vertex\n            fn main(@builtin(vertex_index) VertexIndex : u32)-> @builtin(position) vec4<f32> {\n              var pos : array<vec2<f32>, 6> = array<vec2<f32>, 6>(\n                  vec2<f32>(-1.0,  1.0),\n                  vec2<f32>(-1.0, -1.0),\n                  vec2<f32>( 1.0,  1.0),\n                  vec2<f32>(-1.0, -1.0),\n                  vec2<f32>( 1.0,  1.0),\n                  vec2<f32>( 1.0, -1.0));\n              return vec4<f32>(pos[VertexIndex], 0.0, 1.0);\n            }`,\n        }),\n        entryPoint: 'main',\n      },\n\n      fragment: {\n        module: t.device.createShaderModule({\n          code: `\n            struct Params {\n              stencilBitIndex: u32\n            };\n            @group(0) @binding(0) var<uniform> param: Params;\n            @fragment\n            fn main() -> @location(0) vec4<f32> {\n              return vec4<f32>(f32(1u << param.stencilBitIndex) / 255.0, 0.0, 0.0, 0.0);\n            }`,\n        }),\n        entryPoint: 'main',\n        targets: [\n          {\n            // As we implement \"rendering one bit in each draw() call\" with blending operation\n            // 'add', the format of outputTexture must support blending.\n            format: 'r8unorm',\n            blend: {\n              color: { srcFactor: 'one', dstFactor: 'one', operation: 'add' },\n              alpha: {},\n            },\n          },\n        ],\n      },\n\n      primitive: {\n        topology: 'triangle-list',\n      },\n\n      depthStencil: {\n        depthWriteEnabled: false,\n        depthCompare: 'always',\n        format,\n        stencilFront: {\n          compare: 'equal',\n        },\n        stencilBack: {\n          compare: 'equal',\n        },\n      },\n    };\n\n    // Prepare the bindGroup that contains uniformBuffer and referenceTexture.\n    const bindGroup = t.device.createBindGroup({\n      layout: bindGroupLayout,\n      entries: [\n        {\n          binding: 0,\n          resource: {\n            buffer: uniformBuffer,\n            size: 4,\n          },\n        },\n      ],\n    });\n\n    // \"Copy\" the stencil value into the color attachment with 8 draws in one render pass. Each draw\n    // will \"Copy\" one bit of the stencil value into the color attachment. The bit of the stencil\n    // value is specified by setStencilReference().\n    const copyFromOutputTextureLayout = getTextureCopyLayout(\n      format,\n      '2d',\n      [textureSize[0], textureSize[1], 1],\n      {\n        mipLevel,\n        aspect: 'stencil-only',\n      }\n    );\n    const outputTextureSize = [\n      copyFromOutputTextureLayout.mipSize[0],\n      copyFromOutputTextureLayout.mipSize[1],\n      1,\n    ];\n    const outputTexture = t.createTextureTracked({\n      format: 'r8unorm',\n      size: outputTextureSize,\n      usage: GPUTextureUsage.COPY_SRC | GPUTextureUsage.RENDER_ATTACHMENT,\n    });\n\n    for (let stencilTextureLayer = 0; stencilTextureLayer < textureSize[2]; ++stencilTextureLayer) {\n      const encoder = t.device.createCommandEncoder();\n      const depthStencilAttachment: GPURenderPassDepthStencilAttachment = {\n        view: srcTexture.createView({\n          baseMipLevel: mipLevel,\n          mipLevelCount: 1,\n          baseArrayLayer: stencilTextureLayer,\n          arrayLayerCount: 1,\n        }),\n      };\n      if (isDepthTextureFormat(format)) {\n        depthStencilAttachment.depthClearValue = 0;\n        depthStencilAttachment.depthLoadOp = 'clear';\n        depthStencilAttachment.depthStoreOp = 'store';\n      }\n      if (isStencilTextureFormat(format)) {\n        depthStencilAttachment.stencilLoadOp = 'load';\n        depthStencilAttachment.stencilStoreOp = 'store';\n      }\n      const renderPass = encoder.beginRenderPass({\n        colorAttachments: [\n          {\n            view: outputTexture.createView(),\n            clearValue: { r: 0.0, g: 0.0, b: 0.0, a: 0.0 },\n            loadOp: 'clear',\n            storeOp: 'store',\n          },\n        ],\n        depthStencilAttachment,\n      });\n\n      for (let stencilBitIndex = 0; stencilBitIndex < stencilBitCount; ++stencilBitIndex) {\n        const renderPipelineDescriptor = renderPipelineDescriptorBase;\n        assert(renderPipelineDescriptor.depthStencil !== undefined);\n        renderPipelineDescriptor.depthStencil.stencilReadMask = 1 << stencilBitIndex;\n        const renderPipeline = t.device.createRenderPipeline(renderPipelineDescriptor);\n\n        renderPass.setPipeline(renderPipeline);\n        renderPass.setStencilReference(1 << stencilBitIndex);\n        renderPass.setBindGroup(0, bindGroup, [stencilBitIndex * kMinDynamicBufferOffsetAlignment]);\n        renderPass.draw(6);\n      }\n      renderPass.end();\n\n      // Check outputTexture by copying the content of outputTexture into outputStagingBuffer and\n      // checking all the data in outputStagingBuffer.\n      const outputStagingBuffer = t.createBufferTracked({\n        size: copyFromOutputTextureLayout.byteLength,\n        usage: GPUBufferUsage.COPY_SRC | GPUBufferUsage.COPY_DST,\n      });\n      encoder.copyTextureToBuffer(\n        {\n          texture: outputTexture,\n        },\n        {\n          buffer: outputStagingBuffer,\n          bytesPerRow: copyFromOutputTextureLayout.bytesPerRow,\n          rowsPerImage: copyFromOutputTextureLayout.rowsPerImage,\n        },\n        outputTextureSize\n      );\n\n      t.queue.submit([encoder.finish()]);\n\n      // Check the valid data in outputStagingBuffer once per row.\n      for (let y = 0; y < copyFromOutputTextureLayout.mipSize[1]; ++y) {\n        const dataStart =\n          initialDataOffset + bytesPerRow * rowsPerImage * stencilTextureLayer + bytesPerRow * y;\n        t.expectGPUBufferValuesEqual(\n          outputStagingBuffer,\n          initialData.slice(dataStart, dataStart + copyFromOutputTextureLayout.mipSize[0]),\n          copyFromOutputTextureLayout.bytesPerRow * y\n        );\n      }\n    }\n  });\n"],"mappings":"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"}