{"version":3,"sources":["../../../../../src/webgpu/api/operation/rendering/depth.spec.ts"],"names":["description","makeTestGroup","kDepthStencilFormats","kTextureFormatInfo","GPUTest","backgroundColor","triangleColor","g","test","desc","unimplemented","params","u","combine","filter","format","depth","combineWithParams","depthCompare","depthClearValue","_expected","fn","t","selectDeviceForTextureFormatOrSkipTestCase","colorAttachmentFormat","colorAttachment","device","createTexture","size","width","height","depthOrArrayLayers","usage","GPUTextureUsage","COPY_SRC","RENDER_ATTACHMENT","colorAttachmentView","createView","depthTexture","TEXTURE_BINDING","depthTextureView","pipelineDescriptor","vertex","module","createShaderModule","code","entryPoint","fragment","targets","primitive","topology","depthStencil","depthWriteEnabled","pipeline","createRenderPipeline","encoder","createCommandEncoder","depthStencilAttachment","view","depthLoadOp","depthStoreOp","stencil","stencilClearValue","stencilLoadOp","stencilStoreOp","pass","beginRenderPass","colorAttachments","storeOp","clearValue","r","b","a","loadOp","setPipeline","draw","end","queue","submit","finish","expectSinglePixelIn2DTexture","x","y","exp","Uint8Array","depthBufferFormat","reversed"],"mappings":"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","sourcesContent":["export const description = `\nTest related to depth buffer, depth op, compare func, etc.\n`;\n\nimport { makeTestGroup } from '../../../../common/framework/test_group.js';\nimport { kDepthStencilFormats, kTextureFormatInfo } from '../../../capability_info.js';\nimport { GPUTest } from '../../../gpu_test.js';\n\nconst backgroundColor = [0x00, 0x00, 0x00, 0xff];\nconst triangleColor = [0xff, 0xff, 0xff, 0xff];\n\nexport const g = makeTestGroup(GPUTest);\n\ng.test('depth_bias')\n  .desc(\n    `Tests render results with different depth bias values: positive, negative, infinity, slope, clamp, etc.`\n  )\n  .unimplemented();\n\ng.test('depth_disabled').desc(`Tests render results with depth test disabled`).unimplemented();\n\ng.test('depth_write_disabled')\n  .desc(`Tests render results with depth write disabled`)\n  .unimplemented();\n\ng.test('depth_compare_func')\n  .desc(\n    `Tests each depth compare function works properly. Clears the depth attachment to various values, and renders a point at depth 0.5 with various depthCompare modes.`\n  )\n  .params(u =>\n    u\n      .combine(\n        'format',\n        kDepthStencilFormats.filter(format => kTextureFormatInfo[format].depth)\n      )\n      .combineWithParams([\n        { depthCompare: 'never', depthClearValue: 1.0, _expected: backgroundColor },\n        { depthCompare: 'never', depthClearValue: 0.5, _expected: backgroundColor },\n        { depthCompare: 'never', depthClearValue: 0.0, _expected: backgroundColor },\n        { depthCompare: 'less', depthClearValue: 1.0, _expected: triangleColor },\n        { depthCompare: 'less', depthClearValue: 0.5, _expected: backgroundColor },\n        { depthCompare: 'less', depthClearValue: 0.0, _expected: backgroundColor },\n        { depthCompare: 'less-equal', depthClearValue: 1.0, _expected: triangleColor },\n        { depthCompare: 'less-equal', depthClearValue: 0.5, _expected: triangleColor },\n        { depthCompare: 'less-equal', depthClearValue: 0.0, _expected: backgroundColor },\n        { depthCompare: 'equal', depthClearValue: 1.0, _expected: backgroundColor },\n        { depthCompare: 'equal', depthClearValue: 0.5, _expected: triangleColor },\n        { depthCompare: 'equal', depthClearValue: 0.0, _expected: backgroundColor },\n        { depthCompare: 'not-equal', depthClearValue: 1.0, _expected: triangleColor },\n        { depthCompare: 'not-equal', depthClearValue: 0.5, _expected: backgroundColor },\n        { depthCompare: 'not-equal', depthClearValue: 0.0, _expected: triangleColor },\n        { depthCompare: 'greater-equal', depthClearValue: 1.0, _expected: backgroundColor },\n        { depthCompare: 'greater-equal', depthClearValue: 0.5, _expected: triangleColor },\n        { depthCompare: 'greater-equal', depthClearValue: 0.0, _expected: triangleColor },\n        { depthCompare: 'greater', depthClearValue: 1.0, _expected: backgroundColor },\n        { depthCompare: 'greater', depthClearValue: 0.5, _expected: backgroundColor },\n        { depthCompare: 'greater', depthClearValue: 0.0, _expected: triangleColor },\n        { depthCompare: 'always', depthClearValue: 1.0, _expected: triangleColor },\n        { depthCompare: 'always', depthClearValue: 0.5, _expected: triangleColor },\n        { depthCompare: 'always', depthClearValue: 0.0, _expected: triangleColor },\n      ] as const)\n  )\n  .fn(async t => {\n    const { depthCompare, depthClearValue, _expected, format } = t.params;\n    await t.selectDeviceForTextureFormatOrSkipTestCase(format);\n\n    const colorAttachmentFormat = 'rgba8unorm';\n    const colorAttachment = t.device.createTexture({\n      format: colorAttachmentFormat,\n      size: { width: 1, height: 1, depthOrArrayLayers: 1 },\n      usage: GPUTextureUsage.COPY_SRC | GPUTextureUsage.RENDER_ATTACHMENT,\n    });\n    const colorAttachmentView = colorAttachment.createView();\n\n    const depthTexture = t.device.createTexture({\n      size: { width: 1, height: 1 },\n      format,\n      usage: GPUTextureUsage.RENDER_ATTACHMENT | GPUTextureUsage.TEXTURE_BINDING,\n    });\n    const depthTextureView = depthTexture.createView();\n\n    const pipelineDescriptor: GPURenderPipelineDescriptor = {\n      vertex: {\n        module: t.device.createShaderModule({\n          code: `\n            @stage(vertex) fn main(\n              @builtin(vertex_index) VertexIndex : u32) -> @builtin(position) vec4<f32> {\n              return vec4<f32>(0.5, 0.5, 0.5, 1.0);\n            }\n            `,\n        }),\n        entryPoint: 'main',\n      },\n      fragment: {\n        module: t.device.createShaderModule({\n          code: `\n            @stage(fragment) fn main() -> @location(0) vec4<f32> {\n              return vec4<f32>(1.0, 1.0, 1.0, 1.0);\n            }\n            `,\n        }),\n        entryPoint: 'main',\n        targets: [{ format: colorAttachmentFormat }],\n      },\n      primitive: { topology: 'point-list' },\n      depthStencil: {\n        depthWriteEnabled: true,\n        depthCompare,\n        format,\n      },\n    };\n    const pipeline = t.device.createRenderPipeline(pipelineDescriptor);\n\n    const encoder = t.device.createCommandEncoder();\n    const depthStencilAttachment: GPURenderPassDepthStencilAttachment = {\n      view: depthTextureView,\n      depthClearValue,\n      depthLoadOp: 'clear',\n      depthStoreOp: 'store',\n    };\n    if (kTextureFormatInfo[format].stencil) {\n      depthStencilAttachment.stencilClearValue = 0;\n      depthStencilAttachment.stencilLoadOp = 'clear';\n      depthStencilAttachment.stencilStoreOp = 'store';\n    }\n    const pass = encoder.beginRenderPass({\n      colorAttachments: [\n        {\n          view: colorAttachmentView,\n          storeOp: 'store',\n          clearValue: { r: 0.0, g: 0.0, b: 0.0, a: 1.0 },\n          loadOp: 'clear',\n        },\n      ],\n      depthStencilAttachment,\n    });\n    pass.setPipeline(pipeline);\n    pass.draw(1);\n    pass.end();\n    t.device.queue.submit([encoder.finish()]);\n\n    t.expectSinglePixelIn2DTexture(\n      colorAttachment,\n      colorAttachmentFormat,\n      { x: 0, y: 0 },\n      { exp: new Uint8Array(_expected) }\n    );\n  });\n\ng.test('reverse_depth')\n  .desc(\n    `Tests simple rendering with reversed depth buffer, ensures depth test works properly: fragments are in correct order and out of range fragments are clipped.\n    Note that in real use case the depth range remapping is done by the modified projection matrix.\n(see https://developer.nvidia.com/content/depth-precision-visualized).`\n  )\n  .params(u => u.combine('reversed', [false, true]))\n  .fn(async t => {\n    const colorAttachmentFormat = 'rgba8unorm';\n    const colorAttachment = t.device.createTexture({\n      format: colorAttachmentFormat,\n      size: { width: 1, height: 1, depthOrArrayLayers: 1 },\n      usage: GPUTextureUsage.COPY_SRC | GPUTextureUsage.RENDER_ATTACHMENT,\n    });\n    const colorAttachmentView = colorAttachment.createView();\n\n    const depthBufferFormat = 'depth32float';\n    const depthTexture = t.device.createTexture({\n      size: { width: 1, height: 1 },\n      format: depthBufferFormat,\n      usage: GPUTextureUsage.RENDER_ATTACHMENT | GPUTextureUsage.TEXTURE_BINDING,\n    });\n    const depthTextureView = depthTexture.createView();\n\n    const pipelineDescriptor: GPURenderPipelineDescriptor = {\n      vertex: {\n        module: t.device.createShaderModule({\n          code: `\n            struct Output {\n              @builtin(position) Position : vec4<f32>,\n              @location(0) color : vec4<f32>,\n            };\n\n            @stage(vertex) fn main(\n              @builtin(vertex_index) VertexIndex : u32,\n              @builtin(instance_index) InstanceIndex : u32) -> Output {\n              // TODO: remove workaround for Tint unary array access broke\n              var zv : array<vec2<f32>, 4> = array<vec2<f32>, 4>(\n                  vec2<f32>(0.2, 0.2),\n                  vec2<f32>(0.3, 0.3),\n                  vec2<f32>(-0.1, -0.1),\n                  vec2<f32>(1.1, 1.1));\n              let z : f32 = zv[InstanceIndex].x;\n\n              var output : Output;\n              output.Position = vec4<f32>(0.5, 0.5, z, 1.0);\n              var colors : array<vec4<f32>, 4> = array<vec4<f32>, 4>(\n                  vec4<f32>(1.0, 0.0, 0.0, 1.0),\n                  vec4<f32>(0.0, 1.0, 0.0, 1.0),\n                  vec4<f32>(0.0, 0.0, 1.0, 1.0),\n                  vec4<f32>(1.0, 1.0, 1.0, 1.0)\n              );\n              output.color = colors[InstanceIndex];\n              return output;\n            }\n            `,\n        }),\n        entryPoint: 'main',\n      },\n      fragment: {\n        module: t.device.createShaderModule({\n          code: `\n            @stage(fragment) fn main(\n              @location(0) color : vec4<f32>\n              ) -> @location(0) vec4<f32> {\n              return color;\n            }\n            `,\n        }),\n        entryPoint: 'main',\n        targets: [{ format: colorAttachmentFormat }],\n      },\n      primitive: { topology: 'point-list' },\n      depthStencil: {\n        depthWriteEnabled: true,\n        depthCompare: t.params.reversed ? 'greater' : 'less',\n        format: depthBufferFormat,\n      },\n    };\n    const pipeline = t.device.createRenderPipeline(pipelineDescriptor);\n\n    const encoder = t.device.createCommandEncoder();\n    const pass = encoder.beginRenderPass({\n      colorAttachments: [\n        {\n          view: colorAttachmentView,\n          storeOp: 'store',\n          clearValue: { r: 0.5, g: 0.5, b: 0.5, a: 1.0 },\n          loadOp: 'clear',\n        },\n      ],\n      depthStencilAttachment: {\n        view: depthTextureView,\n\n        depthClearValue: t.params.reversed ? 0.0 : 1.0,\n        depthLoadOp: 'clear',\n        depthStoreOp: 'store',\n      },\n    });\n    pass.setPipeline(pipeline);\n    pass.draw(1, 4);\n    pass.end();\n    t.device.queue.submit([encoder.finish()]);\n\n    t.expectSinglePixelIn2DTexture(\n      colorAttachment,\n      colorAttachmentFormat,\n      { x: 0, y: 0 },\n      {\n        exp: new Uint8Array(\n          t.params.reversed ? [0x00, 0xff, 0x00, 0xff] : [0xff, 0x00, 0x00, 0xff]\n        ),\n      }\n    );\n  });\n"],"file":"depth.spec.js"}