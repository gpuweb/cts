{"version":3,"sources":["../../../../../../src/webgpu/api/operation/resource_init/check_texture/by_copy.ts"],"names":["assert","kTextureFormatInfo","virtualMipSize","checkContentsByBufferCopy","t","params","texture","state","subresourceRange","level","mipLevel","layer","each","format","expectSingleColor","size","textureWidth","textureHeight","textureDepth","dimension","slice","layout","aspect","exp","stateToTexelComponents","checkContentsByTextureCopy","width","height","depth","dst","device","createTexture","usage","GPUTextureUsage","COPY_DST","COPY_SRC","trackForCleanup","commandEncoder","createCommandEncoder","copyTextureToTexture","origin","x","y","z","depthOrArrayLayers","queue","submit","finish"],"mappings":"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","sourcesContent":["import { assert } from '../../../../../common/util/util.js';\nimport { EncodableTextureFormat, kTextureFormatInfo } from '../../../../capability_info.js';\nimport { virtualMipSize } from '../../../../util/texture/base.js';\nimport { CheckContents } from '../texture_zero.spec.js';\n\nexport const checkContentsByBufferCopy: CheckContents = (\n  t,\n  params,\n  texture,\n  state,\n  subresourceRange\n) => {\n  for (const { level: mipLevel, layer } of subresourceRange.each()) {\n    assert(params.format in kTextureFormatInfo);\n    const format = params.format as EncodableTextureFormat;\n\n    t.expectSingleColor(texture, format, {\n      size: [t.textureWidth, t.textureHeight, t.textureDepth],\n      dimension: params.dimension,\n      slice: layer,\n      layout: { mipLevel, aspect: params.aspect },\n      exp: t.stateToTexelComponents[state],\n    });\n  }\n};\n\nexport const checkContentsByTextureCopy: CheckContents = (\n  t,\n  params,\n  texture,\n  state,\n  subresourceRange\n) => {\n  for (const { level, layer } of subresourceRange.each()) {\n    assert(params.format in kTextureFormatInfo);\n    const format = params.format as EncodableTextureFormat;\n\n    const [width, height, depth] = virtualMipSize(\n      params.dimension,\n      [t.textureWidth, t.textureHeight, t.textureDepth],\n      level\n    );\n\n    const dst = t.device.createTexture({\n      dimension: params.dimension,\n      size: [width, height, depth],\n      format: params.format,\n      usage: GPUTextureUsage.COPY_DST | GPUTextureUsage.COPY_SRC,\n    });\n    t.trackForCleanup(dst);\n\n    const commandEncoder = t.device.createCommandEncoder();\n    commandEncoder.copyTextureToTexture(\n      { texture, mipLevel: level, origin: { x: 0, y: 0, z: layer } },\n      { texture: dst, mipLevel: 0 },\n      { width, height, depthOrArrayLayers: depth }\n    );\n    t.queue.submit([commandEncoder.finish()]);\n\n    t.expectSingleColor(dst, format, {\n      size: [width, height, depth],\n      exp: t.stateToTexelComponents[state],\n      layout: { mipLevel: 0, aspect: params.aspect },\n    });\n  }\n};\n"],"file":"by_copy.js"}