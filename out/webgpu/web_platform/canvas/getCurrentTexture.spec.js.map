{"version":3,"file":"getCurrentTexture.spec.js","names":["description","SkipTestCase","makeTestGroup","timeout","assert","unreachable","AllFeaturesMaxLimitsGPUTest","kAllCanvasTypes","createCanvas","kFormat","expectSingleColorInCanvas","t","canvas","expectedColor","tolerance","width","height","copy","OffscreenCanvas","copyCtx","getContext","drawImage","imageData","getImageData","i","data","length","forEach","expected","ch","actual","diff","Math","abs","expect","GPUContextTest","initCanvasContext","canvasType","usage","onscreencanvas","style","position","top","left","opacity","document","body","appendChild","trackForCleanup","close","removeChild","ctx","GPUCanvasContext","configure","device","format","GPUTextureUsage","RENDER_ATTACHMENT","COPY_SRC","expectTextureDestroyed","texture","expectDestroyed","expectValidationError","encoder","createCommandEncoder","pass","beginRenderPass","colorAttachments","view","createView","loadOp","storeOp","end","queue","submit","finish","g","test","desc","params","u","combine","fn","shouldThrow","getCurrentTexture","prevTexture","currentTexture","unconfigure","frameTexture","clearValue","expectSingleColor","size","exp","R","G","B","A","destroy","beginSubcases","beforeAllSubcases","skipIf","prototype","clearTexture","Promise","resolve","frameCount","frameCheck","requestAnimationFrame","transferToImageBitmap","prevFrameCallsite","getCurrentTextureAgain","bgl","createBindGroupLayout","entries","binding","visibility","GPUShaderStage","COMPUTE","runInNewCanvasFrame","checkGetCurrentTexture","queueMicrotask","prevTextureView","createBindGroup","layout","resource","isCompatibility","undefined","textureBindingViewDimension","withView","asResolveTarget","srcTexture","createTextureTracked","sampleCount","resolveTarget","TEXTURE_BINDING","module","createShaderModule","code","pipeline","createRenderPipeline","vertex","fragment","targets","bindGroup","getBindGroupLayout","dstTexture","setPipeline","setBindGroup","draw"],"sources":["../../../../src/webgpu/web_platform/canvas/getCurrentTexture.spec.ts"],"sourcesContent":["export const description = `\nTests for GPUCanvasContext.getCurrentTexture.\n`;\n\nimport { SkipTestCase } from '../../../common/framework/fixture.js';\nimport { makeTestGroup } from '../../../common/framework/test_group.js';\nimport { timeout } from '../../../common/util/timeout.js';\nimport { assert, unreachable } from '../../../common/util/util.js';\nimport { AllFeaturesMaxLimitsGPUTest, GPUTest } from '../../gpu_test.js';\nimport { kAllCanvasTypes, createCanvas, CanvasType } from '../../util/create_elements.js';\n\nconst kFormat = 'bgra8unorm';\n\nfunction expectSingleColorInCanvas(\n  t: GPUTest,\n  canvas: HTMLCanvasElement | OffscreenCanvas,\n  expectedColor: number[],\n  tolerance = 0.01\n) {\n  const { width, height } = canvas;\n  const copy = new OffscreenCanvas(width, height);\n  const copyCtx = copy.getContext('2d')!;\n  copyCtx.drawImage(canvas, 0, 0);\n  const imageData = copyCtx.getImageData(0, 0, width, height);\n  for (let i = 0; i < imageData.data.length; i += 4) {\n    expectedColor.forEach((expected, ch) => {\n      const actual = imageData.data[i + ch] / 255;\n      const diff = Math.abs(actual - expected);\n      t.expect(\n        diff < tolerance,\n        () =>\n          `at ${i % width}x${\n            i / width\n          }, channel: ${ch}, expected: ${expected}, actual: ${actual}, <  ${tolerance}`\n      );\n    });\n  }\n}\n\nclass GPUContextTest extends AllFeaturesMaxLimitsGPUTest {\n  initCanvasContext(\n    canvasType: CanvasType = 'onscreen',\n    usage: GPUTextureUsageFlags = 0\n  ): GPUCanvasContext {\n    const canvas = createCanvas(this, canvasType, 2, 2);\n    if (canvasType === 'onscreen') {\n      // To make sure onscreen canvas are visible\n      const onscreencanvas = canvas as HTMLCanvasElement;\n      onscreencanvas.style.position = 'fixed';\n      onscreencanvas.style.top = '0';\n      onscreencanvas.style.left = '0';\n      // Set it to transparent so that if multiple canvas are created, they are still visible.\n      onscreencanvas.style.opacity = '50%';\n      document.body.appendChild(onscreencanvas);\n      this.trackForCleanup({\n        close() {\n          document.body.removeChild(onscreencanvas);\n        },\n      });\n    }\n    const ctx = canvas.getContext('webgpu');\n    assert(ctx instanceof GPUCanvasContext, 'Failed to get WebGPU context from canvas');\n\n    ctx.configure({\n      device: this.device,\n      format: kFormat,\n      usage: GPUTextureUsage.RENDER_ATTACHMENT | GPUTextureUsage.COPY_SRC | usage,\n    });\n\n    return ctx;\n  }\n\n  expectTextureDestroyed(texture: GPUTexture, expectDestroyed = true) {\n    this.expectValidationError(() => {\n      // Try using the texture in a render pass. Because it's a canvas texture\n      // it should have RENDER_ATTACHMENT usage.\n      assert((texture.usage & GPUTextureUsage.RENDER_ATTACHMENT) !== 0);\n      const encoder = this.device.createCommandEncoder();\n      const pass = encoder.beginRenderPass({\n        colorAttachments: [\n          {\n            view: texture.createView(),\n            loadOp: 'clear',\n            storeOp: 'store',\n          },\n        ],\n      });\n      pass.end();\n      // Submitting should generate a validation error if the texture is destroyed.\n      this.queue.submit([encoder.finish()]);\n    }, expectDestroyed);\n  }\n}\n\nexport const g = makeTestGroup(GPUContextTest);\n\ng.test('configured')\n  .desc(\n    `Checks that calling getCurrentTexture requires the context to be configured first, and\n  that each call to configure causes getCurrentTexture to return a new texture.`\n  )\n  .params(u =>\n    u //\n      .combine('canvasType', kAllCanvasTypes)\n  )\n  .fn(t => {\n    const canvas = createCanvas(t, t.params.canvasType, 2, 2);\n    const ctx = canvas.getContext('webgpu');\n    assert(ctx instanceof GPUCanvasContext, 'Failed to get WebGPU context from canvas');\n\n    // Calling getCurrentTexture prior to configuration should throw an InvalidStateError exception.\n    t.shouldThrow('InvalidStateError', () => {\n      ctx.getCurrentTexture();\n    });\n\n    // Once the context has been configured getCurrentTexture can be called.\n    ctx.configure({\n      device: t.device,\n      format: kFormat,\n    });\n\n    let prevTexture = ctx.getCurrentTexture();\n\n    // Calling configure again with different values will change the texture returned.\n    ctx.configure({\n      device: t.device,\n      format: 'bgra8unorm',\n    });\n\n    let currentTexture = ctx.getCurrentTexture();\n    t.expect(prevTexture !== currentTexture);\n    prevTexture = currentTexture;\n\n    // Calling configure again with the same values will still change the texture returned.\n    ctx.configure({\n      device: t.device,\n      format: 'bgra8unorm',\n    });\n\n    currentTexture = ctx.getCurrentTexture();\n    t.expect(prevTexture !== currentTexture);\n    prevTexture = currentTexture;\n\n    // Calling getCurrentTexture after calling unconfigure should throw an InvalidStateError exception.\n    ctx.unconfigure();\n\n    t.shouldThrow('InvalidStateError', () => {\n      ctx.getCurrentTexture();\n    });\n  });\n\ng.test('single_frames')\n  .desc(`Checks that the value of getCurrentTexture is consistent within a single frame.`)\n  .params(u =>\n    u //\n      .combine('canvasType', kAllCanvasTypes)\n  )\n  .fn(t => {\n    const ctx = t.initCanvasContext(t.params.canvasType);\n    const frameTexture = ctx.getCurrentTexture();\n\n    // Calling getCurrentTexture a second time returns the same texture.\n    t.expect(frameTexture === ctx.getCurrentTexture());\n\n    const encoder = t.device.createCommandEncoder();\n    const pass = encoder.beginRenderPass({\n      colorAttachments: [\n        {\n          view: frameTexture.createView(),\n          clearValue: [1.0, 0.0, 0.0, 1.0],\n          loadOp: 'clear',\n          storeOp: 'store',\n        },\n      ],\n    });\n    pass.end();\n    t.device.queue.submit([encoder.finish()]);\n\n    // Calling getCurrentTexture after performing some work on the texture returns the same texture.\n    t.expect(frameTexture === ctx.getCurrentTexture());\n\n    // Ensure that getCurrentTexture does not clear the texture.\n    t.expectSingleColor(frameTexture, frameTexture.format, {\n      size: [frameTexture.width, frameTexture.height, 1],\n      exp: { R: 1, G: 0, B: 0, A: 1 },\n    });\n\n    frameTexture.destroy();\n\n    // Calling getCurrentTexture after destroying the texture still returns the same texture.\n    t.expect(frameTexture === ctx.getCurrentTexture());\n  });\n\ng.test('multiple_frames')\n  .desc(`Checks that the value of getCurrentTexture differs across multiple frames.`)\n  .params(u =>\n    u //\n      .combine('canvasType', kAllCanvasTypes)\n      .beginSubcases()\n      .combine('clearTexture', [true, false])\n  )\n  .beforeAllSubcases(t => {\n    const { canvasType } = t.params;\n    t.skipIf(\n      canvasType === 'offscreen' && typeof OffscreenCanvas === 'undefined',\n      'OffscreenCanvas does not exist in this environment'\n    );\n    t.skipIf(\n      canvasType === 'offscreen' && !('transferToImageBitmap' in OffscreenCanvas.prototype),\n      'transferToImageBitmap not supported'\n    );\n  })\n  .fn(t => {\n    const { canvasType, clearTexture } = t.params;\n\n    return new Promise(resolve => {\n      const ctx = t.initCanvasContext(canvasType);\n      let prevTexture: GPUTexture | undefined;\n      let frameCount = 0;\n\n      function frameCheck() {\n        const currentTexture = ctx.getCurrentTexture();\n\n        if (prevTexture) {\n          // Ensure that each frame a new texture object is returned.\n          t.expect(currentTexture !== prevTexture);\n\n          // Ensure that the texture's initial contents are transparent black.\n          t.expectSingleColor(currentTexture, currentTexture.format, {\n            size: [currentTexture.width, currentTexture.height, 1],\n            exp: { R: 0, G: 0, B: 0, A: 0 },\n          });\n        }\n\n        if (clearTexture) {\n          // Fill the texture with a non-zero color, to test that texture\n          // contents don't carry over from frame to frame.\n          const encoder = t.device.createCommandEncoder();\n          const pass = encoder.beginRenderPass({\n            colorAttachments: [\n              {\n                view: currentTexture.createView(),\n                clearValue: [1.0, 0.0, 0.0, 1.0],\n                loadOp: 'clear',\n                storeOp: 'store',\n              },\n            ],\n          });\n          pass.end();\n          t.device.queue.submit([encoder.finish()]);\n        }\n\n        prevTexture = currentTexture;\n\n        if (frameCount++ < 5) {\n          // Which method will be used to begin a new \"frame\"?\n          switch (canvasType) {\n            case 'onscreen':\n              requestAnimationFrame(frameCheck);\n              break;\n            case 'offscreen': {\n              (ctx.canvas as OffscreenCanvas).transferToImageBitmap();\n              frameCheck();\n              break;\n            }\n            default:\n              unreachable();\n          }\n        } else {\n          resolve();\n        }\n      }\n\n      // Render the first frame immediately. The rest will be triggered recursively.\n      frameCheck();\n    });\n  });\n\ng.test('resize')\n  .desc(`Checks the value of getCurrentTexture differs when the canvas is resized.`)\n  .params(u =>\n    u //\n      .combine('canvasType', kAllCanvasTypes)\n  )\n  .fn(t => {\n    const ctx = t.initCanvasContext(t.params.canvasType);\n    let prevTexture = ctx.getCurrentTexture();\n\n    // Trigger a resize by changing the width.\n    ctx.canvas.width = 4;\n\n    t.expectTextureDestroyed(prevTexture);\n\n    // When the canvas resizes the texture returned by getCurrentTexture should immediately begin\n    // returning a new texture matching the update dimensions.\n    let currentTexture = ctx.getCurrentTexture();\n    t.expect(prevTexture !== currentTexture);\n    t.expect(currentTexture.width === ctx.canvas.width);\n    t.expect(currentTexture.height === ctx.canvas.height);\n\n    // The width and height of the previous texture should remain unchanged.\n    t.expect(prevTexture.width === 2);\n    t.expect(prevTexture.height === 2);\n    prevTexture = currentTexture;\n\n    // Ensure that texture contents are transparent black.\n    t.expectSingleColor(currentTexture, currentTexture.format, {\n      size: [currentTexture.width, currentTexture.height, 1],\n      exp: { R: 0, G: 0, B: 0, A: 0 },\n    });\n\n    // Trigger a resize by changing the height.\n    ctx.canvas.height = 4;\n\n    // Check to ensure the texture is resized again.\n    currentTexture = ctx.getCurrentTexture();\n    t.expect(prevTexture !== currentTexture);\n    t.expect(currentTexture.width === ctx.canvas.width);\n    t.expect(currentTexture.height === ctx.canvas.height);\n    t.expect(prevTexture.width === 4);\n    t.expect(prevTexture.height === 2);\n\n    // Ensure that texture contents are transparent black.\n    t.expectSingleColor(currentTexture, currentTexture.format, {\n      size: [currentTexture.width, currentTexture.height, 1],\n      exp: { R: 0, G: 0, B: 0, A: 0 },\n    });\n\n    // HTMLCanvasElement behaves differently than OffscreenCanvas\n    if (t.params.canvasType === 'onscreen') {\n      // Ensure canvas goes back to defaults when set to negative numbers.\n      ctx.canvas.width = -1;\n      currentTexture = ctx.getCurrentTexture();\n      t.expect(currentTexture.width === 300);\n      t.expect(currentTexture.height === 4);\n\n      ctx.canvas.height = -1;\n      currentTexture = ctx.getCurrentTexture();\n      t.expect(currentTexture.width === 300);\n      t.expect(currentTexture.height === 150);\n\n      // Setting the canvas width and height values to their current values should\n      // still trigger a change in the texture.\n      prevTexture = ctx.getCurrentTexture();\n      const { width, height } = ctx.canvas;\n      ctx.canvas.width = width;\n      ctx.canvas.height = height;\n\n      t.expectTextureDestroyed(prevTexture);\n\n      currentTexture = ctx.getCurrentTexture();\n      t.expect(prevTexture !== currentTexture);\n    }\n  });\n\ng.test('expiry')\n  .desc(\n    `\nTest automatic WebGPU canvas texture expiry on all canvas types with the following requirements:\n- getCurrentTexture returns the same texture object until the next task:\n  - after previous frame update the rendering\n  - before current frame update the rendering\n  - in a microtask off the current frame task\n- getCurrentTexture returns a new texture object and the old texture object becomes invalid\n  as soon as possible after HTML update the rendering.\n\nTODO: test more canvas types, and ways to update the rendering\n- if on a different thread, expiry happens when the worker updates its rendering (worker \"rPAF\") OR transferToImageBitmap is called\n- [draw, transferControlToOffscreen, then canvas is displayed] on either {main thread, or transferred to worker}\n- [draw, canvas is displayed, then transferControlToOffscreen] on either {main thread, or transferred to worker}\n- reftests for the above 2 (what gets displayed when the canvas is displayed)\n- with canvas element added to DOM or not (applies to other canvas tests as well)\n  - canvas is added to DOM after being rendered\n  - canvas is already in DOM but becomes visible after being rendered\n  `\n  )\n  .params(u =>\n    u //\n      .combine('canvasType', kAllCanvasTypes)\n      .combine('prevFrameCallsite', ['runInNewCanvasFrame', 'requestAnimationFrame'] as const)\n      .combine('getCurrentTextureAgain', [true, false] as const)\n  )\n  .beforeAllSubcases(t => {\n    if (\n      t.params.prevFrameCallsite === 'requestAnimationFrame' &&\n      typeof requestAnimationFrame === 'undefined'\n    ) {\n      throw new SkipTestCase('requestAnimationFrame not available');\n    }\n  })\n  .fn(t => {\n    const { canvasType, prevFrameCallsite, getCurrentTextureAgain } = t.params;\n    const ctx = t.initCanvasContext(t.params.canvasType);\n    // Create a bindGroupLayout to test invalid texture view usage later.\n    const bgl = t.device.createBindGroupLayout({\n      entries: [\n        {\n          binding: 0,\n          visibility: GPUShaderStage.COMPUTE,\n          texture: {},\n        },\n      ],\n    });\n\n    // The fn is called immediately after previous frame updating the rendering.\n    // Polyfill by calling the callback by setTimeout, in the requestAnimationFrame callback (for onscreen canvas)\n    // or after transferToImageBitmap (for offscreen canvas).\n    function runInNewCanvasFrame(fn: () => void) {\n      switch (canvasType) {\n        case 'onscreen':\n          requestAnimationFrame(() => timeout(fn));\n          break;\n        case 'offscreen':\n          // for offscreen canvas, after calling transferToImageBitmap, we are in a new frame immediately\n          (ctx.canvas as OffscreenCanvas).transferToImageBitmap();\n          fn();\n          break;\n        default:\n          unreachable();\n      }\n    }\n\n    function checkGetCurrentTexture() {\n      // Call getCurrentTexture on previous frame.\n      const prevTexture = ctx.getCurrentTexture();\n\n      // Call getCurrentTexture immediately after the frame, the texture object should stay the same.\n      queueMicrotask(() => {\n        if (getCurrentTextureAgain) {\n          t.expect(prevTexture === ctx.getCurrentTexture());\n        }\n\n        // Call getCurrentTexture in a new frame.\n        // It should expire the previous texture object return a new texture object by the next frame by then.\n        // Call runInNewCanvasFrame in the micro task to make sure the new frame run after the getCurrentTexture in the micro task for offscreen canvas.\n        runInNewCanvasFrame(() => {\n          if (getCurrentTextureAgain) {\n            t.expect(prevTexture !== ctx.getCurrentTexture());\n          }\n\n          // Event when prevTexture expired, createView should still succeed anyway.\n          const prevTextureView = prevTexture.createView();\n          // Using the invalid view should fail if it expires.\n          t.expectValidationError(() => {\n            t.device.createBindGroup({\n              layout: bgl,\n              entries: [{ binding: 0, resource: prevTextureView }],\n            });\n          });\n        });\n      });\n    }\n\n    switch (prevFrameCallsite) {\n      case 'runInNewCanvasFrame':\n        runInNewCanvasFrame(checkGetCurrentTexture);\n        break;\n      case 'requestAnimationFrame':\n        requestAnimationFrame(checkGetCurrentTexture);\n        break;\n      default:\n        break;\n    }\n  });\n\ng.test('compatibility')\n  .desc(\n    `\nTest that the texture returned from getCurrentTexture has textureBindingViewDimension\nand that it's undefined in core and '2d' in compatibility mode.\n  `\n  )\n  .params(u =>\n    u //\n      .combine('canvasType', kAllCanvasTypes)\n  )\n  .fn(t => {\n    const { canvasType } = t.params;\n    const ctx = t.initCanvasContext(canvasType);\n    const texture = ctx.getCurrentTexture();\n    t.expect(() => 'textureBindingViewDimension' in texture);\n\n    const expected = t.isCompatibility ? '2d' : undefined;\n    t.expect(texture.textureBindingViewDimension === expected);\n  });\n\ng.test('usage_as_color_attachment_and_resolve_target')\n  .desc(\n    `\nTest that the texture returned from getCurrentTexture can be used as a color attachment.\n  `\n  )\n  .params(u =>\n    u //\n      .combine('canvasType', kAllCanvasTypes)\n      .combine('withView', [true, false])\n      .combine('asResolveTarget', [true, false])\n  )\n  .fn(t => {\n    const { canvasType, withView, asResolveTarget } = t.params;\n    const ctx = t.initCanvasContext(canvasType);\n    const texture = ctx.getCurrentTexture();\n\n    const clearValue = [1, 0.5, 0, 1];\n    const encoder = t.device.createCommandEncoder();\n\n    if (asResolveTarget) {\n      const srcTexture = t.createTextureTracked({\n        size: [texture.width, texture.height, 1],\n        format: texture.format,\n        usage: GPUTextureUsage.RENDER_ATTACHMENT,\n        sampleCount: 4,\n      });\n      const pass = encoder.beginRenderPass({\n        colorAttachments: [\n          {\n            view: withView ? srcTexture.createView() : srcTexture,\n            resolveTarget: withView ? texture.createView() : texture,\n            loadOp: 'clear',\n            storeOp: 'store',\n            clearValue,\n          },\n        ],\n      });\n      pass.end();\n    } else {\n      const pass = encoder.beginRenderPass({\n        colorAttachments: [\n          {\n            view: withView ? texture.createView() : texture,\n            loadOp: 'clear',\n            storeOp: 'store',\n            clearValue,\n          },\n        ],\n      });\n      pass.end();\n    }\n    t.device.queue.submit([encoder.finish()]);\n    expectSingleColorInCanvas(t, ctx.canvas, clearValue);\n  });\n\ng.test('usage_as_texture_binding')\n  .params(u =>\n    u //\n      .combine('canvasType', kAllCanvasTypes)\n      .combine('withView', [true, false])\n  )\n  .fn(t => {\n    const { canvasType, withView } = t.params;\n    const ctx = t.initCanvasContext(canvasType, GPUTextureUsage.TEXTURE_BINDING);\n    const texture = ctx.getCurrentTexture();\n\n    const clearValue = [1, 1, 0, 1];\n    const encoder = t.device.createCommandEncoder();\n\n    // clear canvas to solid color.\n    {\n      const pass = encoder.beginRenderPass({\n        colorAttachments: [\n          {\n            view: texture.createView(),\n            loadOp: 'clear',\n            storeOp: 'store',\n            clearValue,\n          },\n        ],\n      });\n      pass.end();\n    }\n\n    // Render canvas to texture\n    {\n      const module = t.device.createShaderModule({\n        code: `\n          @vertex\n          fn vs(@builtin(vertex_index) index : u32) -> @builtin(position) vec4f {\n            let pos = array(\n              vec2f(-1, -1),\n              vec2f(-1,  3),\n              vec2f( 3, -1),\n            );\n            return vec4f(pos[index], 0, 1);\n          }\n\n          @group(0) @binding(0) var tex: texture_2d<f32>;\n\n          @fragment\n          fn fs(@builtin(position) pos: vec4f) -> @location(0) vec4f {\n            return textureLoad(tex, vec2u(pos.xy), 0);\n          }\n        `,\n      });\n\n      const pipeline = t.device.createRenderPipeline({\n        layout: 'auto',\n        vertex: { module },\n        fragment: { module, targets: [{ format: texture.format }] },\n      });\n\n      const bindGroup = t.device.createBindGroup({\n        layout: pipeline.getBindGroupLayout(0),\n        entries: [\n          {\n            binding: 0,\n            resource: withView ? texture.createView() : texture,\n          },\n        ],\n      });\n\n      const dstTexture = t.createTextureTracked({\n        size: [texture.width, texture.height, 1],\n        format: texture.format,\n        usage: GPUTextureUsage.RENDER_ATTACHMENT | GPUTextureUsage.COPY_SRC,\n      });\n\n      const pass = encoder.beginRenderPass({\n        colorAttachments: [\n          {\n            view: dstTexture.createView(),\n            loadOp: 'clear',\n            storeOp: 'store',\n          },\n        ],\n      });\n      pass.setPipeline(pipeline);\n      pass.setBindGroup(0, bindGroup);\n      pass.draw(3);\n      pass.end();\n      t.device.queue.submit([encoder.finish()]);\n\n      t.expectSingleColor(dstTexture, dstTexture.format, {\n        size: [dstTexture.width, dstTexture.height, 1],\n        exp: {\n          R: clearValue[0],\n          G: clearValue[1],\n          B: clearValue[2],\n          A: clearValue[3],\n        },\n      });\n    }\n  });\n"],"mappings":"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"}