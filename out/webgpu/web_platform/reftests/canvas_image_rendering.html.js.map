{"version":3,"file":"canvas_image_rendering.html.js","names":["runRefTest","t","device","presentationFormat","navigator","gpu","getPreferredCanvasFormat","module","createShaderModule","code","pipeline","createRenderPipeline","layout","vertex","entryPoint","fragment","targets","format","draw","selector","alphaMode","canvas","document","querySelector","context","getContext","configure","encoder","createCommandEncoder","pass","beginRenderPass","colorAttachments","view","getCurrentTexture","createView","clearValue","loadOp","storeOp","setPipeline","end","queue","submit","finish"],"sources":["../../../../src/webgpu/web_platform/reftests/canvas_image_rendering.html.ts"],"sourcesContent":["import { runRefTest } from './gpu_ref_test.js';\n\nrunRefTest(t => {\n  const device = t.device;\n  const presentationFormat = navigator.gpu.getPreferredCanvasFormat();\n\n  const module = device.createShaderModule({\n    code: `\n      @vertex fn vs(\n        @builtin(vertex_index) VertexIndex : u32\n      ) -> @builtin(position) vec4<f32> {\n        var pos = array<vec2<f32>, 3>(\n        vec2(-1.0, 3.0),\n        vec2(-1.0,-1.0),\n        vec2( 3.0,-1.0)\n        );\n\n        return vec4(pos[VertexIndex], 0.0, 1.0);\n      }\n\n      @fragment fn fs(\n         @builtin(position) Pos : vec4<f32>\n      ) -> @location(0) vec4<f32> {\n        let black = vec4f(0, 0, 0, 1);\n        let white = vec4f(1, 1, 1, 1);\n        let iPos = vec4u(Pos);\n        let check = (iPos.x + iPos.y) & 1;\n        return mix(black, white, f32(check));\n      }\n    `,\n  });\n\n  const pipeline = device.createRenderPipeline({\n    layout: 'auto',\n    vertex: {\n      module,\n      entryPoint: 'vs',\n    },\n    fragment: {\n      module,\n      entryPoint: 'fs',\n      targets: [{ format: presentationFormat }],\n    },\n  });\n\n  function draw(selector: string, alphaMode: GPUCanvasAlphaMode) {\n    const canvas = document.querySelector(selector) as HTMLCanvasElement;\n    const context = canvas.getContext('webgpu') as GPUCanvasContext;\n    context.configure({\n      device,\n      format: presentationFormat,\n      alphaMode,\n    });\n\n    const encoder = device.createCommandEncoder();\n    const pass = encoder.beginRenderPass({\n      colorAttachments: [\n        {\n          view: context.getCurrentTexture().createView(),\n          clearValue: [0.0, 0.0, 0.0, 0.0],\n          loadOp: 'clear',\n          storeOp: 'store',\n        },\n      ],\n    });\n    pass.setPipeline(pipeline);\n    pass.draw(3);\n    pass.end();\n\n    device.queue.submit([encoder.finish()]);\n  }\n\n  draw('#elem1', 'premultiplied');\n  draw('#elem2', 'premultiplied');\n  draw('#elem3', 'premultiplied');\n  draw('#elem4', 'opaque');\n  draw('#elem5', 'opaque');\n  draw('#elem6', 'opaque');\n});\n"],"mappings":";;GAAA,SAASA,UAAU,QAAQ,mBAAmB,CAE9CA,UAAU,CAAC,CAAAC,CAAC,KAAI;EACd,MAAMC,MAAM,GAAGD,CAAC,CAACC,MAAM;EACvB,MAAMC,kBAAkB,GAAGC,SAAS,CAACC,GAAG,CAACC,wBAAwB,CAAC,CAAC;;EAEnE,MAAMC,MAAM,GAAGL,MAAM,CAACM,kBAAkB,CAAC;IACvCC,IAAI,EAAG;AACX;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACE,CAAC,CAAC;;EAEF,MAAMC,QAAQ,GAAGR,MAAM,CAACS,oBAAoB,CAAC;IAC3CC,MAAM,EAAE,MAAM;IACdC,MAAM,EAAE;MACNN,MAAM;MACNO,UAAU,EAAE;IACd,CAAC;IACDC,QAAQ,EAAE;MACRR,MAAM;MACNO,UAAU,EAAE,IAAI;MAChBE,OAAO,EAAE,CAAC,EAAEC,MAAM,EAAEd,kBAAkB,CAAC,CAAC;IAC1C;EACF,CAAC,CAAC;;EAEF,SAASe,IAAIA,CAACC,QAAgB,EAAEC,SAA6B,EAAE;IAC7D,MAAMC,MAAM,GAAGC,QAAQ,CAACC,aAAa,CAACJ,QAAQ,CAAsB;IACpE,MAAMK,OAAO,GAAGH,MAAM,CAACI,UAAU,CAAC,QAAQ,CAAqB;IAC/DD,OAAO,CAACE,SAAS,CAAC;MAChBxB,MAAM;MACNe,MAAM,EAAEd,kBAAkB;MAC1BiB;IACF,CAAC,CAAC;;IAEF,MAAMO,OAAO,GAAGzB,MAAM,CAAC0B,oBAAoB,CAAC,CAAC;IAC7C,MAAMC,IAAI,GAAGF,OAAO,CAACG,eAAe,CAAC;MACnCC,gBAAgB,EAAE;MAChB;QACEC,IAAI,EAAER,OAAO,CAACS,iBAAiB,CAAC,CAAC,CAACC,UAAU,CAAC,CAAC;QAC9CC,UAAU,EAAE,CAAC,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,CAAC;QAChCC,MAAM,EAAE,OAAO;QACfC,OAAO,EAAE;MACX,CAAC;;IAEL,CAAC,CAAC;IACFR,IAAI,CAACS,WAAW,CAAC5B,QAAQ,CAAC;IAC1BmB,IAAI,CAACX,IAAI,CAAC,CAAC,CAAC;IACZW,IAAI,CAACU,GAAG,CAAC,CAAC;;IAEVrC,MAAM,CAACsC,KAAK,CAACC,MAAM,CAAC,CAACd,OAAO,CAACe,MAAM,CAAC,CAAC,CAAC,CAAC;EACzC;;EAEAxB,IAAI,CAAC,QAAQ,EAAE,eAAe,CAAC;EAC/BA,IAAI,CAAC,QAAQ,EAAE,eAAe,CAAC;EAC/BA,IAAI,CAAC,QAAQ,EAAE,eAAe,CAAC;EAC/BA,IAAI,CAAC,QAAQ,EAAE,QAAQ,CAAC;EACxBA,IAAI,CAAC,QAAQ,EAAE,QAAQ,CAAC;EACxBA,IAAI,CAAC,QAAQ,EAAE,QAAQ,CAAC;AAC1B,CAAC,CAAC"}