{"version":3,"file":"fragment_builtins.spec.js","names":["description","makeTestGroup","ErrorWithExtra","assert","range","unreachable","getBlockInfoForTextureFormat","AllFeaturesMaxLimitsGPUTest","TextureTestMixin","getProvokingVertexForFlatInterpolationEitherSampling","getMultisampleFragmentOffsets","dotProduct","subtractVectors","align","TexelView","findFailedPixels","FragmentBuiltinTest","g","s_deviceToPipelineMap","WeakMap","getPipelinesForDevice","device","pipelines","get","set","getCopyMultisamplePipelineForDevice","textures","length","sampleCount","pipelineType","pipeline","isMultisampled","numSamples","sampleIndex","module","createShaderModule","code","createComputePipeline","label","layout","compute","entryPoint","isTextureSameDimensions","a","b","width","height","depthOrArrayLayers","copyRGBA8EncodedFloatTexturesToBufferIncludingMultisampledTextures","t","copyBuffer","createBufferTracked","size","usage","GPUBufferUsage","STORAGE","COPY_SRC","buffer","MAP_READ","COPY_DST","encoder","createCommandEncoder","textureEntries","map","texture","i","binding","resource","createView","bindGroup","createBindGroup","getBindGroupLayout","entries","pass","beginComputePass","setPipeline","setBindGroup","dispatchWorkgroups","end","copyBufferToBuffer","queue","submit","finish","kX","kY","kZ","kW","getColumn","values","colNum","v","linearInterpolation","baryCoords","interCoords","perspectiveInterpolation","barycentricCoords","clipSpaceTriangleCoords","c","fa","fb","fc","wa","wb","wc","clipSpaceToNDC","point","ndcToWindow","ndcPoint","viewport","xd","yd","zd","px","py","ox","oy","zNear","zFar","calcBarycentricCoordinates","trianglePoints","p","v0","v1","v2","dot00","dot01","dot11","dot20","dot21","denom","w","u","isInsideTriangle","isTriangleClockwise","windowPoints","sum","p0","p1","generateFragmentInputs","nearFar","frontFace","clipSpacePoints","interpolateFn","expected","Float32Array","vertexIndex","ndcPoints","slice","windowPoints2D","cw","frontFacing","fragmentOffsets","y","x","sampleMask","localSampleMask","multisampleOffset","sampleFragmentPoint","sampleBarycentricCoords","inside","fragmentPoint","fragmentBarycentricCoords","output","baseVertexIndex","offset","computeFragmentPosition","createInterStageInterpolationFn","interStagePoints","type","sampling","provokingVertex","triangleInterStagePoints","undefined","_","createInterStageInterpolationBetween0And1TestFn","fragData","interpolatedValues","allTrue","reduce","all","computeFragmentSampleIndex","computeFragmentFrontFacing","computeSampleMask","renderFragmentShaderInputsTo4TexturesAndReadbackValues","interpolationType","interpolationSampling","fragInCode","outputCode","interpolate","join","createTextureTracked","GPUTextureUsage","RENDER_ATTACHMENT","TEXTURE_BINDING","format","createRenderPipeline","vertex","fragment","targets","primitive","multisample","count","uniformBuffer","UNIFORM","writeBuffer","beginRenderPass","colorAttachments","view","loadOp","storeOp","setViewport","draw","mapAsync","GPUMapMode","READ","getMappedRange","checkSampleRectsApproximatelyEqual","actual","maxDiffULPsForFloatFormat","subrectOrigin","subrectSize","areaDesc","bytesPerRow","rowsPerImage","actTexelView","fromTextureDataByReference","Uint8Array","expTexelView","failedPixelsMessage","z","msg","test","desc","params","combine","beforeAllSubcases","interpolation","skipIfInterpolationTypeOrSamplingNotSupported","fn","expectOK","skipIf","isCompatibility","indexOf","findIndex","beginSubcases","combineWithParams","kSizes","popcount","input","n","runSubgroupTest","fsShader","checker","vsShader","topology","blockWidth","blockHeight","bytesPerBlock","blocksPerRow","blocksPerColumn","byteLength","uintLength","framebuffer","copyWholeTextureToNewBufferSimple","readback","readGPUBufferRangeTyped","srcByteOffset","Uint32Array","typedLength","method","data","kMaximumSubgroupSize","kSubgroupShaderNoError","checkSubgroupSizeConsistency","min","max","uintsPerRow","uintsPerTexel","row","col","subgroupSize","countActive","ballotedSubgroupSize","error","Error","skipIfDeviceDoesNotHaveFeature","subgroupMinSize","subgroupMaxSize","adapterInfo","checkSubgroupInvocationIdConsistency","id","sgSize","ballotSize"],"sources":["../../../../../src/webgpu/shader/execution/shader_io/fragment_builtins.spec.ts"],"sourcesContent":["export const description = `Test fragment shader builtin variables and inter-stage variables\n\n* test builtin(position)\n* test @interpolate\n* test builtin(sample_index)\n* test builtin(front_facing)\n* test builtin(sample_mask)\n\nNote: @interpolate settings and sample_index affect whether or not the fragment shader\nis evaluated per-fragment or per-sample. With @interpolate(, sample) or usage of\n@builtin(sample_index) the fragment shader should be executed per-sample.\n\n* sample_mask output is tested in\n  src/webgpu/api/operation/render_pipeline/sample_mask.spec.ts\n\n* frag_depth output is tested in\n  src/webgpu/api/operation/rendering/depth_clip_clamp.spec.ts\n`;\n\nimport { makeTestGroup } from '../../../../common/framework/test_group.js';\nimport { ErrorWithExtra, assert, range, unreachable } from '../../../../common/util/util.js';\nimport { InterpolationSampling, InterpolationType } from '../../../constants.js';\nimport { getBlockInfoForTextureFormat } from '../../../format_info.js';\nimport { AllFeaturesMaxLimitsGPUTest, GPUTest, TextureTestMixin } from '../../../gpu_test.js';\nimport { getProvokingVertexForFlatInterpolationEitherSampling } from '../../../inter_stage.js';\nimport { getMultisampleFragmentOffsets } from '../../../multisample_info.js';\nimport { dotProduct, subtractVectors, align } from '../../../util/math.js';\nimport { TexelView } from '../../../util/texture/texel_view.js';\nimport { findFailedPixels } from '../../../util/texture/texture_ok.js';\n\nclass FragmentBuiltinTest extends TextureTestMixin(AllFeaturesMaxLimitsGPUTest) {}\n\nexport const g = makeTestGroup(FragmentBuiltinTest);\n\nconst s_deviceToPipelineMap = new WeakMap<\n  GPUDevice,\n  {\n    texture_2d?: GPUComputePipeline;\n    texture_multisampled_2d?: GPUComputePipeline;\n  }\n>();\n\n/**\n * Returns an object of pipelines associated\n * by weakmap to a device so we can cache pipelines.\n */\nfunction getPipelinesForDevice(device: GPUDevice) {\n  let pipelines = s_deviceToPipelineMap.get(device);\n  if (!pipelines) {\n    pipelines = {};\n    s_deviceToPipelineMap.set(device, pipelines);\n  }\n  return pipelines;\n}\n\n/**\n * Gets a compute pipeline that will copy the given texture if passed\n * a dispatch size of texture.width, texture.height\n * @param device a device\n * @param texture texture the pipeline is needed for.\n * @returns A GPUComputePipeline\n */\nfunction getCopyMultisamplePipelineForDevice(device: GPUDevice, textures: GPUTexture[]) {\n  assert(textures.length === 4);\n  assert(textures[0].sampleCount === textures[1].sampleCount);\n  assert(textures[0].sampleCount === textures[2].sampleCount);\n  assert(textures[0].sampleCount === textures[3].sampleCount);\n\n  const pipelineType = textures[0].sampleCount > 1 ? 'texture_multisampled_2d' : 'texture_2d';\n  const pipelines = getPipelinesForDevice(device);\n  let pipeline = pipelines[pipelineType];\n  if (!pipeline) {\n    const isMultisampled = pipelineType === 'texture_multisampled_2d';\n    const numSamples = isMultisampled ? 'textureNumSamples(texture0)' : '1u';\n    const sampleIndex = isMultisampled ? 'sampleIndex' : '0';\n    const module = device.createShaderModule({\n      code: `\n        @group(0) @binding(0) var texture0: ${pipelineType}<f32>;\n        @group(0) @binding(1) var texture1: ${pipelineType}<f32>;\n        @group(0) @binding(2) var texture2: ${pipelineType}<f32>;\n        @group(0) @binding(3) var texture3: ${pipelineType}<f32>;\n        @group(0) @binding(4) var<storage, read_write> buffer: array<f32>;\n\n        @compute @workgroup_size(1) fn cs(@builtin(global_invocation_id) id: vec3u) {\n          let numSamples = ${numSamples};\n          let dimensions = textureDimensions(texture0);\n          let sampleIndex = id.x % numSamples;\n          let tx = id.x / numSamples;\n          let offset = ((id.y * dimensions.x + tx) * numSamples + sampleIndex) * 4;\n          let r = vec4u(textureLoad(texture0, vec2u(tx, id.y), ${sampleIndex}) * 255.0);\n          let g = vec4u(textureLoad(texture1, vec2u(tx, id.y), ${sampleIndex}) * 255.0);\n          let b = vec4u(textureLoad(texture2, vec2u(tx, id.y), ${sampleIndex}) * 255.0);\n          let a = vec4u(textureLoad(texture3, vec2u(tx, id.y), ${sampleIndex}) * 255.0);\n\n          // expand rgba8unorm values back to their byte form, add them together\n          // and cast them to an f32 so we can recover the f32 values we encoded\n          // in the rgba8unorm texture.\n          buffer[offset + 0] = bitcast<f32>(dot(r, vec4u(0x1000000, 0x10000, 0x100, 0x1)));\n          buffer[offset + 1] = bitcast<f32>(dot(g, vec4u(0x1000000, 0x10000, 0x100, 0x1)));\n          buffer[offset + 2] = bitcast<f32>(dot(b, vec4u(0x1000000, 0x10000, 0x100, 0x1)));\n          buffer[offset + 3] = bitcast<f32>(dot(a, vec4u(0x1000000, 0x10000, 0x100, 0x1)));\n        }\n      `,\n    });\n\n    pipeline = device.createComputePipeline({\n      label: 'copy multisampled texture pipeline',\n      layout: 'auto',\n      compute: {\n        module,\n        entryPoint: 'cs',\n      },\n    });\n\n    pipelines[pipelineType] = pipeline;\n  }\n  return pipeline;\n}\n\nfunction isTextureSameDimensions(a: GPUTexture, b: GPUTexture) {\n  return (\n    a.sampleCount === b.sampleCount &&\n    a.width === b.width &&\n    a.height === b.height &&\n    a.depthOrArrayLayers === b.depthOrArrayLayers\n  );\n}\n\n/**\n * Copies a texture (even if multisampled) to a buffer\n * @param t a gpu test\n * @param texture texture to copy\n * @returns buffer with copy of texture, mip level 0, array layer 0.\n */\nfunction copyRGBA8EncodedFloatTexturesToBufferIncludingMultisampledTextures(\n  t: GPUTest,\n  textures: GPUTexture[]\n) {\n  assert(textures.length === 4);\n  assert(isTextureSameDimensions(textures[0], textures[1]));\n  assert(isTextureSameDimensions(textures[0], textures[2]));\n  assert(isTextureSameDimensions(textures[0], textures[3]));\n  const { width, height, sampleCount } = textures[0];\n\n  const copyBuffer = t.createBufferTracked({\n    size: width * height * sampleCount * 4 * 4,\n    usage: GPUBufferUsage.STORAGE | GPUBufferUsage.COPY_SRC,\n  });\n\n  const buffer = t.createBufferTracked({\n    size: copyBuffer.size,\n    usage: GPUBufferUsage.MAP_READ | GPUBufferUsage.COPY_DST,\n  });\n\n  const pipeline = getCopyMultisamplePipelineForDevice(t.device, textures);\n  const encoder = t.device.createCommandEncoder();\n\n  const textureEntries = textures.map(\n    (texture, i) => ({ binding: i, resource: texture.createView() }) as GPUBindGroupEntry\n  );\n\n  const bindGroup = t.device.createBindGroup({\n    layout: pipeline.getBindGroupLayout(0),\n    entries: [...textureEntries, { binding: 4, resource: { buffer: copyBuffer } }],\n  });\n\n  const pass = encoder.beginComputePass();\n  pass.setPipeline(pipeline);\n  pass.setBindGroup(0, bindGroup);\n  pass.dispatchWorkgroups(width * sampleCount, height);\n  pass.end();\n\n  encoder.copyBufferToBuffer(copyBuffer, 0, buffer, 0, buffer.size);\n\n  t.device.queue.submit([encoder.finish()]);\n\n  return buffer;\n}\n\n/* column constants */\nconst kX = 0;\nconst kY = 1;\nconst kZ = 2;\nconst kW = 3;\n\n/**\n * Gets a column of values from an array of arrays.\n */\nfunction getColumn(values: readonly number[][], colNum: number) {\n  return values.map(v => v[colNum]);\n}\n\n/**\n * Computes the linear interpolation of 3 values from 3 vertices of a triangle\n * based on barycentric coordinates\n */\nfunction linearInterpolation(baryCoords: readonly number[], interCoords: readonly number[]) {\n  return dotProduct(baryCoords, interCoords);\n}\n\n/**\n * Computes the perspective interpolation of 3 values from 3 vertices of a\n * triangle based on barycentric coordinates and their corresponding clip space\n * W coordinates.\n */\nfunction perspectiveInterpolation(\n  barycentricCoords: readonly number[],\n  clipSpaceTriangleCoords: readonly number[][],\n  interCoords: readonly number[]\n) {\n  const [a, b, c] = barycentricCoords;\n  const [fa, fb, fc] = interCoords;\n  const wa = clipSpaceTriangleCoords[0][kW];\n  const wb = clipSpaceTriangleCoords[1][kW];\n  const wc = clipSpaceTriangleCoords[2][kW];\n\n  return ((a * fa) / wa + (b * fb) / wb + (c * fc) / wc) / (a / wa + b / wb + c / wc);\n}\n\n/**\n * Converts clip space coords to NDC coords\n */\nfunction clipSpaceToNDC(point: readonly number[]) {\n  return point.map(v => v / point[kW]);\n}\n\n/**\n * Converts NDC coords to window coords.\n */\nfunction ndcToWindow(ndcPoint: readonly number[], viewport: readonly number[]) {\n  const [xd, yd, zd] = ndcPoint;\n  const px = viewport[2];\n  const py = viewport[3];\n  const ox = viewport[0] + px / 2;\n  const oy = viewport[1] + py / 2;\n  const zNear = viewport[4];\n  const zFar = viewport[5];\n  // prettier-ignore\n  return [\n    px / 2 * xd + ox,\n    -py / 2 * yd + oy,\n    zd * (zFar - zNear) + zNear,\n  ];\n}\n\n/**\n * Computes barycentric coordinates of triangle for point p.\n * @param trianglePoints points for triangle\n * @param p point in triangle (or relative to it)\n * @returns barycentric coords of p\n */\nfunction calcBarycentricCoordinates(trianglePoints: number[][], p: number[]) {\n  const [a, b, c] = trianglePoints;\n\n  const v0 = subtractVectors(b, a);\n  const v1 = subtractVectors(c, a);\n  const v2 = subtractVectors(p, a);\n\n  const dot00 = dotProduct(v0, v0);\n  const dot01 = dotProduct(v0, v1);\n  const dot11 = dotProduct(v1, v1);\n  const dot20 = dotProduct(v2, v0);\n  const dot21 = dotProduct(v2, v1);\n\n  const denom = 1 / (dot00 * dot11 - dot01 * dot01);\n  const v = (dot11 * dot20 - dot01 * dot21) * denom;\n  const w = (dot00 * dot21 - dot01 * dot20) * denom;\n  const u = 1 - v - w;\n\n  return [u, v, w];\n}\n\n/**\n * Returns true if point is inside triangle\n */\nfunction isInsideTriangle(barycentricCoords: number[]) {\n  for (const v of barycentricCoords) {\n    if (v < 0 || v > 1) {\n      return false;\n    }\n  }\n  return true;\n}\n\n/**\n * Returns true if windowPoints define a clockwise triangle\n */\nfunction isTriangleClockwise(windowPoints: readonly number[][]) {\n  let sum = 0;\n  for (let i = 0; i < 3; ++i) {\n    const p0 = windowPoints[i];\n    const p1 = windowPoints[(i + 1) % 3];\n    sum += p0[kX] * p1[kY] - p1[kX] * p0[kY];\n  }\n  return sum >= 0;\n}\n\ntype FragData = {\n  baseVertexIndex: number;\n  fragmentPoint: readonly number[];\n  fragmentBarycentricCoords: readonly number[];\n  sampleBarycentricCoords: readonly number[];\n  clipSpacePoints: readonly number[][];\n  ndcPoints: readonly number[][];\n  windowPoints: readonly number[][];\n  sampleIndex: number;\n  sampleMask: number;\n  frontFacing: boolean;\n};\n\n/**\n * For each sample in texture, computes the values that would be provided\n * to the shader as `@builtin(position)` if the texture was a render target\n * and every point in the texture was inside the triangle.\n * @param texture The texture\n * @param clipSpacePoints triangle points in clip space\n * @returns the expected values for each sample\n */\nfunction generateFragmentInputs({\n  width,\n  height,\n  nearFar,\n  sampleCount,\n  frontFace,\n  clipSpacePoints,\n  interpolateFn,\n}: {\n  width: number;\n  height: number;\n  nearFar: readonly number[];\n  sampleCount: number;\n  frontFace?: GPUFrontFace;\n  clipSpacePoints: readonly number[][];\n  interpolateFn: (fragData: FragData) => number[];\n}) {\n  const expected = new Float32Array(width * height * sampleCount * 4);\n\n  const viewport = [0, 0, width, height, ...nearFar];\n\n  // For each triangle\n  for (let vertexIndex = 0; vertexIndex < clipSpacePoints.length; vertexIndex += 3) {\n    const ndcPoints = clipSpacePoints.slice(vertexIndex, vertexIndex + 3).map(clipSpaceToNDC);\n    const windowPoints = ndcPoints.map(p => ndcToWindow(p, viewport));\n    const windowPoints2D = windowPoints.map(p => p.slice(0, 2));\n\n    const cw = isTriangleClockwise(windowPoints2D);\n    const frontFacing = frontFace === 'cw' ? cw : !cw;\n    const fragmentOffsets = getMultisampleFragmentOffsets(sampleCount);\n\n    for (let y = 0; y < height; ++y) {\n      for (let x = 0; x < width; ++x) {\n        let sampleMask = 0;\n        for (let sampleIndex = 0; sampleIndex < sampleCount; ++sampleIndex) {\n          const localSampleMask = 1 << sampleIndex;\n          const multisampleOffset = fragmentOffsets[sampleIndex];\n          const sampleFragmentPoint = [x + multisampleOffset[0], y + multisampleOffset[1]];\n          const sampleBarycentricCoords = calcBarycentricCoordinates(\n            windowPoints2D,\n            sampleFragmentPoint\n          );\n\n          const inside = isInsideTriangle(sampleBarycentricCoords);\n          if (inside) {\n            sampleMask |= localSampleMask;\n          }\n        }\n\n        for (let sampleIndex = 0; sampleIndex < sampleCount; ++sampleIndex) {\n          const fragmentPoint = [x + 0.5, y + 0.5];\n          const multisampleOffset = fragmentOffsets[sampleIndex];\n          const sampleFragmentPoint = [x + multisampleOffset[0], y + multisampleOffset[1]];\n          const fragmentBarycentricCoords = calcBarycentricCoordinates(\n            windowPoints2D,\n            fragmentPoint\n          );\n          const sampleBarycentricCoords = calcBarycentricCoordinates(\n            windowPoints2D,\n            sampleFragmentPoint\n          );\n\n          const inside = isInsideTriangle(sampleBarycentricCoords);\n          if (inside) {\n            const output = interpolateFn({\n              baseVertexIndex: vertexIndex,\n              fragmentPoint,\n              fragmentBarycentricCoords,\n              sampleBarycentricCoords,\n              clipSpacePoints,\n              ndcPoints,\n              windowPoints,\n              sampleIndex,\n              sampleMask,\n              frontFacing,\n            });\n\n            const offset = ((y * width + x) * sampleCount + sampleIndex) * 4;\n            expected.set(output, offset);\n          }\n        }\n      }\n    }\n  }\n  return expected;\n}\n\n/**\n * Computes 'builtin(position)`\n */\nfunction computeFragmentPosition({\n  fragmentPoint,\n  fragmentBarycentricCoords,\n  clipSpacePoints,\n  windowPoints,\n}: FragData) {\n  return [\n    fragmentPoint[0],\n    fragmentPoint[1],\n    linearInterpolation(fragmentBarycentricCoords, getColumn(windowPoints, kZ)),\n    1 /\n      perspectiveInterpolation(\n        fragmentBarycentricCoords,\n        clipSpacePoints,\n        getColumn(clipSpacePoints, kW)\n      ),\n  ];\n}\n\n/**\n * Creates a function that will compute the interpolation of an inter-stage variable.\n */\nasync function createInterStageInterpolationFn(\n  t: GPUTest,\n  interStagePoints: number[][],\n  type: InterpolationType,\n  sampling: InterpolationSampling | undefined\n) {\n  const provokingVertex =\n    type === 'flat' && sampling === 'either'\n      ? await getProvokingVertexForFlatInterpolationEitherSampling(t)\n      : 'first';\n\n  return function ({\n    baseVertexIndex,\n    fragmentBarycentricCoords,\n    sampleBarycentricCoords,\n    clipSpacePoints,\n  }: FragData) {\n    const triangleInterStagePoints = interStagePoints.slice(baseVertexIndex, baseVertexIndex + 3);\n    const barycentricCoords =\n      sampling === 'center' || sampling === undefined\n        ? fragmentBarycentricCoords\n        : sampleBarycentricCoords;\n    switch (type) {\n      case 'perspective':\n        return triangleInterStagePoints[0].map((_, colNum: number) =>\n          perspectiveInterpolation(\n            barycentricCoords,\n            clipSpacePoints,\n            getColumn(triangleInterStagePoints, colNum)\n          )\n        );\n        break;\n      case 'linear':\n        return triangleInterStagePoints[0].map((_, colNum: number) =>\n          linearInterpolation(barycentricCoords, getColumn(triangleInterStagePoints, colNum))\n        );\n        break;\n      case 'flat':\n        return triangleInterStagePoints[provokingVertex === 'first' ? 0 : 2];\n        break;\n      default:\n        unreachable();\n    }\n  };\n}\n\n/**\n * Creates a function that will compute the interpolation of an inter-stage variable\n * and then return [1, 0, 0, 0] if all interpolated values are between 0.0 and 1.0 inclusive\n * or [-1, 0, 0, 0] otherwise.\n */\nasync function createInterStageInterpolationBetween0And1TestFn(\n  t: GPUTest,\n  interStagePoints: number[][],\n  type: InterpolationType,\n  sampling: InterpolationSampling | undefined\n) {\n  const interpolateFn = await createInterStageInterpolationFn(t, interStagePoints, type, sampling);\n  return function (fragData: FragData) {\n    const interpolatedValues = interpolateFn(fragData);\n    const allTrue = interpolatedValues.reduce((all, v) => all && v >= 0 && v <= 1, true);\n    return [allTrue ? 1 : -1, 0, 0, 0];\n  };\n}\n\n/**\n * Computes 'builtin(sample_index)'\n */\nfunction computeFragmentSampleIndex({ sampleIndex }: FragData) {\n  return [sampleIndex, 0, 0, 0];\n}\n\n/**\n * Computes 'builtin(front_facing)'\n */\nfunction computeFragmentFrontFacing({ frontFacing }: FragData) {\n  return [frontFacing ? 1 : 0, 0, 0, 0];\n}\n\n/**\n * Computes 'builtin(sample_mask)'\n */\nfunction computeSampleMask({ sampleMask }: FragData) {\n  return [sampleMask, 0, 0, 0];\n}\n\n/**\n * Renders float32 fragment shader inputs values to 4 rgba8unorm textures that\n * can be multisampled textures. It stores each of the channels, r, g, b, a of\n * the shader input to a separate texture, doing the math required to store the\n * float32 value into an rgba8unorm texel.\n *\n * Note: We could try to store the output to an vec4f storage buffer.\n * Unfortunately, using a storage buffer has the issue that we need to compute\n * an index with the very thing we're trying to test. Similarly, if we used a\n * storage texture we would need to compute texture locations with the things\n * we're trying to test. Also, using a storage buffer seems to affect certain\n * backends like M1 Mac so it seems better to stick to rgba8unorm here and test\n * using a storage buffer in a fragment shader separately.\n *\n * We can't use rgba32float, nor rgba16float, nor rgba32uint as they can't be\n * multisampled in all feature levels.\n */\nasync function renderFragmentShaderInputsTo4TexturesAndReadbackValues(\n  t: GPUTest,\n  {\n    interpolationType,\n    interpolationSampling,\n    sampleCount,\n    width,\n    height,\n    nearFar,\n    frontFace,\n    clipSpacePoints,\n    interStagePoints,\n    fragInCode,\n    outputCode,\n  }: {\n    interpolationType: InterpolationType;\n    interpolationSampling?: InterpolationSampling;\n    width: number;\n    height: number;\n    sampleCount: number;\n    frontFace?: GPUFrontFace;\n    nearFar: readonly number[];\n    clipSpacePoints: readonly number[][];\n    interStagePoints: readonly number[][];\n    fragInCode: string;\n    outputCode: string;\n  }\n) {\n  const interpolate = `${interpolationType}${\n    interpolationSampling ? `, ${interpolationSampling}` : ''\n  }`;\n  const module = t.device.createShaderModule({\n    code: `\n      struct Uniforms {\n        resolution: vec2f,\n      };\n\n      @group(0) @binding(0) var<uniform> uni: Uniforms;\n\n      struct VertexOut {\n        @builtin(position) position: vec4f,\n        @location(0) @interpolate(${interpolate}) interpolatedValue: vec4f,\n      };\n\n      @vertex fn vs(@builtin(vertex_index) vNdx: u32) -> VertexOut {\n        let pos = array(\n          ${clipSpacePoints.map(p => `vec4f(${p.join(', ')})`).join(', ')}\n        );\n        let interStage = array(\n          ${interStagePoints.map(p => `vec4f(${p.join(', ')})`).join(', ')}\n        );\n        var v: VertexOut;\n        v.position = pos[vNdx];\n        v.interpolatedValue = interStage[vNdx];\n        _ = uni;\n        return v;\n      }\n\n      struct FragmentIn {\n        @builtin(position) position: vec4f,\n@location(0) @interpolate(${interpolate}) interpolatedValue: vec4f,\n        ${fragInCode}\n      };\n\n      struct FragOut {\n        @location(0) out0: vec4f,\n        @location(1) out1: vec4f,\n        @location(2) out2: vec4f,\n        @location(3) out3: vec4f,\n      };\n\n      fn u32ToRGBAUnorm(u: u32) -> vec4f {\n        return vec4f(\n          f32((u >> 24) & 0xFF) / 255.0,\n          f32((u >> 16) & 0xFF) / 255.0,\n          f32((u >>  8) & 0xFF) / 255.0,\n          f32((u >>  0) & 0xFF) / 255.0,\n        );\n      }\n\n      @fragment fn fs(fin: FragmentIn) -> FragOut {\n        var f: FragOut;\n        let v = ${outputCode};\n        let u = bitcast<vec4u>(v);\n        f.out0 = u32ToRGBAUnorm(u[0]);\n        f.out1 = u32ToRGBAUnorm(u[1]);\n        f.out2 = u32ToRGBAUnorm(u[2]);\n        f.out3 = u32ToRGBAUnorm(u[3]);\n        _ = fin.interpolatedValue;\n        return f;\n      }\n    `,\n  });\n\n  const textures = range(4, () =>\n    t.createTextureTracked({\n      size: [width, height],\n      usage:\n        GPUTextureUsage.RENDER_ATTACHMENT |\n        GPUTextureUsage.TEXTURE_BINDING |\n        GPUTextureUsage.COPY_SRC,\n      format: 'rgba8unorm',\n      sampleCount,\n    })\n  );\n\n  const pipeline = t.device.createRenderPipeline({\n    layout: 'auto',\n    vertex: {\n      module,\n      entryPoint: 'vs',\n    },\n    fragment: {\n      module,\n      entryPoint: 'fs',\n      targets: textures.map(() => ({ format: 'rgba8unorm' })),\n    },\n    ...(frontFace && {\n      primitive: {\n        frontFace,\n      },\n    }),\n    multisample: {\n      count: sampleCount,\n    },\n  });\n\n  const uniformBuffer = t.createBufferTracked({\n    size: 8,\n    usage: GPUBufferUsage.UNIFORM | GPUBufferUsage.COPY_DST,\n  });\n  t.device.queue.writeBuffer(uniformBuffer, 0, new Float32Array([width, height]));\n\n  const viewport = [0, 0, width, height, ...nearFar] as const;\n\n  const bindGroup = t.device.createBindGroup({\n    layout: pipeline.getBindGroupLayout(0),\n    entries: [{ binding: 0, resource: { buffer: uniformBuffer } }],\n  });\n\n  const encoder = t.device.createCommandEncoder();\n  const pass = encoder.beginRenderPass({\n    colorAttachments: textures.map(texture => ({\n      view: texture.createView(),\n      loadOp: 'clear',\n      storeOp: 'store',\n    })),\n  });\n  pass.setPipeline(pipeline);\n  pass.setBindGroup(0, bindGroup);\n  pass.setViewport(viewport[0], viewport[1], viewport[2], viewport[3], viewport[4], viewport[5]);\n  pass.draw(clipSpacePoints.length);\n  pass.end();\n  t.queue.submit([encoder.finish()]);\n\n  const buffer = copyRGBA8EncodedFloatTexturesToBufferIncludingMultisampledTextures(t, textures);\n  await buffer.mapAsync(GPUMapMode.READ);\n  return new Float32Array(buffer.getMappedRange());\n}\n\nfunction checkSampleRectsApproximatelyEqual({\n  width,\n  height,\n  sampleCount,\n  actual,\n  expected,\n  maxDiffULPsForFloatFormat,\n}: {\n  width: number;\n  height: number;\n  sampleCount: number;\n  actual: Float32Array;\n  expected: Float32Array;\n  maxDiffULPsForFloatFormat: number;\n}) {\n  const subrectOrigin = [0, 0, 0];\n  const subrectSize = [width * sampleCount, height, 1];\n  const areaDesc = {\n    bytesPerRow: width * sampleCount * 4 * 4,\n    rowsPerImage: height,\n    subrectOrigin,\n    subrectSize,\n  };\n\n  const format = 'rgba32float';\n  const actTexelView = TexelView.fromTextureDataByReference(\n    format,\n    new Uint8Array(actual.buffer),\n    areaDesc\n  );\n  const expTexelView = TexelView.fromTextureDataByReference(\n    format,\n    new Uint8Array(expected.buffer),\n    areaDesc\n  );\n\n  const failedPixelsMessage = findFailedPixels(\n    format,\n    { x: 0, y: 0, z: 0 },\n    { width: width * sampleCount, height, depthOrArrayLayers: 1 },\n    { actTexelView, expTexelView },\n    { maxDiffULPsForFloatFormat }\n  );\n\n  if (failedPixelsMessage !== undefined) {\n    const msg = 'Texture level had unexpected contents:\\n' + failedPixelsMessage;\n    return new ErrorWithExtra(msg, () => ({\n      expTexelView,\n      actTexelView,\n    }));\n  }\n\n  return undefined;\n}\n\ng.test('inputs,position')\n  .desc(\n    `\n    Test fragment shader builtin(position) values.\n\n    Note: @builtin(position) is always a fragment position, never a sample position.\n  `\n  )\n  .params(u =>\n    u //\n      .combine('nearFar', [[0, 1] as const, [0.25, 0.75] as const] as const)\n      .combine('sampleCount', [1, 4] as const)\n      .combine('interpolation', [\n        { type: 'perspective', sampling: 'center' },\n        { type: 'perspective', sampling: 'centroid' },\n        { type: 'perspective', sampling: 'sample' },\n        { type: 'linear', sampling: 'center' },\n        { type: 'linear', sampling: 'centroid' },\n        { type: 'linear', sampling: 'sample' },\n        { type: 'flat', sampling: 'first' },\n        { type: 'flat', sampling: 'either' },\n      ] as const)\n  )\n  .beforeAllSubcases(t => {\n    const {\n      interpolation: { type, sampling },\n    } = t.params;\n    t.skipIfInterpolationTypeOrSamplingNotSupported({ type, sampling });\n  })\n  .fn(async t => {\n    const {\n      nearFar,\n      sampleCount,\n      interpolation: { type, sampling },\n    } = t.params;\n    // prettier-ignore\n    const clipSpacePoints = [       // ndc values\n      [0.333, 0.333, 0.333, 0.333],  //  1,  1, 1\n      [ 1.0,  -3.0,   0.25, 1.0  ],  //  1, -3, 0.25\n      [-1.5,   0.5,   0.25, 0.5  ],  // -3,  1, 0.5\n    ];\n\n    const interStagePoints = [\n      [1, 2, 3, 4],\n      [5, 6, 7, 8],\n      [9, 10, 11, 12],\n    ];\n\n    const width = 4;\n    const height = 4;\n    const actual = await renderFragmentShaderInputsTo4TexturesAndReadbackValues(t, {\n      interpolationType: type,\n      interpolationSampling: sampling,\n      sampleCount,\n      width,\n      height,\n      nearFar,\n      clipSpacePoints,\n      interStagePoints,\n      fragInCode: '',\n      outputCode: 'fin.position',\n    });\n\n    const expected = generateFragmentInputs({\n      width,\n      height,\n      nearFar,\n      sampleCount,\n      clipSpacePoints,\n      interpolateFn: computeFragmentPosition,\n    });\n\n    // Since @builtin(position) is always a fragment position, never a sample position, check\n    // the first coordinate. It should be 0.5, 0.5 always. This is just to double check\n    // that computeFragmentPosition is generating the correct values.\n    assert(expected[0] === 0.5);\n    assert(expected[1] === 0.5);\n\n    t.expectOK(\n      checkSampleRectsApproximatelyEqual({\n        width,\n        height,\n        sampleCount,\n        actual,\n        expected,\n        maxDiffULPsForFloatFormat: 4,\n      })\n    );\n  });\n\ng.test('inputs,interStage')\n  .desc(\n    `\n    Test fragment shader inter-stage variable values except for centroid interpolation.\n  `\n  )\n  .params(u =>\n    u //\n      .combine('nearFar', [[0, 1] as const, [0.25, 0.75] as const] as const)\n      .combine('sampleCount', [1, 4] as const)\n      .combine('interpolation', [\n        { type: 'perspective' },\n        { type: 'perspective', sampling: 'center' },\n        { type: 'perspective', sampling: 'sample' },\n        { type: 'linear' },\n        { type: 'linear', sampling: 'center' },\n        { type: 'linear', sampling: 'sample' },\n        { type: 'flat' },\n        { type: 'flat', sampling: 'first' },\n        { type: 'flat', sampling: 'either' },\n      ] as const)\n  )\n  .beforeAllSubcases(t => {\n    const {\n      interpolation: { type, sampling },\n    } = t.params;\n    t.skipIfInterpolationTypeOrSamplingNotSupported({ type, sampling });\n  })\n  .fn(async t => {\n    const {\n      nearFar,\n      sampleCount,\n      interpolation: { type, sampling },\n    } = t.params;\n    // prettier-ignore\n    const clipSpacePoints = [       // ndc values\n      [0.333, 0.333, 0.333, 0.333],  //  1,  1, 1\n      [ 1.0,  -3.0,   0.25, 1.0  ],  //  1, -3, 0.25\n      [-1.5,   0.5,   0.25, 0.5  ],  // -3,  1, 0.5\n    ];\n\n    const interStagePoints = [\n      [1, 2, 3, 4],\n      [5, 6, 7, 8],\n      [9, 10, 11, 12],\n    ];\n\n    const width = 4;\n    const height = 4;\n    const actual = await renderFragmentShaderInputsTo4TexturesAndReadbackValues(t, {\n      interpolationType: type,\n      interpolationSampling: sampling,\n      sampleCount,\n      width,\n      height,\n      nearFar,\n      clipSpacePoints,\n      interStagePoints,\n      fragInCode: '',\n      outputCode: 'fin.interpolatedValue',\n    });\n\n    const expected = generateFragmentInputs({\n      width,\n      height,\n      nearFar,\n      sampleCount,\n      clipSpacePoints,\n      interpolateFn: await createInterStageInterpolationFn(t, interStagePoints, type, sampling),\n    });\n\n    t.expectOK(\n      checkSampleRectsApproximatelyEqual({\n        width,\n        height,\n        sampleCount,\n        actual,\n        expected,\n        maxDiffULPsForFloatFormat: 4,\n      })\n    );\n  });\n\ng.test('inputs,interStage,centroid')\n  .desc(\n    `\n    Test fragment shader inter-stage variable values in centroid sampling mode.\n\n    Centroid sampling mode is trying to solve the following issue\n\n    +-------------+\n    |....s1|/     |\n    |......|      |\n    |...../|   s2 |\n    +------C------+\n    |s3./  |      |\n    |../   |      |\n    |./    |s4    |\n    +-------------+\n\n    Above is a diagram of a texel where s1, s2, s3, s4 are sample points,\n    C is the center of the texel and the diagonal line is some edge of\n    a triangle. s1 and s3 are inside the triangle. In sampling = 'center'\n    modes, the interpolated value will be relative to C. The problem is,\n    C is outside of the triangle. In sample = 'centroid' mode, the\n    interpolated value will be computed relative to some point inside the\n    portion of the triangle inside the texel. While ideally it would be\n    the actual centroid, the specs from the various APIs suggest the only\n    guarantee is it's inside the triangle.\n\n    So, we set the interStage values to barycentric coords. We expect\n    that when sampling mode is 'center', some interpolated values\n    will be outside of the triangle (ie, one or more of their values will\n    be outside the 0 to 1 range). In sampling mode = 'centroid' mode, none\n    of the values will be outside of the 0 to 1 range.\n\n    Note: generateFragmentInputs below generates \"expected\". Values not\n    rendered to will be 0. Values rendered to outside the triangle will\n    be -1. Values rendered to inside the triangle will be 1. Manually\n    checking, \"expected\" for sampling = 'center' should have a couple of\n    -1 values where as \"expected\" for sampling = 'centroid' should not.\n    This was verified with manual testing.\n\n    Since we only care about inside vs outside of the triangle, having\n    createInterStageInterpolationFn use the interpolated value relative\n    to the sample point when sampling = 'centroid' will give us a value\n    inside the triangle, which is good enough for our test.\n  `\n  )\n  .params(u =>\n    u //\n      .combine('nearFar', [[0, 1] as const, [0.25, 0.75] as const] as const)\n      .combine('sampleCount', [1, 4] as const)\n      .combine('interpolation', [\n        { type: 'perspective', sampling: 'center' },\n        { type: 'perspective', sampling: 'centroid' },\n        { type: 'linear', sampling: 'center' },\n        { type: 'linear', sampling: 'centroid' },\n      ] as const)\n  )\n  .beforeAllSubcases(t => {\n    const {\n      interpolation: { type, sampling },\n    } = t.params;\n    t.skipIfInterpolationTypeOrSamplingNotSupported({ type, sampling });\n  })\n  .fn(async t => {\n    const {\n      nearFar,\n      sampleCount,\n      interpolation: { type, sampling },\n    } = t.params;\n    //\n    // We're drawing 1 triangle that cut the viewport\n    //\n    //  -1   0   1\n    //   +===+===+  2\n    //   |\\..|...|\n    //   +---+---+  1  <---\n    //   |  \\|...|       |\n    //   +---+---+  0    | viewport\n    //   |   |\\..|       |\n    //   +---+---+ -1  <---\n    //   |   |  \\|\n    //   +===+===+ -2\n\n    // prettier-ignore\n    const clipSpacePoints = [       // ndc values\n      [ 1, -2, 0, 1],\n      [-1,  2, 0, 1],\n      [ 1,  2, 0, 1],\n    ];\n\n    // prettier-ignore\n    const interStagePoints = [\n      [ 1, 0, 0, 0],\n      [ 0, 1, 0, 0],\n      [ 0, 0, 1, 0],\n    ];\n\n    const width = 4;\n    const height = 4;\n    const actual = await renderFragmentShaderInputsTo4TexturesAndReadbackValues(t, {\n      interpolationType: type,\n      interpolationSampling: sampling,\n      sampleCount,\n      width,\n      height,\n      nearFar,\n      clipSpacePoints,\n      interStagePoints,\n      fragInCode: '',\n      outputCode:\n        'vec4f(select(-1.0, 1.0, all(fin.interpolatedValue >= vec4f(0)) && all(fin.interpolatedValue <= vec4f(1))), 0, 0, 0)',\n    });\n\n    const expected = generateFragmentInputs({\n      width,\n      height,\n      nearFar,\n      sampleCount,\n      clipSpacePoints,\n      interpolateFn: await createInterStageInterpolationBetween0And1TestFn(\n        t,\n        interStagePoints,\n        type,\n        sampling\n      ),\n    });\n\n    t.expectOK(\n      checkSampleRectsApproximatelyEqual({\n        width,\n        height,\n        sampleCount,\n        actual,\n        expected,\n        maxDiffULPsForFloatFormat: 3,\n      })\n    );\n  });\n\ng.test('inputs,sample_index')\n  .desc(\n    `\n    Test fragment shader builtin(sample_index) values.\n  `\n  )\n  .params(u =>\n    u //\n      .combine('nearFar', [[0, 1] as const, [0.25, 0.75] as const] as const)\n      .combine('sampleCount', [1, 4] as const)\n      .combine('interpolation', [\n        { type: 'perspective', sampling: 'center' },\n        { type: 'perspective', sampling: 'centroid' },\n        { type: 'perspective', sampling: 'sample' },\n        { type: 'linear', sampling: 'center' },\n        { type: 'linear', sampling: 'centroid' },\n        { type: 'linear', sampling: 'sample' },\n        { type: 'flat', sampling: 'first' },\n        { type: 'flat', sampling: 'either' },\n      ] as const)\n  )\n  .beforeAllSubcases(t => {\n    t.skipIf(t.isCompatibility, 'sample_index is not supported in compatibility mode');\n  })\n  .fn(async t => {\n    const {\n      nearFar,\n      sampleCount,\n      interpolation: { type, sampling },\n    } = t.params;\n    // prettier-ignore\n    const clipSpacePoints = [       // ndc values\n      [0.333, 0.333, 0.333, 0.333],  //  1,  1, 1\n      [ 1.0,  -3.0,   0.25, 1.0  ],  //  1, -3, 0.25\n      [-1.5,   0.5,   0.25, 0.5  ],  // -3,  1, 0.5\n    ];\n\n    const interStagePoints = [\n      [1, 2, 3, 4],\n      [5, 6, 7, 8],\n      [9, 10, 11, 12],\n    ];\n\n    const width = 4;\n    const height = 4;\n    const actual = await renderFragmentShaderInputsTo4TexturesAndReadbackValues(t, {\n      interpolationType: type,\n      interpolationSampling: sampling,\n      sampleCount,\n      width,\n      height,\n      nearFar,\n      clipSpacePoints,\n      interStagePoints,\n      fragInCode: `@builtin(sample_index) sampleIndex: u32,`,\n      outputCode: 'vec4f(f32(fin.sampleIndex), 0, 0, 0)',\n    });\n\n    const expected = generateFragmentInputs({\n      width,\n      height,\n      nearFar,\n      sampleCount,\n      clipSpacePoints,\n      interpolateFn: computeFragmentSampleIndex,\n    });\n\n    t.expectOK(\n      checkSampleRectsApproximatelyEqual({\n        width,\n        height,\n        sampleCount,\n        actual,\n        expected,\n        maxDiffULPsForFloatFormat: 1,\n      })\n    );\n  });\n\ng.test('inputs,front_facing')\n  .desc(\n    `\n    Test fragment shader builtin(front_facing) values.\n\n    Draws a quad from 2 triangles that entirely cover clip space. (see diagram below in code)\n    One triangle is clockwise, the other is counter clockwise. The triangles\n    bisect pixels so that different samples are covered by each triangle so that some\n    samples should get different values for front_facing for the same fragment.\n  `\n  )\n  .params(u =>\n    u //\n      .combine('nearFar', [[0, 1] as const, [0.25, 0.75] as const] as const)\n      .combine('sampleCount', [1, 4] as const)\n      .combine('frontFace', ['cw', 'ccw'] as const)\n      .combine('interpolation', [\n        { type: 'perspective', sampling: 'center' },\n        { type: 'perspective', sampling: 'centroid' },\n        { type: 'perspective', sampling: 'sample' },\n        { type: 'linear', sampling: 'center' },\n        { type: 'linear', sampling: 'centroid' },\n        { type: 'linear', sampling: 'sample' },\n        { type: 'flat', sampling: 'first' },\n        { type: 'flat', sampling: 'either' },\n      ] as const)\n  )\n  .beforeAllSubcases(t => {\n    const {\n      interpolation: { type, sampling },\n    } = t.params;\n    t.skipIfInterpolationTypeOrSamplingNotSupported({ type, sampling });\n  })\n  .fn(async t => {\n    const {\n      nearFar,\n      sampleCount,\n      frontFace,\n      interpolation: { type, sampling },\n    } = t.params;\n    //\n    // We're drawing 2 triangles starting at y = -2 to y = +2\n    //\n    //  -1   0   1\n    //   +===+===+  2\n    //   |\\  |   |\n    //   +---+---+  1  <---\n    //   |  \\|   |       |\n    //   +---+---+  0    | viewport\n    //   |   |\\  |       |\n    //   +---+---+ -1  <---\n    //   |   |  \\|\n    //   +===+===+ -2\n\n    // prettier-ignore\n    const clipSpacePoints = [\n      // ccw\n      [-1, -2, 0, 1],\n      [ 1, -2, 0, 1],\n      [-1,  2, 0, 1],\n\n      // cw\n      [ 1, -2, 0, 1],\n      [-1,  2, 0, 1],\n      [ 1,  2, 0, 1],\n    ];\n\n    const interStagePoints = [\n      [1, 2, 3, 4],\n      [5, 6, 7, 8],\n      [9, 10, 11, 12],\n\n      [13, 14, 15, 16],\n      [17, 18, 19, 20],\n      [21, 22, 23, 24],\n    ];\n\n    const width = 4;\n    const height = 4;\n    const actual = await renderFragmentShaderInputsTo4TexturesAndReadbackValues(t, {\n      interpolationType: type,\n      interpolationSampling: sampling,\n      frontFace,\n      sampleCount,\n      width,\n      height,\n      nearFar,\n      clipSpacePoints,\n      interStagePoints,\n      fragInCode: '@builtin(front_facing) frontFacing: bool,',\n      outputCode: 'vec4f(select(0.0, 1.0, fin.frontFacing), 0, 0, 0)',\n    });\n\n    const expected = generateFragmentInputs({\n      width,\n      height,\n      nearFar,\n      sampleCount,\n      clipSpacePoints,\n      frontFace,\n      interpolateFn: computeFragmentFrontFacing,\n    });\n\n    assert(expected.indexOf(0) >= 0, 'expect some values to be 0');\n    assert(expected.findIndex(v => v !== 0) >= 0, 'expect some values to be non 0');\n\n    t.expectOK(\n      checkSampleRectsApproximatelyEqual({\n        width,\n        height,\n        sampleCount,\n        actual,\n        expected,\n        maxDiffULPsForFloatFormat: 0,\n      })\n    );\n  });\n\ng.test('inputs,sample_mask')\n  .desc(\n    `\n    Test fragment shader builtin(sample_mask) values.\n\n    Draws various triangles that should trigger different sample_mask values.\n    Checks that sample_mask matches what's expected. Note: the triangles\n    are selected so they do not intersect sample points as we don't want\n    to test precision issues on whether or not a sample point is inside\n    or outside the triangle when right on the edge.\n\n    Example: x=-1, y=2, it draws the following triangle\n\n    [ -0.8, -2 ]\n    [  1.2,  2 ]\n    [ -0.8,  2 ]\n\n    On to a 4x4 pixel texture\n\n     -0.8, 2\n      .----------------------.  1.2 2\n      |...................../\n      |..................../\n      |.................../\n      |................../\n      |................./\n    +-|---+-----+-----+/----+  ---\n    | |...|.....|...../     |   ^\n    | |...|.....|..../|     |   |\n    +-|---+-----+---/-+-----+   |\n    | |...|.....|../  |     |   |\n    | |...|.....|./   |     |   |\n    +-|---+-----+/----+-----+   texture / clip space\n    | |...|...../     |     |   |\n    | |...|..../|     |     |   |\n    +-|---+---/-+-----+-----+   |\n    | |...|../  |     |     |   |\n    | |...|./   |     |     |   V\n    +-|---+/----+-----+-----+  ---\n      |.../\n      |../\n      |./\n      |/\n      /\n      .\n      -0.8, -2\n\n    Inside an individual pixel you might see this situation\n\n    +-------------+\n    |....s1|/     |\n    |......|      |\n    |...../|   s2 |\n    +------C------+\n    |s3./  |      |\n    |../   |      |\n    |./    |s4    |\n    +-------------+\n\n    where s1, s2, s3, s4, are sample points and C is the center. For a sampleCount = 4 texture\n    the sample_mask is expected to emit sample_mask = 0b0101\n\n    ref: https://learn.microsoft.com/en-us/windows/win32/api/d3d11/ne-d3d11-d3d11_standard_multisample_quality_levels\n  `\n  )\n  .params(u =>\n    u //\n      .combine('nearFar', [[0, 1] as const, [0.25, 0.75] as const] as const)\n      .combine('sampleCount', [1, 4] as const)\n      .combine('interpolation', [\n        // given that 'sample' effects whether things are run per-sample or per-fragment\n        // we test all of these to make sure they don't affect the result differently than expected.\n        { type: 'perspective', sampling: 'center' },\n        { type: 'perspective', sampling: 'centroid' },\n        { type: 'perspective', sampling: 'sample' },\n        { type: 'linear', sampling: 'center' },\n        { type: 'linear', sampling: 'centroid' },\n        { type: 'linear', sampling: 'sample' },\n        { type: 'flat', sampling: 'first' },\n        { type: 'flat', sampling: 'either' },\n      ] as const)\n      .beginSubcases()\n      .combineWithParams([\n        { x: -1, y: -1 },\n        { x: -1, y: -2 },\n        { x: -1, y: 1 },\n        { x: -1, y: 3 },\n        { x: -2, y: -1 },\n        { x: -2, y: 3 },\n        { x: -3, y: -1 },\n        { x: -3, y: -2 },\n        { x: -3, y: 1 },\n        { x: 1, y: -1 },\n        { x: 1, y: -3 },\n        { x: 1, y: 1 },\n        { x: 1, y: 2 },\n        { x: 2, y: -2 },\n        { x: 2, y: -3 },\n        { x: 2, y: 1 },\n        { x: 2, y: 2 },\n        { x: 3, y: -1 },\n        { x: 3, y: -3 },\n        { x: 3, y: 1 },\n        { x: 3, y: 2 },\n        { x: 3, y: 3 },\n      ])\n  )\n  .beforeAllSubcases(t => {\n    const {\n      interpolation: { type, sampling },\n    } = t.params;\n    t.skipIfInterpolationTypeOrSamplingNotSupported({ type, sampling });\n    t.skipIf(t.isCompatibility, 'sample_mask is not supported in compatibility mode');\n  })\n  .fn(async t => {\n    const {\n      x,\n      y,\n      nearFar,\n      sampleCount,\n      interpolation: { type, sampling },\n    } = t.params;\n    // prettier-ignore\n    const clipSpacePoints = [\n      [ x + 0.2, -y, 0, 1],\n      [-x + 0.2,  y, 0, 1],\n      [ x + 0.2,  y, 0, 1],\n    ];\n\n    const interStagePoints = [\n      [13, 14, 15, 16],\n      [17, 18, 19, 20],\n      [21, 22, 23, 24],\n    ];\n\n    const width = 4;\n    const height = 4;\n    const actual = await renderFragmentShaderInputsTo4TexturesAndReadbackValues(t, {\n      interpolationType: type,\n      interpolationSampling: sampling,\n      sampleCount,\n      width,\n      height,\n      nearFar,\n      clipSpacePoints,\n      interStagePoints,\n      fragInCode: '@builtin(sample_mask) sample_mask: u32,',\n      outputCode: 'vec4f(f32(fin.sample_mask), 0, 0, 0)',\n    });\n\n    const expected = generateFragmentInputs({\n      width,\n      height,\n      nearFar,\n      sampleCount,\n      clipSpacePoints,\n      interpolateFn: computeSampleMask,\n    });\n\n    t.expectOK(\n      checkSampleRectsApproximatelyEqual({\n        width,\n        height,\n        sampleCount,\n        actual,\n        expected,\n        maxDiffULPsForFloatFormat: 0,\n      })\n    );\n  });\n\nconst kSizes = [\n  [15, 15],\n  [16, 16],\n  [17, 17],\n  [19, 13],\n  [13, 10],\n  [111, 2],\n  [2, 111],\n  [35, 2],\n  [2, 35],\n  [53, 13],\n  [13, 53],\n] as const;\n\n/**\n * @returns The population count of input.\n *\n * @param input Treated as an unsigned 32-bit integer\n */\nfunction popcount(input: number): number {\n  let n = input;\n  n = n - ((n >> 1) & 0x55555555);\n  n = (n & 0x33333333) + ((n >> 2) & 0x33333333);\n  return (((n + (n >> 4)) & 0xf0f0f0f) * 0x1010101) >> 24;\n}\n\n/**\n * Runs a subgroup builtin test for fragment shaders\n *\n * This test draws a full screen in 2 separate draw calls (half screen each).\n * Results are checked for each draw.\n * @param t The base test\n * @param format The framebuffer format\n * @param fsShader The fragment shader with the following interface:\n *                 Location 0 output is framebuffer with format\n *                 Group 0 binding 0 is a u32 sized data\n * @param width The framebuffer width\n * @param height The framebuffer height\n * @param checker A functor to check the framebuffer values\n */\nasync function runSubgroupTest(\n  t: FragmentBuiltinTest,\n  format: GPUTextureFormat,\n  fsShader: string,\n  width: number,\n  height: number,\n  checker: (data: Uint32Array) => Error | undefined\n) {\n  const vsShader = `\n@vertex\nfn vsMain(@builtin(vertex_index) index : u32) -> @builtin(position) vec4f {\n  const vertices = array(\n    vec2(-1, -1), vec2(-1,  1), vec2( 1,  1),\n    vec2(-1, -1), vec2( 1, -1), vec2( 1,  1),\n  );\n  return vec4f(vec2f(vertices[index]), 0, 1);\n}`;\n\n  const pipeline = t.device.createRenderPipeline({\n    layout: 'auto',\n    vertex: {\n      module: t.device.createShaderModule({ code: vsShader }),\n    },\n    fragment: {\n      module: t.device.createShaderModule({ code: fsShader }),\n      targets: [{ format }],\n    },\n    primitive: {\n      topology: 'triangle-list',\n    },\n  });\n\n  const { blockWidth, blockHeight, bytesPerBlock } = getBlockInfoForTextureFormat(format);\n  assert(bytesPerBlock !== undefined);\n\n  const blocksPerRow = width / blockWidth;\n  const blocksPerColumn = height / blockHeight;\n  const bytesPerRow = align(blocksPerRow * (bytesPerBlock ?? 1), 256);\n  const byteLength = bytesPerRow * blocksPerColumn;\n  const uintLength = byteLength / 4;\n\n  for (let i = 0; i < 2; i++) {\n    const framebuffer = t.createTextureTracked({\n      size: [width, height],\n      usage:\n        GPUTextureUsage.COPY_SRC |\n        GPUTextureUsage.COPY_DST |\n        GPUTextureUsage.RENDER_ATTACHMENT |\n        GPUTextureUsage.TEXTURE_BINDING,\n      format,\n    });\n\n    const encoder = t.device.createCommandEncoder();\n    const pass = encoder.beginRenderPass({\n      colorAttachments: [\n        {\n          view: framebuffer.createView(),\n          loadOp: 'clear',\n          storeOp: 'store',\n        },\n      ],\n    });\n    pass.setPipeline(pipeline);\n    // Draw the upper-left triangle (vertices 0-2) or the lower-right triangle (vertices 3-5)\n    pass.draw(3, 1, i * 3);\n    pass.end();\n    t.queue.submit([encoder.finish()]);\n\n    const buffer = t.copyWholeTextureToNewBufferSimple(framebuffer, 0);\n    const readback = await t.readGPUBufferRangeTyped(buffer, {\n      srcByteOffset: 0,\n      type: Uint32Array,\n      typedLength: uintLength,\n      method: 'copy',\n    });\n    const data: Uint32Array = readback.data;\n\n    t.expectOK(checker(data));\n  }\n}\n\nconst kMaximumSubgroupSize = 128;\n// A non-zero magic number indicating no expectation error, in order to prevent the false no-error\n// result from zero-initialization.\nconst kSubgroupShaderNoError = 17;\n\n/**\n * Checks subgroup_size builtin value consistency.\n *\n * The builtin subgroup_size is not assumed to be uniform in fragment shaders.\n * Therefore, this function checks the value is a power of two within the device\n * limits and that the ballot size is less than the stated size.\n * @param data An array of vec4u that contains (per texel):\n *             * subgroup_size builtin value\n *             * balloted active invocations number\n *             * balloted subgroup size all active invocations agreed on, otherwise 0\n *             * error flag, should be equal to kSubgroupShaderNoError or shader found\n *               expectation failed otherwise.\n * @param format The texture format for data\n * @param min The minimum subgroup size from the device\n * @param max The maximum subgroup size from the device\n * @param width The width of the framebuffer\n * @param height The height of the framebuffer\n */\nfunction checkSubgroupSizeConsistency(\n  data: Uint32Array,\n  format: GPUTextureFormat,\n  min: number,\n  max: number,\n  width: number,\n  height: number\n): Error | undefined {\n  const { blockWidth, blockHeight, bytesPerBlock } = getBlockInfoForTextureFormat(format);\n  const blocksPerRow = width / blockWidth;\n  // Image copies require bytesPerRow to be a multiple of 256.\n  const bytesPerRow = align(blocksPerRow * (bytesPerBlock ?? 1), 256);\n  const uintsPerRow = bytesPerRow / 4;\n  const uintsPerTexel = (bytesPerBlock ?? 1) / blockWidth / blockHeight / 4;\n\n  for (let row = 0; row < height; row++) {\n    for (let col = 0; col < width; col++) {\n      const offset = uintsPerRow * row + col * uintsPerTexel;\n      const subgroupSize = data[offset];\n      const countActive = data[offset + 1];\n      const ballotedSubgroupSize = data[offset + 2];\n      const error = data[offset + 3];\n\n      if (error === 0) {\n        // Inactive fragment get error `0` instead of noError. Check all output being zero.\n        if (subgroupSize !== 0 || countActive !== 0 || ballotedSubgroupSize !== 0) {\n          return new Error(\n            `Unexpected zero error with non-zero outputs for (${row}, ${col}): got output [${subgroupSize}, ${countActive}, ${ballotedSubgroupSize}, ${error}]`\n          );\n        }\n        continue;\n      }\n\n      if (popcount(subgroupSize) !== 1) {\n        return new Error(`Subgroup size '${subgroupSize}' is not a power of two`);\n      }\n\n      if (subgroupSize < min) {\n        return new Error(`Subgroup size '${subgroupSize}' is less than minimum '${min}'`);\n      }\n      if (max < subgroupSize) {\n        return new Error(`Subgroup size '${subgroupSize}' is greater than maximum '${max}'`);\n      }\n\n      if (subgroupSize < countActive) {\n        return new Error(`Unexpected active invocations number larger than subgroup size\n-       icoord: (${row}, ${col})\n- subgroupSize: ${subgroupSize}\n-  countActive: ${countActive}`);\n      }\n\n      if (subgroupSize !== ballotedSubgroupSize) {\n        return new Error(`Inconsistent subgroup size\n-                 icoord: (${row}, ${col})\n-           subgroupSize: ${subgroupSize}\n- balloted subgroup size: ${ballotedSubgroupSize}`);\n      }\n\n      if (error !== kSubgroupShaderNoError) {\n        return new Error(\n          `Unexpected error value\n-   icoord: (${row}, ${col})\n- expected: noError (${kSubgroupShaderNoError})\n-      got: ${error}`\n        );\n      }\n    }\n  }\n\n  return undefined;\n}\n\ng.test('subgroup_size')\n  .desc('Tests subgroup_size values')\n  .params(u =>\n    u\n      .combine('size', kSizes)\n      .beginSubcases()\n      .combineWithParams([{ format: 'rgba32uint' }] as const)\n  )\n  .fn(async t => {\n    t.skipIfDeviceDoesNotHaveFeature('subgroups' as GPUFeatureName);\n    interface SubgroupProperties extends GPUAdapterInfo {\n      subgroupMinSize: number;\n      subgroupMaxSize: number;\n    }\n    const { subgroupMinSize, subgroupMaxSize } = t.device.adapterInfo as SubgroupProperties;\n\n    const fsShader = `\nenable subgroups;\n\nconst subgroupMaxSize = ${kMaximumSubgroupSize}u;\nconst noError = ${kSubgroupShaderNoError}u;\n\nconst width = ${t.params.size[0]};\nconst height = ${t.params.size[1]};\n\n@fragment\nfn fsMain(\n  @builtin(position) pos : vec4f,\n  @builtin(subgroup_size) sg_size : u32,\n) -> @location(0) vec4u {\n  var error: u32 = noError;\n\n  let ballotActive = countOneBits(subgroupBallot(true));\n  let countActive = ballotActive.x + ballotActive.y + ballotActive.z + ballotActive.w;\n  // Validate that balloted active invocations number no larger than subgroup size\n  if (countActive > sg_size) {\n    error++;\n  }\n\n  var subgroupSizeBallotedInvocations: u32 = 0u;\n  var ballotedSubgroupSize: u32 = 0u;\n  for (var i: u32 = 0; i <= subgroupMaxSize; i++) {\n    let ballotSubgroupSizeEqualI = countOneBits(subgroupBallot(sg_size == i));\n    let countSubgroupSizeEqualI = ballotSubgroupSizeEqualI.x + ballotSubgroupSizeEqualI.y + ballotSubgroupSizeEqualI.z + ballotSubgroupSizeEqualI.w;\n    subgroupSizeBallotedInvocations += countSubgroupSizeEqualI;\n    // Validate that all active invocations see the same subgroup size, i.e. ballotedSubgroupSize\n    ballotedSubgroupSize = select(ballotedSubgroupSize, i, countSubgroupSizeEqualI == countActive);\n    error = select(error, error + 1, countSubgroupSizeEqualI != countActive && countSubgroupSizeEqualI != 0);\n  }\n  // Validate that all active invocations balloted in previous loop\n  if (subgroupSizeBallotedInvocations != countActive) {\n    error++;\n  }\n  // Validate that ballotedSubgroupSize is identical to subgroup_size\n  if (ballotedSubgroupSize != sg_size) {\n    error++;\n  }\n\n  return vec4u(sg_size, countActive, ballotedSubgroupSize, error);\n}`;\n\n    await runSubgroupTest(\n      t,\n      t.params.format,\n      fsShader,\n      t.params.size[0],\n      t.params.size[1],\n      (data: Uint32Array) => {\n        return checkSubgroupSizeConsistency(\n          data,\n          t.params.format,\n          subgroupMinSize,\n          subgroupMaxSize,\n          t.params.size[0],\n          t.params.size[1]\n        );\n      }\n    );\n  });\n\n/**\n * Checks subgroup_invocation_id value consistency\n *\n * Very little uniformity is expected for subgroup_invocation_id.\n * This function checks that all ids are less than the subgroup size\n * (not the ballot size, since the subgroup id can be allocated to\n * inactivate invocations between active ones) and no id is repeated.\n * @param data An array of vec4u that contains (per texel):\n *             * subgroup_invocation_id\n *             * subgroup size\n *             * ballot active invocation number\n *             * error flag, should be equal to kSubgroupShaderNoError or shader found\n *               expectation failed otherwise.\n * @param format The texture format of data\n * @param width The width of the framebuffer\n * @param height The height of the framebuffer\n */\nfunction checkSubgroupInvocationIdConsistency(\n  data: Uint32Array,\n  format: GPUTextureFormat,\n  width: number,\n  height: number\n): Error | undefined {\n  const { blockWidth, blockHeight, bytesPerBlock } = getBlockInfoForTextureFormat(format);\n  const blocksPerRow = width / blockWidth;\n  const bytesPerRow = align(blocksPerRow * (bytesPerBlock ?? 1), 256);\n  const uintsPerRow = bytesPerRow / 4;\n  const uintsPerTexel = (bytesPerBlock ?? 1) / blockWidth / blockHeight / 4;\n\n  for (let row = 0; row < height; row++) {\n    for (let col = 0; col < width; col++) {\n      const offset = uintsPerRow * row + col * uintsPerTexel;\n      const id = data[offset];\n      const sgSize = data[offset + 1];\n      const ballotSize = data[offset + 2];\n      const error = data[offset + 3];\n\n      if (error === 0) {\n        // Inactive fragment get error `0` instead of noError. Check all output being zero.\n        if (id !== 0 || sgSize !== 0 || ballotSize !== 0) {\n          return new Error(\n            `Unexpected zero error with non-zero outputs for (${row}, ${col}): got output [${id}, ${sgSize}, ${ballotSize}, ${error}]`\n          );\n        }\n        continue;\n      }\n\n      if (sgSize < id) {\n        return new Error(\n          `Invocation id '${id}' is greater than subgroup size '${sgSize}' for (${row}, ${col})`\n        );\n      }\n\n      if (sgSize < ballotSize) {\n        return new Error(\n          `Ballot size '${ballotSize}' is greater than subgroup size '${sgSize}' for (${row}, ${col})`\n        );\n      }\n\n      if (error !== kSubgroupShaderNoError) {\n        return new Error(\n          `Unexpected error value\n-   icoord: (${row}, ${col})\n- expected: noError (${kSubgroupShaderNoError})\n-      got: ${error}`\n        );\n      }\n    }\n  }\n\n  return undefined;\n}\n\ng.test('subgroup_invocation_id')\n  .desc('Tests subgroup_invocation_id built-in value')\n  .params(u =>\n    u\n      .combine('size', kSizes)\n      .beginSubcases()\n      .combineWithParams([{ format: 'rgba32uint' }] as const)\n  )\n  .fn(async t => {\n    t.skipIfDeviceDoesNotHaveFeature('subgroups' as GPUFeatureName);\n    const fsShader = `\nenable subgroups;\n\nconst width = ${t.params.size[0]};\nconst height = ${t.params.size[1]};\n\nconst subgroupMaxSize = ${kMaximumSubgroupSize}u;\n// A non-zero magic number indicating no expectation error, in order to prevent the\n// false no-error result from zero-initialization.\nconst noError = ${kSubgroupShaderNoError}u;\n\n@fragment\nfn fsMain(\n  @builtin(position) pos : vec4f,\n  @builtin(subgroup_invocation_id) id : u32,\n  @builtin(subgroup_size) sg_size : u32,\n) -> @location(0) vec4u {\n\n  var error: u32 = noError;\n\n  // Validate that reported subgroup size is no larger than subgroupMaxSize\n  if (sg_size > subgroupMaxSize) {\n    error++;\n  }\n\n  // Validate that reported subgroup invocation id is smaller than subgroup size\n  if (id >= sg_size) {\n    error++;\n  }\n\n  // Validate that each subgroup id is assigned to at most one active invocation\n  // in the subgroup\n  var countAssignedId: u32 = 0u;\n  for (var i: u32 = 0; i < subgroupMaxSize; i++) {\n    let ballotIdEqualsI = countOneBits(subgroupBallot(id == i));\n    let countInvocationIdEqualsI = ballotIdEqualsI.x + ballotIdEqualsI.y + ballotIdEqualsI.z + ballotIdEqualsI.w;\n    // Validate an id assigned at most once\n    error += select(1u, 0u, countInvocationIdEqualsI <= 1);\n    // Validate id larger than subgroup size will not get balloted\n    error += select(1u, 0u, (id < sg_size) || (countInvocationIdEqualsI == 0));\n    // Sum up the assigned invocation number of each id\n    countAssignedId += countInvocationIdEqualsI;\n  }\n  // Validate that all active invocation get counted during the above loop\n  let ballotActive = countOneBits(subgroupBallot(true));\n  let activeInvocations = ballotActive.x + ballotActive.y + ballotActive.z + ballotActive.w;\n  if (activeInvocations != countAssignedId) {\n    error++;\n  }\n\n  return vec4u(id, sg_size, activeInvocations, error);\n}`;\n\n    await runSubgroupTest(\n      t,\n      t.params.format,\n      fsShader,\n      t.params.size[0],\n      t.params.size[1],\n      (data: Uint32Array) => {\n        return checkSubgroupInvocationIdConsistency(\n          data,\n          t.params.format,\n          t.params.size[0],\n          t.params.size[1]\n        );\n      }\n    );\n  });\n"],"mappings":"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"}