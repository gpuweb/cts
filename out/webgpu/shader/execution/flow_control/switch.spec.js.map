{"version":3,"file":"switch.spec.js","names":["description","makeTestGroup","AllFeaturesMaxLimitsGPUTest","runFlowControlTest","g","test","desc","params","u","combine","fn","t","f","expect_order","value","expect_not_reached"],"sources":["../../../../../src/webgpu/shader/execution/flow_control/switch.spec.ts"],"sourcesContent":["export const description = `\nFlow control tests for switch statements.\n`;\n\nimport { makeTestGroup } from '../../../../common/framework/test_group.js';\nimport { AllFeaturesMaxLimitsGPUTest } from '../../../gpu_test.js';\n\nimport { runFlowControlTest } from './harness.js';\n\nexport const g = makeTestGroup(AllFeaturesMaxLimitsGPUTest);\n\ng.test('switch')\n  .desc('Test that flow control executes the correct switch case block')\n  .params(u => u.combine('preventValueOptimizations', [true, false]))\n  .fn(t => {\n    runFlowControlTest(\n      t,\n      f => `\n  ${f.expect_order(0)}\n  switch (${f.value(1)}) {\n    case 0: {\n      ${f.expect_not_reached()}\n      break;\n    }\n    case 1: {\n      ${f.expect_order(1)}\n      break;\n    }\n    case 2: {\n      ${f.expect_not_reached()}\n      break;\n    }\n    default: {\n      ${f.expect_not_reached()}\n      break;\n    }\n  }\n  ${f.expect_order(2)}\n`\n    );\n  });\n\ng.test('switch_multiple_case')\n  .desc(\n    'Test that flow control executes the correct switch case block with multiple cases per block'\n  )\n  .params(u => u.combine('preventValueOptimizations', [true, false]))\n  .fn(t => {\n    runFlowControlTest(\n      t,\n      f => `\n  ${f.expect_order(0)}\n  switch (${f.value(2)}) {\n    case 0, 1: {\n      ${f.expect_not_reached()}\n      break;\n    }\n    case 2, 3: {\n      ${f.expect_order(1)}\n      break;\n    }\n    default: {\n      ${f.expect_not_reached()}\n      break;\n    }\n  }\n  ${f.expect_order(2)}\n`\n    );\n  });\n\ng.test('switch_multiple_case_default')\n  .desc(\n    'Test that flow control executes the correct switch case block with multiple cases per block (combined with default)'\n  )\n  .params(u => u.combine('preventValueOptimizations', [true, false]))\n  .fn(t => {\n    runFlowControlTest(\n      t,\n      f => `\n  ${f.expect_order(0)}\n  switch (${f.value(2)}) {\n    case 0, 1: {\n      ${f.expect_not_reached()}\n      break;\n    }\n    case 2, 3, default: {\n      ${f.expect_order(1)}\n      break;\n    }\n  }\n  ${f.expect_order(2)}\n  switch (${f.value(1)}) {\n    case 0, 1: {\n      ${f.expect_order(3)}\n      break;\n    }\n    case 2, 3, default: {\n      ${f.expect_not_reached()}\n      break;\n    }\n  }\n  ${f.expect_order(4)}\n`\n    );\n  });\n\ng.test('switch_default')\n  .desc('Test that flow control executes the switch default block')\n  .params(u => u.combine('preventValueOptimizations', [true, false]))\n  .fn(t => {\n    runFlowControlTest(\n      t,\n      f => `\n${f.expect_order(0)}\nswitch (${f.value(4)}) {\n  case 0: {\n    ${f.expect_not_reached()}\n    break;\n  }\n  case 1: {\n    ${f.expect_not_reached()}\n    break;\n  }\n  case 2: {\n    ${f.expect_not_reached()}\n    break;\n  }\n  default: {\n    ${f.expect_order(1)}\n    break;\n  }\n}\n${f.expect_order(2)}\n`\n    );\n  });\n\ng.test('switch_default_only')\n  .desc('Test that flow control executes the switch default block, which is the only case')\n  .params(u => u.combine('preventValueOptimizations', [true, false]))\n  .fn(t => {\n    runFlowControlTest(\n      t,\n      f => `\n${f.expect_order(0)}\nswitch (${f.value(4)}) {\ndefault: {\n  ${f.expect_order(1)}\n  break;\n}\n}\n${f.expect_order(2)}\n`\n    );\n  });\n\ng.test('switch_inside_loop_with_continue')\n  .desc('Test that flow control executes correct for a switch calling continue inside a loop')\n  .params(u => u.combine('preventValueOptimizations', [true, false]))\n  .fn(t => {\n    runFlowControlTest(\n      t,\n      f => `\n${f.expect_order(0)}\nvar i = ${f.value(0)};\nloop {\n  switch (i) {\n    case 1: {\n      ${f.expect_order(4)}\n      continue;\n    }\n    default: {\n      ${f.expect_order(1)}\n      break;\n    }\n  }\n  ${f.expect_order(2)}\n\n  continuing {\n    ${f.expect_order(3, 5)}\n    i++;\n    break if i >= 2;\n  }\n}\n${f.expect_order(6)}\n`\n    );\n  });\n"],"mappings":"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"}