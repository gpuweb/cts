{"version":3,"file":"loop.spec.js","names":["description","makeTestGroup","GPUTest","runFlowControlTest","g","test","desc","params","u","combine","fn","t","f","expect_order","value","expect_not_reached","entrypoint","extra"],"sources":["../../../../../src/webgpu/shader/execution/flow_control/loop.spec.ts"],"sourcesContent":["export const description = `\nFlow control tests for loops.\n`;\n\nimport { makeTestGroup } from '../../../../common/framework/test_group.js';\nimport { GPUTest } from '../../../gpu_test.js';\n\nimport { runFlowControlTest } from './harness.js';\n\nexport const g = makeTestGroup(GPUTest);\n\ng.test('loop_break')\n  .desc('Test that flow control exits a loop when reaching a break statement')\n  .params(u => u.combine('preventValueOptimizations', [true, false]))\n  .fn(t => {\n    runFlowControlTest(\n      t,\n      f =>\n        `\n  ${f.expect_order(0)}\n  var i = ${f.value(0)};\n  loop {\n    ${f.expect_order(1, 3, 5, 7)}\n    if i == 3 {\n      break;\n    }\n    ${f.expect_order(2, 4, 6)}\n    i++;\n  }\n  ${f.expect_order(8)}\n`\n    );\n  });\n\ng.test('loop_continue')\n  .desc('Test flow control for a loop continue statement')\n  .params(u => u.combine('preventValueOptimizations', [true, false]))\n  .fn(t => {\n    runFlowControlTest(\n      t,\n      f =>\n        `\n  ${f.expect_order(0)}\n  var i = ${f.value(0)};\n  loop {\n    ${f.expect_order(1, 3, 5, 7, 8)}\n    if i == 3 {\n      i++;\n      continue;\n      ${f.expect_not_reached()}\n    }\n    ${f.expect_order(2, 4, 6, 9)}\n    if i == 4 {\n      break;\n    }\n    i++;\n  }\n  ${f.expect_order(10)}\n`\n    );\n  });\n\ng.test('loop_continuing_basic')\n  .desc('Test basic flow control for a loop continuing block')\n  .params(u => u.combine('preventValueOptimizations', [true, false]))\n  .fn(t => {\n    runFlowControlTest(\n      t,\n      f =>\n        `\n  ${f.expect_order(0)}\n  var i = ${f.value(0)};\n  loop {\n    ${f.expect_order(1, 3, 5)}\n    i++;\n\n    continuing {\n      ${f.expect_order(2, 4, 6)}\n      break if i == 3;\n    }\n  }\n  ${f.expect_order(7)}\n`\n    );\n  });\n\ng.test('nested_loops')\n  .desc('Test flow control for a loop nested in another loop')\n  .params(u => u.combine('preventValueOptimizations', [true, false]))\n  .fn(t => {\n    runFlowControlTest(\n      t,\n      f =>\n        `\n  ${f.expect_order(0)}\n  var i = ${f.value(0)};\n  loop {\n    ${f.expect_order(1, 11, 21)}\n    if i == ${f.value(6)} {\n      ${f.expect_order(22)}\n      break;\n      ${f.expect_not_reached()}\n    }\n    ${f.expect_order(2, 12)}\n    loop {\n      i++;\n      ${f.expect_order(3, 6, 9, 13, 16, 19)}\n      if (i % ${f.value(3)}) == 0 {\n        ${f.expect_order(10, 20)}\n        break;\n        ${f.expect_not_reached()}\n      }\n      ${f.expect_order(4, 7, 14, 17)}\n      if (i & ${f.value(1)}) == 0 {\n        ${f.expect_order(8, 15)}\n        continue;\n        ${f.expect_not_reached()}\n      }\n      ${f.expect_order(5, 18)}\n    }\n  }\n  ${f.expect_order(23)}\n`\n    );\n  });\n\ng.test('loop_break_if_logical_and_condition')\n  .desc('Test flow control for a loop with a logical and break if')\n  .params(u => u.combine('preventValueOptimizations', [true, false]))\n  .fn(t => {\n    runFlowControlTest(t, f => ({\n      entrypoint: `\n  ${f.expect_order(0)}\n  var i = ${f.value(0)};\n  loop {\n    ${f.expect_order(1, 4, 7)}\n    continuing {\n      i++;\n      break if !(a(i) && b(i));\n    }\n  }\n  ${f.expect_order(9)}\n      `,\n      extra: `\nfn a(i : i32) -> bool {\n  ${f.expect_order(2, 5, 8)}\n  return i < ${f.value(3)};\n}\nfn b(i : i32) -> bool {\n  ${f.expect_order(3, 6)}\n  return i < ${f.value(5)};\n}\n      `,\n    }));\n  });\n\ng.test('loop_break_if_logical_or_condition')\n  .desc('Test flow control for a loop with a logical or break if')\n  .params(u => u.combine('preventValueOptimizations', [true, false]))\n  .fn(t => {\n    runFlowControlTest(t, f => ({\n      entrypoint: `\n  ${f.expect_order(0)}\n  var i = ${f.value(0)};\n  loop {\n    ${f.expect_order(1, 3, 6, 9)}\n    continuing {\n      i++;\n      break if !(a(i) || b(i));\n    }\n  }\n  ${f.expect_order(12)}\n      `,\n      extra: `\nfn a(i : i32) -> bool {\n  ${f.expect_order(2, 4, 7, 10)}\n  return i < ${f.value(2)};\n}\nfn b(i : i32) -> bool {\n  ${f.expect_order(5, 8, 11)}\n  return i < ${f.value(4)};\n}\n      `,\n    }));\n  });\n"],"mappings":";;GAAA,OAAO,MAAMA,WAAW,GAAI;AAC5B;AACA,CAAC,CAED,SAASC,aAAa,QAAQ,4CAA4C;AAC1E,SAASC,OAAO,QAAQ,sBAAsB;;AAE9C,SAASC,kBAAkB,QAAQ,cAAc;;AAEjD,OAAO,MAAMC,CAAC,GAAGH,aAAa,CAACC,OAAO,CAAC;;AAEvCE,CAAC,CAACC,IAAI,CAAC,YAAY,CAAC;AACjBC,IAAI,CAAC,qEAAqE,CAAC;AAC3EC,MAAM,CAAC,CAAAC,CAAC,KAAIA,CAAC,CAACC,OAAO,CAAC,2BAA2B,EAAE,CAAC,IAAI,EAAE,KAAK,CAAC,CAAC,CAAC;AAClEC,EAAE,CAAC,CAAAC,CAAC,KAAI;EACPR,kBAAkB;IAChBQ,CAAC;IACD,CAAAC,CAAC;IACE;AACT,IAAIA,CAAC,CAACC,YAAY,CAAC,CAAC,CAAE;AACtB,YAAYD,CAAC,CAACE,KAAK,CAAC,CAAC,CAAE;AACvB;AACA,MAAMF,CAAC,CAACC,YAAY,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAE;AACjC;AACA;AACA;AACA,MAAMD,CAAC,CAACC,YAAY,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAE;AAC9B;AACA;AACA,IAAID,CAAC,CAACC,YAAY,CAAC,CAAC,CAAE;AACtB;EACI,CAAC;AACH,CAAC,CAAC;;AAEJT,CAAC,CAACC,IAAI,CAAC,eAAe,CAAC;AACpBC,IAAI,CAAC,iDAAiD,CAAC;AACvDC,MAAM,CAAC,CAAAC,CAAC,KAAIA,CAAC,CAACC,OAAO,CAAC,2BAA2B,EAAE,CAAC,IAAI,EAAE,KAAK,CAAC,CAAC,CAAC;AAClEC,EAAE,CAAC,CAAAC,CAAC,KAAI;EACPR,kBAAkB;IAChBQ,CAAC;IACD,CAAAC,CAAC;IACE;AACT,IAAIA,CAAC,CAACC,YAAY,CAAC,CAAC,CAAE;AACtB,YAAYD,CAAC,CAACE,KAAK,CAAC,CAAC,CAAE;AACvB;AACA,MAAMF,CAAC,CAACC,YAAY,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAE;AACpC;AACA;AACA;AACA,QAAQD,CAAC,CAACG,kBAAkB,CAAC,CAAE;AAC/B;AACA,MAAMH,CAAC,CAACC,YAAY,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAE;AACjC;AACA;AACA;AACA;AACA;AACA,IAAID,CAAC,CAACC,YAAY,CAAC,EAAE,CAAE;AACvB;EACI,CAAC;AACH,CAAC,CAAC;;AAEJT,CAAC,CAACC,IAAI,CAAC,uBAAuB,CAAC;AAC5BC,IAAI,CAAC,qDAAqD,CAAC;AAC3DC,MAAM,CAAC,CAAAC,CAAC,KAAIA,CAAC,CAACC,OAAO,CAAC,2BAA2B,EAAE,CAAC,IAAI,EAAE,KAAK,CAAC,CAAC,CAAC;AAClEC,EAAE,CAAC,CAAAC,CAAC,KAAI;EACPR,kBAAkB;IAChBQ,CAAC;IACD,CAAAC,CAAC;IACE;AACT,IAAIA,CAAC,CAACC,YAAY,CAAC,CAAC,CAAE;AACtB,YAAYD,CAAC,CAACE,KAAK,CAAC,CAAC,CAAE;AACvB;AACA,MAAMF,CAAC,CAACC,YAAY,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAE;AAC9B;AACA;AACA;AACA,QAAQD,CAAC,CAACC,YAAY,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAE;AAChC;AACA;AACA;AACA,IAAID,CAAC,CAACC,YAAY,CAAC,CAAC,CAAE;AACtB;EACI,CAAC;AACH,CAAC,CAAC;;AAEJT,CAAC,CAACC,IAAI,CAAC,cAAc,CAAC;AACnBC,IAAI,CAAC,qDAAqD,CAAC;AAC3DC,MAAM,CAAC,CAAAC,CAAC,KAAIA,CAAC,CAACC,OAAO,CAAC,2BAA2B,EAAE,CAAC,IAAI,EAAE,KAAK,CAAC,CAAC,CAAC;AAClEC,EAAE,CAAC,CAAAC,CAAC,KAAI;EACPR,kBAAkB;IAChBQ,CAAC;IACD,CAAAC,CAAC;IACE;AACT,IAAIA,CAAC,CAACC,YAAY,CAAC,CAAC,CAAE;AACtB,YAAYD,CAAC,CAACE,KAAK,CAAC,CAAC,CAAE;AACvB;AACA,MAAMF,CAAC,CAACC,YAAY,CAAC,CAAC,EAAE,EAAE,EAAE,EAAE,CAAE;AAChC,cAAcD,CAAC,CAACE,KAAK,CAAC,CAAC,CAAE;AACzB,QAAQF,CAAC,CAACC,YAAY,CAAC,EAAE,CAAE;AAC3B;AACA,QAAQD,CAAC,CAACG,kBAAkB,CAAC,CAAE;AAC/B;AACA,MAAMH,CAAC,CAACC,YAAY,CAAC,CAAC,EAAE,EAAE,CAAE;AAC5B;AACA;AACA,QAAQD,CAAC,CAACC,YAAY,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,CAAE;AAC5C,gBAAgBD,CAAC,CAACE,KAAK,CAAC,CAAC,CAAE;AAC3B,UAAUF,CAAC,CAACC,YAAY,CAAC,EAAE,EAAE,EAAE,CAAE;AACjC;AACA,UAAUD,CAAC,CAACG,kBAAkB,CAAC,CAAE;AACjC;AACA,QAAQH,CAAC,CAACC,YAAY,CAAC,CAAC,EAAE,CAAC,EAAE,EAAE,EAAE,EAAE,CAAE;AACrC,gBAAgBD,CAAC,CAACE,KAAK,CAAC,CAAC,CAAE;AAC3B,UAAUF,CAAC,CAACC,YAAY,CAAC,CAAC,EAAE,EAAE,CAAE;AAChC;AACA,UAAUD,CAAC,CAACG,kBAAkB,CAAC,CAAE;AACjC;AACA,QAAQH,CAAC,CAACC,YAAY,CAAC,CAAC,EAAE,EAAE,CAAE;AAC9B;AACA;AACA,IAAID,CAAC,CAACC,YAAY,CAAC,EAAE,CAAE;AACvB;EACI,CAAC;AACH,CAAC,CAAC;;AAEJT,CAAC,CAACC,IAAI,CAAC,qCAAqC,CAAC;AAC1CC,IAAI,CAAC,0DAA0D,CAAC;AAChEC,MAAM,CAAC,CAAAC,CAAC,KAAIA,CAAC,CAACC,OAAO,CAAC,2BAA2B,EAAE,CAAC,IAAI,EAAE,KAAK,CAAC,CAAC,CAAC;AAClEC,EAAE,CAAC,CAAAC,CAAC,KAAI;EACPR,kBAAkB,CAACQ,CAAC,EAAE,CAAAC,CAAC,MAAK;IAC1BI,UAAU,EAAG;AACnB,IAAIJ,CAAC,CAACC,YAAY,CAAC,CAAC,CAAE;AACtB,YAAYD,CAAC,CAACE,KAAK,CAAC,CAAC,CAAE;AACvB;AACA,MAAMF,CAAC,CAACC,YAAY,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAE;AAC9B;AACA;AACA;AACA;AACA;AACA,IAAID,CAAC,CAACC,YAAY,CAAC,CAAC,CAAE;AACtB,OAAO;IACDI,KAAK,EAAG;AACd;AACA,IAAIL,CAAC,CAACC,YAAY,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAE;AAC5B,eAAeD,CAAC,CAACE,KAAK,CAAC,CAAC,CAAE;AAC1B;AACA;AACA,IAAIF,CAAC,CAACC,YAAY,CAAC,CAAC,EAAE,CAAC,CAAE;AACzB,eAAeD,CAAC,CAACE,KAAK,CAAC,CAAC,CAAE;AAC1B;AACA;EACI,CAAC,CAAC,CAAC;AACL,CAAC,CAAC;;AAEJV,CAAC,CAACC,IAAI,CAAC,oCAAoC,CAAC;AACzCC,IAAI,CAAC,yDAAyD,CAAC;AAC/DC,MAAM,CAAC,CAAAC,CAAC,KAAIA,CAAC,CAACC,OAAO,CAAC,2BAA2B,EAAE,CAAC,IAAI,EAAE,KAAK,CAAC,CAAC,CAAC;AAClEC,EAAE,CAAC,CAAAC,CAAC,KAAI;EACPR,kBAAkB,CAACQ,CAAC,EAAE,CAAAC,CAAC,MAAK;IAC1BI,UAAU,EAAG;AACnB,IAAIJ,CAAC,CAACC,YAAY,CAAC,CAAC,CAAE;AACtB,YAAYD,CAAC,CAACE,KAAK,CAAC,CAAC,CAAE;AACvB;AACA,MAAMF,CAAC,CAACC,YAAY,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAE;AACjC;AACA;AACA;AACA;AACA;AACA,IAAID,CAAC,CAACC,YAAY,CAAC,EAAE,CAAE;AACvB,OAAO;IACDI,KAAK,EAAG;AACd;AACA,IAAIL,CAAC,CAACC,YAAY,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE,CAAE;AAChC,eAAeD,CAAC,CAACE,KAAK,CAAC,CAAC,CAAE;AAC1B;AACA;AACA,IAAIF,CAAC,CAACC,YAAY,CAAC,CAAC,EAAE,CAAC,EAAE,EAAE,CAAE;AAC7B,eAAeD,CAAC,CAACE,KAAK,CAAC,CAAC,CAAE;AAC1B;AACA;EACI,CAAC,CAAC,CAAC;AACL,CAAC,CAAC"}