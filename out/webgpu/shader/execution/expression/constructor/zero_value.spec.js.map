{"version":3,"file":"zero_value.spec.js","names":["description","makeTestGroup","AllFeaturesMaxLimitsGPUTest","Type","basicExpressionBuilder","run","g","test","specURL","desc","params","u","combine","fn","t","type","skipIfDeviceDoesNotHaveFeature","ops","inputSource","input","expected","create","vec","width","constEvaluationMode","mat","columns","rows","array","length","beginSubcases","expand","member_types","map","_","i","includes","memberType","member_index","builder","nested","ty","join"],"sources":["../../../../../../src/webgpu/shader/execution/expression/constructor/zero_value.spec.ts"],"sourcesContent":["export const description = `\nExecution Tests for zero value constructors\n`;\n\nimport { makeTestGroup } from '../../../../../common/framework/test_group.js';\nimport { AllFeaturesMaxLimitsGPUTest } from '../../../../gpu_test.js';\nimport { ScalarKind, Type } from '../../../../util/conversion.js';\nimport { ShaderBuilderParams, basicExpressionBuilder, run } from '../expression.js';\n\nexport const g = makeTestGroup(AllFeaturesMaxLimitsGPUTest);\n\ng.test('scalar')\n  .specURL('https://www.w3.org/TR/WGSL/#zero-value-builtin-function')\n  .desc(`Test that a zero value scalar constructor produces the expected zero value`)\n  .params(u => u.combine('type', ['bool', 'i32', 'u32', 'f32', 'f16'] as const))\n  .fn(async t => {\n    if (t.params.type === 'f16') {\n      t.skipIfDeviceDoesNotHaveFeature('shader-f16');\n    }\n    const type = Type[t.params.type];\n    await run(\n      t,\n      basicExpressionBuilder(ops => `${type}()`),\n      [],\n      type,\n      { inputSource: 'const' },\n      [{ input: [], expected: type.create(0) }]\n    );\n  });\n\ng.test('vector')\n  .specURL('https://www.w3.org/TR/WGSL/#zero-value-builtin-function')\n  .desc(`Test that a zero value vector constructor produces the expected zero value`)\n  .params(u =>\n    u\n      .combine('type', ['bool', 'i32', 'u32', 'f32', 'f16'] as const)\n      .combine('width', [2, 3, 4] as const)\n  )\n  .fn(async t => {\n    if (t.params.type === 'f16') {\n      t.skipIfDeviceDoesNotHaveFeature('shader-f16');\n    }\n    const type = Type.vec(t.params.width, Type[t.params.type]);\n    await run(\n      t,\n      basicExpressionBuilder(ops => `${type}()`),\n      [],\n      type,\n      { inputSource: 'const' },\n      [{ input: [], expected: type.create(0) }]\n    );\n  });\n\ng.test('vector_prefix')\n  .desc(`Test that a zero value vector constructor produces the expected zero value`)\n  .params(u =>\n    u.combine('type', ['i32', 'u32', 'f32', 'f16'] as const).combine('width', [2, 3, 4] as const)\n  )\n  .fn(async t => {\n    if (t.params.type === 'f16') {\n      t.skipIfDeviceDoesNotHaveFeature('shader-f16');\n    }\n    const type = Type.vec(t.params.width, Type[t.params.type]);\n    await run(\n      t,\n      basicExpressionBuilder(ops => `vec${t.params.width}()`),\n      [],\n      type,\n      { inputSource: 'const', constEvaluationMode: 'direct' },\n      [{ input: [], expected: type.create(0) }]\n    );\n  });\n\ng.test('matrix')\n  .specURL('https://www.w3.org/TR/WGSL/#zero-value-builtin-function')\n  .desc(`Test that a zero value matrix constructor produces the expected zero value`)\n  .params(u =>\n    u\n      .combine('type', ['f32', 'f16'] as const)\n      .combine('columns', [2, 3, 4] as const)\n      .combine('rows', [2, 3, 4] as const)\n  )\n  .fn(async t => {\n    if (t.params.type === 'f16') {\n      t.skipIfDeviceDoesNotHaveFeature('shader-f16');\n    }\n    const type = Type.mat(t.params.columns, t.params.rows, Type[t.params.type]);\n    await run(\n      t,\n      basicExpressionBuilder(ops => `${type}()`),\n      [],\n      type,\n      { inputSource: 'const' },\n      [{ input: [], expected: type.create(0) }]\n    );\n  });\n\ng.test('array')\n  .specURL('https://www.w3.org/TR/WGSL/#zero-value-builtin-function')\n  .desc(`Test that a zero value matrix constructor produces the expected zero value`)\n  .params(u =>\n    u\n      .combine('type', ['bool', 'i32', 'u32', 'f32', 'f16', 'vec3f', 'vec4i'] as const)\n      .combine('length', [1, 5, 10] as const)\n  )\n  .fn(async t => {\n    if (t.params.type === 'f16') {\n      t.skipIfDeviceDoesNotHaveFeature('shader-f16');\n    }\n    const type = Type.array(t.params.length, Type[t.params.type]);\n    await run(\n      t,\n      basicExpressionBuilder(ops => `${type}()`),\n      [],\n      type,\n      { inputSource: 'const' },\n      [{ input: [], expected: type.create(0) }]\n    );\n  });\n\ng.test('structure')\n  .specURL('https://www.w3.org/TR/WGSL/#zero-value-builtin-function')\n  .desc(`Test that an structure constructed from element values produces the expected value`)\n  .params(u =>\n    u\n      .combine('member_types', [\n        ['bool'],\n        ['u32'],\n        ['vec3f'],\n        ['i32', 'u32'],\n        ['i32', 'f16', 'vec4i', 'mat3x2f'],\n        ['bool', 'u32', 'f16', 'vec3f', 'vec2i'],\n        ['i32', 'u32', 'f32', 'f16', 'vec3f', 'vec4i'],\n      ] as readonly ScalarKind[][])\n      .combine('nested', [false, true])\n      .beginSubcases()\n      .expand('member_index', t => t.member_types.map((_, i) => i))\n  )\n  .fn(async t => {\n    if (t.params.member_types.includes('f16')) {\n      t.skipIfDeviceDoesNotHaveFeature('shader-f16');\n    }\n    const memberType = Type[t.params.member_types[t.params.member_index]];\n    const builder = basicExpressionBuilder(_ =>\n      t.params.nested\n        ? `OuterStruct().inner.member_${t.params.member_index}`\n        : `MyStruct().member_${t.params.member_index}`\n    );\n    await run(\n      t,\n      (params: ShaderBuilderParams) => {\n        return `\n${t.params.member_types.includes('f16') ? 'enable f16;' : ''}\n\n${builder(params)}\n\nstruct MyStruct {\n${t.params.member_types.map((ty, i) => `  member_${i} : ${ty},`).join('\\n')}\n};\nstruct OuterStruct {\n  pre : i32,\n  inner : MyStruct,\n  post : i32,\n};\n`;\n      },\n      [],\n      memberType,\n      { inputSource: 'const' },\n      [{ input: [], expected: memberType.create(0) }]\n    );\n  });\n"],"mappings":"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"}