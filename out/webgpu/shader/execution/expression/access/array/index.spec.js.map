{"version":3,"file":"index.spec.js","names":["description","makeTestGroup","AllFeaturesMaxLimitsGPUTest","False","True","Type","array","f32","scalarTypeOf","align","allInputSources","basicExpressionBuilder","run","g","test","specURL","desc","params","u","combine","fn","t","elementType","skipIfDeviceDoesNotHaveFeature","inputSource","skipIfLanguageFeatureNotSupported","indexType","cases","input","create","expected","ops","bool","valueArrayType","indexArrayType","kind","wgsl","pipeline","device","createComputePipeline","layout","compute","module","createShaderModule","code","entryPoint","values","indices","inputValues","map","i","inputIndices","bufferSize","arr","offset","alignment","value","Math","max","type","size","toArray","Uint8Array","copyTo","inputArrayBuffer","makeBufferWithContents","GPUBufferUsage","STORAGE","inputIndexBuffer","outputBuffer","createBufferTracked","usage","COPY_SRC","bindGroup","createBindGroup","getBindGroupLayout","entries","binding","resource","buffer","encoder","createCommandEncoder","pass","beginComputePass","setPipeline","setBindGroup","dispatchWorkgroups","end","queue","submit","finish","expectGPUBufferValuesEqual","expand","_","beginSubcases","filter","mat","columns","rows","hasLanguageFeature","skipIf","matrixType","buildMat","index","elements","c","r","push","matrices"],"sources":["../../../../../../../src/webgpu/shader/execution/expression/access/array/index.spec.ts"],"sourcesContent":["export const description = `\nExecution Tests for array indexing expressions\n`;\n\nimport { makeTestGroup } from '../../../../../../common/framework/test_group.js';\nimport { AllFeaturesMaxLimitsGPUTest } from '../../../../../gpu_test.js';\nimport {\n  False,\n  True,\n  Type,\n  Value,\n  array,\n  f32,\n  scalarTypeOf,\n} from '../../../../../util/conversion.js';\nimport { align } from '../../../../../util/math.js';\nimport { Case } from '../../case.js';\nimport { allInputSources, basicExpressionBuilder, run } from '../../expression.js';\n\nexport const g = makeTestGroup(AllFeaturesMaxLimitsGPUTest);\n\ng.test('concrete_scalar')\n  .specURL('https://www.w3.org/TR/WGSL/#array-access-expr')\n  .desc(`Test indexing of an array of concrete scalars`)\n  .params(u =>\n    u\n      .combine('inputSource', allInputSources)\n      .combine('elementType', ['i32', 'u32', 'f32', 'f16'] as const)\n      .combine('indexType', ['i32', 'u32'] as const)\n  )\n  .fn(async t => {\n    if (t.params.elementType === 'f16') {\n      t.skipIfDeviceDoesNotHaveFeature('shader-f16');\n    }\n    if (t.params.inputSource === 'uniform') {\n      // 'uniform' address space requires array stride to be multiple of 16 bytes without this language feature.\n      t.skipIfLanguageFeatureNotSupported('uniform_buffer_standard_layout');\n    }\n    const elementType = Type[t.params.elementType];\n    const indexType = Type[t.params.indexType];\n    const cases: Case[] = [\n      {\n        input: [\n          array(\n            /* 0 */ elementType.create(10),\n            /* 1 */ elementType.create(11),\n            /* 2 */ elementType.create(12)\n          ),\n          indexType.create(0),\n        ],\n        expected: elementType.create(10),\n      },\n      {\n        input: [\n          array(\n            /* 0 */ elementType.create(20),\n            /* 1 */ elementType.create(21),\n            /* 2 */ elementType.create(22)\n          ),\n          indexType.create(1),\n        ],\n        expected: elementType.create(21),\n      },\n      {\n        input: [\n          array(\n            /* 0 */ elementType.create(30),\n            /* 1 */ elementType.create(31),\n            /* 2 */ elementType.create(32)\n          ),\n          indexType.create(2),\n        ],\n        expected: elementType.create(32),\n      },\n    ];\n    await run(\n      t,\n      basicExpressionBuilder(ops => `${ops[0]}[${ops[1]}]`),\n      [Type.array(3, elementType), indexType],\n      elementType,\n      t.params,\n      cases\n    );\n  });\n\ng.test('bool')\n  .specURL('https://www.w3.org/TR/WGSL/#array-access-expr')\n  .desc(`Test indexing of an array of booleans`)\n  .params(u =>\n    u.combine('inputSource', allInputSources).combine('indexType', ['i32', 'u32'] as const)\n  )\n  .fn(async t => {\n    if (t.params.inputSource === 'uniform') {\n      // 'uniform' address space requires array stride to be multiple of 16 bytes without this language feature.\n      t.skipIfLanguageFeatureNotSupported('uniform_buffer_standard_layout');\n    }\n\n    const indexType = Type[t.params.indexType];\n    const cases: Case[] = [\n      {\n        input: [array(True, False, True), indexType.create(0)],\n        expected: True,\n      },\n      {\n        input: [array(True, False, True), indexType.create(1)],\n        expected: False,\n      },\n      {\n        input: [array(True, False, True), indexType.create(2)],\n        expected: True,\n      },\n    ];\n    await run(\n      t,\n      basicExpressionBuilder(ops => `${ops[0]}[${ops[1]}]`),\n      [Type.array(3, Type.bool), indexType],\n      Type.bool,\n      t.params,\n      cases\n    );\n  });\n\ng.test('abstract_scalar')\n  .specURL('https://www.w3.org/TR/WGSL/#array-access-expr')\n  .desc(`Test indexing of an array of scalars`)\n  .params(u =>\n    u\n      .combine('elementType', ['abstract-int', 'abstract-float'] as const)\n      .combine('indexType', ['i32', 'u32'] as const)\n  )\n  .fn(async t => {\n    const elementType = Type[t.params.elementType];\n    const indexType = Type[t.params.indexType];\n    const cases: Case[] = [\n      {\n        input: [\n          array(\n            /* 0 */ elementType.create(0x10_00000000),\n            /* 1 */ elementType.create(0x11_00000000),\n            /* 2 */ elementType.create(0x12_00000000)\n          ),\n          indexType.create(0),\n        ],\n        expected: f32(0x10),\n      },\n      {\n        input: [\n          array(\n            /* 0 */ elementType.create(0x20_00000000),\n            /* 1 */ elementType.create(0x21_00000000),\n            /* 2 */ elementType.create(0x22_00000000)\n          ),\n          indexType.create(1),\n        ],\n        expected: f32(0x21),\n      },\n      {\n        input: [\n          array(\n            /* 0 */ elementType.create(0x30_00000000),\n            /* 1 */ elementType.create(0x31_00000000),\n            /* 2 */ elementType.create(0x32_00000000)\n          ),\n          indexType.create(2),\n        ],\n        expected: f32(0x32),\n      },\n    ];\n    await run(\n      t,\n      basicExpressionBuilder(ops => `${ops[0]}[${ops[1]}] / 0x100000000`),\n      [Type.array(3, elementType), indexType],\n      Type.f32,\n      { inputSource: 'const' },\n      cases\n    );\n  });\n\ng.test('runtime_sized')\n  .specURL('https://www.w3.org/TR/WGSL/#array-access-expr')\n  .desc(`Test indexing of a runtime sized array`)\n  .params(u =>\n    u\n      .combine('elementType', [\n        'i32',\n        'u32',\n        'f32',\n        'f16',\n        'vec4i',\n        'vec2u',\n        'vec3f',\n        'vec2h',\n      ] as const)\n      .combine('indexType', ['i32', 'u32'] as const)\n  )\n  .fn(t => {\n    const elementType = Type[t.params.elementType];\n    const valueArrayType = Type.array(0, elementType);\n    const indexType = Type[t.params.indexType];\n    const indexArrayType = Type.array(0, indexType);\n\n    if (scalarTypeOf(elementType).kind === 'f16') {\n      t.skipIfDeviceDoesNotHaveFeature('shader-f16');\n    }\n\n    const wgsl = `\n${scalarTypeOf(elementType).kind === 'f16' ? 'enable f16;' : ''}\n\n@group(0) @binding(0) var<storage, read> input_values : ${valueArrayType};\n@group(0) @binding(1) var<storage, read> input_indices : ${indexArrayType};\n@group(0) @binding(2) var<storage, read_write> output : ${valueArrayType};\n\n@compute @workgroup_size(16)\nfn main(@builtin(local_invocation_index) invocation_id : u32) {\n  let index = input_indices[invocation_id];\n  output[invocation_id] = input_values[index];\n}\n`;\n\n    const pipeline = t.device.createComputePipeline({\n      layout: 'auto',\n      compute: {\n        module: t.device.createShaderModule({ code: wgsl }),\n        entryPoint: 'main',\n      },\n    });\n\n    const values = [2, 3, 5, 7, 11, 13, 17, 19, 23, 29, 31, 37, 41, 43, 47, 53];\n    const indices = [9, 0, 14, 10, 12, 4, 15, 3, 5, 6, 11, 2, 8, 13, 7, 1];\n\n    const inputValues = values.map(i => elementType.create(i));\n    const inputIndices = indices.map(i => indexType.create(i));\n    const expected = indices.map(i => inputValues[i]);\n\n    const bufferSize = (arr: Value[]) => {\n      let offset = 0;\n      let alignment = 0;\n      for (const value of arr) {\n        alignment = Math.max(alignment, value.type.alignment);\n        offset = align(offset, value.type.alignment) + value.type.size;\n      }\n      return align(offset, alignment);\n    };\n\n    const toArray = (arr: Value[]) => {\n      const array = new Uint8Array(bufferSize(arr));\n      let offset = 0;\n      for (const value of arr) {\n        offset = align(offset, value.type.alignment);\n        value.copyTo(array, offset);\n        offset += value.type.size;\n      }\n      return array;\n    };\n\n    const inputArrayBuffer = t.makeBufferWithContents(toArray(inputValues), GPUBufferUsage.STORAGE);\n    const inputIndexBuffer = t.makeBufferWithContents(\n      toArray(inputIndices),\n      GPUBufferUsage.STORAGE\n    );\n    const outputBuffer = t.createBufferTracked({\n      size: bufferSize(expected),\n      usage: GPUBufferUsage.STORAGE | GPUBufferUsage.COPY_SRC,\n    });\n\n    const bindGroup = t.device.createBindGroup({\n      layout: pipeline.getBindGroupLayout(0),\n      entries: [\n        { binding: 0, resource: { buffer: inputArrayBuffer } },\n        { binding: 1, resource: { buffer: inputIndexBuffer } },\n        { binding: 2, resource: { buffer: outputBuffer } },\n      ],\n    });\n\n    const encoder = t.device.createCommandEncoder();\n    const pass = encoder.beginComputePass();\n    pass.setPipeline(pipeline);\n    pass.setBindGroup(0, bindGroup);\n    pass.dispatchWorkgroups(1);\n    pass.end();\n    t.queue.submit([encoder.finish()]);\n\n    t.expectGPUBufferValuesEqual(outputBuffer, toArray(expected));\n  });\n\ng.test('vector')\n  .specURL('https://www.w3.org/TR/WGSL/#array-access-expr')\n  .desc(`Test indexing of an array of vectors`)\n  .params(u =>\n    u\n      .combine('inputSource', allInputSources)\n      .expand('elementType', _ => ['vec4i', 'vec4u', 'vec4f', 'vec4h'] as const)\n      .combine('indexType', ['i32', 'u32'] as const)\n  )\n  .fn(async t => {\n    if (t.params.elementType === 'vec4h') {\n      t.skipIfDeviceDoesNotHaveFeature('shader-f16');\n      if (t.params.inputSource === 'uniform') {\n        // 'uniform' address space requires array stride to be multiple of 16 bytes without this language feature.\n        t.skipIfLanguageFeatureNotSupported('uniform_buffer_standard_layout');\n      }\n    }\n    const elementType = Type[t.params.elementType];\n    const indexType = Type[t.params.indexType];\n\n    const cases: Case[] = [\n      {\n        input: [\n          array(\n            /* 0 */ elementType.create([0x10, 0x11, 0x12, 0x13]),\n            /* 1 */ elementType.create([0x14, 0x15, 0x16, 0x17]),\n            /* 2 */ elementType.create([0x18, 0x19, 0x1a, 0x1b])\n          ),\n          indexType.create(0),\n        ],\n        expected: elementType.create([0x10, 0x11, 0x12, 0x13]),\n      },\n      {\n        input: [\n          array(\n            /* 0 */ elementType.create([0x20, 0x21, 0x22, 0x23]),\n            /* 1 */ elementType.create([0x24, 0x25, 0x26, 0x27]),\n            /* 2 */ elementType.create([0x28, 0x29, 0x2a, 0x2b])\n          ),\n          indexType.create(1),\n        ],\n        expected: elementType.create([0x24, 0x25, 0x26, 0x27]),\n      },\n      {\n        input: [\n          array(\n            /* 0 */ elementType.create([0x30, 0x31, 0x32, 0x33]),\n            /* 1 */ elementType.create([0x34, 0x35, 0x36, 0x37]),\n            /* 2 */ elementType.create([0x38, 0x39, 0x3a, 0x3b])\n          ),\n          indexType.create(2),\n        ],\n        expected: elementType.create([0x38, 0x39, 0x3a, 0x3b]),\n      },\n    ];\n    await run(\n      t,\n      basicExpressionBuilder(ops => `${ops[0]}[${ops[1]}]`),\n      [Type.array(3, elementType), indexType],\n      elementType,\n      t.params,\n      cases\n    );\n  });\n\ng.test('matrix')\n  .specURL('https://www.w3.org/TR/WGSL/#array-access-expr')\n  .desc(`Test indexing of an array of matrices`)\n  .params(u =>\n    u\n      .combine('inputSource', allInputSources)\n      .combine('elementType', ['f16', 'f32'] as const)\n      .beginSubcases()\n      .combine('columns', [2, 3, 4] as const)\n      .combine('rows', [2, 3, 4] as const)\n      .combine('indexType', ['i32', 'u32'] as const)\n      .filter(u => {\n        if (u.inputSource !== 'uniform') {\n          return true;\n        }\n        const mat = Type.mat(u.columns, u.rows, Type[u.elementType]);\n        return (align(mat.size, mat.alignment) & 15) === 0;\n      })\n  )\n  .fn(async t => {\n    if (t.params.elementType === 'f16') {\n      t.skipIfDeviceDoesNotHaveFeature('shader-f16');\n    }\n    if (\n      t.params.inputSource === 'uniform' &&\n      !t.hasLanguageFeature('uniform_buffer_standard_layout')\n    ) {\n      // 'uniform' address space requires array stride to be multiple of 16 bytes without this language feature.\n      const mat = Type.mat(t.params.columns, t.params.rows, Type[t.params.elementType]);\n      t.skipIf((align(mat.size, mat.alignment) & 15) !== 0);\n    }\n    const elementType = Type[t.params.elementType];\n    const indexType = Type[t.params.indexType];\n    const matrixType = Type.mat(t.params.columns, t.params.rows, elementType);\n    const buildMat = (index: number) => {\n      const elements = [];\n      for (let c = 0; c < t.params.rows; c++) {\n        for (let r = 0; r < t.params.columns; r++) {\n          elements.push(index * 100 + c * 10 + r);\n        }\n      }\n      return matrixType.create(elements);\n    };\n    const matrices = [buildMat(0), buildMat(1), buildMat(2)];\n    await run(\n      t,\n      basicExpressionBuilder(ops => `${ops[0]}[${ops[1]}]`),\n      [Type.array(3, matrixType), indexType],\n      matrixType,\n      t.params,\n      [\n        {\n          input: [array(...matrices), indexType.create(1)],\n          expected: matrices[1],\n        },\n      ]\n    );\n  });\n"],"mappings":"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"}