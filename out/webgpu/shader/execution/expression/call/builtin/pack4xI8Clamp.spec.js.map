{"version":3,"file":"pack4xI8Clamp.spec.js","names":["description","makeTestGroup","GPUTest","u32","toVector","i32","Type","clamp","allInputSources","run","builtin","g","test","specURL","desc","params","u","combine","fn","t","cfg","pack4xI8Clamp","vals","result","Uint32Array","i","clampedValue","min","max","testInputs","makeCase","input","expected","cases","flatMap","v","vec4i"],"sources":["../../../../../../../src/webgpu/shader/execution/expression/call/builtin/pack4xI8Clamp.spec.ts"],"sourcesContent":["export const description = `\nExecution tests for the 'pack4xI8Clamp' builtin function\n\n@const fn pack4xI8Clamp(e: vec4<i32>) -> u32\nClamp each component of e in the range [-128, 127] and then pack the lower 8 bits of each component\ninto a u32 value. Component e[i] of the input is mapped to bits (8 * i) through (8 * (i + 7)) of the\nresult.\n`;\n\nimport { makeTestGroup } from '../../../../../../common/framework/test_group.js';\nimport { GPUTest } from '../../../../../gpu_test.js';\nimport { u32, toVector, i32, Type } from '../../../../../util/conversion.js';\nimport { clamp } from '../../../../../util/math.js';\nimport { Case } from '../../case.js';\nimport { allInputSources, Config, run } from '../../expression.js';\n\nimport { builtin } from './builtin.js';\n\nexport const g = makeTestGroup(GPUTest);\n\ng.test('basic')\n  .specURL('https://www.w3.org/TR/WGSL/#pack4xI8Clamp-builtin')\n  .desc(\n    `\n@const fn pack4xI8Clamp(e: vec4<i32>) -> u32\n  `\n  )\n  .params(u => u.combine('inputSource', allInputSources))\n  .fn(async t => {\n    const cfg: Config = t.params;\n\n    const pack4xI8Clamp = (vals: readonly [number, number, number, number]) => {\n      const result = new Uint32Array(1);\n      for (let i = 0; i < 4; ++i) {\n        const clampedValue = clamp(vals[i], { min: -128, max: 127 });\n        result[0] |= (clampedValue & 0xff) << (i * 8);\n      }\n      return result[0];\n    };\n\n    const testInputs = [\n      [0, 0, 0, 0],\n      [1, 2, 3, 4],\n      [-1, 2, 3, 4],\n      [1, -2, 3, 4],\n      [1, 2, -3, 4],\n      [1, 2, 3, -4],\n      [-1, -2, 3, 4],\n      [-1, 2, -3, 4],\n      [-1, 2, 3, -4],\n      [1, -2, -3, 4],\n      [1, -2, 3, -4],\n      [1, 2, -3, -4],\n      [-1, -2, -3, 4],\n      [-1, -2, 3, -4],\n      [-1, 2, -3, -4],\n      [1, -2, -3, -4],\n      [-1, -2, -3, -4],\n      [126, 127, 128, 129],\n      [-130, -129, -128, -127],\n      [127, 128, -128, -129],\n      [32767, 32768, -32768, -32769],\n    ] as const;\n\n    const makeCase = (vals: readonly [number, number, number, number]): Case => {\n      return { input: [toVector(vals, i32)], expected: u32(pack4xI8Clamp(vals)) };\n    };\n    const cases: Array<Case> = testInputs.flatMap(v => {\n      return [makeCase(v)];\n    });\n\n    await run(t, builtin('pack4xI8Clamp'), [Type.vec4i], Type.u32, cfg, cases);\n  });\n"],"mappings":"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"}