{"version":3,"file":"subgroupMinMax.spec.js","names":["description","makeTestGroup","keysOf","objectsToRecord","assert","iterRange","kValue","kConcreteNumericScalarsAndVectors","VectorType","FP","PRNG","kNumCases","kStride","kWGSizes","kPredicateCases","runAccuracyTest","runComputeTest","generateTypedInputs","getUintsPerFramebuffer","kFramebufferSizes","runFragmentTest","SubgroupTest","g","kDataTypes","kOps","identity","op","type","f16","positive","max","f32","negative","min","interval","minInterval","maxInterval","test","desc","params","u","combine","x","beforeAllSubcases","t","features","push","selectDeviceOrSkipTestCase","fn","case","wgSize","checkDataTypes","metadata","output","requiresF16","expected","expectF16","i","index","Math","floor","shift","res","Error","toString","uints","width","j","expect","undefined","beginSubcases","enables","wgsl","idx2","idx1","idx1Id","inputData","uintsPerOutput","generateInputData","seed","num","prng","Uint32Array","uniformInt","checkCompute","input","numInvs","filter","func","Map","id","subgroup_id","size","e","get","set","kNumRandomCases","wgThreads","testcase","predicate","cond","checkFragment","data","format","height","uintsPerRow","uintsPerTexel","inBounds","row","col","offset","ok","anyInBounds","_","value","Boolean","subgroupInBounds","v","expected_v","combineWithParams","numInputs","subgroupMinSize","device","adapterInfo","innerTexels","skipIf","fsShader","length"],"sources":["../../../../../../../src/webgpu/shader/execution/expression/call/builtin/subgroupMinMax.spec.ts"],"sourcesContent":["export const description = `\nExecution tests for subgroupMin and subgroupMax.\n\nNote: There is a lack of portability for non-uniform execution so these tests\nrestrict themselves to uniform control flow.\nNote: There is no guaranteed mapping between subgroup_invocation_id and\nlocal_invocation_index. Tests should avoid assuming there is.\n`;\n\nimport { makeTestGroup } from '../../../../../../common/framework/test_group.js';\nimport { keysOf, objectsToRecord } from '../../../../../../common/util/data_tables.js';\nimport { assert, iterRange } from '../../../../../../common/util/util.js';\nimport { kValue } from '../../../../../util/constants.js';\nimport {\n  kConcreteNumericScalarsAndVectors,\n  Type,\n  VectorType,\n} from '../../../../../util/conversion.js';\nimport { FP, FPInterval } from '../../../../../util/floating_point.js';\nimport { PRNG } from '../../../../../util/prng.js';\n\nimport {\n  kNumCases,\n  kStride,\n  kWGSizes,\n  kPredicateCases,\n  runAccuracyTest,\n  runComputeTest,\n  generateTypedInputs,\n  getUintsPerFramebuffer,\n  kFramebufferSizes,\n  runFragmentTest,\n  SubgroupTest,\n} from './subgroup_util.js';\n\nexport const g = makeTestGroup(SubgroupTest);\n\nconst kDataTypes = objectsToRecord(kConcreteNumericScalarsAndVectors);\n\ntype Op = 'subgroupMin' | 'subgroupMax';\n\nconst kOps: Op[] = ['subgroupMin', 'subgroupMax'];\n\n/**\n * Returns an identity value for the given operation and type.\n *\n * This function should use positive or negative infinity for min and max\n * identities respectively, but implementations may assume infinities are not\n * present so max value is used instead.\n * @param op Min or max\n * @param type The type (f16 or f32)\n */\nfunction identity(op: Op, type: string): number {\n  assert(type === 'f16' || type === 'f32');\n  if (op === 'subgroupMin') {\n    return type === 'f16' ? kValue.f16.positive.max : kValue.f32.positive.max;\n  } else {\n    return type === 'f16' ? kValue.f16.negative.min : kValue.f32.negative.min;\n  }\n}\n\n/**\n * Returns the interval generator for the given operation and type.\n *\n * @param op Min or max\n * @param type The type (f16 or f32)\n */\nfunction interval(\n  op: Op,\n  type: string\n): (x: number | FPInterval, y: number | FPInterval) => FPInterval {\n  assert(type === 'f16' || type === 'f32');\n  if (op === 'subgroupMin') {\n    return type === 'f16' ? FP.f16.minInterval : FP.f32.minInterval;\n  } else {\n    return type === 'f16' ? FP.f16.maxInterval : FP.f32.maxInterval;\n  }\n}\n\ng.test('fp_accuracy')\n  .desc(\n    `Tests the accuracy of floating-point addition.\n\nThe order of operations is implementation defined, most threads are filled with\nthe identity value and two receive random values.\nSubgroup sizes are not known ahead of time so some cases may not perform any\ninteresting operations. The test biases towards checking subgroup sizes under 64.\nThese tests only check two values in order to reuse more of the existing infrastructure\nand limit the number of permutations needed to calculate the final result.`\n  )\n  .params(u =>\n    u\n      .combine('case', [...iterRange(kNumCases, x => x)])\n      .combine('type', ['f32', 'f16'] as const)\n      .combine('op', kOps)\n      .combine('wgSize', [\n        [kStride, 1, 1],\n        [kStride / 2, 2, 1],\n      ] as const)\n  )\n  .beforeAllSubcases(t => {\n    const features: GPUFeatureName[] = ['subgroups' as GPUFeatureName];\n    if (t.params.type === 'f16') {\n      features.push('shader-f16');\n    }\n    t.selectDeviceOrSkipTestCase(features);\n  })\n  .fn(async t => {\n    await runAccuracyTest(\n      t,\n      t.params.case,\n      [t.params.wgSize[0], t.params.wgSize[1], t.params.wgSize[2]],\n      t.params.op,\n      t.params.type,\n      identity(t.params.op, t.params.type),\n      interval(t.params.op, t.params.type)\n    );\n  });\n\n/**\n * Checks the results of subgroupMin and subgroupMax for allowed data types.\n *\n * The shader performs a subgroup operation and equivalent single invocation\n * operation and the results are compared. Since the subgroup operation is a\n * reduction all invocations should have the same expected result.\n * @param metadata The expected reduction results\n * @param output The subgroup operation outputs\n * @param type The data type\n */\nfunction checkDataTypes(metadata: Uint32Array, output: Uint32Array, type: Type): Error | undefined {\n  if (type.requiresF16() && !(type instanceof VectorType)) {\n    const expected = metadata[0];\n    const expectF16 = expected & 0xffff;\n    for (let i = 0; i < 4; i++) {\n      const index = Math.floor(i / 2);\n      const shift = i % 2 === 1;\n      let res = output[index];\n      if (shift) {\n        res >>= 16;\n      }\n      res &= 0xffff;\n\n      if (res !== expectF16) {\n        return new Error(`Invocation ${i}: incorrect results\n- expected: ${expectF16.toString(16)}\n-      got: ${res.toString(16)}`);\n      }\n    }\n  } else {\n    let uints = 1;\n    if (type instanceof VectorType) {\n      uints = type.width === 3 ? 4 : type.width;\n      if (type.requiresF16()) {\n        uints = Math.floor(uints / 2);\n      }\n    }\n    for (let i = 0; i < 4; i++) {\n      for (let j = 0; j < uints; j++) {\n        const expect = metadata[j];\n        const res = output[i * uints + j];\n        if (res !== expect) {\n          return new Error(`${uints * i + j}: incorrect result\n- expected: ${expect}\n-      got: ${res}`);\n        }\n      }\n    }\n  }\n\n  return undefined;\n}\n\ng.test('data_types')\n  .desc('Test allowed data types')\n  .params(u =>\n    u\n      .combine('op', kOps)\n      .combine('type', keysOf(kDataTypes))\n      .beginSubcases()\n      .combine('idx1', [0, 1, 2, 3] as const)\n      .combine('idx2', [0, 1, 2, 3] as const)\n      .combine('idx1Id', [0, 1, 2, 3] as const)\n  )\n  .beforeAllSubcases(t => {\n    const features: GPUFeatureName[] = ['subgroups' as GPUFeatureName];\n    const type = kDataTypes[t.params.type];\n    if (type.requiresF16()) {\n      features.push('shader-f16' as GPUFeatureName);\n    }\n    t.selectDeviceOrSkipTestCase(features);\n  })\n  .fn(async t => {\n    const wgSize = [4, 1, 1];\n    const type = kDataTypes[t.params.type];\n    let enables = `enable subgroups;\\n`;\n    if (type.requiresF16()) {\n      enables += `enable f16;`;\n    }\n    const wgsl = `\n${enables}\n\n@group(0) @binding(0)\nvar<storage> input : array<${type.toString()}>;\n\n@group(0) @binding(1)\nvar<storage, read_write> output : array<${type.toString()}>;\n\n@group(0) @binding(2)\nvar<storage, read_write> metadata : array<${type.toString()}>;\n\n@compute @workgroup_size(${wgSize[0]}, ${wgSize[1]}, ${wgSize[2]})\nfn main(\n  @builtin(subgroup_invocation_id) id : u32,\n) {\n  let value = select(input[${t.params.idx2}], input[${t.params.idx1}], id == ${t.params.idx1Id});\n  output[id] = ${t.params.op}(value);\n\n  if (id == 0) {\n    metadata[0] = ${t.params.op === 'subgroupMin' ? 'min' : 'max'}(input[${t.params.idx1}], input[${\n      t.params.idx2\n    }]);\n  }\n}`;\n\n    const inputData = generateTypedInputs(type);\n    let uintsPerOutput = 1;\n    if (type instanceof VectorType) {\n      uintsPerOutput = type.width === 3 ? 4 : type.width;\n      if (type.requiresF16()) {\n        uintsPerOutput = Math.floor(uintsPerOutput / 2);\n      }\n    }\n    await runComputeTest(\n      t,\n      wgsl,\n      wgSize,\n      uintsPerOutput,\n      inputData,\n      (metadata: Uint32Array, output: Uint32Array) => {\n        return checkDataTypes(metadata, output, type);\n      }\n    );\n  });\n\n/**\n * Returns a Uint32Array of randomized integers in the range [0, 2**30)\n *\n * @param seed The PRNG seed\n * @param num The number of integers to generate\n */\nfunction generateInputData(seed: number, num: number): Uint32Array {\n  const prng = new PRNG(seed);\n  return new Uint32Array([\n    ...iterRange(num, x => {\n      return prng.uniformInt(1 << 30);\n    }),\n  ]);\n}\n\n/**\n * Checks results from compute shaders\n *\n * @param metadata An array of uint32s containing:\n *                 * subgroup_invocation_id\n *                 * generated unique subgroup id\n * @param output An array of uint32s containing:\n *               * subgroup operation results\n *               * subgroup_size\n * @param input An array of uint32s used as input data\n * @param numInvs The number of invocations\n * @param op The subgroup operation\n * @param filter A functor for filtering active invocations\n */\nfunction checkCompute(\n  metadata: Uint32Array,\n  output: Uint32Array,\n  input: Uint32Array,\n  numInvs: number,\n  op: Op,\n  filter: (id: number, size: number) => boolean\n): Error | undefined {\n  const identity = op === 'subgroupMin' ? 0x7fffffff : 0;\n  const func = op === 'subgroupMin' ? Math.min : Math.max;\n  const expected = new Map<number, number>();\n  for (let i = 0; i < numInvs; i++) {\n    const id = metadata[i];\n    const subgroup_id = metadata[numInvs + i];\n    const size = output[numInvs + i];\n    if (!filter(id, size)) {\n      continue;\n    }\n\n    let e = expected.get(subgroup_id) ?? identity;\n    e = func(e, input[i]);\n    expected.set(subgroup_id, e);\n  }\n\n  for (let i = 0; i < numInvs; i++) {\n    const id = metadata[i];\n    const subgroup_id = metadata[numInvs + i];\n    const size = output[numInvs + i];\n    if (!filter(id, size)) {\n      continue;\n    }\n\n    const res = output[i];\n    const e = expected.get(subgroup_id) ?? identity;\n    if (res !== e) {\n      return new Error(`Invocation ${i}: incorrect result\n- expected: ${e}\n-      got: ${res}`);\n    }\n  }\n\n  return undefined;\n}\n\nconst kNumRandomCases = 15;\n\ng.test('compute,all_active')\n  .desc(\n    'Test subgroupMin/Max in compute shader with all active invocations and varied workgroup sizes'\n  )\n  .params(u =>\n    u\n      .combine('op', kOps)\n      .combine('wgSize', kWGSizes)\n      .beginSubcases()\n      .combine('case', [...iterRange(kNumRandomCases, x => x)] as const)\n  )\n  .beforeAllSubcases(t => {\n    t.selectDeviceOrSkipTestCase('subgroups' as GPUFeatureName);\n  })\n  .fn(async t => {\n    const wgThreads = t.params.wgSize[0] * t.params.wgSize[1] * t.params.wgSize[2];\n\n    const wgsl = `\nenable subgroups;\n\n@group(0) @binding(0)\nvar<storage> input : array<u32>;\n\nstruct Output {\n  res : array<u32, ${wgThreads}>,\n  size : array<u32, ${wgThreads}>\n}\n\n@group(0) @binding(1)\nvar<storage, read_write> output : Output;\n\nstruct Metadata {\n  id : array<u32, ${wgThreads}>,\n  subgroup_id : array<u32, ${wgThreads}>\n}\n\n@group(0) @binding(2)\nvar<storage, read_write> metadata : Metadata;\n\n@compute @workgroup_size(${t.params.wgSize[0]}, ${t.params.wgSize[1]}, ${t.params.wgSize[2]})\nfn main(\n  @builtin(local_invocation_index) lid : u32,\n  @builtin(subgroup_invocation_id) id : u32,\n  @builtin(subgroup_size) subgroupSize : u32,\n) {\n  metadata.id[lid] = id;\n  metadata.subgroup_id[lid] = subgroupBroadcastFirst(lid + 1); // avoid 0\n\n  output.size[lid] = subgroupSize;\n  output.res[lid] = ${t.params.op}(input[lid]);\n}`;\n\n    const inputData = generateInputData(t.params.case, wgThreads);\n    const uintsPerOutput = 2;\n    await runComputeTest(\n      t,\n      wgsl,\n      [t.params.wgSize[0], t.params.wgSize[1], t.params.wgSize[2]],\n      uintsPerOutput,\n      inputData,\n      (metadata: Uint32Array, output: Uint32Array) => {\n        return checkCompute(\n          metadata,\n          output,\n          inputData,\n          wgThreads,\n          t.params.op,\n          (id: number, size: number) => {\n            return true;\n          }\n        );\n      }\n    );\n  });\n\ng.test('compute,split')\n  .desc('Test that only active invocations participate')\n  .params(u =>\n    u\n      .combine('op', kOps)\n      .combine('predicate', keysOf(kPredicateCases))\n      .beginSubcases()\n      .combine('wgSize', kWGSizes)\n      .combine('case', [...iterRange(kNumRandomCases, x => x)])\n  )\n  .beforeAllSubcases(t => {\n    t.selectDeviceOrSkipTestCase('subgroups' as GPUFeatureName);\n  })\n  .fn(async t => {\n    const testcase = kPredicateCases[t.params.predicate];\n    const wgThreads = t.params.wgSize[0] * t.params.wgSize[1] * t.params.wgSize[2];\n\n    const wgsl = `\nenable subgroups;\n\ndiagnostic(off, subgroup_uniformity);\n\n@group(0) @binding(0)\nvar<storage> input : array<u32>;\n\nstruct Output {\n  res : array<u32, ${wgThreads}>,\n  size : array<u32, ${wgThreads}>\n}\n\n@group(0) @binding(1)\nvar<storage, read_write> output : Output;\n\nstruct Metadata {\n  id : array<u32, ${wgThreads}>,\n  subgroup_id : array<u32, ${wgThreads}>\n}\n\n@group(0) @binding(2)\nvar<storage, read_write> metadata : Metadata;\n\n@compute @workgroup_size(${t.params.wgSize[0]}, ${t.params.wgSize[1]}, ${t.params.wgSize[2]})\nfn main(\n  @builtin(local_invocation_index) lid : u32,\n  @builtin(subgroup_invocation_id) id : u32,\n  @builtin(subgroup_size) subgroupSize : u32,\n) {\n  metadata.id[lid] = id;\n  metadata.subgroup_id[lid] = subgroupBroadcastFirst(lid + 1); // avoid 0\n\n  output.size[lid] = subgroupSize;\n  if ${testcase.cond} {\n    output.res[lid] = ${t.params.op}(input[lid]);\n  } else {\n    return;\n  }\n}`;\n\n    const inputData = generateInputData(t.params.case, wgThreads);\n    const uintsPerOutput = 2;\n    await runComputeTest(\n      t,\n      wgsl,\n      [t.params.wgSize[0], t.params.wgSize[1], t.params.wgSize[2]],\n      uintsPerOutput,\n      inputData,\n      (metadata: Uint32Array, output: Uint32Array) => {\n        return checkCompute(metadata, output, inputData, wgThreads, t.params.op, testcase.filter);\n      }\n    );\n  });\n\n/**\n * Checks min/max ops results from a fragment shader.\n *\n * Avoids subgroups in last row or column to skip potential helper invocations.\n * @param data Framebuffer output\n *             * component 0 is result\n *             * component 1 is generated subgroup id\n * @param input An array of input data\n * @param op The subgroup operation\n * @param format The framebuffer format\n * @param width Framebuffer width\n * @param height Framebuffer height\n */\nfunction checkFragment(\n  data: Uint32Array,\n  input: Uint32Array,\n  op: Op,\n  format: GPUTextureFormat,\n  width: number,\n  height: number\n): Error | undefined {\n  const { uintsPerRow, uintsPerTexel } = getUintsPerFramebuffer(format, width, height);\n\n  // Determine if the subgroup should be included in the checks.\n  const inBounds = new Map<number, boolean>();\n  for (let row = 0; row < height; row++) {\n    for (let col = 0; col < width; col++) {\n      const offset = uintsPerRow * row + col * uintsPerTexel;\n      const subgroup_id = data[offset + 1];\n      if (subgroup_id === 0) {\n        return new Error(`Internal error: helper invocation at (${col}, ${row})`);\n      }\n\n      let ok = inBounds.get(subgroup_id) ?? true;\n      ok = ok && row !== height - 1 && col !== width - 1;\n      inBounds.set(subgroup_id, ok);\n    }\n  }\n\n  let anyInBounds = false;\n  for (const [_, value] of inBounds) {\n    const ok = Boolean(value);\n    anyInBounds = anyInBounds || ok;\n  }\n  if (!anyInBounds) {\n    // This variant would not reliably test behavior.\n    return undefined;\n  }\n\n  const identity = op === 'subgroupMin' ? 0x7fffffff : 0;\n\n  // Iteration skips subgroups in the last row or column to avoid helper\n  // invocations because it is not guaranteed whether or not they participate\n  // in the subgroup operation.\n  const expected = new Map<number, number>();\n  for (let row = 0; row < height; row++) {\n    for (let col = 0; col < width; col++) {\n      const offset = uintsPerRow * row + col * uintsPerTexel;\n      const subgroup_id = data[offset + 1];\n\n      if (subgroup_id === 0) {\n        return new Error(`Internal error: helper invocation at (${col}, ${row})`);\n      }\n\n      const subgroupInBounds = inBounds.get(subgroup_id) ?? true;\n      if (!subgroupInBounds) {\n        continue;\n      }\n\n      const func = op === 'subgroupMin' ? Math.min : Math.max;\n      let v = expected.get(subgroup_id) ?? identity;\n      v = func(v, input[row * width + col]);\n      expected.set(subgroup_id, v);\n    }\n  }\n\n  for (let row = 0; row < height; row++) {\n    for (let col = 0; col < width; col++) {\n      const offset = uintsPerRow * row + col * uintsPerTexel;\n      const res = data[offset];\n      const subgroup_id = data[offset + 1];\n\n      if (subgroup_id === 0) {\n        // Inactive in the fragment.\n        continue;\n      }\n\n      const subgroupInBounds = inBounds.get(subgroup_id) ?? true;\n      if (!subgroupInBounds) {\n        continue;\n      }\n\n      const expected_v = expected.get(subgroup_id) ?? identity;\n      if (expected_v !== res) {\n        return new Error(`Row ${row}, col ${col}: incorrect results:\n- expected: ${expected_v}\n-      got: ${res}`);\n      }\n    }\n  }\n\n  return undefined;\n}\n\ng.test('fragment')\n  .desc('Test subgroupMin/Max in fragment shaders')\n  .params(u =>\n    u\n      .combine('size', kFramebufferSizes)\n      .combine('op', kOps)\n      .beginSubcases()\n      .combine('case', [...iterRange(kNumRandomCases, x => x)])\n      .combineWithParams([{ format: 'rg32uint' }] as const)\n  )\n  .beforeAllSubcases(t => {\n    t.selectDeviceOrSkipTestCase('subgroups' as GPUFeatureName);\n  })\n  .fn(async t => {\n    const numInputs = t.params.size[0] * t.params.size[1];\n\n    interface SubgroupProperties extends GPUAdapterInfo {\n      subgroupMinSize: number;\n    }\n    const { subgroupMinSize } = t.device.adapterInfo as SubgroupProperties;\n    const innerTexels = (t.params.size[0] - 1) * (t.params.size[1] - 1);\n    t.skipIf(innerTexels < subgroupMinSize, 'Too few texels to be reliable');\n\n    const inputData = generateInputData(t.params.case, numInputs);\n\n    const identity = t.params.op === 'subgroupMin' ? 0x7fffffff : 0;\n    const fsShader = `\nenable subgroups;\n\n@group(0) @binding(0)\nvar<uniform> inputs : array<vec4u, ${inputData.length}>;\n\n@fragment\nfn main(\n  @builtin(position) pos : vec4f,\n) -> @location(0) vec2u {\n  // Generate a subgroup id based on linearized position, avoid 0.\n  let linear = u32(pos.x) + u32(pos.y) * ${t.params.size[0]};\n  let subgroup_id = subgroupBroadcastFirst(linear + 1);\n\n  // Filter out possible helper invocations.\n  let x_in_range = u32(pos.x) < (${t.params.size[0]} - 1);\n  let y_in_range = u32(pos.y) < (${t.params.size[1]} - 1);\n  let in_range = x_in_range && y_in_range;\n  let input = select(${identity}, inputs[linear].x, in_range);\n\n  let res = ${t.params.op}(input);\n  return vec2u(res, subgroup_id);\n}`;\n\n    await runFragmentTest(\n      t,\n      t.params.format,\n      fsShader,\n      t.params.size[0],\n      t.params.size[1],\n      inputData,\n      (data: Uint32Array) => {\n        return checkFragment(\n          data,\n          inputData,\n          t.params.op,\n          t.params.format,\n          t.params.size[0],\n          t.params.size[1]\n        );\n      }\n    );\n  });\n"],"mappings":"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"}