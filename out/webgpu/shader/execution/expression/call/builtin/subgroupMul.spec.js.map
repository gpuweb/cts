{"version":3,"file":"subgroupMul.spec.js","names":["description","makeTestGroup","keysOf","objectsToRecord","iterRange","kConcreteNumericScalarsAndVectors","Type","VectorType","numberToFloatBits","floatBitsToNumber","kFloat32Format","kFloat16Format","scalarTypeOf","FP","kDataSentinel","kNumCases","kStride","kWGSizes","kPredicateCases","runAccuracyTest","runComputeTest","SubgroupTest","runFragmentTest","getUintsPerFramebuffer","kFramebufferSizes","g","kIdentity","kDataTypes","kOperations","test","desc","params","u","combine","x","fn","t","skipIfDeviceDoesNotHaveFeature","type","case","wgSize","f16","multiplicationInterval","f32","checkMultiplication","metadata","output","operation","expectedfillValue","numEles","width","scalarTy","expectedOffset","length","i","expected","Math","pow","j","idx","isOdd","floor","val","Error","undefined","filter","beginSubcases","requiresF16","scalarType","enables","wgThreads","wgsl","toString","fillValue","numUints","ceil","Uint32Array","checkPredicatedMultiplication","size","id","u32Boundary","expectedU32","valueModFun","bound","testcase","outputUintsPerElement","inputData","cond","kMaxSize","checkFragment","data","op","format","height","uintsPerRow","uintsPerTexel","inBounds","Map","row","col","offset","subgroup_id","ok","get","set","anyInBounds","_","value","Boolean","subgroupInBounds","v","res","expectU32","combineWithParams","subgroupMinSize","subgroupMaxSize","device","adapterInfo","innerTexels","skipIf","quadIndex","numInputs","fsShader"],"sources":["../../../../../../../src/webgpu/shader/execution/expression/call/builtin/subgroupMul.spec.ts"],"sourcesContent":["export const description = `\nExecution tests for subgroupMul, subgroupExclusiveMul, and subgroupInclusiveMul\n\nNote: There is a lack of portability for non-uniform execution so these tests\nrestrict themselves to uniform control flow.\nNote: There is no guaranteed mapping between subgroup_invocation_id and\nlocal_invocation_index. Tests should avoid assuming there is.\n`;\n\nimport { makeTestGroup } from '../../../../../../common/framework/test_group.js';\nimport { keysOf, objectsToRecord } from '../../../../../../common/util/data_tables.js';\nimport { iterRange } from '../../../../../../common/util/util.js';\nimport {\n  kConcreteNumericScalarsAndVectors,\n  Type,\n  VectorType,\n  numberToFloatBits,\n  floatBitsToNumber,\n  kFloat32Format,\n  kFloat16Format,\n  scalarTypeOf,\n} from '../../../../../util/conversion.js';\nimport { FP } from '../../../../../util/floating_point.js';\n\nimport {\n  kDataSentinel,\n  kNumCases,\n  kStride,\n  kWGSizes,\n  kPredicateCases,\n  runAccuracyTest,\n  runComputeTest,\n  SubgroupTest,\n  runFragmentTest,\n  getUintsPerFramebuffer,\n  kFramebufferSizes,\n} from './subgroup_util.js';\n\nexport const g = makeTestGroup(SubgroupTest);\n\nconst kIdentity = 1;\n\nconst kDataTypes = objectsToRecord(kConcreteNumericScalarsAndVectors);\n\ntype Op = 'subgroupMul' | 'subgroupExclusiveMul' | 'subgroupInclusiveMul';\n\nconst kOperations: Op[] = ['subgroupMul', 'subgroupExclusiveMul', 'subgroupInclusiveMul'];\n\ng.test('fp_accuracy')\n  .desc(\n    `Tests the accuracy of floating-point multiplication.\n\nThe order of operations is implementation defined, most threads are filled with\nthe identity value and two receive random values.\nSubgroup sizes are not known ahead of time so some cases may not perform any\ninteresting operations. The test biases towards checking subgroup sizes under 64.\nThese tests only check two values in order to reuse more of the existing infrastructure\nand limit the number of permutations needed to calculate the final result.`\n  )\n  .params(u =>\n    u\n      .combine('case', [...iterRange(kNumCases, x => x)])\n      .combine('type', ['f32', 'f16'] as const)\n      .combine('wgSize', [\n        [kStride, 1, 1],\n        [kStride / 2, 2, 1],\n      ] as const)\n  )\n  .fn(async t => {\n    t.skipIfDeviceDoesNotHaveFeature('subgroups' as GPUFeatureName);\n    if (t.params.type === 'f16') {\n      t.skipIfDeviceDoesNotHaveFeature('shader-f16');\n    }\n\n    await runAccuracyTest(\n      t,\n      t.params.case,\n      [t.params.wgSize[0], t.params.wgSize[1], t.params.wgSize[2]],\n      'subgroupMul',\n      t.params.type,\n      kIdentity,\n      t.params.type === 'f16' ? FP.f16.multiplicationInterval : FP.f32.multiplicationInterval\n    );\n  });\n\n/**\n * Checks subgroup multiplications.\n *\n * Expected results:\n * - subgroupMul: each invocation should have result equal to 2 to the real subgroup size\n * - subgroupExclusiveMul: each invocation should have result equal to 2 to its subgroup invocation id\n * - subgroupInclusiveMul: each invocation should be equal to subgroupExclusiveMul result multiplied by the fill value\n * @param metadata An array containing actual subgroup size per invocation followed by\n *                 subgroup invocation id per invocation\n * @param output An array of multiplications\n * @param type The data type\n * @param operation Type of multiplication\n * @param expectedFillValue The original value used to fill the test array\n */\nfunction checkMultiplication(\n  metadata: Uint32Array,\n  output: Uint32Array,\n  type: Type,\n  operation: Op,\n  expectedfillValue: number\n): undefined | Error {\n  let numEles = 1;\n  if (type instanceof VectorType) {\n    numEles = type.width;\n  }\n  const scalarTy = scalarTypeOf(type);\n  const expectedOffset = operation === 'subgroupMul' ? 0 : metadata.length / 2;\n  for (let i = 0; i < metadata.length / 2; i++) {\n    let expected = Math.pow(2, metadata[i + expectedOffset]);\n    if (operation === 'subgroupInclusiveMul') {\n      expected *= expectedfillValue;\n    }\n    for (let j = 0; j < numEles; j++) {\n      let idx = i * numEles + j;\n      const isOdd = idx & 0x1;\n      if (scalarTy === Type.f16) {\n        idx = Math.floor(idx / 2);\n      }\n      let val = output[idx];\n      if (scalarTy === Type.f32) {\n        val = floatBitsToNumber(val, kFloat32Format);\n      } else if (scalarTy === Type.f16) {\n        if (isOdd) {\n          val = val >> 16;\n        }\n        val = floatBitsToNumber(val & 0xffff, kFloat16Format);\n      }\n      if (expected !== val) {\n        return new Error(`Invocation ${i}, component ${j}: incorrect result\n- expected: ${expected}\n-      got: ${val}`);\n      }\n    }\n  }\n\n  return undefined;\n}\n\ng.test('data_types')\n  .desc(\n    `Tests subgroup multiplication for valid data types\n\nTests a simple multiplication of all 2 values.\nReductions expect result to be equal to actual subgroup size.\nExclusice scans expect result to be equal subgroup invocation id.\n\nTODO: support vec3 types.\n  `\n  )\n  .params(u =>\n    u\n      .combine('type', keysOf(kDataTypes))\n      .filter(t => {\n        const type = kDataTypes[t.type];\n        if (type instanceof VectorType) {\n          return type.width !== 3;\n        }\n        return true;\n      })\n      .beginSubcases()\n      // Workgroup sizes are kept < 16 to avoid overflows.\n      // Other tests cover that the full subgroup will contribute.\n      .combine('wgSize', [\n        [4, 1, 1],\n        [8, 1, 1],\n        [1, 4, 1],\n        [1, 8, 1],\n        [1, 1, 4],\n        [1, 1, 8],\n        [2, 2, 2],\n        [4, 2, 1],\n        [4, 1, 2],\n        [2, 4, 1],\n        [2, 1, 4],\n        [1, 4, 2],\n        [1, 2, 4],\n        [3, 3, 1],\n        [3, 1, 3],\n        [1, 3, 3],\n      ] as const)\n      .combine('operation', kOperations)\n  )\n  .fn(async t => {\n    t.skipIfDeviceDoesNotHaveFeature('subgroups' as GPUFeatureName);\n    const type = kDataTypes[t.params.type];\n    if (type.requiresF16()) {\n      t.skipIfDeviceDoesNotHaveFeature('shader-f16');\n    }\n    let numEles = 1;\n    if (type instanceof VectorType) {\n      numEles = type.width;\n    }\n    const scalarType = scalarTypeOf(type);\n    let enables = 'enable subgroups;\\n';\n    if (type.requiresF16()) {\n      enables += 'enable f16;\\n';\n    }\n\n    const wgThreads = t.params.wgSize[0] * t.params.wgSize[1] * t.params.wgSize[2];\n\n    const wgsl = `\n${enables}\n\n@group(0) @binding(0)\nvar<storage> inputs : array<${type.toString()}>;\n\n@group(0) @binding(1)\nvar<storage, read_write> outputs : array<${type.toString()}>;\n\nstruct Metadata {\n  subgroup_size : array<u32, ${wgThreads}>,\n  subgroup_invocation_id : array<u32, ${wgThreads}>,\n}\n\n@group(0) @binding(2)\nvar<storage, read_write> metadata : Metadata;\n\n@compute @workgroup_size(${t.params.wgSize[0]}, ${t.params.wgSize[1]}, ${t.params.wgSize[2]})\nfn main(\n  @builtin(local_invocation_index) lid : u32,\n  @builtin(subgroup_invocation_id) id : u32,\n) {\n  // Record the actual subgroup size for this invocation.\n  // Note: subgroup_size builtin is always a power-of-2 and might be larger\n  // if the subgroup is not full.\n  let ballot = subgroupBallot(true);\n  var size = countOneBits(ballot.x);\n  size += countOneBits(ballot.y);\n  size += countOneBits(ballot.z);\n  size += countOneBits(ballot.w);\n  metadata.subgroup_size[lid] = size;\n\n  // Record subgroup invocation id for this invocation.\n  metadata.subgroup_invocation_id[lid] = id;\n\n  outputs[lid] = ${t.params.operation}(inputs[lid]);\n}`;\n\n    const expectedfillValue = 2;\n    let fillValue = expectedfillValue;\n    let numUints = wgThreads * numEles;\n    if (scalarType === Type.f32) {\n      fillValue = numberToFloatBits(fillValue, kFloat32Format);\n    } else if (scalarType === Type.f16) {\n      const f16 = numberToFloatBits(fillValue, kFloat16Format);\n      fillValue = f16 | (f16 << 16);\n      numUints = Math.ceil(numUints / 2);\n    }\n    await runComputeTest(\n      t,\n      wgsl,\n      [t.params.wgSize[0], t.params.wgSize[1], t.params.wgSize[2]],\n      numUints,\n      new Uint32Array([...iterRange(numUints, x => fillValue)]),\n      (metadata: Uint32Array, output: Uint32Array) => {\n        return checkMultiplication(metadata, output, type, t.params.operation, expectedfillValue);\n      }\n    );\n  });\n\n/**\n * Performs correctness checking for predicated multiplications\n *\n * Assumes the shader performs a predicated subgroup multiplication with the\n * subgroup_invocation_id as the data.\n *\n * @param metadata An array containing subgroup sizes and subgroup invocation ids\n * @param output An array containing the output results\n * @param operation The type of multiplication\n * @param filter A functor that mirrors the predication in the shader\n */\nfunction checkPredicatedMultiplication(\n  metadata: Uint32Array,\n  output: Uint32Array,\n  operation: Op,\n  filter: (id: number, size: number) => boolean\n): Error | undefined {\n  for (let i = 0; i < output.length; i++) {\n    const size = metadata[i];\n    const id = metadata[output.length + i];\n    const u32Boundary = Math.pow(2, 32);\n    let expectedU32 = 1;\n    if (filter(id, size)) {\n      // This function replicates the behavior in the shader.\n      const valueModFun = function (id: number) {\n        return (id % 4) + 1;\n      };\n      const bound =\n        operation === 'subgroupInclusiveMul' ? id + 1 : operation === 'subgroupMul' ? size : id;\n      for (let j = 0; j < bound; j++) {\n        if (filter(j, size)) {\n          // Result may overflow u32, compute it by modulo u32Boundary (2^32) after every multiplication.\n          expectedU32 = (expectedU32 * valueModFun(j)) % u32Boundary;\n        }\n      }\n    } else {\n      expectedU32 = kDataSentinel;\n    }\n    if (expectedU32 !== output[i]) {\n      return new Error(`Invocation ${i}: incorrect result\n- expected: ${expectedU32}\n-      got: ${output[i]}`);\n    }\n  }\n  return undefined;\n}\n\ng.test('compute,split')\n  .desc('Tests that only active invocations contribute to the operation')\n  .params(u =>\n    u\n      .combine('case', keysOf(kPredicateCases))\n      .beginSubcases()\n      .combine('operation', kOperations)\n      .combine('wgSize', kWGSizes)\n  )\n  .fn(async t => {\n    t.skipIfDeviceDoesNotHaveFeature('subgroups' as GPUFeatureName);\n    const testcase = kPredicateCases[t.params.case];\n    const outputUintsPerElement = 1;\n    const inputData = new Uint32Array([0]); // no input data\n    const wgThreads = t.params.wgSize[0] * t.params.wgSize[1] * t.params.wgSize[2];\n\n    const wgsl = `\nenable subgroups;\n\ndiagnostic(off, subgroup_uniformity);\ndiagnostic(off, subgroup_branching);\n\n@group(0) @binding(0)\nvar<storage> input : array<u32>;\n\n@group(0) @binding(1)\nvar<storage, read_write> outputs : array<u32>;\n\nstruct Metadata {\n  subgroup_size : array<u32, ${wgThreads}>,\n  subgroup_invocation_id : array<u32, ${wgThreads}>,\n}\n\n@group(0) @binding(2)\nvar<storage, read_write> metadata : Metadata;\n\n@compute @workgroup_size(${t.params.wgSize[0]}, ${t.params.wgSize[1]}, ${t.params.wgSize[2]})\nfn main(\n  @builtin(local_invocation_index) lid : u32,\n  @builtin(subgroup_invocation_id) id : u32,\n) {\n  _ = input[0];\n\n  // Record the actual subgroup size for this invocation.\n  // Note: subgroup_size builtin is always a power-of-2 and might be larger\n  // if the subgroup is not full.\n  let ballot = subgroupBallot(true);\n  var subgroupSize = countOneBits(ballot.x);\n  subgroupSize += countOneBits(ballot.y);\n  subgroupSize += countOneBits(ballot.z);\n  subgroupSize += countOneBits(ballot.w);\n  metadata.subgroup_size[lid] = subgroupSize;\n\n  // Record subgroup invocation id for this invocation.\n  metadata.subgroup_invocation_id[lid] = id;\n\n  if ${testcase.cond} {\n    outputs[lid] = ${t.params.operation}((id % 4) + 1);\n  } else {\n    return;\n  }\n}`;\n\n    await runComputeTest(\n      t,\n      wgsl,\n      [t.params.wgSize[0], t.params.wgSize[1], t.params.wgSize[2]],\n      outputUintsPerElement,\n      inputData,\n      (metadata: Uint32Array, output: Uint32Array) => {\n        return checkPredicatedMultiplication(metadata, output, t.params.operation, testcase.filter);\n      }\n    );\n  });\n\n// Max subgroup size is 128.\nconst kMaxSize = 128;\n\n/**\n * Checks subgroup multiplication results in fragment shaders\n *\n * Avoid subgroups with invocations in the last row or column to avoid helper invocations.\n * @param data The framebuffer results\n *             * Component 0 is the addition result\n *             * Component 1 is the subgroup_invocation_id\n *             * Component 2 is a unique generated subgroup_id\n * @param inputData Input data array\n * @param op The type of subgroup mulitply\n * @param format The framebuffer format\n * @param width The framebuffer width\n * @param height The framebuffer height\n */\nfunction checkFragment(\n  data: Uint32Array,\n  inputData: Uint32Array,\n  op: Op,\n  format: GPUTextureFormat,\n  width: number,\n  height: number\n): Error | undefined {\n  const { uintsPerRow, uintsPerTexel } = getUintsPerFramebuffer(format, width, height);\n\n  // Determine if the subgroup should be included in the checks.\n  const inBounds = new Map<number, boolean>();\n  for (let row = 0; row < height; row++) {\n    for (let col = 0; col < width; col++) {\n      const offset = uintsPerRow * row + col * uintsPerTexel;\n      const subgroup_id = data[offset + 2];\n      if (subgroup_id === 0) {\n        return new Error(`Internal error: helper invocation at (${col}, ${row})`);\n      }\n\n      let ok = inBounds.get(subgroup_id) ?? true;\n      ok = ok && row !== height - 1 && col !== width - 1;\n      inBounds.set(subgroup_id, ok);\n    }\n  }\n\n  let anyInBounds = false;\n  for (const [_, value] of inBounds) {\n    const ok = Boolean(value);\n    anyInBounds = anyInBounds || ok;\n  }\n  if (!anyInBounds) {\n    // This variant would not reliably test behavior.\n    return undefined;\n  }\n\n  // Iteration skips subgroups in the last row or column to avoid helper\n  // invocations because it is not guaranteed whether or not they participate\n  // in the subgroup operation.\n  const expected = new Map<number, Uint32Array>();\n  for (let row = 0; row < height; row++) {\n    for (let col = 0; col < width; col++) {\n      const offset = uintsPerRow * row + col * uintsPerTexel;\n      const subgroup_id = data[offset + 2];\n\n      if (subgroup_id === 0) {\n        return new Error(`Internal error: helper invocation at (${col}, ${row})`);\n      }\n\n      const subgroupInBounds = inBounds.get(subgroup_id) ?? true;\n      if (!subgroupInBounds) {\n        continue;\n      }\n\n      const id = data[offset + 1];\n      const v =\n        expected.get(subgroup_id) ?? new Uint32Array([...iterRange(kMaxSize, x => kIdentity)]);\n      v[id] = inputData[row * width + col];\n      expected.set(subgroup_id, v);\n    }\n  }\n\n  for (let row = 0; row < height; row++) {\n    for (let col = 0; col < width; col++) {\n      const offset = uintsPerRow * row + col * uintsPerTexel;\n      const subgroup_id = data[offset + 2];\n\n      if (subgroup_id === 0) {\n        return new Error(`Internal error: helper invocation at (${col}, ${row})`);\n      }\n\n      const subgroupInBounds = inBounds.get(subgroup_id) ?? true;\n      if (!subgroupInBounds) {\n        continue;\n      }\n\n      const res = data[offset];\n      const id = data[offset + 1];\n      const v =\n        expected.get(subgroup_id) ?? new Uint32Array([...iterRange(kMaxSize, x => kIdentity)]);\n      const bound = op === 'subgroupMul' ? kMaxSize : op === 'subgroupInclusiveMul' ? id + 1 : id;\n      const u32Boundary = Math.pow(2, 32);\n      let expectU32 = kIdentity;\n      for (let i = 0; i < bound; i++) {\n        // Result may overflow u32, compute it by modulo u32Boundary (2^32) after every multiplication.\n        expectU32 = (expectU32 * v[i]) % u32Boundary;\n      }\n\n      if (res !== expectU32) {\n        return new Error(`Row ${row}, col ${col}: incorrect results\n- expected: ${expectU32}\n-      got: ${res}`);\n      }\n    }\n  }\n\n  return undefined;\n}\n\ng.test('fragment')\n  .desc('Test subgroup multiplications in fragment shaders')\n  .params(u =>\n    u\n      .combine('op', kOperations)\n      .combine('size', kFramebufferSizes)\n      .beginSubcases()\n      .combine('quadIndex', [0, 1, 2, 3] as const)\n      .combineWithParams([{ format: 'rgba32uint' }] as const)\n  )\n  .fn(async t => {\n    t.skipIfDeviceDoesNotHaveFeature('subgroups' as GPUFeatureName);\n    interface SubgroupProperties extends GPUAdapterInfo {\n      subgroupMinSize: number;\n      subgroupMaxSize: number;\n    }\n    const { subgroupMinSize, subgroupMaxSize } = t.device.adapterInfo as SubgroupProperties;\n    const innerTexels = (t.params.size[0] - 1) * (t.params.size[1] - 1);\n    t.skipIf(innerTexels < subgroupMinSize, 'Too few texels to be reliable');\n    t.skipIf(subgroupMaxSize === 4 && t.params.quadIndex !== 0, 'Duplicate test');\n\n    // Max possible subgroup size is 128 which is too large so we reduce the\n    // multiplication by a factor of 4. We populate one element of each quad with a\n    // non-identity value. subgroupMaxSize of 4 is a special case where all\n    // elements are populated.\n    const numInputs = t.params.size[0] * t.params.size[1];\n    const inputData = new Uint32Array([\n      ...iterRange(numInputs, x => {\n        if (subgroupMaxSize === 4) {\n          return 2;\n        } else {\n          const row = Math.floor(x / t.params.size[0]);\n          const col = x % t.params.size[0];\n          const idx = (col % 2) + 2 * (row % 2);\n          return idx === t.params.quadIndex ? 2 : kIdentity;\n        }\n      }),\n    ]);\n\n    const fsShader = `\nenable subgroups;\n\n@group(0) @binding(0)\nvar<uniform> inputs : array<vec4u, ${inputData.length}>;\n\n@fragment\nfn main(\n  @builtin(position) pos : vec4f,\n  @builtin(subgroup_invocation_id) id : u32\n) -> @location(0) vec4u {\n  let linear = u32(pos.x) + u32(pos.y) * ${t.params.size[0]};\n  let subgroup_id = subgroupBroadcastFirst(linear + 1);\n\n  // Filter out possible helper invocations.\n  let x_in_range = u32(pos.x) < (${t.params.size[0]} - 1);\n  let y_in_range = u32(pos.y) < (${t.params.size[1]} - 1);\n  let in_range = x_in_range && y_in_range;\n\n  let value = select(${kIdentity}, inputs[linear].x, in_range);\n  return vec4u(${t.params.op}(value), id, subgroup_id, 0);\n};`;\n\n    await runFragmentTest(\n      t,\n      t.params.format,\n      fsShader,\n      t.params.size[0],\n      t.params.size[1],\n      inputData,\n      (data: Uint32Array) => {\n        return checkFragment(\n          data,\n          inputData,\n          t.params.op,\n          t.params.format,\n          t.params.size[0],\n          t.params.size[1]\n        );\n      }\n    );\n  });\n"],"mappings":"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"}