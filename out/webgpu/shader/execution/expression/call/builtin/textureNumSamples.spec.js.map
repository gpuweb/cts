{"version":3,"file":"textureNumSamples.spec.js","names":["description","makeTestGroup","AllFeaturesMaxLimitsGPUTest","kShaderStages","executeTextureQueryAndExpectResult","kSampleTypeInfo","g","test","specURL","desc","params","u","beginSubcases","combine","fn","t","stage","sampled_type","format","skipIfTextureFormatNotMultisampled","sampleCount","texture","createTextureTracked","usage","GPUTextureUsage","TEXTURE_BINDING","RENDER_ATTACHMENT","size","code","expected"],"sources":["../../../../../../../src/webgpu/shader/execution/expression/call/builtin/textureNumSamples.spec.ts"],"sourcesContent":["export const description = `\nExecution tests for the 'textureNumSamples' builtin function\n\nReturns the number samples per texel in a multisampled texture.\n`;\n\nimport { makeTestGroup } from '../../../../../../common/framework/test_group.js';\nimport { AllFeaturesMaxLimitsGPUTest } from '../../../../../gpu_test.js';\nimport { kShaderStages } from '../../../../validation/decl/util.js';\n\nimport { executeTextureQueryAndExpectResult, kSampleTypeInfo } from './texture_utils.js';\n\nexport const g = makeTestGroup(AllFeaturesMaxLimitsGPUTest);\n\ng.test('sampled')\n  .specURL('https://www.w3.org/TR/WGSL/#texturenumsamples')\n  .desc(\n    `\nT, a sampled type.\n\nfn textureNumSamples(t: texture_multisampled_2d<T>) -> u32\n\nParameters\n * t The multisampled texture.\n`\n  )\n  .params(u =>\n    u\n      .beginSubcases()\n      .combine('stage', kShaderStages)\n      .combine('sampled_type', ['f32', 'i32', 'u32'] as const)\n  )\n  .fn(t => {\n    const { stage, sampled_type } = t.params;\n    const { format } = kSampleTypeInfo[sampled_type];\n\n    t.skipIfTextureFormatNotMultisampled(format);\n\n    const sampleCount = 4;\n    const texture = t.createTextureTracked({\n      format,\n      usage: GPUTextureUsage.TEXTURE_BINDING | GPUTextureUsage.RENDER_ATTACHMENT,\n      size: [1, 1, 1],\n      sampleCount,\n    });\n\n    const code = `\n@group(0) @binding(0) var t: texture_multisampled_2d<${sampled_type}>;\n@group(0) @binding(1) var<storage, read_write> result: u32;\nfn getValue() -> u32 {\n  return textureNumSamples(t);\n}\n    `;\n\n    const expected = [sampleCount];\n    executeTextureQueryAndExpectResult(t, stage, code, texture, {}, expected);\n  });\n\ng.test('depth')\n  .specURL('https://www.w3.org/TR/WGSL/#texturenumsamples')\n  .desc(\n    `\nfn textureNumSamples(t: texture_depth_multisampled_2d) -> u32\n\nParameters\n * t The multisampled texture.\n`\n  )\n  .params(u => u.beginSubcases().combine('stage', kShaderStages))\n  .fn(t => {\n    const { stage } = t.params;\n    const sampleCount = 4;\n    const texture = t.createTextureTracked({\n      format: 'depth32float',\n      usage: GPUTextureUsage.TEXTURE_BINDING | GPUTextureUsage.RENDER_ATTACHMENT,\n      size: [1, 1, 1],\n      sampleCount,\n    });\n\n    const code = `\n@group(0) @binding(0) var t: texture_depth_multisampled_2d;\n@group(0) @binding(1) var<storage, read_write> result: u32;\nfn getValue() -> u32 {\n  return textureNumSamples(t);\n}\n    `;\n\n    const expected = [sampleCount];\n    executeTextureQueryAndExpectResult(t, stage, code, texture, {}, expected);\n  });\n"],"mappings":";;GAAA,OAAO,MAAMA,WAAW,GAAI;AAC5B;AACA;AACA;AACA,CAAC,CAED,SAASC,aAAa,QAAQ,kDAAkD;AAChF,SAASC,2BAA2B,QAAQ,4BAA4B;AACxE,SAASC,aAAa,QAAQ,qCAAqC;;AAEnE,SAASC,kCAAkC,EAAEC,eAAe,QAAQ,oBAAoB;;AAExF,OAAO,MAAMC,CAAC,GAAGL,aAAa,CAACC,2BAA2B,CAAC;;AAE3DI,CAAC,CAACC,IAAI,CAAC,SAAS,CAAC;AACdC,OAAO,CAAC,+CAA+C,CAAC;AACxDC,IAAI;EACF;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACE,CAAC;AACAC,MAAM,CAAC,CAAAC,CAAC;AACPA,CAAC;AACEC,aAAa,CAAC,CAAC;AACfC,OAAO,CAAC,OAAO,EAAEV,aAAa,CAAC;AAC/BU,OAAO,CAAC,cAAc,EAAE,CAAC,KAAK,EAAE,KAAK,EAAE,KAAK,CAAU;AAC3D,CAAC;AACAC,EAAE,CAAC,CAAAC,CAAC,KAAI;EACP,MAAM,EAAEC,KAAK,EAAEC,YAAY,CAAC,CAAC,GAAGF,CAAC,CAACL,MAAM;EACxC,MAAM,EAAEQ,MAAM,CAAC,CAAC,GAAGb,eAAe,CAACY,YAAY,CAAC;;EAEhDF,CAAC,CAACI,kCAAkC,CAACD,MAAM,CAAC;;EAE5C,MAAME,WAAW,GAAG,CAAC;EACrB,MAAMC,OAAO,GAAGN,CAAC,CAACO,oBAAoB,CAAC;IACrCJ,MAAM;IACNK,KAAK,EAAEC,eAAe,CAACC,eAAe,GAAGD,eAAe,CAACE,iBAAiB;IAC1EC,IAAI,EAAE,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC;IACfP;EACF,CAAC,CAAC;;EAEF,MAAMQ,IAAI,GAAI;AAClB,uDAAuDX,YAAa;AACpE;AACA;AACA;AACA;AACA,KAAK;;EAED,MAAMY,QAAQ,GAAG,CAACT,WAAW,CAAC;EAC9BhB,kCAAkC,CAACW,CAAC,EAAEC,KAAK,EAAEY,IAAI,EAAEP,OAAO,EAAE,CAAC,CAAC,EAAEQ,QAAQ,CAAC;AAC3E,CAAC,CAAC;;AAEJvB,CAAC,CAACC,IAAI,CAAC,OAAO,CAAC;AACZC,OAAO,CAAC,+CAA+C,CAAC;AACxDC,IAAI;EACF;AACL;AACA;AACA;AACA;AACA;AACE,CAAC;AACAC,MAAM,CAAC,CAAAC,CAAC,KAAIA,CAAC,CAACC,aAAa,CAAC,CAAC,CAACC,OAAO,CAAC,OAAO,EAAEV,aAAa,CAAC,CAAC;AAC9DW,EAAE,CAAC,CAAAC,CAAC,KAAI;EACP,MAAM,EAAEC,KAAK,CAAC,CAAC,GAAGD,CAAC,CAACL,MAAM;EAC1B,MAAMU,WAAW,GAAG,CAAC;EACrB,MAAMC,OAAO,GAAGN,CAAC,CAACO,oBAAoB,CAAC;IACrCJ,MAAM,EAAE,cAAc;IACtBK,KAAK,EAAEC,eAAe,CAACC,eAAe,GAAGD,eAAe,CAACE,iBAAiB;IAC1EC,IAAI,EAAE,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC;IACfP;EACF,CAAC,CAAC;;EAEF,MAAMQ,IAAI,GAAI;AAClB;AACA;AACA;AACA;AACA;AACA,KAAK;;EAED,MAAMC,QAAQ,GAAG,CAACT,WAAW,CAAC;EAC9BhB,kCAAkC,CAACW,CAAC,EAAEC,KAAK,EAAEY,IAAI,EAAEP,OAAO,EAAE,CAAC,CAAC,EAAEQ,QAAQ,CAAC;AAC3E,CAAC,CAAC"}