{"version":3,"file":"workgroup_size.spec.js","names":["description","makeTestGroup","keysOf","ShaderValidationTest","g","kWorkgroupSizeTests","x_only_float","src","pass","xy_only_float","xyz_float","x_only_float_literal","xy_only_float_literal","xyz_float_literal","empty","empty_x","empty_y","invalid_entry","x_only_abstract","xy_only_abstract","xyz_abstract","x_only_unsigned","xy_only_unsigned","xyz_unsigned","x_only_signed","xy_only_signed","xyz_signed","x_only_hex","xy_only_hex","xyz_hex","const_expr","override","override_no_default","trailing_comma_x","trailing_comma_y","trailing_comma_z","override_expr","mixed_abstract_signed","mixed_abstract_unsigned","mixed_signed_unsigned","zero_x","zero_y","zero_z","negative_x","negative_y","negative_z","max_values","missing_left_paren","missing_right_paren","misspelling","no_params","multi_line","comment","mix_ux","mix_uy","mix_uz","duplicate1","duplicate2","test","desc","params","u","combine","fn","t","code","attr","expectCompileResult","ext"],"sources":["../../../../../src/webgpu/shader/validation/shader_io/workgroup_size.spec.ts"],"sourcesContent":["export const description = `Validation tests for workgroup_size`;\n\nimport { makeTestGroup } from '../../../../common/framework/test_group.js';\nimport { keysOf } from '../../../../common/util/data_tables.js';\nimport { ShaderValidationTest } from '../shader_validation_test.js';\n\nexport const g = makeTestGroup(ShaderValidationTest);\n\nconst kWorkgroupSizeTests = {\n  x_only_float: {\n    src: `@workgroup_size(8f)`,\n    pass: false,\n  },\n  xy_only_float: {\n    src: `@workgroup_size(8, 8f)`,\n    pass: false,\n  },\n  xyz_float: {\n    src: `@workgroup_size(8, 8, 8f)`,\n    pass: false,\n  },\n  x_only_float_literal: {\n    src: `@workgroup_size(8.0)`,\n    pass: false,\n  },\n  xy_only_float_literal: {\n    src: `@workgroup_size(8, 8.0)`,\n    pass: false,\n  },\n  xyz_float_literal: {\n    src: `@workgroup_size(8, 8, 8.0)`,\n    pass: false,\n  },\n  empty: {\n    src: `@workgroup_size()`,\n    pass: false,\n  },\n  empty_x: {\n    src: `@workgroup_size(, 8)`,\n    pass: false,\n  },\n  empty_y: {\n    src: `@workgroup_size(8, , 8)`,\n    pass: false,\n  },\n  invalid_entry: {\n    src: `@workgroup_size(let)`,\n    pass: false,\n  },\n\n  x_only_abstract: {\n    src: `@workgroup_size(8)`,\n    pass: true,\n  },\n  xy_only_abstract: {\n    src: `@workgroup_size(8, 8)`,\n    pass: true,\n  },\n  xyz_abstract: {\n    src: `@workgroup_size(8, 8, 8)`,\n    pass: true,\n  },\n  x_only_unsigned: {\n    src: `@workgroup_size(8u)`,\n    pass: true,\n  },\n  xy_only_unsigned: {\n    src: `@workgroup_size(8u, 8u)`,\n    pass: true,\n  },\n  xyz_unsigned: {\n    src: `@workgroup_size(8u, 8u, 8u)`,\n    pass: true,\n  },\n  x_only_signed: {\n    src: `@workgroup_size(8i)`,\n    pass: true,\n  },\n  xy_only_signed: {\n    src: `@workgroup_size(8i, 8i)`,\n    pass: true,\n  },\n  xyz_signed: {\n    src: `@workgroup_size(8i, 8i, 8i)`,\n    pass: true,\n  },\n  x_only_hex: {\n    src: `@workgroup_size(0x1)`,\n    pass: true,\n  },\n  xy_only_hex: {\n    src: `@workgroup_size(0x1, 0x1)`,\n    pass: true,\n  },\n  xyz_hex: {\n    src: `@workgroup_size(0x1, 0x1, 0x1)`,\n    pass: true,\n  },\n\n  const_expr: {\n    src: `const a = 4;\n    const b = 5;\n    @workgroup_size(a, b, a + b)`,\n    pass: true,\n  },\n\n  override: {\n    src: `@id(42) override block_width = 12u;\n@workgroup_size(block_width)`,\n    pass: true,\n  },\n  override_no_default: {\n    src: `override block_width: i32;\n@workgroup_size(block_width)`,\n    pass: true,\n  },\n\n  trailing_comma_x: {\n    src: `@workgroup_size(8, )`,\n    pass: true,\n  },\n  trailing_comma_y: {\n    src: `@workgroup_size(8, 8,)`,\n    pass: true,\n  },\n  trailing_comma_z: {\n    src: `@workgroup_size(8, 8, 8,)`,\n    pass: true,\n  },\n\n  override_expr: {\n    src: `override a = 5;\n    override b = 6;\n    @workgroup_size(a, b, a + b)`,\n    pass: true,\n  },\n\n  // Mixed abstract is ok\n  mixed_abstract_signed: {\n    src: `@workgroup_size(8, 8i)`,\n    pass: true,\n  },\n  mixed_abstract_unsigned: {\n    src: `@workgroup_size(8u, 8)`,\n    pass: true,\n  },\n  // Mixed signed and unsigned is not\n  mixed_signed_unsigned: {\n    src: `@workgroup_size(8i, 8i, 8u)`,\n    pass: false,\n  },\n\n  zero_x: {\n    src: `@workgroup_size(0)`,\n    pass: false,\n  },\n  zero_y: {\n    src: `@workgroup_size(8, 0)`,\n    pass: false,\n  },\n  zero_z: {\n    src: `@workgroup_size(8, 8, 0)`,\n    pass: false,\n  },\n  negative_x: {\n    src: `@workgroup_size(-8)`,\n    pass: false,\n  },\n  negative_y: {\n    src: `@workgroup_size(8, -8)`,\n    pass: false,\n  },\n  negative_z: {\n    src: `@workgroup_size(8, 8, -8)`,\n    pass: false,\n  },\n\n  max_values: {\n    src: `@workgroup_size(256, 256, 64)`,\n    pass: true,\n  },\n\n  missing_left_paren: {\n    src: `@workgroup_size 1, 2, 3)`,\n    pass: false,\n  },\n  missing_right_paren: {\n    src: `@workgroup_size(1, 2, 3`,\n    pass: false,\n  },\n  misspelling: {\n    src: `@aworkgroup_size(1)`,\n    pass: false,\n  },\n  no_params: {\n    src: `@workgroup_size`,\n    pass: false,\n  },\n  multi_line: {\n    src: '@\\nworkgroup_size(1)',\n    pass: true,\n  },\n  comment: {\n    src: `@/* comment */workgroup_size(1)`,\n    pass: true,\n  },\n\n  mix_ux: {\n    src: `@workgroup_size(1u, 1i, 1i)`,\n    pass: false,\n  },\n  mix_uy: {\n    src: `@workgroup_size(1i, 1u, 1i)`,\n    pass: false,\n  },\n  mix_uz: {\n    src: `@workgroup_size(1i, 1i, 1u)`,\n    pass: false,\n  },\n\n  duplicate1: {\n    src: `@workgroup_size(1) @workgroup_size(1)`,\n    pass: false,\n  },\n  duplicate2: {\n    src: `@workgroup_size(1)\n@workgroup_size(2, 2, 2)`,\n    pass: false,\n  },\n};\ng.test('workgroup_size')\n  .desc(`Test validation of workgroup_size`)\n  .params(u => u.combine('attr', keysOf(kWorkgroupSizeTests)))\n  .fn(t => {\n    const code = `\n${kWorkgroupSizeTests[t.params.attr].src}\n@compute fn main() {}`;\n    t.expectCompileResult(kWorkgroupSizeTests[t.params.attr].pass, code);\n  });\n\ng.test('workgroup_size_fragment_shader')\n  .desc(`Test validation of workgroup_size on a fragment shader`)\n  .fn(t => {\n    const code = `\n@workgroup_size(1)\n@fragment fn main(@builtin(position) pos: vec4<f32>) {}`;\n    t.expectCompileResult(false, code);\n  });\n\ng.test('workgroup_size_vertex_shader')\n  .desc(`Test validation of workgroup_size on a vertex shader`)\n  .fn(t => {\n    const code = `\n@workgroup_size(1)\n@vertex fn main() -> @builtin(position) vec4<f32> {}`;\n    t.expectCompileResult(false, code);\n  });\n\ng.test('workgroup_size_function')\n  .desc(`Test validation of workgroup_size on user function`)\n  .fn(t => {\n    const code = `\n@workgroup_size(1)\nfn my_func() {}`;\n    t.expectCompileResult(false, code);\n  });\n\ng.test('workgroup_size_const')\n  .desc(`Test validation of workgroup_size on a const`)\n  .fn(t => {\n    const code = `\n@workgroup_size(1)\nconst a : i32 = 4;\n\nfn my_func() {}`;\n    t.expectCompileResult(false, code);\n  });\n\ng.test('workgroup_size_var')\n  .desc(`Test validation of workgroup_size on a var`)\n  .fn(t => {\n    const code = `\n@workgroup_size(1)\n@group(1) @binding(1)\nvar<storage> a: i32;\n\nfn my_func() {\n  _ = a;\n}`;\n    t.expectCompileResult(false, code);\n  });\n\ng.test('workgroup_size_fp16')\n  .desc(`Test validation of workgroup_size with fp16`)\n  .params(u => u.combine('ext', ['', 'h']))\n  .fn(t => {\n    const code = `\n@workgroup_size(1${t.params.ext})\n@compute fn main() {}`;\n    t.expectCompileResult(t.params.ext === '', code);\n  });\n"],"mappings":"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"}