{"version":3,"file":"id.spec.js","names":["description","makeTestGroup","keysOf","ShaderValidationTest","g","kTests","zero","src","pass","one","hex","trailing_comma","i32","ui32","largest","newline","comment","const_expr","misspelling","empty","missing_left_paren","missing_right_paren","multi_value","overide_expr","f32_literal","f32","negative","too_large","no_params","duplicate","test","desc","params","u","combine","fn","t","code","attr","expectCompileResult","beforeAllSubcases","selectDeviceOrSkipTestCase","ext","id"],"sources":["../../../../../src/webgpu/shader/validation/shader_io/id.spec.ts"],"sourcesContent":["export const description = `Validation tests for id`;\n\nimport { makeTestGroup } from '../../../../common/framework/test_group.js';\nimport { keysOf } from '../../../../common/util/data_tables.js';\nimport { ShaderValidationTest } from '../shader_validation_test.js';\n\nexport const g = makeTestGroup(ShaderValidationTest);\n\nconst kTests = {\n  zero: {\n    src: `@id(0)`,\n    pass: true,\n  },\n  one: {\n    src: `@id(1)`,\n    pass: true,\n  },\n  hex: {\n    src: `@id(0x1)`,\n    pass: true,\n  },\n  trailing_comma: {\n    src: `@id(1,)`,\n    pass: true,\n  },\n  i32: {\n    src: `@id(1i)`,\n    pass: true,\n  },\n  ui32: {\n    src: `@id(1u)`,\n    pass: true,\n  },\n  largest: {\n    src: `@id(65535)`,\n    pass: true,\n  },\n  newline: {\n    src: '@\\nid(1)',\n    pass: true,\n  },\n  comment: {\n    src: `@/* comment */id(1)`,\n    pass: true,\n  },\n  const_expr: {\n    src: `const z = 5;\n      const y = 2;\n      @id(z + y)`,\n    pass: true,\n  },\n\n  misspelling: {\n    src: `@aid(1)`,\n    pass: false,\n  },\n  empty: {\n    src: `@id()`,\n    pass: false,\n  },\n  missing_left_paren: {\n    src: `@id 1)`,\n    pass: false,\n  },\n  missing_right_paren: {\n    src: `@id(1`,\n    pass: false,\n  },\n  multi_value: {\n    src: `@id(1, 2)`,\n    pass: false,\n  },\n  overide_expr: {\n    src: `override z = 5;\n      override y = 2;\n      @id(z + y)`,\n    pass: false,\n  },\n  f32_literal: {\n    src: `@id(1.0)`,\n    pass: false,\n  },\n  f32: {\n    src: `@id(1f)`,\n    pass: false,\n  },\n  negative: {\n    src: `@id(-1)`,\n    pass: false,\n  },\n  too_large: {\n    src: `@id(65536)`,\n    pass: false,\n  },\n  no_params: {\n    src: `@id`,\n    pass: false,\n  },\n  duplicate: {\n    src: `@id(1) @id(1)`,\n    pass: false,\n  },\n};\n\ng.test('id')\n  .desc(`Test validation of id`)\n  .params(u => u.combine('attr', keysOf(kTests)))\n  .fn(t => {\n    const code = `\n${kTests[t.params.attr].src}\noverride a = 4;\n\n@workgroup_size(1, 1, 1)\n@compute fn main() {}`;\n    t.expectCompileResult(kTests[t.params.attr].pass, code);\n  });\n\ng.test('id_fp16')\n  .desc(`Test validation of id with fp16`)\n  .params(u => u.combine('ext', ['', 'h']))\n  .beforeAllSubcases(t => {\n    t.selectDeviceOrSkipTestCase('shader-f16');\n  })\n  .fn(t => {\n    const code = `\n@id(1${t.params.ext})\noverride a = 4;\n\n@workgroup_size(1, 1, 1)\n@compute fn main() {}`;\n    t.expectCompileResult(t.params.ext === '', code);\n  });\n\ng.test('id_struct_member')\n  .desc(`Test validation of id with struct member`)\n  .params(u => u.combine('id', ['@id(1) override', '@id(1)', '']))\n  .fn(t => {\n    const code = `\nstruct S {\n  ${t.params.id} a: i32,\n}\n\n@workgroup_size(1, 1, 1)\n@compute fn main() {}`;\n    t.expectCompileResult(t.params.id === '', code);\n  });\n\ng.test('id_non_override')\n  .desc(`Test validation of id with non-override`)\n  .params(u => u.combine('type', ['var', 'const', 'override']))\n  .fn(t => {\n    const code = `\n@id(1) ${t.params['type']} a = 4;\n\n@workgroup_size(1, 1, 1)\n@compute fn main() {}`;\n    t.expectCompileResult(t.params['type'] === 'override', code);\n  });\n\ng.test('id_in_function')\n  .desc(`Test validation of id inside a function`)\n  .params(u => u.combine('id', ['@id(1)', '']))\n  .fn(t => {\n    const code = `\n@workgroup_size(1, 1, 1)\n@compute fn main() {\n  ${t.params['id']} var a = 4;\n}`;\n    t.expectCompileResult(t.params['id'] === '', code);\n  });\n"],"mappings":"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"}