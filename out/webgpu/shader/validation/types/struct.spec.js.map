{"version":3,"file":"struct.spec.js","names":["description","makeTestGroup","keysOf","ShaderValidationTest","g","test","desc","params","u","combine","fn","t","wgsl","target","expectCompileResult","attribute","kStructureCases","bool","code","valid","u32","i32","f32","f16","vec2u","vec3i","vec4f","vec4h","mat2x2f","mat3x4h","atomic_u32","atomic_i32","array_u32_4","array_u32","array_u32_not_last","array_u32_override","structure","structure_structure_rta","pointer","texture","sampler","sampler_comparison","many_members","trailing_comma","empty","name_collision1","name_collision2","name_collision3","member_collision","no_name","missing_l_brace","missing_r_brace","bad_name","bad_delimiter","missing_delimiter","bad_member_decl","testcase","case"],"sources":["../../../../../src/webgpu/shader/validation/types/struct.spec.ts"],"sourcesContent":["export const description = `\nValidation tests for struct types\n`;\n\nimport { makeTestGroup } from '../../../../common/framework/test_group.js';\nimport { keysOf } from '../../../../common/util/data_tables.js';\nimport { ShaderValidationTest } from '../shader_validation_test.js';\n\nexport const g = makeTestGroup(ShaderValidationTest);\n\ng.test('no_direct_recursion')\n  .desc('Test that direct recursion of structures is rejected')\n  .params(u => u.combine('target', ['i32', 'S']))\n  .fn(t => {\n    const wgsl = `\nstruct S {\n  a : ${t.params.target}\n}`;\n    t.expectCompileResult(t.params.target === 'i32', wgsl);\n  });\n\ng.test('no_indirect_recursion')\n  .desc('Test that indirect recursion of structures is rejected')\n  .params(u => u.combine('target', ['i32', 'S']))\n  .fn(t => {\n    const wgsl = `\nstruct S {\n  a : T\n}\nstruct T {\n  a : ${t.params.target}\n}`;\n    t.expectCompileResult(t.params.target === 'i32', wgsl);\n  });\n\ng.test('no_indirect_recursion_via_array_element')\n  .desc('Test that indirect recursion of structures via array element types is rejected')\n  .params(u => u.combine('target', ['i32', 'S']))\n  .fn(t => {\n    const wgsl = `\nstruct S {\n  a : array<${t.params.target}, 4>\n}\n`;\n    t.expectCompileResult(t.params.target === 'i32', wgsl);\n  });\n\ng.test('no_indirect_recursion_via_array_size')\n  .desc('Test that indirect recursion of structures via array size expressions is rejected')\n  .params(u => u.combine('target', ['S1', 'S2']))\n  .fn(t => {\n    const wgsl = `\nstruct S1 {\n  a : i32,\n}\nstruct S2 {\n  a : i32,\n  b : array<i32, ${t.params.target}().a + 1>,\n}\n`;\n    t.expectCompileResult(t.params.target === 'S1', wgsl);\n  });\n\ng.test('no_indirect_recursion_via_struct_attribute')\n  .desc('Test that indirect recursion of structures via struct members is rejected')\n  .params(u =>\n    u //\n      .combine('target', ['S1', 'S2'])\n      .combine('attribute', ['align', 'location', 'size'])\n  )\n  .fn(t => {\n    const wgsl = `\nstruct S1 {\n  a : i32\n}\nstruct S2 {\n  @${t.params.attribute}(${t.params.target}(4).a) a : i32\n}\n`;\n    t.expectCompileResult(t.params.target === 'S1', wgsl);\n  });\n\ng.test('no_indirect_recursion_via_struct_member_nested_in_alias')\n  .desc(\n    `Test that indirect recursion of structures via struct members is rejected when the member type\n    is an alias that contains the structure`\n  )\n  .params(u => u.combine('target', ['i32', 'A']))\n  .fn(t => {\n    const wgsl = `\nalias A = array<S2, 4>;\nstruct S1 {\n  a : ${t.params.target}\n}\nstruct S2 {\n  a : S1\n}\n`;\n    t.expectCompileResult(t.params.target === 'i32', wgsl);\n  });\n\ninterface StructureCase {\n  code: string;\n  valid: boolean;\n  f16?: boolean;\n}\n\nconst kStructureCases: Record<string, StructureCase> = {\n  bool: {\n    code: `struct S { x : bool }`,\n    valid: true,\n  },\n  u32: {\n    code: `struct S { x : u32 }`,\n    valid: true,\n  },\n  i32: {\n    code: `struct S { x : i32 }`,\n    valid: true,\n  },\n  f32: {\n    code: `struct S { x : f32 }`,\n    valid: true,\n  },\n  f16: {\n    code: `struct S { x : f16 }`,\n    valid: true,\n    f16: true,\n  },\n\n  vec2u: {\n    code: `struct S { x : vec2u }`,\n    valid: true,\n  },\n  vec3i: {\n    code: `struct S { x : vec3i }`,\n    valid: true,\n  },\n  vec4f: {\n    code: `struct S { x : vec4f }`,\n    valid: true,\n  },\n  vec4h: {\n    code: `struct S { x : vec4h }`,\n    valid: true,\n    f16: true,\n  },\n\n  mat2x2f: {\n    code: `struct S { x : mat2x2f }`,\n    valid: true,\n  },\n  mat3x4h: {\n    code: `struct S { x : mat3x4h }`,\n    valid: true,\n    f16: true,\n  },\n\n  atomic_u32: {\n    code: `struct S { x : atomic<u32> }`,\n    valid: true,\n  },\n  atomic_i32: {\n    code: `struct S { x : atomic<i32> }`,\n    valid: true,\n  },\n\n  array_u32_4: {\n    code: `struct S { x : array<u32, 4> }`,\n    valid: true,\n  },\n  array_u32: {\n    code: `struct S { x : array<u32> }`,\n    valid: true,\n  },\n  array_u32_not_last: {\n    code: `struct S { x : array<u32>, y : u32 }`,\n    valid: false,\n  },\n  array_u32_override: {\n    code: `override o : u32;\n    struct S { x : array<u32, o> }`,\n    valid: false,\n  },\n\n  structure: {\n    code: `struct S { x : u32 }\n    struct T { x : S }`,\n    valid: true,\n  },\n  structure_structure_rta: {\n    code: `struct S { x : array<u32> }\n    struct T { x : S }`,\n    valid: false,\n  },\n\n  pointer: {\n    code: `struct S { x : ptr<function, u32> }`,\n    valid: false,\n  },\n\n  texture: {\n    code: `struct S { x : texture_2d<f32> }`,\n    valid: false,\n  },\n  sampler: {\n    code: `struct S { x : sampler }`,\n    valid: false,\n  },\n  sampler_comparison: {\n    code: `struct S { x : sampler_comparison }`,\n    valid: false,\n  },\n\n  many_members: {\n    code: `struct S {\n      m1 : u32,\n      m2 : i32,\n      m3 : vec4f,\n      m4 : array<u32, 8>,\n      m5 : array<f32>\n    }`,\n    valid: true,\n  },\n\n  trailing_comma: {\n    code: `struct S { x : u32, }`,\n    valid: true,\n  },\n\n  empty: {\n    code: `struct S { }`,\n    valid: false,\n  },\n\n  name_collision1: {\n    code: `struct S { x : u32 }\n    struct S { x : u32 }`,\n    valid: false,\n  },\n  name_collision2: {\n    code: `fn S() { }\n    struct S { x : u32 }`,\n    valid: false,\n  },\n  name_collision3: {\n    code: `struct S { x : u32 }\n    alias S = u32;`,\n    valid: false,\n  },\n  member_collision: {\n    code: `struct S { x : u32, x : u32 }`,\n    valid: false,\n  },\n  no_name: {\n    code: `struct { x : u32 }`,\n    valid: false,\n  },\n  missing_l_brace: {\n    code: `struct S x : u32 }`,\n    valid: false,\n  },\n  missing_r_brace: {\n    code: `struct S { x : u32`,\n    valid: false,\n  },\n  bad_name: {\n    code: `struct 123 { x : u32 }`,\n    valid: false,\n  },\n  bad_delimiter: {\n    code: `struct S { x : u32; y : u32 }`,\n    valid: false,\n  },\n  missing_delimiter: {\n    code: `struct S { x : u32 y : u32 }`,\n    valid: false,\n  },\n  bad_member_decl: {\n    code: `struct S { x u32 }`,\n    valid: false,\n  },\n};\n\ng.test('structures')\n  .desc('Validation tests for structures')\n  .params(u => u.combine('case', keysOf(kStructureCases)))\n  .fn(t => {\n    const testcase = kStructureCases[t.params.case];\n    const code = `${testcase.f16 ? 'enable f16;' : ''}\n    ${testcase.code}`;\n    t.expectCompileResult(testcase.valid, code);\n  });\n"],"mappings":"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"}