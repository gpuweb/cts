{"version":3,"file":"struct.spec.js","names":["description","makeTestGroup","ShaderValidationTest","g","test","desc","params","u","combine","fn","t","wgsl","target","expectCompileResult","attribute"],"sources":["../../../../../src/webgpu/shader/validation/types/struct.spec.ts"],"sourcesContent":["export const description = `\nValidation tests for struct types\n`;\n\nimport { makeTestGroup } from '../../../../common/framework/test_group.js';\nimport { ShaderValidationTest } from '../shader_validation_test.js';\n\nexport const g = makeTestGroup(ShaderValidationTest);\n\ng.test('no_direct_recursion')\n  .desc('Test that direct recursion of structures is rejected')\n  .params(u => u.combine('target', ['i32', 'S']))\n  .fn(t => {\n    const wgsl = `\nstruct S {\n  a : ${t.params.target}\n}`;\n    t.expectCompileResult(t.params.target === 'i32', wgsl);\n  });\n\ng.test('no_indirect_recursion')\n  .desc('Test that indirect recursion of structures is rejected')\n  .params(u => u.combine('target', ['i32', 'S']))\n  .fn(t => {\n    const wgsl = `\nstruct S {\n  a : T\n}\nstruct T {\n  a : ${t.params.target}\n}`;\n    t.expectCompileResult(t.params.target === 'i32', wgsl);\n  });\n\ng.test('no_indirect_recursion_via_array_element')\n  .desc('Test that indirect recursion of structures via array element types is rejected')\n  .params(u => u.combine('target', ['i32', 'S']))\n  .fn(t => {\n    const wgsl = `\nstruct S {\n  a : array<${t.params.target}, 4>\n}\n`;\n    t.expectCompileResult(t.params.target === 'i32', wgsl);\n  });\n\ng.test('no_indirect_recursion_via_array_size')\n  .desc('Test that indirect recursion of structures via array size expressions is rejected')\n  .params(u => u.combine('target', ['S1', 'S2']))\n  .fn(t => {\n    const wgsl = `\nstruct S1 {\n  a : i32,\n}\nstruct S2 {\n  a : i32,\n  b : array<i32, ${t.params.target}().a + 1>,\n}\n`;\n    t.expectCompileResult(t.params.target === 'S1', wgsl);\n  });\n\ng.test('no_indirect_recursion_via_struct_attribute')\n  .desc('Test that indirect recursion of structures via struct members is rejected')\n  .params(u =>\n    u //\n      .combine('target', ['S1', 'S2'])\n      .combine('attribute', ['align', 'location', 'size'])\n  )\n  .fn(t => {\n    const wgsl = `\nstruct S1 {\n  a : i32\n}\nstruct S2 {\n  @${t.params.attribute}(${t.params.target}(4).a) a : i32\n}\n`;\n    t.expectCompileResult(t.params.target === 'S1', wgsl);\n  });\n\ng.test('no_indirect_recursion_via_struct_member_nested_in_alias')\n  .desc(\n    `Test that indirect recursion of structures via struct members is rejected when the member type\n    is an alias that contains the structure`\n  )\n  .params(u => u.combine('target', ['i32', 'A']))\n  .fn(t => {\n    const wgsl = `\nalias A = array<S2, 4>;\nstruct S1 {\n  a : ${t.params.target}\n}\nstruct S2 {\n  a : S1\n}\n`;\n    t.expectCompileResult(t.params.target === 'i32', wgsl);\n  });\n"],"mappings":"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"}