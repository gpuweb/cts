{"version":3,"file":"readonly_and_readwrite_storage_textures.spec.js","names":["description","makeTestGroup","TexelFormats","ShaderValidationTest","g","kFeatureName","test","desc","paramsSubcasesOnly","u","combine","fn","t","type","format","access","params","skipIfTextureFormatNotUsableAsStorageTextureDeprecated","source","requiresFeature","expectCompileResult","hasLanguageFeature"],"sources":["../../../../../src/webgpu/shader/validation/extension/readonly_and_readwrite_storage_textures.spec.ts"],"sourcesContent":["export const description = `\nValidation tests for the readonly_and_readwrite_storage_textures language feature\n`;\n\nimport { makeTestGroup } from '../../../../common/framework/test_group.js';\nimport { TexelFormats } from '../../types.js';\nimport { ShaderValidationTest } from '../shader_validation_test.js';\n\nexport const g = makeTestGroup(ShaderValidationTest);\n\nconst kFeatureName = 'readonly_and_readwrite_storage_textures';\n\ng.test('var_decl')\n  .desc(\n    `Checks that the read and read_write access modes are only allowed with the language feature present`\n  )\n  .paramsSubcasesOnly(u =>\n    u\n      .combine('type', [\n        'texture_storage_1d',\n        'texture_storage_2d',\n        'texture_storage_2d_array',\n        'texture_storage_3d',\n      ])\n      .combine('format', TexelFormats)\n      .combine('access', ['read', 'write', 'read_write'])\n  )\n  .fn(t => {\n    const { type, format, access } = t.params;\n    t.skipIfTextureFormatNotUsableAsStorageTextureDeprecated(format.format);\n\n    const source = `@group(0) @binding(0) var t : ${type}<${format.format}, ${access}>;`;\n    const requiresFeature = access !== 'write';\n    t.expectCompileResult(t.hasLanguageFeature(kFeatureName) || !requiresFeature, source);\n  });\n\ng.test('textureBarrier')\n  .desc(\n    `Checks that the textureBarrier() builtin is only allowed with the language feature present`\n  )\n  .fn(t => {\n    t.expectCompileResult(\n      t.hasLanguageFeature(kFeatureName),\n      `\n        @workgroup_size(1) @compute fn main() {\n            textureBarrier();\n        }\n    `\n    );\n  });\n"],"mappings":";;GAAA,OAAO,MAAMA,WAAW,GAAI;AAC5B;AACA,CAAC,CAED,SAASC,aAAa,QAAQ,4CAA4C;AAC1E,SAASC,YAAY,QAAQ,gBAAgB;AAC7C,SAASC,oBAAoB,QAAQ,8BAA8B;;AAEnE,OAAO,MAAMC,CAAC,GAAGH,aAAa,CAACE,oBAAoB,CAAC;;AAEpD,MAAME,YAAY,GAAG,yCAAyC;;AAE9DD,CAAC,CAACE,IAAI,CAAC,UAAU,CAAC;AACfC,IAAI;EACF;AACH,CAAC;AACAC,kBAAkB,CAAC,CAAAC,CAAC;AACnBA,CAAC;AACEC,OAAO,CAAC,MAAM,EAAE;AACf,oBAAoB;AACpB,oBAAoB;AACpB,0BAA0B;AAC1B,oBAAoB;AACrB,CAAC;AACDA,OAAO,CAAC,QAAQ,EAAER,YAAY,CAAC;AAC/BQ,OAAO,CAAC,QAAQ,EAAE,CAAC,MAAM,EAAE,OAAO,EAAE,YAAY,CAAC;AACtD,CAAC;AACAC,EAAE,CAAC,CAAAC,CAAC,KAAI;EACP,MAAM,EAAEC,IAAI,EAAEC,MAAM,EAAEC,MAAM,CAAC,CAAC,GAAGH,CAAC,CAACI,MAAM;EACzCJ,CAAC,CAACK,sDAAsD,CAACH,MAAM,CAACA,MAAM,CAAC;;EAEvE,MAAMI,MAAM,GAAI,iCAAgCL,IAAK,IAAGC,MAAM,CAACA,MAAO,KAAIC,MAAO,IAAG;EACpF,MAAMI,eAAe,GAAGJ,MAAM,KAAK,OAAO;EAC1CH,CAAC,CAACQ,mBAAmB,CAACR,CAAC,CAACS,kBAAkB,CAAChB,YAAY,CAAC,IAAI,CAACc,eAAe,EAAED,MAAM,CAAC;AACvF,CAAC,CAAC;;AAEJd,CAAC,CAACE,IAAI,CAAC,gBAAgB,CAAC;AACrBC,IAAI;EACF;AACH,CAAC;AACAI,EAAE,CAAC,CAAAC,CAAC,KAAI;EACPA,CAAC,CAACQ,mBAAmB;IACnBR,CAAC,CAACS,kBAAkB,CAAChB,YAAY,CAAC;IACjC;AACP;AACA;AACA;AACA;EACI,CAAC;AACH,CAAC,CAAC"}