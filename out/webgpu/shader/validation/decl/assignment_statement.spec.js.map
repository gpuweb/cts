{"version":3,"file":"assignment_statement.spec.js","names":["description","makeTestGroup","keysOf","ShaderValidationTest","g","test","desc","fn","t","code","expectCompileResult","kSwizzleTests","single","src","pass","multi","hasLanguageFeature","swizzleswizzle","params","u","combine","wgsl","case"],"sources":["../../../../../src/webgpu/shader/validation/decl/assignment_statement.spec.ts"],"sourcesContent":["export const description = `\nValidation tests for assignment statements.\n`;\n\nimport { makeTestGroup } from '../../../../common/framework/test_group.js';\nimport { keysOf } from '../../../../common/util/data_tables.js';\nimport { ShaderValidationTest } from '../shader_validation_test.js';\n\nexport const g = makeTestGroup(ShaderValidationTest);\n\ng.test('scalar_assignment')\n  .desc('Test simple scalar assignments.')\n  .fn(t => {\n    const code = `\n      @fragment\n      fn main() {\n        var a: i32 = 0;\n        a = 1;\n        let b: f32 = 0.0;\n        var c: f32;\n        c = b;\n      }\n    `;\n    t.expectCompileResult(true, code);\n  });\n\ng.test('vector_full_assignment')\n  .desc('Test full vector assignments.')\n  .fn(t => {\n    const code = `\n      @fragment\n      fn main() {\n        var v1: vec3<f32> = vec3(0.0, 0.0, 0.0);\n        var v2: vec3<f32>;\n        v2 = v1;\n        v2 = vec3(1.0, 2.0, 3.0);\n      }\n    `;\n    t.expectCompileResult(true, code);\n  });\n\ng.test('vector_indexed_assignment')\n  .desc('Test vector indexed assignments.')\n  .fn(t => {\n    const code = `\n      @fragment\n      fn main() {\n        var v: vec3<i32> = vec3(0, 0, 0);\n        v[0] = 1;\n        v[2] = 5;\n      }\n    `;\n    t.expectCompileResult(true, code);\n  });\n\nconst kSwizzleTests = {\n  single: {\n    src: 'v.x = 1.0',\n    pass: (t: ShaderValidationTest) => true,\n  },\n  multi: {\n    src: 'v.xy = vec2(1.0, 2.0)',\n    pass: (t: ShaderValidationTest) => false || t.hasLanguageFeature('swizzle_assignment'),\n  },\n  swizzleswizzle: {\n    src: 'v.xy.x = 1.0',\n    pass: (t: ShaderValidationTest) => false || t.hasLanguageFeature('swizzle_assignment'),\n  },\n};\n\ng.test('vector_swizzle_assignment')\n  .desc('Test vector swizzle assignments.')\n  .params(u => u.combine('case', keysOf(kSwizzleTests)))\n  .fn(t => {\n    const wgsl = `\n      @fragment\n      fn main() {\n        var v: vec4<f32> = vec4(0.0, 0.0, 0.0, 0.0);\n        ${kSwizzleTests[t.params.case].src};\n      }`;\n    t.expectCompileResult(kSwizzleTests[t.params.case].pass(t), wgsl);\n  });\n\ng.test('compound_assignment_with_swizzle')\n  .desc('Test compound assignment of a vector with a swizzle on the rhs.')\n  .fn(t => {\n    const code = `\n      @fragment\n      fn main() {\n        var v: vec3<i32> = vec3(1, 2, 3);\n        var w: vec4<i32> = vec4(10);\n        v *= w.xyz;\n      }\n    `;\n    t.expectCompileResult(true, code);\n  });\n"],"mappings":";;GAAA,OAAO,MAAMA,WAAW,GAAI;AAC5B;AACA,CAAC,CAED,SAASC,aAAa,QAAQ,4CAA4C;AAC1E,SAASC,MAAM,QAAQ,wCAAwC;AAC/D,SAASC,oBAAoB,QAAQ,8BAA8B;;AAEnE,OAAO,MAAMC,CAAC,GAAGH,aAAa,CAACE,oBAAoB,CAAC;;AAEpDC,CAAC,CAACC,IAAI,CAAC,mBAAmB,CAAC;AACxBC,IAAI,CAAC,iCAAiC,CAAC;AACvCC,EAAE,CAAC,CAAAC,CAAC,KAAI;EACP,MAAMC,IAAI,GAAI;AAClB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;EACDD,CAAC,CAACE,mBAAmB,CAAC,IAAI,EAAED,IAAI,CAAC;AACnC,CAAC,CAAC;;AAEJL,CAAC,CAACC,IAAI,CAAC,wBAAwB,CAAC;AAC7BC,IAAI,CAAC,+BAA+B,CAAC;AACrCC,EAAE,CAAC,CAAAC,CAAC,KAAI;EACP,MAAMC,IAAI,GAAI;AAClB;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;EACDD,CAAC,CAACE,mBAAmB,CAAC,IAAI,EAAED,IAAI,CAAC;AACnC,CAAC,CAAC;;AAEJL,CAAC,CAACC,IAAI,CAAC,2BAA2B,CAAC;AAChCC,IAAI,CAAC,kCAAkC,CAAC;AACxCC,EAAE,CAAC,CAAAC,CAAC,KAAI;EACP,MAAMC,IAAI,GAAI;AAClB;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;EACDD,CAAC,CAACE,mBAAmB,CAAC,IAAI,EAAED,IAAI,CAAC;AACnC,CAAC,CAAC;;AAEJ,MAAME,aAAa,GAAG;EACpBC,MAAM,EAAE;IACNC,GAAG,EAAE,WAAW;IAChBC,IAAI,EAAEA,CAACN,CAAuB,KAAK;EACrC,CAAC;EACDO,KAAK,EAAE;IACLF,GAAG,EAAE,uBAAuB;IAC5BC,IAAI,EAAEA,CAACN,CAAuB,KAAK,KAAK,IAAIA,CAAC,CAACQ,kBAAkB,CAAC,oBAAoB;EACvF,CAAC;EACDC,cAAc,EAAE;IACdJ,GAAG,EAAE,cAAc;IACnBC,IAAI,EAAEA,CAACN,CAAuB,KAAK,KAAK,IAAIA,CAAC,CAACQ,kBAAkB,CAAC,oBAAoB;EACvF;AACF,CAAC;;AAEDZ,CAAC,CAACC,IAAI,CAAC,2BAA2B,CAAC;AAChCC,IAAI,CAAC,kCAAkC,CAAC;AACxCY,MAAM,CAAC,CAAAC,CAAC,KAAIA,CAAC,CAACC,OAAO,CAAC,MAAM,EAAElB,MAAM,CAACS,aAAa,CAAC,CAAC,CAAC;AACrDJ,EAAE,CAAC,CAAAC,CAAC,KAAI;EACP,MAAMa,IAAI,GAAI;AAClB;AACA;AACA;AACA,UAAUV,aAAa,CAACH,CAAC,CAACU,MAAM,CAACI,IAAI,CAAC,CAACT,GAAI;AAC3C,QAAQ;EACJL,CAAC,CAACE,mBAAmB,CAACC,aAAa,CAACH,CAAC,CAACU,MAAM,CAACI,IAAI,CAAC,CAACR,IAAI,CAACN,CAAC,CAAC,EAAEa,IAAI,CAAC;AACnE,CAAC,CAAC;;AAEJjB,CAAC,CAACC,IAAI,CAAC,kCAAkC,CAAC;AACvCC,IAAI,CAAC,iEAAiE,CAAC;AACvEC,EAAE,CAAC,CAAAC,CAAC,KAAI;EACP,MAAMC,IAAI,GAAI;AAClB;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;EACDD,CAAC,CAACE,mBAAmB,CAAC,IAAI,EAAED,IAAI,CAAC;AACnC,CAAC,CAAC"}