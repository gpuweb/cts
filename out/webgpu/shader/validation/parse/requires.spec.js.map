{"version":3,"file":"requires.spec.js","names":["description","makeTestGroup","keysOf","kKnownWGSLLanguageFeatures","ShaderValidationTest","g","kCases","valid","code","pass","decl_before","decl_after","enable_before","diagnostic_before","const_assert_before","const_assert_after","embedded_comment","parens","multi_line","multiple_requires_duplicate","multiple_requires_different","multiple_entries_duplicate","multiple_entries_different","unknown","test","desc","params","u","combine","fn","t","skipIfLanguageFeatureNotSupported","c","case","expectCompileResult","feature","hasLanguageFeature"],"sources":["../../../../../src/webgpu/shader/validation/parse/requires.spec.ts"],"sourcesContent":["export const description = `Parser validation tests for requires`;\n\nimport { makeTestGroup } from '../../../../common/framework/test_group.js';\nimport { keysOf } from '../../../../common/util/data_tables.js';\nimport { kKnownWGSLLanguageFeatures } from '../../../capability_info.js';\nimport { ShaderValidationTest } from '../shader_validation_test.js';\n\nexport const g = makeTestGroup(ShaderValidationTest);\n\nconst kCases = {\n  valid: { code: `requires readonly_and_readwrite_storage_textures;`, pass: true },\n  decl_before: {\n    code: `alias i = i32;\nrequires readonly_and_readwrite_storage_textures;`,\n    pass: false,\n  },\n  decl_after: {\n    code: `requires readonly_and_readwrite_storage_textures;\nalias i = i32;`,\n    pass: true,\n  },\n  enable_before: {\n    code: `enable f16;\nrequires readonly_and_readwrite_storage_textures;`,\n    pass: true,\n  },\n  diagnostic_before: {\n    code: `diagnostic(info, derivative_uniformity);\nrequires readonly_and_readwrite_storage_textures;`,\n    pass: true,\n  },\n  const_assert_before: {\n    code: `const_assert 1 == 1;\nrequires readonly_and_readwrite_storage_textures;`,\n    pass: false,\n  },\n  const_assert_after: {\n    code: `requires readonly_and_readwrite_storage_textures;\nconst_assert 1 == 1;`,\n    pass: true,\n  },\n  embedded_comment: {\n    code: `/* comment\n\n*/requires readonly_and_readwrite_storage_textures;`,\n    pass: true,\n  },\n  parens: {\n    code: `requires(readonly_and_readwrite_storage_textures);`,\n    pass: false,\n  },\n  multi_line: {\n    code: `requires\nreadonly_and_readwrite_storage_textures;`,\n    pass: true,\n  },\n  multiple_requires_duplicate: {\n    code: `requires readonly_and_readwrite_storage_textures;\nrequires readonly_and_readwrite_storage_textures;`,\n    pass: true,\n  },\n  multiple_requires_different: {\n    code: `requires readonly_and_readwrite_storage_textures;\nrequires packed_4x8_integer_dot_product;`,\n    pass: true,\n  },\n  multiple_entries_duplicate: {\n    code: `requires readonly_and_readwrite_storage_textures, readonly_and_readwrite_storage_textures, readonly_and_readwrite_storage_textures;`,\n    pass: true,\n  },\n  multiple_entries_different: {\n    code: `requires readonly_and_readwrite_storage_textures, packed_4x8_integer_dot_product;`,\n    pass: true,\n  },\n  unknown: {\n    code: `requires unknown;`,\n    pass: false,\n  },\n};\n\ng.test('requires')\n  .desc(`Tests that requires are validated correctly.`)\n  .params(u => u.combine('case', keysOf(kCases)))\n  .fn(t => {\n    t.skipIfLanguageFeatureNotSupported('readonly_and_readwrite_storage_textures');\n    t.skipIfLanguageFeatureNotSupported('packed_4x8_integer_dot_product');\n\n    const c = kCases[t.params.case];\n    t.expectCompileResult(c.pass, c.code);\n  });\n\ng.test('wgsl_matches_api')\n  .desc(`Tests that language features are accepted iff the API reports support for them.`)\n  .params(u => u.combine('feature', kKnownWGSLLanguageFeatures))\n  .fn(t => {\n    const code = `requires ${t.params.feature};`;\n    t.expectCompileResult(t.hasLanguageFeature(t.params.feature), code);\n  });\n"],"mappings":"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"}