{"version":3,"file":"swizzle_assignment.spec.js","names":["description","makeTestGroup","ShaderValidationTest","g","test","desc","params","u","combine","fn","t","skipIfLanguageFeatureNotSupported","elemType","vecSize","swizzle","substring","vecType","length","code","expectCompileResult","lhs"],"sources":["../../../../../src/webgpu/shader/validation/statement/swizzle_assignment.spec.ts"],"sourcesContent":["export const description = `\nValidation tests for swizzle assignments.\n`;\n\nimport { makeTestGroup } from '../../../../common/framework/test_group.js';\nimport { ShaderValidationTest } from '../shader_validation_test.js';\n\nexport const g = makeTestGroup(ShaderValidationTest);\n\ng.test('valid')\n  .desc('Valid swizzle assignments')\n  .params(u =>\n    u.combine('elemType', ['f32', 'i32', 'u32'] as const).combine('vecSize', [2, 3, 4] as const)\n  )\n  .fn(t => {\n    t.skipIfLanguageFeatureNotSupported('swizzle_assignment');\n    const { elemType, vecSize } = t.params;\n    const swizzle = 'xyzw'.substring(0, vecSize);\n    const vecType = `vec${swizzle.length}<${elemType}>`;\n    const code = `\n@fragment\nfn main() {\n  var v = vec4<${elemType}>(0);\n  v.${swizzle} = ${vecType}(1);\n}\n`;\n    t.expectCompileResult(true, code);\n  });\n\ng.test('invalid_lhs_not_reference')\n  .desc('Invalid swizzle assignment where LHS is not a reference')\n  .params(u => u.combine('lhs', ['vec4f()', 'const_vec', 'foo()']))\n  .fn(t => {\n    t.skipIfLanguageFeatureNotSupported('swizzle_assignment');\n    const code = `\nconst const_vec = vec4f();\n\nfn foo() -> vec4f {\n  return vec4f();\n}\n\n@fragment\nfn main() {\n  var v = vec4f();\n  ${t.params.lhs}.xyz = vec3(0.0);\n}\n`;\n    t.expectCompileResult(false, code);\n  });\n\ng.test('invalid_duplicate_components')\n  .desc('Invalid swizzle assignment with duplicate LHS components')\n  .fn(t => {\n    t.skipIfLanguageFeatureNotSupported('swizzle_assignment');\n    const code = `\n@fragment\nfn main() {\n  var v = vec4f();\n  v.xx = vec2f();\n}\n`;\n    t.expectCompileResult(false, code);\n  });\n\ng.test('invalid_component_mismatch')\n  .desc('Invalid swizzle assignment with mismatched number of components')\n  .fn(t => {\n    t.skipIfLanguageFeatureNotSupported('swizzle_assignment');\n    const code = `\n@fragment\nfn main() {\n  var v = vec4f();\n  v.xy = vec3f();\n}\n`;\n    t.expectCompileResult(false, code);\n  });\n\ng.test('invalid_component_oob')\n  .desc('Invalid swizzle assignment with components out of bounds')\n  .fn(t => {\n    t.skipIfLanguageFeatureNotSupported('swizzle_assignment');\n    const code = `\n@fragment\nfn main() {\n  var v = vec3f();\n  v.xyzw = vec4f();\n}\n`;\n    t.expectCompileResult(false, code);\n  });\n\ng.test('invalid_type_mismatch')\n  .desc('Invalid swizzle assignment with mismatched types')\n  .fn(t => {\n    t.skipIfLanguageFeatureNotSupported('swizzle_assignment');\n    const code = `\n@fragment\nfn main() {\n  var v = vec4f();\n  v.xy = vec2i();\n}\n`;\n    t.expectCompileResult(false, code);\n  });\n\ng.test('invalid_mixed_letter_schemes')\n  .desc('Invalid swizzle assignment with mixed letter schemes (xyzw vs. rgba)')\n  .fn(t => {\n    t.skipIfLanguageFeatureNotSupported('swizzle_assignment');\n    const code = `\n@fragment\nfn main() {\n  var v = vec4f();\n  v.xr = vec2i();\n}\n`;\n    t.expectCompileResult(false, code);\n  });\n\ng.test('invalid_address_of_swizzle_view')\n  .desc('Invalid to take the address of a swizzle view')\n  .fn(t => {\n    t.skipIfLanguageFeatureNotSupported('swizzle_assignment');\n    const code = `\n@fragment\nfn main() {\n  var v = vec4f();\n  let p = &v.xy;\n}\n`;\n    t.expectCompileResult(false, code);\n  });\n\ng.test('invalid_index_into_swizzle_view')\n  .desc('Invalid to index into a swizzle view on the lhs')\n  .fn(t => {\n    t.skipIfLanguageFeatureNotSupported('swizzle_assignment');\n    const code = `\n@fragment\nfn main() {\n  var v = vec2u();\n  v.xy[0] = 1;\n`;\n    t.expectCompileResult(false, code);\n  });\n"],"mappings":"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"}