{"version":3,"file":"for.spec.js","names":["description","makeTestGroup","keysOf","ShaderValidationTest","kTestTypes","g","test","desc","params","u","combine","fn","t","type","code","requires","header","value","pass","expectCompileResult","kTests","break","wgsl","init_var","init_var_type","init_var_function","init_var_function_type","init_let","init_let_type","init_const","init_const_type","init_call","init_phony","init_increment","init_compound_assign","cond_true","cont_call","cont_phony","cont_increment","cont_compound_assign","init_cond","cond_cont","init_cond_cont","init_shadow","no_semicolon","one_semicolon","no_paren","empty","init_expr","cond_stmt","cont_expr","cont_var","cont_var_type","cont_var_function","cont_var_function_type","cont_let","cont_let_type"],"sources":["../../../../../src/webgpu/shader/validation/statement/for.spec.ts"],"sourcesContent":["export const description = `Validation tests for 'for' statements'`;\n\nimport { makeTestGroup } from '../../../../common/framework/test_group.js';\nimport { keysOf } from '../../../../common/util/data_tables.js';\nimport { ShaderValidationTest } from '../shader_validation_test.js';\n\nimport { kTestTypes } from './test_types.js';\n\nexport const g = makeTestGroup(ShaderValidationTest);\n\ng.test('condition_type')\n  .desc(`Tests that a 'for' condition must be a bool type`)\n  .params(u => u.combine('type', keysOf(kTestTypes)))\n  .fn(t => {\n    const type = kTestTypes[t.params.type];\n    const code = `\n${type.requires ? `enable ${type.requires};` : ''}\n\n${type.header ?? ''}\n\nfn f() -> bool {\n  for (; ${type.value};) {\n    return true;\n  }\n  return false;\n}\n`;\n\n    const pass = t.params.type === 'bool';\n    t.expectCompileResult(pass, code);\n  });\n\nconst kTests = {\n  break: { wgsl: `for (;;) { break; }`, pass: true },\n\n  init_var: { wgsl: `for (var i = 1;;) { break; }`, pass: true },\n  init_var_type: { wgsl: `for (var i : i32 = 1;;) { break; }`, pass: true },\n  init_var_function: { wgsl: `for (var<function> i = 1;;) { break; }`, pass: true },\n  init_var_function_type: { wgsl: `for (var<function> i : i32 = 1;;) { break; }`, pass: true },\n  init_let: { wgsl: `for (let i = 1;;) { break; }`, pass: true },\n  init_let_type: { wgsl: `for (let i : u32 = 1;;) { break; }`, pass: true },\n  init_const: { wgsl: `for (const i = 1;;) { break; }`, pass: true },\n  init_const_type: { wgsl: `for (const i : f32 = 1;;) { break; }`, pass: true },\n  init_call: { wgsl: `for (x();;) { break; }`, pass: true },\n  init_phony: { wgsl: `for (_ = v;;) { break; }`, pass: true },\n  init_increment: { wgsl: `for (v++;;) { break; }`, pass: true },\n  init_compound_assign: { wgsl: `for (v += 3;;) { break; }`, pass: true },\n\n  cond_true: { wgsl: `for (;true;) { break; }`, pass: true },\n\n  cont_call: { wgsl: `for (;;x()) { break; }`, pass: true },\n  cont_phony: { wgsl: `for (;;_ = v) { break; }`, pass: true },\n  cont_increment: { wgsl: `for (;;v++) { break; }`, pass: true },\n  cont_compound_assign: { wgsl: `for (;;v += 3) { break; }`, pass: true },\n\n  init_cond: { wgsl: `for (var i = 1; i < 5;) {}`, pass: true },\n  cond_cont: { wgsl: `for (;v < 5; v++) {}`, pass: true },\n  init_cond_cont: { wgsl: `for (var i = 0; i < 5; i++) {}`, pass: true },\n  init_shadow: { wgsl: `for (var f = 0; f < 5; f++) {}`, pass: true },\n\n  no_semicolon: { wgsl: `for () { break; }`, pass: false },\n  one_semicolon: { wgsl: `for (;) { break; }`, pass: false },\n  no_paren: { wgsl: `for ;; { break; }`, pass: false },\n  empty: { wgsl: `for (;;) {}`, pass: false }, // note: fails due to behavior-analysis\n  init_expr: { wgsl: `for (true;;) { break; }`, pass: false },\n  cond_stmt: { wgsl: `for (;var i = 0;) { break; }`, pass: false },\n  cont_expr: { wgsl: `for (;;true) { break; }`, pass: false },\n  cont_var: { wgsl: `for (;;var i = 1) { break; }`, pass: false },\n  cont_var_type: { wgsl: `for (;;var i : i32 = 1) { break; }`, pass: false },\n  cont_var_function: { wgsl: `for (;;var<function> i = 1) { break; }`, pass: false },\n  cont_var_function_type: { wgsl: `for (;;var<function> i : i32 = 1) { break; }`, pass: false },\n  cont_let: { wgsl: `for (;;let i = 1) { break; }`, pass: false },\n  cont_let_type: { wgsl: `for (;;let i : u32 = 1) { break; }`, pass: false },\n};\n\ng.test('parse')\n  .desc(`Test that 'for' statements are parsed correctly.`)\n  .params(u => u.combine('test', keysOf(kTests)))\n  .fn(t => {\n    const code = `\nfn f() {\n  var v = 1;\n  ${kTests[t.params.test].wgsl}\n}\n\nfn x() {}\n`;\n    t.expectCompileResult(kTests[t.params.test].pass, code);\n  });\n"],"mappings":"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"}