{"version":3,"file":"loop.spec.js","names":["description","makeTestGroup","keysOf","ShaderValidationTest","kTestTypes","g","test","desc","params","u","combine","beforeAllSubcases","t","type","requires","selectDeviceOrSkipTestCase","fn","code","header","value","pass","expectCompileResult","kTests","break","wgsl","return","break_continuing","var_break","var_break_continuing_inc","var_break_continuing_discard","continuing_break_if","expr_break","loop","continuing_break","break_continuing_continue","break_continuing_return","break_continuing_if_break","break_continuing_if_return","break_continuing_lbrace","break_continuing_rbrace","continuing","semicolon","lbrace","rbrace","lparen","rparen","continue","discard","empty"],"sources":["../../../../../src/webgpu/shader/validation/statement/loop.spec.ts"],"sourcesContent":["export const description = `Validation tests for 'loop' statements'`;\n\nimport { makeTestGroup } from '../../../../common/framework/test_group.js';\nimport { keysOf } from '../../../../common/util/data_tables.js';\nimport { ShaderValidationTest } from '../shader_validation_test.js';\n\nimport { kTestTypes } from './test_types.js';\n\nexport const g = makeTestGroup(ShaderValidationTest);\n\ng.test('break_if_type')\n  .desc(`Tests that a 'break if' condition must be a bool type`)\n  .params(u => u.combine('type', keysOf(kTestTypes)))\n  .beforeAllSubcases(t => {\n    if (kTestTypes[t.params.type].requires === 'f16') {\n      t.selectDeviceOrSkipTestCase('shader-f16');\n    }\n  })\n  .fn(t => {\n    const type = kTestTypes[t.params.type];\n    const code = `\n${type.requires ? `enable ${type.requires};` : ''}\n\n${type.header ?? ''}\n\nfn f() {\n  loop {\n    continuing {\n      break if ${type.value};\n    }\n  }\n}\n`;\n\n    const pass = t.params.type === 'bool';\n    t.expectCompileResult(pass, code);\n  });\n\nconst kTests = {\n  break: { wgsl: `loop { break; }`, pass: true },\n  return: { wgsl: `loop { return; }`, pass: true },\n  break_continuing: { wgsl: `loop { break; continuing {} }`, pass: true },\n  var_break: { wgsl: `loop { var a = 1; break; }`, pass: true },\n  var_break_continuing_inc: {\n    wgsl: `loop { var a = 1; break; continuing { a += 1; }}`,\n    pass: true,\n  },\n  var_break_continuing_discard: {\n    wgsl: `loop { var a = 1; break; continuing { discard; }}`,\n    pass: true,\n  },\n  continuing_break_if: {\n    wgsl: `loop { continuing { break if true; } }`,\n    pass: true,\n  },\n\n  expr_break: { wgsl: `loop expr { break; }`, pass: false },\n  loop: { wgsl: `loop`, pass: false },\n  continuing_break: { wgsl: `loop { continuing {} break; }`, pass: false },\n  break_continuing_continue: { wgsl: `loop { break; continuing { continue; } }`, pass: false },\n  break_continuing_return: { wgsl: `loop { break; continuing { return; } }`, pass: false },\n  break_continuing_if_break: {\n    wgsl: `loop { break; continuing { if true { break; } }`,\n    pass: false,\n  },\n  break_continuing_if_return: {\n    wgsl: `loop { break; continuing { if true { return; } }`,\n    pass: false,\n  },\n  break_continuing_lbrace: { wgsl: `loop { break; continuing { }`, pass: false },\n  break_continuing_rbrace: { wgsl: `loop { break; continuing } }`, pass: false },\n  continuing: { wgsl: `loop { continuing {} }`, pass: false },\n  semicolon: { wgsl: `loop;`, pass: false },\n  lbrace: { wgsl: `loop {`, pass: false },\n  rbrace: { wgsl: `loop }`, pass: false },\n  lparen: { wgsl: `loop ({}`, pass: false },\n  rparen: { wgsl: `loop ){}`, pass: false },\n\n  // note: these parse, but fails due to behavior-analysis\n  continue: { wgsl: `loop { continue; }`, pass: false },\n  discard: { wgsl: `loop { discard; }`, pass: false },\n  empty: { wgsl: `loop{}`, pass: false },\n};\n\ng.test('parse')\n  .desc(`Test that 'loop' statements are parsed correctly.`)\n  .params(u => u.combine('test', keysOf(kTests)))\n  .fn(t => {\n    const code = `\nfn f() {\n  let expr = true;\n  ${kTests[t.params.test].wgsl}\n}`;\n    t.expectCompileResult(kTests[t.params.test].pass, code);\n  });\n"],"mappings":"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"}