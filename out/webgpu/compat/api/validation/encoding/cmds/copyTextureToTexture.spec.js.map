{"version":3,"file":"copyTextureToTexture.spec.js","names":["description","makeTestGroup","kAllTextureFormats","kCompressedTextureFormats","kTextureFormatInfo","CompatibilityTest","g","test","desc","params","u","combine","beforeAllSubcases","t","format","selectDeviceOrSkipTestCase","feature","fn","blockWidth","blockHeight","srcTexture","device","createTexture","size","usage","GPUTextureUsage","COPY_SRC","trackForCleanup","dstTexture","COPY_DST","encoder","createCommandEncoder","copyTextureToTexture","texture","expectGPUError","finish","beginSubcases","filter","info","multisample","skipIfTextureFormatNotSupported","sampleCount","RENDER_ATTACHMENT"],"sources":["../../../../../../../src/webgpu/compat/api/validation/encoding/cmds/copyTextureToTexture.spec.ts"],"sourcesContent":["export const description = `\nTests limitations of copyTextureToTextures in compat mode.\n`;\n\nimport { makeTestGroup } from '../../../../../../common/framework/test_group.js';\nimport {\n  kAllTextureFormats,\n  kCompressedTextureFormats,\n  kTextureFormatInfo,\n} from '../../../../../format_info.js';\nimport { CompatibilityTest } from '../../../../compatibility_test.js';\n\nexport const g = makeTestGroup(CompatibilityTest);\n\ng.test('compressed')\n  .desc(`Tests that you can not call copyTextureToTexture with compressed textures in compat mode.`)\n  .params(u => u.combine('format', kCompressedTextureFormats))\n  .beforeAllSubcases(t => {\n    const { format } = t.params;\n    t.selectDeviceOrSkipTestCase([kTextureFormatInfo[format].feature]);\n  })\n  .fn(t => {\n    const { format } = t.params;\n\n    const { blockWidth, blockHeight } = kTextureFormatInfo[format];\n\n    const srcTexture = t.device.createTexture({\n      size: [blockWidth, blockHeight, 1],\n      format,\n      usage: GPUTextureUsage.COPY_SRC,\n    });\n    t.trackForCleanup(srcTexture);\n\n    const dstTexture = t.device.createTexture({\n      size: [blockWidth, blockHeight, 1],\n      format,\n      usage: GPUTextureUsage.COPY_DST,\n    });\n    t.trackForCleanup(dstTexture);\n\n    const encoder = t.device.createCommandEncoder();\n    encoder.copyTextureToTexture({ texture: srcTexture }, { texture: dstTexture }, [\n      blockWidth,\n      blockHeight,\n      1,\n    ]);\n    t.expectGPUError('validation', () => {\n      encoder.finish();\n    });\n  });\n\ng.test('multisample')\n  .desc(`Test that you can not call copyTextureToTexture with multisample textures in compat mode.`)\n  .params(u =>\n    u\n      .beginSubcases()\n      .combine('format', kAllTextureFormats)\n      .filter(({ format }) => {\n        const info = kTextureFormatInfo[format];\n        return info.multisample && !info.feature;\n      })\n  )\n  .fn(t => {\n    const { format } = t.params;\n    const { blockWidth, blockHeight } = kTextureFormatInfo[format];\n\n    t.skipIfTextureFormatNotSupported(format as GPUTextureFormat);\n\n    const srcTexture = t.device.createTexture({\n      size: [blockWidth, blockHeight, 1],\n      format,\n      sampleCount: 4,\n      usage: GPUTextureUsage.COPY_SRC | GPUTextureUsage.RENDER_ATTACHMENT,\n    });\n    t.trackForCleanup(srcTexture);\n\n    const dstTexture = t.device.createTexture({\n      size: [blockWidth, blockHeight, 1],\n      format,\n      sampleCount: 4,\n      usage: GPUTextureUsage.COPY_DST | GPUTextureUsage.RENDER_ATTACHMENT,\n    });\n    t.trackForCleanup(dstTexture);\n\n    const encoder = t.device.createCommandEncoder();\n    encoder.copyTextureToTexture({ texture: srcTexture }, { texture: dstTexture }, [\n      blockWidth,\n      blockHeight,\n      1,\n    ]);\n    t.expectGPUError('validation', () => {\n      encoder.finish();\n    });\n  });\n"],"mappings":"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"}