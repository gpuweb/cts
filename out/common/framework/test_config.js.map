{"version":3,"file":"test_config.js","names":["assert","hasFeature","globalTestConfig","enableDebugLogs","maxSubcasesInFlight","subcasesBetweenAttemptingGC","casesBetweenReplacingDevice","Infinity","testHeartbeatCallback","noRaceWithRejectOnTimeout","unrollConstEvalLoops","compatibility","forceFallbackAdapter","enforceDefaultLimits","blockAllFeatures","logToWebSocket","isCompatibilityMode","features","isCompatibilityDevice","device"],"sources":["../../../src/common/framework/test_config.ts"],"sourcesContent":["import { assert, hasFeature } from '../util/util.js';\n\nexport type TestConfig = {\n  /**\n   * Enable debug-level logs (normally logged via `Fixture.debug()`).\n   */\n  enableDebugLogs: boolean;\n\n  /**\n   * Maximum number of subcases in flight at once, within a case. Once this many\n   * are in flight, wait for a subcase to finish before starting the next one.\n   */\n  maxSubcasesInFlight: number;\n\n  /**\n   * After this many subcases run on the page, run `attemptGarbageCollection()`.\n   * Setting to `Infinity` disables this. Setting to 1 attempts GC every time (slow!).\n   */\n  subcasesBetweenAttemptingGC: number;\n\n  /**\n   * After this many cases use a device, destroy and replace it to free GPU resources.\n   * Setting to `Infinity` disables this. Setting to 1 gets a new device every time (slow!).\n   */\n  casesBetweenReplacingDevice: number;\n\n  testHeartbeatCallback: () => void;\n\n  noRaceWithRejectOnTimeout: boolean;\n\n  /**\n   * Logger for debug messages from the test framework\n   * (that can't be captured in the logs of a test).\n   */\n  frameworkDebugLog?: (msg: string) => void;\n\n  /**\n   * Controls the emission of loops in constant-evaluation shaders under\n   * 'webgpu:shader,execution,expression,*'\n   * FXC is extremely slow to compile shaders with loops unrolled, where as the\n   * MSL compiler is extremely slow to compile with loops rolled.\n   */\n  unrollConstEvalLoops: boolean;\n\n  /**\n   * Whether or not we're running in compatibility mode.\n   */\n  compatibility: boolean;\n\n  /**\n   * Whether or not to request a fallback adapter.\n   */\n  forceFallbackAdapter: boolean;\n\n  /**\n   * Enforce the default limits on the adapter\n   */\n  enforceDefaultLimits: boolean;\n\n  /**\n   * Block all features on the adapter\n   */\n  blockAllFeatures: boolean;\n\n  /**\n   * Whether to enable the `logToWebSocket` function used for out-of-band test logging.\n   */\n  logToWebSocket: boolean;\n};\n\n/** Test configuration options. Globally modifiable global state. */\nexport const globalTestConfig: TestConfig = {\n  enableDebugLogs: false,\n  maxSubcasesInFlight: 100,\n  subcasesBetweenAttemptingGC: 5000,\n  casesBetweenReplacingDevice: Infinity,\n  testHeartbeatCallback: () => {},\n  noRaceWithRejectOnTimeout: false,\n  unrollConstEvalLoops: false,\n  compatibility: false,\n  forceFallbackAdapter: false,\n  enforceDefaultLimits: false,\n  blockAllFeatures: false,\n  logToWebSocket: false,\n};\n\n// Check if features has 'core-features-and-limits'.\n// Note: The CTS generally, requires that if globalTestConfig.compatibility\n// is true then the device MUST be a compatibility device since the CTS\n// is trying to test that compatibility devices have the correct validation.\nexport function isCompatibilityMode(features: GPUSupportedFeatures) {\n  if (globalTestConfig.compatibility) {\n    assert(!hasFeature(features, 'core-features-and-limits'));\n  }\n  return globalTestConfig.compatibility;\n}\n\n// Check if a device is a compatibility device.\n// Note: The CTS generally, requires that if globalTestConfig.compatibility\n// is true then the device MUST be a compatibility device since the CTS\n// is trying to test that compatibility devices have the correct validation.\nexport function isCompatibilityDevice(device: GPUDevice) {\n  return isCompatibilityMode(device.features);\n}\n"],"mappings":";;GAAA,SAASA,MAAM,EAAEC,UAAU,QAAQ,iBAAiB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAsEpD;AACA,OAAO,MAAMC,gBAA4B,GAAG;EAC1CC,eAAe,EAAE,KAAK;EACtBC,mBAAmB,EAAE,GAAG;EACxBC,2BAA2B,EAAE,IAAI;EACjCC,2BAA2B,EAAEC,QAAQ;EACrCC,qBAAqB,EAAEA,CAAA,KAAM,CAAC,CAAC;EAC/BC,yBAAyB,EAAE,KAAK;EAChCC,oBAAoB,EAAE,KAAK;EAC3BC,aAAa,EAAE,KAAK;EACpBC,oBAAoB,EAAE,KAAK;EAC3BC,oBAAoB,EAAE,KAAK;EAC3BC,gBAAgB,EAAE,KAAK;EACvBC,cAAc,EAAE;AAClB,CAAC;;AAED;AACA;AACA;AACA;AACA,OAAO,SAASC,mBAAmBA,CAACC,QAA8B,EAAE;EAClE,IAAIf,gBAAgB,CAACS,aAAa,EAAE;IAClCX,MAAM,CAAC,CAACC,UAAU,CAACgB,QAAQ,EAAE,0BAA0B,CAAC,CAAC;EAC3D;EACA,OAAOf,gBAAgB,CAACS,aAAa;AACvC;;AAEA;AACA;AACA;AACA;AACA,OAAO,SAASO,qBAAqBA,CAACC,MAAiB,EAAE;EACvD,OAAOH,mBAAmB,CAACG,MAAM,CAACF,QAAQ,CAAC;AAC7C"}