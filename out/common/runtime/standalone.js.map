{"version":3,"file":"standalone.js","names":["dataCache","getResourcePath","setBaseResourcePath","globalTestConfig","DefaultTestFileLoader","Logger","parseQuery","TestTree","setDefaultRequestAdapterOptions","unreachable","kCTSOptionsInfo","parseSearchParamLikeWithOptions","camelCaseToSnakeCase","TestDedicatedWorker","TestSharedWorker","TestServiceWorker","rootQuerySpec","promptBeforeReload","isFullCTS","frameworkDebugLog","console","log","window","onbeforeunload","undefined","kOpenTestLinkAltText","kStandaloneOptionsInfos","runnow","description","queries","qs","options","location","search","powerPreference","compatibility","forceFallbackAdapter","enableDebugLogs","debug","unrollConstEvalLoops","logToWebSocket","logger","testWorker","worker","autoCloseOnPass","document","getElementById","resultsVis","progressElem","progressTestNameElem","querySelector","stopButtonElem","runDepth","stopRequested","addEventListener","compatibilityMode","setStore","load","path","response","fetch","ok","Promise","reject","statusText","Uint8Array","arrayBuffer","emptySubtreeResult","pass","fail","warn","skip","total","timems","mergeSubtreeResults","results","target","result","memoize","fn","value","makeTreeNodeHTML","tree","parentLevel","subtree","makeSubtreeHTML","makeCaseHTML","generateMyHTML","parentElement","div","$","appendTo","generateSubtreeHTML","runSubtree","t","caseResult","clearRenderedResult","updateRenderedResult","name","query","toString","textContent","rec","res","record","run","status","classList","add","caselogs","addClass","hide","casehead","setChecked","makeTreeNodeHeaderHTML","checked","show","casetime","html","appendChild","removeAttribute","text","empty","setAttribute","toFixed","logs","filter","l","forEach","toJSON","caselog","attr","on","consoleLogError","n","subtreeResult","makeSubtreeChildrenHTML","children","values","level","runMySubtree","style","display","filePathParts","length","subtreeHTML","generateSubtree","header","firstElementChild","setChildrenChecked","childFns","Array","from","push","setChildChecked","e","globalThis","_stack","extra","onChange","isLeaf","lastNodeName","event","nodeName","preventDefault","prop","href","createSearchQuery","open","lastQueryLevelToExpand","runtext","showInfo","startTime","performance","now","dt","dtMinutes","removeClass","navigator","clipboard","writeText","testCreationStack","nodetitle","nodecolumns","select","val","subtreeCounts","countsToString","append","keyValueToPairs","k","v","key","isArray","map","prepareParams","params","pairsArrays","Object","entries","pairs","flat","URLSearchParams","optionsToRecord","q","join","msg","loader","updateURLsWithCurrentOptions","url","origin","pathname","history","replaceState","querySelectorAll","elem","a","getAll","addOptionsToPage","optionsInfos","optionsElem","optionValues","createCheckbox","optionName","createSelect","info","JSON","parse","currentValue","selectValueDescriptions","stringify","input","rootQuery","ev","data","loadTree","err","title","dissolveSingleChildTrees","root","setTreeCheckedRecursively","asJSON"],"sources":["../../../src/common/runtime/standalone.ts"],"sourcesContent":["// Implements the standalone test runner (see also: /standalone/index.html).\n\n/* eslint no-console: \"off\" */\n\nimport { dataCache } from '../framework/data_cache.js';\nimport { getResourcePath, setBaseResourcePath } from '../framework/resources.js';\nimport { globalTestConfig } from '../framework/test_config.js';\nimport { DefaultTestFileLoader } from '../internal/file_loader.js';\nimport { Logger } from '../internal/logging/logger.js';\nimport { LiveTestCaseResult } from '../internal/logging/result.js';\nimport { parseQuery } from '../internal/query/parseQuery.js';\nimport { TestQueryLevel } from '../internal/query/query.js';\nimport { TestTreeNode, TestSubtree, TestTreeLeaf, TestTree } from '../internal/tree.js';\nimport { setDefaultRequestAdapterOptions } from '../util/navigator_gpu.js';\nimport { ErrorWithExtra, unreachable } from '../util/util.js';\n\nimport {\n  kCTSOptionsInfo,\n  parseSearchParamLikeWithOptions,\n  CTSOptions,\n  OptionInfo,\n  OptionsInfos,\n  camelCaseToSnakeCase,\n} from './helper/options.js';\nimport { TestDedicatedWorker, TestSharedWorker, TestServiceWorker } from './helper/test_worker.js';\n\nconst rootQuerySpec = 'webgpu:*';\nlet promptBeforeReload = false;\nlet isFullCTS = false;\n\nglobalTestConfig.frameworkDebugLog = console.log;\n\nwindow.onbeforeunload = () => {\n  // Prompt user before reloading if there are any results\n  return promptBeforeReload ? false : undefined;\n};\n\nconst kOpenTestLinkAltText = 'Open';\n\ntype StandaloneOptions = CTSOptions & { runnow: OptionInfo };\n\nconst kStandaloneOptionsInfos: OptionsInfos<StandaloneOptions> = {\n  ...kCTSOptionsInfo,\n  runnow: { description: 'run immediately on load' },\n};\n\nconst { queries: qs, options } = parseSearchParamLikeWithOptions(\n  kStandaloneOptionsInfos,\n  window.location.search || rootQuerySpec\n);\nconst { runnow, powerPreference, compatibility, forceFallbackAdapter } = options;\nglobalTestConfig.enableDebugLogs = options.debug;\nglobalTestConfig.unrollConstEvalLoops = options.unrollConstEvalLoops;\nglobalTestConfig.compatibility = compatibility;\nglobalTestConfig.logToWebSocket = options.logToWebSocket;\n\nconst logger = new Logger();\n\nsetBaseResourcePath('../out/resources');\n\nconst testWorker =\n  options.worker === null\n    ? null\n    : options.worker === 'dedicated'\n    ? new TestDedicatedWorker(options)\n    : options.worker === 'shared'\n    ? new TestSharedWorker(options)\n    : options.worker === 'service'\n    ? new TestServiceWorker(options)\n    : unreachable();\n\nconst autoCloseOnPass = document.getElementById('autoCloseOnPass') as HTMLInputElement;\nconst resultsVis = document.getElementById('resultsVis')!;\nconst progressElem = document.getElementById('progress')!;\nconst progressTestNameElem = progressElem.querySelector('.progress-test-name')!;\nconst stopButtonElem = progressElem.querySelector('button')!;\nlet runDepth = 0;\nlet stopRequested = false;\n\nstopButtonElem.addEventListener('click', () => {\n  stopRequested = true;\n});\n\nif (powerPreference || compatibility || forceFallbackAdapter) {\n  setDefaultRequestAdapterOptions({\n    ...(powerPreference && { powerPreference }),\n    // MAINTENANCE_TODO: Change this to whatever the option ends up being\n    ...(compatibility && { compatibilityMode: true }),\n    ...(forceFallbackAdapter && { forceFallbackAdapter: true }),\n  });\n}\n\ndataCache.setStore({\n  load: async (path: string) => {\n    const response = await fetch(getResourcePath(`cache/${path}`));\n    if (!response.ok) {\n      return Promise.reject(response.statusText);\n    }\n    return new Uint8Array(await response.arrayBuffer());\n  },\n});\n\ninterface SubtreeResult {\n  pass: number;\n  fail: number;\n  warn: number;\n  skip: number;\n  total: number;\n  timems: number;\n}\n\nfunction emptySubtreeResult() {\n  return { pass: 0, fail: 0, warn: 0, skip: 0, total: 0, timems: 0 };\n}\n\nfunction mergeSubtreeResults(...results: SubtreeResult[]) {\n  const target = emptySubtreeResult();\n  for (const result of results) {\n    target.pass += result.pass;\n    target.fail += result.fail;\n    target.warn += result.warn;\n    target.skip += result.skip;\n    target.total += result.total;\n    target.timems += result.timems;\n  }\n  return target;\n}\n\ntype SetCheckedRecursively = () => void;\ntype GenerateSubtreeHTML = (parent: HTMLElement) => SetCheckedRecursively;\ntype RunSubtree = () => Promise<SubtreeResult>;\n\ninterface VisualizedSubtree {\n  generateSubtreeHTML: GenerateSubtreeHTML;\n  runSubtree: RunSubtree;\n}\n\n// DOM generation\n\nfunction memoize<T>(fn: () => T): () => T {\n  let value: T | undefined;\n  return () => {\n    if (value === undefined) {\n      value = fn();\n    }\n    return value;\n  };\n}\n\nfunction makeTreeNodeHTML(tree: TestTreeNode, parentLevel: TestQueryLevel): VisualizedSubtree {\n  let subtree: VisualizedSubtree;\n\n  if ('children' in tree) {\n    subtree = makeSubtreeHTML(tree, parentLevel);\n  } else {\n    subtree = makeCaseHTML(tree);\n  }\n\n  const generateMyHTML = (parentElement: HTMLElement) => {\n    const div = $('<div>').appendTo(parentElement)[0];\n    return subtree.generateSubtreeHTML(div);\n  };\n  return { runSubtree: subtree.runSubtree, generateSubtreeHTML: generateMyHTML };\n}\n\nfunction makeCaseHTML(t: TestTreeLeaf): VisualizedSubtree {\n  // Becomes set once the case has been run once.\n  let caseResult: LiveTestCaseResult | undefined;\n\n  // Becomes set once the DOM for this case exists.\n  let clearRenderedResult: (() => void) | undefined;\n  let updateRenderedResult: (() => void) | undefined;\n\n  const name = t.query.toString();\n  const runSubtree = async () => {\n    if (clearRenderedResult) clearRenderedResult();\n\n    const result: SubtreeResult = emptySubtreeResult();\n    progressTestNameElem.textContent = name;\n\n    const [rec, res] = logger.record(name);\n    caseResult = res;\n    if (testWorker) {\n      await testWorker.run(rec, name);\n    } else {\n      await t.run(rec);\n    }\n\n    result.total++;\n    result.timems += caseResult.timems;\n    switch (caseResult.status) {\n      case 'pass':\n        result.pass++;\n        break;\n      case 'fail':\n        result.fail++;\n        break;\n      case 'skip':\n        result.skip++;\n        break;\n      case 'warn':\n        result.warn++;\n        break;\n      default:\n        unreachable();\n    }\n\n    if (updateRenderedResult) updateRenderedResult();\n\n    return result;\n  };\n\n  const generateSubtreeHTML = (div: HTMLElement) => {\n    div.classList.add('testcase');\n\n    const caselogs = $('<div>').addClass('testcaselogs').hide();\n    const [casehead, setChecked] = makeTreeNodeHeaderHTML(t, runSubtree, 2, checked => {\n      checked ? caselogs.show() : caselogs.hide();\n    });\n    const casetime = $('<div>').addClass('testcasetime').html('ms').appendTo(casehead);\n    div.appendChild(casehead);\n    div.appendChild(caselogs[0]);\n\n    clearRenderedResult = () => {\n      div.removeAttribute('data-status');\n      casetime.text('ms');\n      caselogs.empty();\n    };\n\n    updateRenderedResult = () => {\n      if (caseResult) {\n        div.setAttribute('data-status', caseResult.status);\n\n        casetime.text(caseResult.timems.toFixed(4) + ' ms');\n\n        if (caseResult.logs) {\n          caselogs.empty();\n          // Show exceptions at the top since they are often unexpected can point out an error in the test itself vs the WebGPU implementation.\n          caseResult.logs\n            .filter(l => l.name === 'EXCEPTION')\n            .forEach(l => {\n              $('<pre>').addClass('testcaselogtext').text(l.toJSON()).appendTo(caselogs);\n            });\n          for (const l of caseResult.logs) {\n            const caselog = $('<div>').addClass('testcaselog').appendTo(caselogs);\n            $('<button>')\n              .addClass('testcaselogbtn')\n              .attr('alt', 'Log stack to console')\n              .attr('title', 'Log stack to console')\n              .appendTo(caselog)\n              .on('click', () => {\n                consoleLogError(l);\n              });\n            $('<pre>').addClass('testcaselogtext').appendTo(caselog).text(l.toJSON());\n          }\n        }\n      }\n    };\n\n    updateRenderedResult();\n\n    return setChecked;\n  };\n\n  return { runSubtree, generateSubtreeHTML };\n}\n\nfunction makeSubtreeHTML(n: TestSubtree, parentLevel: TestQueryLevel): VisualizedSubtree {\n  let subtreeResult: SubtreeResult = emptySubtreeResult();\n  // Becomes set once the DOM for this case exists.\n  let clearRenderedResult: (() => void) | undefined;\n  let updateRenderedResult: (() => void) | undefined;\n\n  const { runSubtree, generateSubtreeHTML } = makeSubtreeChildrenHTML(\n    n.children.values(),\n    n.query.level\n  );\n\n  const runMySubtree = async () => {\n    if (runDepth === 0) {\n      stopRequested = false;\n      progressElem.style.display = '';\n      // only prompt if this is the full CTS and we started from the root.\n      if (isFullCTS && n.query.filePathParts.length === 0) {\n        promptBeforeReload = true;\n      }\n    }\n    if (stopRequested) {\n      const result = emptySubtreeResult();\n      result.skip = 1;\n      result.total = 1;\n      return result;\n    }\n\n    ++runDepth;\n\n    if (clearRenderedResult) clearRenderedResult();\n    subtreeResult = await runSubtree();\n    if (updateRenderedResult) updateRenderedResult();\n\n    --runDepth;\n    if (runDepth === 0) {\n      progressElem.style.display = 'none';\n    }\n\n    return subtreeResult;\n  };\n\n  const generateMyHTML = (div: HTMLElement) => {\n    const subtreeHTML = $('<div>').addClass('subtreechildren');\n    const generateSubtree = memoize(() => generateSubtreeHTML(subtreeHTML[0]));\n\n    // Hide subtree - it's not generated yet.\n    subtreeHTML.hide();\n    const [header, setChecked] = makeTreeNodeHeaderHTML(n, runMySubtree, parentLevel, checked => {\n      if (checked) {\n        // Make sure the subtree is generated and then show it.\n        generateSubtree();\n        subtreeHTML.show();\n      } else {\n        subtreeHTML.hide();\n      }\n    });\n\n    div.classList.add('subtree');\n    div.classList.add(['', 'multifile', 'multitest', 'multicase'][n.query.level]);\n    div.appendChild(header);\n    div.appendChild(subtreeHTML[0]);\n\n    clearRenderedResult = () => {\n      div.removeAttribute('data-status');\n    };\n\n    updateRenderedResult = () => {\n      let status = '';\n      if (subtreeResult.pass > 0) {\n        status += 'pass';\n      }\n      if (subtreeResult.fail > 0) {\n        status += 'fail';\n      }\n      if (subtreeResult.skip === subtreeResult.total && subtreeResult.total > 0) {\n        status += 'skip';\n      }\n      div.setAttribute('data-status', status);\n      if (autoCloseOnPass.checked && status === 'pass') {\n        div.firstElementChild!.removeAttribute('open');\n      }\n    };\n\n    updateRenderedResult();\n\n    return () => {\n      setChecked();\n      const setChildrenChecked = generateSubtree();\n      setChildrenChecked();\n    };\n  };\n\n  return { runSubtree: runMySubtree, generateSubtreeHTML: generateMyHTML };\n}\n\nfunction makeSubtreeChildrenHTML(\n  children: Iterable<TestTreeNode>,\n  parentLevel: TestQueryLevel\n): VisualizedSubtree {\n  const childFns = Array.from(children, subtree => makeTreeNodeHTML(subtree, parentLevel));\n\n  const runMySubtree = async () => {\n    const results: SubtreeResult[] = [];\n    for (const { runSubtree } of childFns) {\n      if (stopRequested) {\n        break;\n      }\n      results.push(await runSubtree());\n    }\n    return mergeSubtreeResults(...results);\n  };\n  const generateMyHTML = (div: HTMLElement) => {\n    const setChildrenChecked = Array.from(childFns, ({ generateSubtreeHTML }) =>\n      generateSubtreeHTML(div)\n    );\n\n    return () => {\n      for (const setChildChecked of setChildrenChecked) {\n        setChildChecked();\n      }\n    };\n  };\n\n  return { runSubtree: runMySubtree, generateSubtreeHTML: generateMyHTML };\n}\n\nfunction consoleLogError(e: Error | ErrorWithExtra | undefined) {\n  if (e === undefined) return;\n  /* eslint-disable-next-line @typescript-eslint/no-explicit-any */\n  (globalThis as any)._stack = e;\n  console.log('_stack =', e);\n  if ('extra' in e && e.extra !== undefined) {\n    console.log('_stack.extra =', e.extra);\n  }\n}\n\nfunction makeTreeNodeHeaderHTML(\n  n: TestTreeNode,\n  runSubtree: RunSubtree,\n  parentLevel: TestQueryLevel,\n  onChange: (checked: boolean) => void\n): [HTMLElement, SetCheckedRecursively] {\n  const isLeaf = 'run' in n;\n  const div = $('<details>').addClass('nodeheader');\n  const header = $('<summary>').appendTo(div);\n\n  // prevent toggling if user is selecting text from an input element\n  {\n    let lastNodeName = '';\n    div.on('pointerdown', event => {\n      lastNodeName = event.target.nodeName;\n    });\n    div.on('click', event => {\n      if (lastNodeName === 'INPUT') {\n        event.preventDefault();\n      }\n    });\n  }\n\n  const setChecked = () => {\n    div.prop('open', true); // (does not fire onChange)\n    onChange(true);\n  };\n\n  const href = createSearchQuery([n.query.toString()]);\n  if (onChange) {\n    div.on('toggle', function (this) {\n      onChange((this as HTMLDetailsElement).open);\n    });\n\n    // Expand the shallower parts of the tree at load.\n    // Also expand completely within subtrees that are at the same query level\n    // (e.g. s:f:t,* and s:f:t,t,*).\n    if (n.query.level <= lastQueryLevelToExpand || n.query.level === parentLevel) {\n      setChecked();\n    }\n  }\n  const runtext = isLeaf ? 'Run case' : 'Run subtree';\n  $('<button>')\n    .addClass(isLeaf ? 'leafrun' : 'subtreerun')\n    .attr('alt', runtext)\n    .attr('title', runtext)\n    .on('click', async () => {\n      if (runDepth > 0) {\n        showInfo('tests are already running');\n        return;\n      }\n      showInfo('');\n      console.log(`Starting run for ${n.query}`);\n      // turn off all run buttons\n      $('#resultsVis').addClass('disable-run');\n      const startTime = performance.now();\n      await runSubtree();\n      const dt = performance.now() - startTime;\n      const dtMinutes = dt / 1000 / 60;\n      // turn on all run buttons\n      $('#resultsVis').removeClass('disable-run');\n      console.log(`Finished run: ${dt.toFixed(1)} ms = ${dtMinutes.toFixed(1)} min`);\n    })\n    .appendTo(header);\n  $('<a>')\n    .addClass('nodelink')\n    .attr('href', href)\n    .attr('alt', kOpenTestLinkAltText)\n    .attr('title', kOpenTestLinkAltText)\n    .appendTo(header);\n  $('<button>')\n    .addClass('copybtn')\n    .attr('alt', 'copy query')\n    .attr('title', 'copy query')\n    .on('click', () => {\n      void navigator.clipboard.writeText(n.query.toString());\n    })\n    .appendTo(header);\n  if ('testCreationStack' in n && n.testCreationStack) {\n    $('<button>')\n      .addClass('testcaselogbtn')\n      .attr('alt', 'Log test creation stack to console')\n      .attr('title', 'Log test creation stack to console')\n      .appendTo(header)\n      .on('click', () => {\n        consoleLogError(n.testCreationStack);\n      });\n  }\n  const nodetitle = $('<div>').addClass('nodetitle').appendTo(header);\n  const nodecolumns = $('<span>').addClass('nodecolumns').appendTo(nodetitle);\n  {\n    $('<input>')\n      .attr('type', 'text')\n      .attr('title', n.query.toString())\n      .prop('readonly', true)\n      .addClass('nodequery')\n      .on('click', event => {\n        (event.target as HTMLInputElement).select();\n      })\n      .val(n.query.toString())\n      .appendTo(nodecolumns);\n    if (n.subtreeCounts) {\n      $('<span>')\n        .attr('title', '(Nodes with TODOs) / (Total test count)')\n        .text(TestTree.countsToString(n))\n        .appendTo(nodecolumns);\n    }\n  }\n  if ('description' in n && n.description) {\n    nodetitle.append('&nbsp;');\n    $('<pre>') //\n      .addClass('nodedescription')\n      .text(n.description)\n      .appendTo(header);\n  }\n  return [div[0], setChecked];\n}\n\n// Collapse s:f:t:* or s:f:t:c by default.\nlet lastQueryLevelToExpand: TestQueryLevel = 2;\n\n/**\n * Takes an array of string, ParamValue and returns an array of pairs\n * of [key, value] where value is a string. Converts boolean to '0' or '1'.\n */\nfunction keyValueToPairs([k, v]: [string, boolean | string | null]): [string, string][] {\n  const key = camelCaseToSnakeCase(k);\n  if (typeof v === 'boolean') {\n    return [[key, v ? '1' : '0']];\n  } else if (Array.isArray(v)) {\n    return v.map(v => [key, v]);\n  } else {\n    return [[key, v!.toString()]];\n  }\n}\n\n/**\n * Converts key value pairs to a search string.\n * Keys will appear in order in the search string.\n * Values can be undefined, null, boolean, string, or string[]\n * If the value is falsy the key will not appear in the search string.\n * If the value is an array the key will appear multiple times.\n *\n * @param params Some object with key value pairs.\n * @returns a search string.\n */\nfunction prepareParams(params: Record<string, boolean | string | null>): string {\n  const pairsArrays = Object.entries(params)\n    .filter(([, v]) => !(v === false || v === null || v === '0'))\n    .map(keyValueToPairs);\n  const pairs = pairsArrays.flat();\n  return new URLSearchParams(pairs).toString();\n}\n\n// This is just a cast in one place.\nexport function optionsToRecord(options: CTSOptions) {\n  return options as unknown as Record<string, boolean | string | null>;\n}\n\n/**\n * Given a search query, generates a search parameter string\n * @param queries array of queries\n * @param params an optional existing search\n * @returns a search query string\n */\nfunction createSearchQuery(queries: string[], params?: string) {\n  params = params === undefined ? prepareParams(optionsToRecord(options)) : params;\n  // Add in q separately to avoid escaping punctuation marks.\n  return `?${params}${params ? '&' : ''}${queries.map(q => 'q=' + q).join('&')}`;\n}\n\n/**\n * Show an info message on the page.\n * @param msg Message to show\n */\nfunction showInfo(msg: string) {\n  $('#info')[0].textContent = msg;\n}\n\nvoid (async () => {\n  const loader = new DefaultTestFileLoader();\n\n  // MAINTENANCE_TODO: start populating page before waiting for everything to load?\n  isFullCTS = qs.length === 1 && qs[0] === rootQuerySpec;\n\n  // Update the URL bar to match the exact current options.\n  const updateURLsWithCurrentOptions = () => {\n    const params = prepareParams(optionsToRecord(options));\n    let url = `${window.location.origin}${window.location.pathname}`;\n    url += createSearchQuery(qs, params);\n    window.history.replaceState(null, '', url.toString());\n    document.querySelectorAll(`a[alt=${kOpenTestLinkAltText}]`).forEach(elem => {\n      const a = elem as HTMLAnchorElement;\n      const qs = new URLSearchParams(a.search).getAll('q');\n      a.search = createSearchQuery(qs, params);\n    });\n  };\n\n  const addOptionsToPage = (\n    options: StandaloneOptions,\n    optionsInfos: typeof kStandaloneOptionsInfos\n  ) => {\n    const optionsElem = $('table#options>tbody')[0];\n    const optionValues = optionsToRecord(options);\n\n    const createCheckbox = (optionName: string) => {\n      return $(`<input>`)\n        .attr('type', 'checkbox')\n        .prop('checked', optionValues[optionName] as boolean)\n        .on('change', function () {\n          optionValues[optionName] = (this as HTMLInputElement).checked;\n          updateURLsWithCurrentOptions();\n        });\n    };\n\n    const createSelect = (optionName: string, info: OptionInfo) => {\n      const select = $('<select>').on('change', function (this: HTMLSelectElement) {\n        optionValues[optionName] = JSON.parse(this.value);\n        updateURLsWithCurrentOptions();\n      });\n      const currentValue = optionValues[optionName];\n      for (const { value, description } of info.selectValueDescriptions!) {\n        $('<option>')\n          .text(description)\n          .val(JSON.stringify(value))\n          .prop('selected', value === currentValue)\n          .appendTo(select);\n      }\n      return select;\n    };\n\n    for (const [optionName, info] of Object.entries(optionsInfos)) {\n      const input =\n        typeof optionValues[optionName] === 'boolean'\n          ? createCheckbox(optionName)\n          : createSelect(optionName, info);\n      $('<tr>')\n        .append($('<td>').append(input))\n        .append($('<td>').text(camelCaseToSnakeCase(optionName)))\n        .append($('<td>').text(info.description))\n        .appendTo(optionsElem);\n    }\n  };\n  addOptionsToPage(options, kStandaloneOptionsInfos);\n\n  if (qs.length !== 1) {\n    showInfo('currently, there must be exactly one ?q=');\n    return;\n  }\n\n  let rootQuery;\n  try {\n    rootQuery = parseQuery(qs[0]);\n  } catch (e) {\n    showInfo((e as Error).toString());\n    return;\n  }\n\n  if (rootQuery.level > lastQueryLevelToExpand) {\n    lastQueryLevelToExpand = rootQuery.level;\n  }\n  loader.addEventListener('import', ev => {\n    showInfo(`loading: ${ev.data.url}`);\n  });\n  loader.addEventListener('imported', ev => {\n    showInfo(`imported: ${ev.data.url}`);\n  });\n  loader.addEventListener('finish', () => {\n    showInfo('');\n  });\n\n  let tree;\n  try {\n    tree = await loader.loadTree(rootQuery);\n  } catch (err) {\n    showInfo((err as Error).toString());\n    return;\n  }\n\n  document.title = `${document.title} ${compatibility ? '(compat)' : ''} - ${rootQuery.toString()}`;\n\n  tree.dissolveSingleChildTrees();\n\n  const { runSubtree, generateSubtreeHTML } = makeSubtreeHTML(tree.root, 1);\n  const setTreeCheckedRecursively = generateSubtreeHTML(resultsVis);\n\n  document.getElementById('expandall')!.addEventListener('click', () => {\n    setTreeCheckedRecursively();\n  });\n\n  document.getElementById('copyResultsJSON')!.addEventListener('click', () => {\n    void navigator.clipboard.writeText(logger.asJSON(2));\n  });\n\n  if (runnow) {\n    void runSubtree();\n  }\n})();\n"],"mappings":"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"}