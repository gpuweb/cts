{"version":3,"file":"gen_listings.js","names":["fs","path","process","crawl","usage","rc","console","error","exit","argv","indexOf","i","splice","length","myself","outDir","suiteDir","slice","then","listing","suite","basename","outFile","normalize","join","mkdirSync","recursive","writeFileSync","JSON","stringify","undefined"],"sources":["../../../src/common/tools/gen_listings.ts"],"sourcesContent":["import * as fs from 'fs';\nimport * as path from 'path';\nimport * as process from 'process';\n\nimport { crawl } from './crawl.js';\n\nfunction usage(rc: number): void {\n  console.error(`Usage: tools/gen_listings [options] [OUT_DIR] [SUITE_DIRS...]\n\nFor each suite in SUITE_DIRS, generate listings and write each listing.js\ninto OUT_DIR/{suite}/listing.js. Example:\n  tools/gen_listings gen/ src/unittests/ src/webgpu/\n\nOptions:\n  --help          Print this message and exit.\n`);\n  process.exit(rc);\n}\n\nconst argv = process.argv;\nif (argv.indexOf('--help') !== -1) {\n  usage(0);\n}\n\n{\n  // Ignore old argument that is now the default\n  const i = argv.indexOf('--no-validate');\n  if (i !== -1) {\n    argv.splice(i, 1);\n  }\n}\n\nif (argv.length < 4) {\n  usage(0);\n}\n\nconst myself = 'src/common/tools/gen_listings.ts';\n\nconst outDir = argv[2];\n\nfor (const suiteDir of argv.slice(3)) {\n  // Run concurrently for each suite (might be a tiny bit more efficient)\n  void crawl(suiteDir).then(listing => {\n    const suite = path.basename(suiteDir);\n    const outFile = path.normalize(path.join(outDir, `${suite}/listing.js`));\n    fs.mkdirSync(path.join(outDir, suite), { recursive: true });\n    fs.writeFileSync(\n      outFile,\n      `\\\n// AUTO-GENERATED - DO NOT EDIT. See ${myself}.\n\nexport const listing = ${JSON.stringify(listing, undefined, 2)};\n`\n    );\n  });\n}\n"],"mappings":";;GAAA,OAAO,KAAKA,EAAE,MAAM,IAAI,CACxB,OAAO,KAAKC,IAAI,MAAM,MAAM,CAC5B,OAAO,KAAKC,OAAO,MAAM,SAAS;;AAElC,SAASC,KAAK,QAAQ,YAAY;;AAElC,SAASC,KAAKA,CAACC,EAAU,EAAQ;EAC/BC,OAAO,CAACC,KAAK,CAAE;AACjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC,CAAC;EACAL,OAAO,CAACM,IAAI,CAACH,EAAE,CAAC;AAClB;;AAEA,MAAMI,IAAI,GAAGP,OAAO,CAACO,IAAI;AACzB,IAAIA,IAAI,CAACC,OAAO,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC,EAAE;EACjCN,KAAK,CAAC,CAAC,CAAC;AACV;;AAEA;EACE;EACA,MAAMO,CAAC,GAAGF,IAAI,CAACC,OAAO,CAAC,eAAe,CAAC;EACvC,IAAIC,CAAC,KAAK,CAAC,CAAC,EAAE;IACZF,IAAI,CAACG,MAAM,CAACD,CAAC,EAAE,CAAC,CAAC;EACnB;AACF;;AAEA,IAAIF,IAAI,CAACI,MAAM,GAAG,CAAC,EAAE;EACnBT,KAAK,CAAC,CAAC,CAAC;AACV;;AAEA,MAAMU,MAAM,GAAG,kCAAkC;;AAEjD,MAAMC,MAAM,GAAGN,IAAI,CAAC,CAAC,CAAC;;AAEtB,KAAK,MAAMO,QAAQ,IAAIP,IAAI,CAACQ,KAAK,CAAC,CAAC,CAAC,EAAE;EACpC;EACA,KAAKd,KAAK,CAACa,QAAQ,CAAC,CAACE,IAAI,CAAC,CAAAC,OAAO,KAAI;IACnC,MAAMC,KAAK,GAAGnB,IAAI,CAACoB,QAAQ,CAACL,QAAQ,CAAC;IACrC,MAAMM,OAAO,GAAGrB,IAAI,CAACsB,SAAS,CAACtB,IAAI,CAACuB,IAAI,CAACT,MAAM,EAAG,GAAEK,KAAM,aAAY,CAAC,CAAC;IACxEpB,EAAE,CAACyB,SAAS,CAACxB,IAAI,CAACuB,IAAI,CAACT,MAAM,EAAEK,KAAK,CAAC,EAAE,EAAEM,SAAS,EAAE,IAAI,CAAC,CAAC,CAAC;IAC3D1B,EAAE,CAAC2B,aAAa;MACdL,OAAO;MACN;AACP,uCAAuCR,MAAO;AAC9C;AACA,yBAAyBc,IAAI,CAACC,SAAS,CAACV,OAAO,EAAEW,SAAS,EAAE,CAAC,CAAE;AAC/D;IACI,CAAC;EACH,CAAC,CAAC;AACJ"}