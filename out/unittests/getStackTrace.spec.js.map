{"version":3,"sources":["../../src/unittests/getStackTrace.spec.ts"],"names":["description","makeTestGroup","extractImportantStackTrace","UnitTest","g","test","paramsSimple","case","_expectedLines","_stack","fn","t","ex","Error","stack","params","expect","stringified","parts","split","length","last","indexOf"],"mappings":"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","sourcesContent":["export const description = `\nTests for getStackTrace.\n`;\n\nimport { makeTestGroup } from '../common/framework/test_group.js';\nimport { extractImportantStackTrace } from '../common/internal/stack.js';\n\nimport { UnitTest } from './unit_test.js';\n\nexport const g = makeTestGroup(UnitTest);\n\ng.test('stacks')\n  .paramsSimple([\n    {\n      case: 'node_fail',\n      _expectedLines: 3,\n      _stack: `Error:\n   at CaseRecorder.fail (/Users/kainino/src/cts/src/common/framework/logger.ts:99:30)\n   at RunCaseSpecific.exports.g.test.t [as fn] (/Users/kainino/src/cts/src/unittests/logger.spec.ts:80:7)\n   at RunCaseSpecific.run (/Users/kainino/src/cts/src/common/framework/test_group.ts:121:18)\n   at processTicksAndRejections (internal/process/task_queues.js:86:5)`,\n    },\n    {\n      // MAINTENANCE_TODO: make sure this test case actually matches what happens on windows\n      case: 'node_fail_backslash',\n      _expectedLines: 3,\n      _stack: `Error:\n   at CaseRecorder.fail (C:\\\\Users\\\\kainino\\\\src\\\\cts\\\\src\\\\common\\\\framework\\\\logger.ts:99:30)\n   at RunCaseSpecific.exports.g.test.t [as fn] (C:\\\\Users\\\\kainino\\\\src\\\\cts\\\\src\\\\unittests\\\\logger.spec.ts:80:7)\n   at RunCaseSpecific.run (C:\\\\Users\\\\kainino\\\\src\\\\cts\\\\src\\\\common\\\\framework\\\\test_group.ts:121:18)\n   at processTicksAndRejections (internal\\\\process\\\\task_queues.js:86:5)`,\n    },\n    {\n      case: 'node_fail_processTicksAndRejections',\n      _expectedLines: 5,\n      _stack: `Error: expectation had no effect: suite1:foo:\n    at Object.generateMinimalQueryList (/Users/kainino/src/cts/src/common/framework/generate_minimal_query_list.ts:72:24)\n    at testGenerateMinimalQueryList (/Users/kainino/src/cts/src/unittests/loading.spec.ts:289:25)\n    at processTicksAndRejections (internal/process/task_queues.js:93:5)\n    at RunCaseSpecific.fn (/Users/kainino/src/cts/src/unittests/loading.spec.ts:300:3)\n    at RunCaseSpecific.run (/Users/kainino/src/cts/src/common/framework/test_group.ts:144:9)\n    at /Users/kainino/src/cts/src/common/runtime/cmdline.ts:62:25\n    at async Promise.all (index 29)\n    at /Users/kainino/src/cts/src/common/runtime/cmdline.ts:78:5`,\n    },\n    {\n      case: 'node_throw',\n      _expectedLines: 2,\n      _stack: `Error: hello\n    at RunCaseSpecific.g.test.t [as fn] (/Users/kainino/src/cts/src/unittests/test_group.spec.ts:51:11)\n    at RunCaseSpecific.run (/Users/kainino/src/cts/src/common/framework/test_group.ts:121:18)\n    at processTicksAndRejections (internal/process/task_queues.js:86:5)`,\n    },\n    {\n      case: 'firefox_fail',\n      _expectedLines: 3,\n      _stack: `fail@http://localhost:8080/out/common/framework/logger.js:104:30\nexpect@http://localhost:8080/out/common/framework/default_fixture.js:59:16\n@http://localhost:8080/out/unittests/util.spec.js:35:5\nrun@http://localhost:8080/out/common/framework/test_group.js:119:18`,\n    },\n    {\n      case: 'firefox_throw',\n      _expectedLines: 1,\n      _stack: `@http://localhost:8080/out/unittests/test_group.spec.js:48:11\nrun@http://localhost:8080/out/common/framework/test_group.js:119:18`,\n    },\n    {\n      case: 'safari_fail',\n      _expectedLines: 3,\n      _stack: `fail@http://localhost:8080/out/common/framework/logger.js:104:39\nexpect@http://localhost:8080/out/common/framework/default_fixture.js:59:20\nhttp://localhost:8080/out/unittests/util.spec.js:35:11\nhttp://localhost:8080/out/common/framework/test_group.js:119:20\nasyncFunctionResume@[native code]\n[native code]\npromiseReactionJob@[native code]`,\n    },\n    {\n      case: 'safari_throw',\n      _expectedLines: 1,\n      _stack: `http://localhost:8080/out/unittests/test_group.spec.js:48:20\nhttp://localhost:8080/out/common/framework/test_group.js:119:20\nasyncFunctionResume@[native code]\n[native code]\npromiseReactionJob@[native code]`,\n    },\n    {\n      case: 'chrome_fail',\n      _expectedLines: 4,\n      _stack: `Error\n    at CaseRecorder.fail (http://localhost:8080/out/common/framework/logger.js:104:30)\n    at DefaultFixture.expect (http://localhost:8080/out/common/framework/default_fixture.js:59:16)\n    at RunCaseSpecific.fn (http://localhost:8080/out/unittests/util.spec.js:35:5)\n    at RunCaseSpecific.run (http://localhost:8080/out/common/framework/test_group.js:119:18)\n    at async runCase (http://localhost:8080/out/common/runtime/standalone.js:37:17)\n    at async http://localhost:8080/out/common/runtime/standalone.js:102:7`,\n    },\n    {\n      case: 'chrome_throw',\n      _expectedLines: 6,\n      _stack: `Error: hello\n    at RunCaseSpecific.fn (http://localhost:8080/out/unittests/test_group.spec.js:48:11)\n    at RunCaseSpecific.run (http://localhost:8080/out/common/framework/test_group.js:119:18)\"\n    at async Promise.all (index 0)\n    at async TestGroupTest.run (http://localhost:8080/out/unittests/test_group_test.js:6:5)\n    at async RunCaseSpecific.fn (http://localhost:8080/out/unittests/test_group.spec.js:53:15)\n    at async RunCaseSpecific.run (http://localhost:8080/out/common/framework/test_group.js:119:7)\n    at async runCase (http://localhost:8080/out/common/runtime/standalone.js:37:17)\n    at async http://localhost:8080/out/common/runtime/standalone.js:102:7`,\n    },\n    {\n      case: 'multiple_lines',\n      _expectedLines: 8,\n      _stack: `Error: hello\n    at RunCaseSpecific.fn (http://localhost:8080/out/unittests/test_group.spec.js:48:11)\n    at RunCaseSpecific.fn (http://localhost:8080/out/unittests/test_group.spec.js:48:11)\n    at RunCaseSpecific.fn (http://localhost:8080/out/unittests/test_group.spec.js:48:11)\n    at RunCaseSpecific.run (http://localhost:8080/out/common/framework/test_group.js:119:18)\"\n    at async Promise.all (index 0)\n    at async TestGroupTest.run (http://localhost:8080/out/unittests/test_group_test.js:6:5)\n    at async RunCaseSpecific.fn (http://localhost:8080/out/unittests/test_group.spec.js:53:15)\n    at async RunCaseSpecific.run (http://localhost:8080/out/common/framework/test_group.js:119:7)\n    at async runCase (http://localhost:8080/out/common/runtime/standalone.js:37:17)\n    at async http://localhost:8080/out/common/runtime/standalone.js:102:7`,\n    },\n  ])\n  .fn(t => {\n    const ex = new Error();\n    ex.stack = t.params._stack;\n    t.expect(ex.stack === t.params._stack);\n    const stringified = extractImportantStackTrace(ex);\n    const parts = stringified.split('\\n');\n\n    t.expect(parts.length === t.params._expectedLines);\n    const last = parts[parts.length - 1];\n    t.expect(last.indexOf('/unittests/') !== -1 || last.indexOf('\\\\unittests\\\\') !== -1);\n  });\n"],"file":"getStackTrace.spec.js"}